!function(w,C,I){"use strict";function l(z,q){if("function"!=typeof q&&null!==q)throw new TypeError("Super expression must either be null or a function");z.prototype=C.create(q&&q.prototype,{constructor:{value:z,writable:!0,configurable:!0}}),q&&rj(z,q)}function Z(d){var c=C.prototype.toString.call(d);return"Array]"===c.substring(c.length-6)}function t(B,K,O,_,D,z){K=K||[],O=O||[],_=_||[];try{K.push(B);var w=Function.apply(0,K);return O[O.length]="return "+w,Function.apply(0,O).apply(0,_)}catch(Z){return z&&z(Z),D}}function d(u){var Y={};return{get:function($){if(Y[$]!==I)return Y[$];var H;switch($){case"WEBGL_depth_texture":H=u.getExtension("WEBGL_depth_texture")||u.getExtension("MOZ_WEBGL_depth_texture")||u.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":H=u.getExtension("EXT_texture_filter_anisotropic")||u.getExtension("MOZ_EXT_texture_filter_anisotropic")||u.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":H=u.getExtension("WEBGL_compressed_texture_s3tc")||u.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||u.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":H=u.getExtension("WEBGL_compressed_texture_pvrtc")||u.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case"WEBGL_compressed_texture_etc1":H=u.getExtension("WEBGL_compressed_texture_etc1");break;default:H=u.getExtension($)}return Y[$]=H,H}}}function m(E,H,y){function K(){if(s!==I)return s;var u=H.get("EXT_texture_filter_anisotropic");return s=null!==u?E.getParameter(u.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}function n(m){if("highp"===m){if(E.getShaderPrecisionFormat(E.VERTEX_SHADER,E.HIGH_FLOAT).precision>0&&E.getShaderPrecisionFormat(E.FRAGMENT_SHADER,E.HIGH_FLOAT).precision>0)return"highp";m="mediump"}return"mediump"===m&&E.getShaderPrecisionFormat(E.VERTEX_SHADER,E.MEDIUM_FLOAT).precision>0&&E.getShaderPrecisionFormat(E.FRAGMENT_SHADER,E.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}var s;y=y||{};var A="undefined"!=typeof WebGL2RenderingContext&&E instanceof WebGL2RenderingContext,D=y.precision!==I?y.precision:"highp",R=n(D);R!==D&&(console.warn("WebGL:",D,"not supported, using",R,"instead."),D=R);var J,W=y.logarithmicDepthBuffer===!0,F=E.getParameter(E.MAX_TEXTURE_IMAGE_UNITS),O=E.getParameter(E.MAX_VERTEX_TEXTURE_IMAGE_UNITS),_=E.getParameter(E.MAX_TEXTURE_SIZE),r=E.getParameter(E.MAX_CUBE_MAP_TEXTURE_SIZE),x=E.getParameter(E.MAX_VERTEX_ATTRIBS),b=E.getParameter(E.MAX_VERTEX_UNIFORM_VECTORS),d=E.getParameter(E.MAX_VARYING_VECTORS),X=E.getParameter(E.MAX_FRAGMENT_UNIFORM_VECTORS),l=O>0,S=A||!!H.get("OES_texture_float"),k=(A||!!H.get("OES_element_index_uint"))&&"undefined"!=typeof Uint32Array,u=l&&S,Y=A?E.getParameter(E.MAX_SAMPLES):0,M=!1;return A?M=!0:(J=H.get("ANGLE_instanced_arrays"))&&(M=!0,E.vertexAttribDivisor=function($,A){return J.vertexAttribDivisorANGLE($,A)},E.drawElementsInstanced=function(E,M,y,P,T){return J.drawElementsInstancedANGLE(E,M,y,P,T)},E.drawArraysInstanced=function($,D,G,I){return J.drawArraysInstancedANGLE($,D,G,I)}),{getMaxAnisotropy:K,getMaxPrecision:n,precision:D,logarithmicDepthBuffer:W,maxTextures:F,maxVertexTextures:O,maxTextureSize:_,maxCubemapSize:r,maxAttributes:x,maxVertexUniforms:b,maxVaryings:d,maxFragmentUniforms:X,vertexTextures:l,floatFragmentTextures:S,elementTypeUint:k,floatVertexTextures:u,maxSamples:Y,instancedArray:M}}function L(j,q){return j.z!==q.z?q.z-j.z:j.id-q.id}var D="ht";if(!w[D]){!function(){Date.now&&Date.prototype.getTime||(Date.now=function(){return(new Date).getTime()}),w.performance&&w.performance.now||function(){var p=Date.now();w.performance||(w.performance={}),w.performance.now=function(){return Date.now()-p}}();for(var t=Date.now(),P=16,K=["ms","moz","webkit","o"],N=0;N<K.length&&!w.requestAnimationFrame;++N)w.requestAnimationFrame=w[K[N]+"RequestAnimationFrame"],w.cancelAnimationFrame=w[K[N]+"CancelAnimationFrame"]||w[K[N]+"CancelRequestAnimationFrame"];w.requestAnimationFrame||(w.requestAnimationFrame=function(E){var $=Date.now(),x=P+t-$;return 0>x&&(x=0),t=$,w.setTimeout(function(){t=Date.now(),E(performance.now())},x)}),w.cancelAnimationFrame||(w.cancelAnimationFrame=function(Z){return w.clearTimeout(Z)}),C.assign===I&&(C.assign=function(y){if(y===I||null===y)throw new TypeError("Cannot convert undefined or null to object");for(var Y=C(y),k=1;k<arguments.length;k++){var t=arguments[k];if(t!==I&&null!==t)for(var R in t)C.prototype.hasOwnProperty.call(t,R)&&(Y[R]=t[R])}return Y}),w.btoa===I&&(w.btoa=function(n){for(var W,w,O=String(n),M=0,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",E="";O.charAt(0|M)||(s="=",M%1);E+=s.charAt(63&W>>8-8*(M%1))){if(w=O.charCodeAt(M+=.75),w>255)throw new Error("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");W=W<<8|w}return E})}();var b,j,x,R,$=w.location,H=$&&w.document,N=null,k=I,y=w[D]={},z=w[D+"config"],F=y.Default=z&&z.Default||{},O=y.Style=z&&z.Style||{},r=y.Attr=z&&z.Attr||{},P=function(){return!0},i=function(){return!1},a=function(c){return c},e=function(g){return!g},B=y.Color=z&&z.Color||{},v=y.IsGetter=z&&z.IsGetter||{};!function(){var t=!1;try{var k=C.defineProperty({},"passive",{get:function(){return t=!0,I}});$&&(x=b=$)&&w.addEventListener("test",k,k),$&&(R=j=$)&&w.removeEventListener("test",k,k)}catch(r){t=!1}F.passiveSupported=t}();var K,Q,E,o,A=F.passiveSupported,M=F.eventListenerOptionsFalse=A?{passive:!1,capture:!1}:!1,X=F.eventListenerOptionsTrue=A?{passive:!1,capture:!0}:!0,q=function(m,H,u,f){m.addEventListener(H,u,f?X:M)},V=function(B,y,m,u){B.removeEventListener(y,m,u?X:M)},S=Math,c=S.round,g=S.floor,p=S.ceil,U=S.sqrt,n=S.max,J=S.min,u=S.abs,s=S.cos,_=S.acos,W=S.sin,T=S.pow,Y=S.asin,h=S.exp,G=S.PI,f=2*G,Rd=G/2,aq=S.tan,ge=S.atan2,sr=S.random,Vo=S.log,cc=function(L,F,S){return Math.max(F,Math.min(S,L))},$q=T(2,1),Ze=!1,Oc=w.parseInt||global.parseInt,Xo="2023-2-15",xi=$&&(w.navigator?w.navigator.platform.indexOf("Win")>-1:!1),Bp=function(J){return J*J},Jo=$&&w.setTimeout,wc=$&&w.clearTimeout,Lf=$&&(w.navigator?w.navigator.userAgent.toLowerCase():""),yd=function(o){return o.test(Lf)},fh=yd(/msie/),ts=yd(/msie/)||yd(/trident/),xk=yd(/msie 10/),rr=yd(/edge/),Uh=yd(/firefox/),Uf=yd(/mac/),dr=yd(/mscAndroid/),Hi=F.isTouchable===I?xi?!1:H?"ontouchend"in H:!1:F.isTouchable,Ci="default",jj="single",xf="multiple",Ki="front",Mj="back",hp="left",Il="right",nc="top",yf="bottom",lo="center",_d="eye",_p="middle",Jh="east",Pf="west",oq="north",Wr="none",ps="px",Wj="absolute",$e="border",Ro="triangle",Yp="rect",Zq="circle",Cm="cylinder",Kb="shape",tj="items",qr="normal",Uj="remove",Mm="clear",Tp="width",nf="height",Ql="ingroup",Ie="check",Lh="uncheck",ud="radio",Sd="radioOn",Nk="radioOff",Xf="points",Lr="values",ve="series",tk="body",Yn="label",Fl="label2",ci="note",qn="note2",Qj="icons",Oi="labelFont",Hp="labelColor",og="labelSelectColor",lb="note.expanded",Tc="note2.expanded",hq="edge.expanded",nb="edge.points",_q="edge.type",ek="rotation",xc="hidden",im="visible",hk="tuv",qe="no",Pp="draw",Sf="select",Eh="currentSubGraph",di="selectBackground",oj="autoMakeVisible",Ak="autoHideScrollBar",Rr="scrollBarColor",Zd="scrollBarSize",dj="indent",bk="rowHeight",ej="columnLineColor",Qi="rowLineColor",Lg="columnLineVisible",Td="rowLineVisible",Ef="visibleFunc",Kf="expandIcon",ws="collapseIcon",Vi="checkMode",No="sortFunc",Cg="editable",Wd="batchEditable",Ve="tristate",Le="asc",Zh="desc",wl="position",Te="__",ko="elevation",de="children",mi="translateX",fk="translateY",xh="dataModel",tr="maxSize",ll="enc",Xg="state",Fo=ll+"o"+"de",Pb="shape3d",pm="shape3d.resolution",Ue="shape3d.visible",ff="shape3d.from.visible",Vp="shape3d.to.visible",wn="shape3d.top.visible",Hg="shape3d.bottom.visible",Gc="repeat.uv.length",jm="serializeValue",Ek="deserializeValue",qg="centerUniform",vp="uniform",Gf="rgba(255,255,255,0)",bd="style",hb="attr",Xp="field",Rq="string",Gi="boolean",uf="color",rq="int",ef="number",Dn="ew-resize",zp="ns-resize",pf="pointer",ms="auto",Zp="mousedown",Po="mousemove",lj="mouseup",Xb="mouseout",Kc="touchstart",_j="touchmove",vn="touchend",yq="keydown",sn="keyup",_i=["DOMMouseScroll","mousewheel"],Cj=Uh?_i[0]:_i[1],fp=Te+D+Te+Fo,Zc=[Kc,_j,vn],nm=[Zp,Po,lj,Xb,Cj,"wheel","mouseenter","mouseleave","mouseover"],Ne=[yq,sn,"keypress","input","contextmenu","compositionstart","compositionupdate","compositionend"],co=Hi?Zc.concat(Ne):nm.concat(Ne),Ld=N,xp=N,Jn=N,Mn=N,Xl=!0,tb=lj.length,$k=function(){Jn&&(wc(Jn.timeout),Jn=N)},kn=function(){Jn&&eq(Jn.e,Jn.info)};w.addEventListener&&(k=$)&&(Hi||(q(w,Xb,function(){$k()}),q(w,Cj,function(){to()})),q(w,sn,function($){91===$.keyCode?Hf={}:delete Hf[$.keyCode]},!0),q(w,yq,function(p){Hf[p.keyCode]=!0},!0),q(w,"blur",function(){Hf={}}));var nh,uh,To,vd=0,el=N,Yh=function(x,W){var L=Jo(function(){delete el[L],kl(el)&&(el=N),x()},W);return L},fg=N,Xk=N,js={},Bn={},Yl={},al={},bf={},vg={},Hf={},Rn={},Ih={},zd={},Ob={},Jp=/.json$/,ok=/\.(json|bin)$/,Kr=/^data:image\/svg\+xml/,Wm={},vj=[],go={},Kj=N,Kq=N,rp=function(){},Yj=function(){throw"Oops!"},ji=[0,0,0],ro={x:0,y:0,width:0,height:0},gi=N,lq=N,qm=N,Tr=function(M,h){Bn[M]=h,h&&h.comps&&!h.uuid&&(h.uuid=y.Math.generateUUID()),Xe[M]&&(h.cacheRule=Xe[M],delete Xe[M])},ib=function(u){lq&&!u._72O&&(qm||(qm={}),qm[u._72O=Nj()]=u),nh!=N?Ii()<.05&&o&&!uh&&(Cf=$k):Cf=xj},pg=function(w,Z,i,J){lq||(lq={});var I=lq[w];if(I){if(I.url===Z)return;I.image?(I.image.onload=rp,I.image.onerror=rp):I.request&&(I.request.onload=rp,I.request.onerror=rp)}if(Jp.test(Z)){var O=new Ge;if(lq[w]={request:O,url:Z},Z=F.beforeLoadURL(Z,w),Z.data){var c=F.parse(Z.data);fc(w,c),F.handleImageLoaded(w,c)}else{O.onload=function(){if(200===this.status||0===this.status){var d=F.parse(O.getResponseText());fc(w,d),F.handleImageLoaded(w,d)}else fc(w,F.handleUnfoundImage(w,Z)||N)},O.onerror=function(){fc(w,F.handleUnfoundImage(w,Z)||N)};var j={};j.url=encodeURI(Z),j.sync=!1,O.send(j)}}else{var c=new Image;lq[w]={image:c,url:Z},/^data:image/.test(Z)||(Z=F.beforeLoadURL(Z,w),Z=F.appendTimeStamp(Z),Z=encodeURI(Z),c.crossOrigin=F.crossOrigin),F.convertImageSrc(Z,function(t){ts&&(Z.toLowerCase().indexOf(".svg")>0||Kr.test(Z))?(H.body.appendChild(c),c.style.visibility="hidden",c.onload=function(){Jo(function(){if(i&&(c.width=i),J&&(c.height=J),!c.width||!c.height){var f=c.width||c.clientWidth,G=c.height||c.clientHeight;c.width=f,c.height=G}F.handleImageLoaded(w,c),fc(w,c),H.body.removeChild(c),c.style.visibility=""},180)},c.onerror=function(){fc(w,F.handleUnfoundImage(w,Z)||N),H.body.removeChild(c),c.style.visibility=""}):(c.onload=function(){i&&(c.width=i),J&&(c.height=J),F.handleImageLoaded(w,c),fc(w,c)},c.onerror=function(){fc(w,F.handleUnfoundImage(w,Z)||N)}),c.src=t})}},fc=function(K,u){if(Tr(K,u),delete lq[K],kl(lq)&&(lq=N,qm)){for(var T in qm){var b=qm[T];b._2O&&b._2O[K]&&(b.deleteTexture(K),delete b._2O[K]),b.invalidateAll&&b.invalidateAll(I,"imageLoaded",K),b.redraw&&b.redraw(),b.iv(),u&&u.layoutAttach&&Cc(b.dm)&&b.dm().updateLayoutAttach(K),delete b._72O}qm=N}if(u&&qm)for(var T in qm){var b=qm[T];b.invalidateAll&&b.invalidateAll(I,"imageLoading",K),b.redraw&&b.redraw(),b.iv(),u.layoutAttach&&Cc(b.dm)&&b.dm().updateLayoutAttach(K)}},Hd=function(){return Vo=S&&Date,function(){return w.performance&&w.performance.now?w.performance.now():Date.now()}}(),jh=function(t,Y,W){return{width:t,height:Y,comps:hr(W)?W:[W]}},Rb=function(M,H){return{type:Zq,rect:[M,H,1.6,1.6],borderWidth:1,borderColor:Cs,gradient:Pm,gradientColor:af,background:Cs}},yb=function(x,D){return jh(16,16,{type:Ro,rect:[4,4,10,8],background:x,rotation:D?1.57:3.14})},Wl=function(L,l){return jh(16,16,{type:Ro,rect:[4,4,8,7],background:L,rotation:l?3.14:0})},If=function(g){var x=g._orientation;return"horizontal"===x||"h"===x},ni=function(O,x){var h=N||4,i=N||1,r=N||1;0>h?h=0:h>.25&&(h=.25);var j,R,A,F,l,p,Z,c=.5,k=[],M=[],S=[],D=f/r,H=f/i,u=c-h;for(R=0;i>=R;R++)for(F=-G+R*H,p=s(F),l=W(F),j=0;r>=j;j++)A=j*D,Z=u+h*p,k.push(s(A)*Z,l*h,-W(A)*Z),(Q=[O,x])&&M.push(j/r,1-R/i);for(R=0;i>R;R++){var e=R*(r+1),C=(R+1)*(r+1);for(j=0;r>j;j++)S.push(e+j,C+j+1,C+j,e+j,e+j+1,C+j+1),uk.z=Sn.z=[O,x]}},kf=function(V){var C=2,X=0;for(var K in V)K.length===C&&Oc(K,32)===am&&(Kj=Kq=V[K]),X++;return X},rb=function(L,n,f,R){return f||(f=Hi?5:3,f/=R||1),{x:L-f,y:n-f,width:2*f,height:2*f}},rd=function(y,b,Y,j){var E=this;b||(b=Hi?5:3,Y=20,j=20);var I={x:y,y:b,width:Y,height:j};if(Y)for(var S=0;Y>S;S++)if(3===Y)j=20;else for(var K=0;j>K;K++)E=w?w:Y;var c={x:G,y:2*G};if(zo(I,c)){var o=nf[0]+nc[0]+Mm[1]+Le.length,L=xc[0]+Ve[0]+Mm[1]+tk.length;Lc[_d]=[E[o],E[L]],E[o]=vb[_d],E[L]=vb[Pb]}},Nr=function(i){return(/ble$/.test(i)||/ed$/.test(i)||v[i]?"is":"get")+i.charAt(0).toUpperCase()+i.slice(1)},vb=function(h){return"set"+h.charAt(0).toUpperCase()+h.slice(1)},Je=function(L){return typeof L===Rq||L instanceof String},dm=function(p){return typeof p===ef},xj=function(N){return typeof N===Gi},Go=function(n){return n&&"object"==typeof n},Cc=function(n){return"function"==typeof n},hr=function(B){return B instanceof Array},Np=function(v){return v instanceof Ik},Gr=function(l){return hr(l)?new Ik(l):l},cl=function(n){return n instanceof Oh},lm=function(G){return G instanceof sp},Ln=function(P){return P instanceof eo},hf=function(Z,M){if(!(Z instanceof y.Group))return!1;if(!M)return Z.isExpanded();var O=M.getDataUI(Z);return O&&O._88I?!0:!1},Ym=function(B){return B instanceof Jc},Wh=function(N){return N&&"IFRAME"===N.tagName},pk=function(w){return w==N||F.numberDigits==N?w:parseFloat(w.toFixed(F.numberDigits))},Bm=function(I,$,v){var G,N=$.length;if(v)for(var S=0;v>S;S++)if(3===N)I.push($[0]),I.push($[1]),I.push($[2]);else for(G=0;N>G;G++)I.push($[G]);else if(3===N)I.push($[0]),I.push($[1]),I.push($[2]);else for(G=0;N>G;G++)I.push($[G])},Qd=function(R){return R?Go(R)?R:{}:!1},xo=function(e,u,F){var N,g=Go(e)?e:e.prototype;for(N in u)F&&N in g?g[N]===I&&console.warn("class",g,"has own undefined property",N,", keep exist!"):g[N]=u[N];return e},fr=function(A,p){if(!("wheelDelta"in p)){var h=p.deltaMode;p.wheelDelta=h===p.DOM_DELTA_PIXEL?-p.deltaY:h===p.DOM_DELTA_LINE?40*-p.deltaY:120*-p.deltaY}A.handle_mousewheel(p)},Wf=function(V){return String.fromCharCode(V)},kg=function(Y){for(var H,o=0,r="";o<Y.length;o++)H=Y[Y.length-1-o],"%"===H?H="'":"a"===H?H='"':"]"===H&&(H="\\"),r+=Wf(H.charCodeAt(0)-1);return r},Iq=function(x,T,Y){x.superClass.constructor.apply(T,Y)},kl=function(X){for(var N in X)return!1;return!0},pi=function(W){return W?0===W.length:!0},ic=function(){var Q="";return[Lh[0],Qi[0],Yn[0]].forEach(function(e){Q+=vb(e).slice(3)}),vp=H&&H[Q]||qg,function(S,u){return S===u?!0:S.x===u.x&&S.y===u.y&&S.width===u.width&&S.height===u.height}}(),ls=function(e,i,R){return i>e?i:e>R?R:e},hi=function(R){return 0>R?-1:R>0?1:0},Ii=function(){var Q=1e4*W(tb++);return Q-g(Q)},mq=function(q,_,K){return Gh(q.x,q.y,_.x,_.y,K.x,K.y,K.x+K.width,K.y,!0)||Gh(q.x,q.y,_.x,_.y,K.x+K.width,K.y,K.x+K.width,K.y+K.height,!0)||Gh(q.x,q.y,_.x,_.y,K.x+K.width,K.y+K.height,K.x,K.y+K.height,!0)||Gh(q.x,q.y,_.x,_.y,K.x,K.y+K.height,K.x,K.y,!0)},Gh=function(e,$,x,q,L,w,c,H,B){var V=(c-L)*($-w)-(H-w)*(e-L),k=(H-w)*(x-e)-(c-L)*(q-$);if(0!==k){var Y=V/k,v=e+Y*(x-e),o=$+Y*(q-$);return B&&(v+Qq<J(e,x)||v-Qq>n(e,x)||v+Qq<J(L,c)||v-Qq>n(L,c)||o+Qq<J($,q)||o-Qq>n($,q)||o+Qq<J(w,H)||o-Qq>n(w,H))?N:[v,o]}return N},oh=function(J,y,i){if(J&&i)if(y){if(y===bd)return J.getStyle(i);if(y===hb)return J.getAttr(i);if(y===Xp)return J[i]}else if(i=Nr(i),J[i])return J[i]();return I},hc=function(U,_,S,v){if(U&&S)if(_){if(_===bd)U.s(S,v);else if(_===hb)U.a(S,v);else if(_===Xp){var N=U[S];U[S]=v,U.fp("f:"+S,N,v)}}else S=vb(S),U[S]&&U[S](v)},zl=function(N,v,J){var y=100*Math.max(N.width,N.height);return v&&"top"!==v?"bottom"===v?{x:N.x-y,y:N.y-y,width:N.width+2*y,height:N.height*J+y}:"right"===v?{x:N.x-y,y:N.y-y,width:N.width*J+y,height:N.height+2*y}:"left"===v?{x:N.x+N.width*(1-J),y:N.y-y,width:N.width*J+y,height:N.height+2*y}:void 0:{x:N.x-y,y:N.y+N.height*(1-J),width:N.width+2*y,height:N.height*J+y}},Bj=function(z,$,E,R,U){$&&no(z,E,R,1,U,$)},xs=function(p,t,v,Q){var c=1-p;return c*c*t+2*p*c*v+p*p*Q},uk=function(h,N,n,F,v){var P=1-h;return P*P*P*N+3*P*P*h*n+3*P*h*h*F+h*h*h*v},Rg=function(w){var W,R,i,U,$=0;return w.forEach(function(Y){if(W=Y.length,W>0)for(R=Y[0],U=1;W>U;U++)i=Y[U],$+=So(R,i),R=i}),$},An=function(a,L,m){var i="__"+a,d=function(N){("mousedown"===a||"mouseup"===a||"touchstart"===a||"touchend"===a)&&Jd(N),m.disabled||m["handle_"+a](N)};m[i]||(m[i]=d,q(L,a,d))},bg=function(N,Q,K){var F="__"+N,j=K[F];j&&(V(Q,N,j),delete K[F])},pc=function(n,O){var N="_"+O;n[Nr(O)]=function(){return this[N]},n[vb(O)]=function(s){var p=this[N];this[N]=s,this.fp(O,p,s)}},Mf=function(g){return C.create(g)},wp=function(S){if(!S.element){var W,g;(W=S.textField)?g=Zm(Jt.TextField,W):(W=S.textArea)?g=Zm(Jt.TextArea,W):(W=S.button)?g=Zm(Jt.Button,W):(W=S.comboBox)?g=Zm(Jt.ComboBox,W):(W=S.checkBox)?g=Zm(Jt.CheckBox,W):(W=S.radioButton)?g=Zm(Jt.RadioButton,W):(W=S.slider)?g=Zm(Jt.Slider,W):(W=S.colorPicker)?g=Zm(Jt.ColorPicker,W):(W=S.image)&&(g=Zm(Jt.Image,W)),g&&(S.element=g)}},vc=function(G,k){var e=jg(G);return e._ht=k,e},un=w.top===w?w.top:w||w.document,jg=function(e,$){var O=H.createElement("div"),K=O.style;return O.tabIndex=-1,O.onkeydown=vr,K.msTouchAction=Wr,Wb(O,N,0),Hi&&K.setProperty("-webkit-tap-highlight-color","rgba(0, 0, 0, 0)",N),e&&(K.overflow=xc),$&&Em($,O),O},Qb=function(P,X){var E=H.createElement("canvas"),y=E.style;return y.msTouchAction=Wr,X||(y.pointerEvents=Wr),Wb(E,N,0),P&&Em(P,E),E},Wb=function(r,q,N){var Z=r.style;Z.border=q?q+" solid 1px":0,Z.outline=0,Z.padding=N?"0 "+N+ps:0,Xj(r)},Xj=function(H){var i=H.style;i.position=Wj,i.margin=0,i.setProperty("box-sizing","border-box",N),i.setProperty("-moz-box-sizing","border-box",N)},Nc=function(L,o,a,U){U||(U=Ep),o!=N&&(L.width=o*U,L.style.width=o+ps),a!=N&&(L.height=a*U,L.style.height=a+ps)},Em=function(C,S,j){C.appendChild(S),j&&(S.style.position=Wj)},gs=function(F,q){q.split||(q+="");for(var c,G=q.split("\n"),g=0,B=G.length,H=0;B>H;H++){var A=ce(F.font,G[H]);A.width>g&&(g=A.width),c||(c=A.height)}return F.ss=G,{width:g,height:c*B}},dp=function(){var v=H?Qb().getContext("2d"):N;return function(A,X,c,O,G,q){var z=A.split("\n"),F=[],V=ce(c,A).height;return O||(O=0),v.font=c,v.textBaseline=nc,z.forEach(function(p){for(var m=0,L=1,r=0,e=p.length;e>=L;L++){var D=p.substring(m,L),h=G?v.measureText(p[L]):ce(c,D);G&&(r+=h.fontBoundingBoxDescent||V);var i=G?r+(D.length-1)*q:h.width+(D.length-1)*O;i>X&&(L-1===m?(F.push(p.substring(m,L)),m=L):(F.push(p.substring(m,L-1)),m=L-1,L--),r=0)}m!==L-1&&F.push(p.substring(m,L))}),F}}(),jc=function(p,L,r,T,v,t,f,A){p.font=r;var B=p.measureText(L);if(p.beginPath(),p.strokeStyle=T,p.lineWidth=1,"underline"===A){var R;R=B.actualBoundingBoxDescent?B.actualBoundingBoxDescent+1:ce(r,L).size/2,p.moveTo(v-f/2,t+R),p.lineTo(v+f/2,t+R)}else if("strikethrough"===A)p.moveTo(v-f/2,t),p.lineTo(v+f/2,t);else if("overline"===A){var R;R=B.fontBoundingBoxAscent?B.fontBoundingBoxAscent:ce(r,L).size/2,p.moveTo(v-f/2,t-R),p.lineTo(v+f/2,t-R)}p.stroke()},Kg=function(X,o,A,Z,g,s,J,d,n,a,w){var m=g.x,b=g.y,O=g.width,h=g.height;if(o!=N){var Q=ce(A,o),C={};n&&(Q.width+=(o.length-1)*n),C.y=J&&J!==_p?J===nc?b+Q.height/2:b+h-Q.height/2:b+h/2,C.x=s&&s!==hp?s===Il?m+O-Q.width/2:m+O/2:m+Q.width/2,fo(X,o,C,A,Z,n,a,w),d&&jc(X,o,A,Z,C.x,C.y,Q.width,d)}},Vk=function(k,G,h,R,H,n,x,E,c,r){var W=G.length;if(1===W){var I=G[0];if(fo(k,I,h,R,H,E,c,r),x){var P=ce(R,I);jc(k,I,R,H,h.x+h.width/2,h.y+h.height/2,P.width,x)}}else for(var _=h.height/W,a={x:h.x,y:h.y,width:h.width,height:_},y=0;y<G.length;y++){if(n)Kg(k,G[y],R,H,a,n,null,x,E,c,r);else if(fo(k,G[y],a,R,H,E,c,r),x){var P=ce(R,G[y]);jc(k,G[y],R,H,a.x+a.width/2,a.y+a.height/2,P.width,x)}a.y+=_}},fo=function(H,K,E,t,v,L,$,z){H.font=t?t:Qf,H.fillStyle=v?v:xr,H.textAlign=lo,H.textBaseline=_p;var U,e;E?E.width===I?(U=E.x,e=E.y):(U=E.x+E.width/2,e=E.y+E.height/2):(U=0,e=0);var B=$&&z;if(B&&(H.strokeStyle=z,H.lineWidth=$),L){var y=ce(t,K);U-=(y.width+L*(K.length-1))/2;for(var u=(K+"").length,h=0;u>h;h++){var R=K[h],M=H.measureText(R);B&&H.strokeText(R,c(U+(M.width+4)/2),c(e)),H.fillText(R,c(U+(M.width+4)/2),c(e)),U+=M.width+L}}else B&&H.strokeText(K,c(U),c(e)),H.fillText(K,c(U),c(e))},Oq=function(o){o.getView&&(o=o.getView());var M=o.offsetWidth||o.scrollWidth;return!M&&o.style.width&&(M=Oc(o.style.width)),M},Cb=function(r){r.getView&&(r=r.getView());var y=r.offsetHeight||r.scrollHeight;return!y&&r.style.height&&(y=Oc(r.style.height)),y},pp=function(h,R,Y){var q=R[0].toUpperCase()+R.substring(1,R.length);h["webkit"+q]=Y,h["moz"+q]=Y,h["ms"+q]=Y,h["o"+q]=Y,h[R]=Y},mm=function(){var G=function(H){vr(H),H.stopPropagation()},$=function(t){vr(t)},r=[Kc,yq,Zp];return function(O,k){var j=jg(),M=j.style;return M.backgroundColor=F.disabledBackground,O&&(M.backgroundImage="url("+O+")",M.backgroundPosition="50% 50%",M.backgroundRepeat="no-repeat no-repeat"),k===!1?r.forEach(function(O){q(j,O,$)}):r.forEach(function(T){q(j,T,G)}),j}}(),tp=function(K){var Z=K.getContext("2d");return Z.save(),Z.lineCap=Ed,Z.lineJoin=Zl,Z},Cf=function(w,k,W,z){jf(w,k*Ep,W*Ep),z*=Ep,1!==z&&w.scale(z,z)},jf=function(X,R,d){X.translate(R,d)},je=function(Z,k){k&&Z.rotate(k)},$r=function(B,p,r){p===I&&(p=1),r===I&&(r=1),(1!==p||1!==r)&&B.scale(p,r)},Tm=!1,h=un[Ie[1]+mi[0]],Re=function(n){var l=H.activeElement;if(H.activeElement!==n){l&&l.forceOnblur&&l.forceOnblur();for(var k=[],a=n.parentNode;a;)k.push([a,a.scrollLeft,a.scrollTop]),a=a.parentNode;if(!Tm){var i=[],M=[];try{for(var q=w.parent,s=w;q!==s;)i.push([q,q.scrollX,q.scrollY]),s=q,q=w.parent;var U=w.frameElement;if(U)for(var j=U.parentNode;j;)M.push([j,j.scrollLeft,j.scrollTop]),j=j.parentNode}catch(O){Tm=!0}}if(Hi)n.focus();else{var V=yo(),W=V.target;n.focus(),W.scrollLeft=V.left,W.scrollTop=V.top}k.forEach(function(b){b[0].scrollLeft=b[1],b[0].scrollTop=b[2]}),Tm||(i.forEach(function(r){r[0].scrollTo(r[1],r[2])}),M.forEach(function(n){n[0].scrollLeft=n[1],n[0].scrollTop=n[2]}))}},ul=function(k){return k&&k.getView?k.getView():k},Xd=function(V,R,J,q,m){if(2===arguments.length&&(J=R.y,q=R.width,m=R.height,R=R.x),V.isSelfViewEvent)V.setX(R),V.setY(J),V.setWidth(q),V.setHeight(m);else{var $=ul(V),C=$.style;if((H.fullscreenElement||H.mozFullScreenElement||H.webkitFullscreenElement||H.msFullscreenElement)!==$)R!==I&&(C.left=R+ps),J!==I&&(C.top=J+ps),q!==I&&(C.width=q+ps),m!==I&&(C.height=m+ps);else{var b=F.getWindowInfo();C.left=(R=b.left)+ps,C.top=(J=b.top)+ps,C.width=(q=b.width)+ps,C.height=(m=b.height)+ps}V.endEditing&&!Hi&&V.endEditing(),V.redraw&&V.redraw(),V.invalidate&&V.invalidate(),V.onLayouted&&V.onLayouted(R,J,q,m),V.fireViewEvent&&V.fireViewEvent("layout")}},_r=function(g){if(!g.touches)return g;var F=g.touches[0];return F?F:g.changedTouches[0]},El=function(t){return Qm(t)?_r(t).target:t.target},Qm=function(B){return B&&"object"==typeof B&&"touches"in B},Pn=function(c){F.popup&&F.popup.close(),F.popup=c},br=N,cn=function(q){br.handleWindowTouchMove(q)},ye=function(o){br.handleWindowTouchEnd(o),V(w,_j,cn),V(w,vn,ye),V(w,"blur",ye),br=N},Rl=function(j){br.handleWindowMouseMove(j)},Fb=function(n){br.handleWindowMouseUp(n),V(w,Po,Rl),V(w,lj,Fb),V(w,"blur",Fb),br=N},Dh=function(L){return 1===hm(L)},xq=function(f,C){return C?C.keyCode===f:Hf[f]},cr=function(k){return Og(k)&&xq(65,k)},Wk=function(Q){return xq(46,Q)||xq(8,Q)},so=function(e){return function(t){return t?t.keyCode===e:Hf[e]}},am=573,Df=[65,83,68,87,37,38,39,40,32,13,27],th=so(Df[0]),ij=so(Df[1]),Xh=so(Df[2]),Tj=so(Df[3]),jr=so(Df[4]),cb=so(Df[5]),wk=so(Df[6]),Yd=so(Df[7]),En=so(Df[8]),Uc=so(Df[9]),zi=so(Df[10]),zq={65:1,83:1,68:1,87:1,37:1,38:1,39:1,40:1},sb=[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,5,5,5,5,5,17,107],Qh=N,dq=N,tl=function(D,B){Qh||(Qh=Qb()),Nc(Qh,D,B,1);var H=tp(Qh);return H.clearRect(0,0,D,B),H},Fn=function(I,A,z){if(A&&I){if("override"===z)return A;if("override_rgb"===z){var V=Ng(A);return I=_f(I),"rgba("+c(255*V[0])+","+c(255*V[1])+","+c(255*V[2])+","+I[3]/255+")"}if("override_a"===z){var V=Ng(A);return I=_f(I),"rgba("+I[0]+","+I[1]+","+I[2]+","+V[3]+")"}if("multiply_destinationAtop"===z){var j=iq(Ng(I)),O=j[3],K=iq(Ng(A)),P=K[3],x=iq(j),Y=x[3],L=j.map(function(X,S){return X*K[S]}),R=1-O,G=1-P,f=G*O+P;return j=j.map(function(z,E){return(P*R*K[E]+P*O*L[E]+G*O*z)/f}),O=f,R=1-O,j=j.map(function(X,o){return(Y*x[o]*R+O*X*Y)/Y}),O=Y,"rgba("+c(255*j[0])+","+c(255*j[1])+","+c(255*j[2])+","+O+")"}var V=Ng(A);return I=_f(I),"rgba("+c(I[0]*V[0])+","+c(I[1]*V[1])+","+c(I[2]*V[2])+","+I[3]/255*V[3]+")"}return I},_f=function(){var m,A={};for(var P in w){var c=xf.length;if(P.length==c&&P[0]===xf[2]&&P[1]===Wr[1]&&P[4]===xf[3]&&P[5]===xf[4]&&P.substr(c-2)===Wr[1]+Wr[2]){var J=w[P];for(var S in J)S.length===c&&S.substr(0,3)===Il[3]+Uj[3]+Sf[0]&&S.substr(c-2)===xf[0]+ci[3]&&(_i=J[S])}}return function(G){var j,p=A[G];return p||(m||(m=Qb(),Nc(m,1,1,1)),j=m.getContext("2d"),j.clearRect(0,0,1,1),no(j,0,0,1,1,G),p=j.getImageData(0,0,1,1).data,p=A[G]=[p[0],p[1],p[2],p[3]]),p}}(),Ng=function(H){if(!Je(H))return H;var X=_f(H);return X.CA||(X.CA=[X[0]/255,X[1]/255,X[2]/255,X[3]/255]),X.CA},Zb=function(z,_,d,X,w){var l=Qb();l.width=d,l.height=X;var T=l.getContext("2d");T.drawImage(z,0,0,d,X);try{for(var H=T.getImageData(0,0,d,X),M=H.data,R=0,s=M.length;s>R;R+=4){var P=M[R+0],q=M[R+1],b=M[R+2],f=M[R+3];"override_a"===w?M[R+3]=255*_[3]:"override_rgb"===w?(M[R+0]=255*_[0],M[R+1]=255*_[1],M[R+2]=255*_[2]):"override"===w?(M[R+0]=255*_[0],M[R+1]=255*_[1],M[R+2]=255*_[2],M[R+3]=255*_[3]):(M[R+0]=_[0]*P,M[R+1]=_[1]*q,M[R+2]=_[2]*b,M[R+3]=_[3]*f)}T.putImageData(H,0,0)}catch(r){return z}return l},Lc=function(p,E,K){return E&&(E="miter"===K?8*E+20:E+1,p&&Oj(p,E)),E},Sq=function(H,P){if(P){var B=new zg(P),f=H.width/2,$=H.height/2,S=Jf([B.tf(-f,-$),B.tf(f,-$),B.tf(f,$),B.tf(-f,$)]);return S.x+=H.x+f,S.y+=H.y+$,S}return H},Dp=function(C,S,X,s,y,n,x,e){s*=Math.PI/180;var u={x:Math.cos(s)*(C.x-x.x)/2+Math.sin(s)*(C.y-x.y)/2,y:-Math.sin(s)*(C.x-x.x)/2+Math.cos(s)*(C.y-x.y)/2},q=Math.pow(u.x,2)/Math.pow(S,2)+Math.pow(u.y,2)/Math.pow(X,2);q>1&&(S*=Math.sqrt(q),X*=Math.sqrt(q));var D=(y==n?-1:1)*Math.sqrt((Math.pow(S,2)*Math.pow(X,2)-Math.pow(S,2)*Math.pow(u.y,2)-Math.pow(X,2)*Math.pow(u.x,2))/(Math.pow(S,2)*Math.pow(u.y,2)+Math.pow(X,2)*Math.pow(u.x,2)));isNaN(D)&&(D=0);var R={x:D*S*u.y/X,y:D*-X*u.x/S},G={x:(C.x+x.x)/2+Math.cos(s)*R.x-Math.sin(s)*R.y,y:(C.y+x.y)/2+Math.sin(s)*R.x+Math.cos(s)*R.y},c=function(C){return Math.sqrt(Math.pow(C[0],2)+Math.pow(C[1],2))},I=function(Y,e){return(Y[0]*e[0]+Y[1]*e[1])/(c(Y)*c(e))},i=function(X,M){return(X[0]*M[1]<X[1]*M[0]?-1:1)*Math.acos(I(X,M))},L=i([1,0],[(u.x-R.x)/S,(u.y-R.y)/X]),z=[(u.x-R.x)/S,(u.y-R.y)/X],h=[(-u.x-R.x)/S,(-u.y-R.y)/X],O=i(z,h);I(z,h)<=-1&&(O=Math.PI),I(z,h)>=1&&(O=0);var I=S>X?S:X,_=S>X?1:S/X,d=S>X?X/S:1;if(null==e){var Y={x:0,y:0,width:0,height:0};Oj(Y,I),Y.x*=_,Y.width*=_,Y.y*=d,Y.height*=d;var p=new zg(s);return Y=Jf([p.tf(Y.x,Y.y),p.tf(Y.x+Y.width,Y.y),p.tf(Y.x+Y.width,Y.y+Y.height),p.tf(Y.x,Y.y+Y.height)]),Y.x+=G.x,Y.y+=G.y,[{x:Y.x,y:Y.y},{x:Y.x+Y.width,y:Y.y},{x:Y.x+Y.width,y:Y.y+Y.height},{x:Y.x,y:Y.y+Y.height}]}e.translate(G.x,G.y),e.rotate(s),e.scale(_,d),e.arc(0,0,I,L,L+O,1-n),e.scale(1/_,1/d),e.rotate(-s),e.translate(-G.x,-G.y)},Lj=function(Z,g){Z&&Z.beginPath();for(var B,$,G,T=[],J=function(F){for(var H,k=/(\-{0,1}[\d\.]+)/gi,A=[];H=k.exec(F);)A.push(parseFloat(H[0]));return A},f=/([MmLlHhVvCcSsQqTtAa]{1}[\d\.,\s\-Zz]*)/gi,K={x:0,y:0};B=f.exec(g);){var z=B[0],H=z.substr(0,1);if("M"===H||"m"===H){for(var R=J(z),m=0;m<R.length;m+=2){var N=R[m],V=R[m+1];"m"===H&&(N+=K.x,V+=K.y),Z&&Z.moveTo(N,V),T.push({x:N,y:V}),K.x=N,K.y=V}$=G=null}else if("H"===H||"h"===H){for(var R=J(z),m=0;m<R.length;m+=1){var N=R[m];"h"===H&&(N+=K.x),Z&&Z.lineTo(N,K.y),T.push({x:N,y:K.y}),K.x=N}$=G=null}else if("C"===H||"c"===H){for(var R=J(z),m=0;m<R.length;m+=6){var C=R[m],l=R[m+1],_=R[m+2],W=R[m+3],N=R[m+4],V=R[m+5];"c"===H&&(C+=K.x,l+=K.y,_+=K.x,W+=K.y,N+=K.x,V+=K.y),Z&&Z.bezierCurveTo(C,l,_,W,N,V),T.push({x:C,y:l}),T.push({x:_,y:W}),T.push({x:N,y:V}),K.x=N,K.y=V}$=[C,l,_,W,N,V],G=null}else if("S"===H||"s"===H){for(var R=J(z),m=0;m<R.length;m+=4){var C,l;$?(C=2*$[4]-$[2],l=2*$[5]-$[3]):(C=K.x,l=K.y);var _=R[m],W=R[m+1],N=R[m+2],V=R[m+3];"s"===H&&(_+=K.x,W+=K.y,N+=K.x,V+=K.y),Z&&Z.bezierCurveTo(C,l,_,W,N,V),T.push({x:C,y:l}),T.push({x:_,y:W}),T.push({x:N,y:V}),K.x=N,K.y=V}$=[C,l,_,W,N,V],G=null}else if("Q"===H||"q"===H){for(var R=J(z),m=0;m<R.length;m+=4){var C=R[m],l=R[m+1],N=R[m+2],V=R[m+3];"q"===H&&(C+=K.x,l+=K.y,N+=K.x,V+=K.y),Z&&Z.quadraticCurveTo(C,l,N,V),T.push({x:C,y:l}),T.push({x:N,y:V}),K.x=N,K.y=V}$=null,G=[C,l,N,V]}else if("T"===H||"t"===H){for(var R=J(z),m=0;m<R.length;m+=2){var C,l;G?(C=2*G[2]-G[0],l=2*G[3]-G[1]):(C=K.x,l=K.y);var N=R[m],V=R[m+1];"t"===H&&(N+=K.x,V+=K.y),Z&&Z.quadraticCurveTo(C,l,N,V),T.push({x:C,y:l}),T.push({x:N,y:V}),K.x=N,K.y=V}$=null,G=[C,l,N,V]}else if("V"===H||"v"===H){for(var R=J(z),m=0;m<R.length;m+=1){var V=R[m];"v"===H&&(V+=K.y),Z&&Z.lineTo(K.x,V),T.push({x:K.x,y:V}),K.y=V}$=G=null}else if("L"===H||"l"===H){for(var R=J(z),m=0;m<R.length;m+=2){var N=R[m],V=R[m+1];"l"===H&&(N+=K.x,V+=K.y),Z&&Z.lineTo(N,V),T.push({x:N,y:V}),K.x=N,K.y=V}$=G=null}else if("A"===H||"a"===H){for(var R=J(z),m=0;m<R.length;m+=7){var y=R[m],v=R[m+1],D=R[m+2],u=R[m+3],x=R[m+4],N=R[m+5],V=R[m+6];"a"===H&&(N+=K.x,V+=K.y);var U=Dp(K,y,v,D,u,x,{x:N,y:V},Z);U&&(T=T.concat(U)),K.x=N,K.y=V}$=G=null}var t=z.substr(z.length-1);("z"===t||"Z"===t)&&Z&&Z.closePath()}return T},hj=function(f,m,i,g,h){var C,W=m[0];if(f.save(),hr(m))if(W&&1===W.length){var c,p="L"===m[0],o=m.length;p?(f.transform(m[5],m[6],m[7],m[8],m[9],m[10]),C=f.createLinearGradient(m[1],m[2],m[3],m[4]),c=11):(f.transform(m[7],m[8],m[9],m[10],m[11],m[12]),C=f.createRadialGradient(m[1],m[2],m[3],m[4],m[5],m[6]),c=13);for(var S=f.compGray;o>c;){var I=m[c+1];I=i(I),C.addColorStop(m[c],S?F.toGrayColor(I):I),c+=2}}else{var c,p="linear"===W,e=h.x,x=h.y,k=h.width,A=h.height,o=m.length,S=f.compGray;if(p)C=f.createLinearGradient(e+k*m[1],x+A*m[2],e+k*m[3],x+A*m[4]),c=5;else{var d=Math.min(k,A),P=m[1]*k+e,E=m[2]*A+x,Y=m[3]*d;if(Je(m[5]))C=f.createRadialGradient(P,E,0,P,E,Y),c=4;else{f.transform(m[7],m[8],m[9],m[10],m[11]+P,m[12]+E);var H=m[4]*k+e-P,w=m[5]*A+x-E,N=m[6]*d;C=f.createRadialGradient(0,0,Y,H,w,N),c=13}}for(;o>c;){var I=m[c+1];I=i(I),C.addColorStop(m[c],S?F.toGrayColor(I):I),c+=2}}else C=m;return g?f.strokeStyle=C:f.fillStyle=C,C},Sn=function(){function d(C,y){var S=C.length,W=C[0];if(Je(C)||W&&1!==W.length)return C;for(var U=new Array(S),p=0;S>p;p++)U[p]=C[p];var r,v,i,d,o,h,t,s,m,M,z,I,T,$="L"===U[0];return r=$?5:7,v=U[r],i=U[r+1],d=U[r+2],o=U[r+3],h=U[r+4],t=U[r+5],s=y[0],m=y[1],M=y[2],z=y[3],I=y[4],T=y[5],U[r]=s*v+M*i,U[r+1]=m*v+z*i,U[r+2]=s*d+M*o,U[r+3]=m*d+z*o,U[r+4]=s*h+M*t+I,U[r+5]=m*h+z*t+T,U}return function(j,l){var e;(e=j.s("shape.gradient.pack"))&&j.s("shape.gradient.pack",d(e,l)),(e=j.s("shape.border.gradient.pack"))&&j.s("shape.border.gradient.pack",d(e,l))}}(),Qr=function($,z,k,N){var A=!1;if($.beginPath?$.beginPath():A=!0,Np(z)&&(z=z._as),Np(k)&&(k=k._as),k&&k.length){for(var Y,V,e,Q,x=0,n=0,j=k.length;j>n;n++)Y=k[n],1===Y?(V=z[x++],$.moveTo(V.x,A?-V.y:V.y)):2===Y?(V=z[x++],$.lineTo(V.x,A?-V.y:V.y)):3===Y?(V=z[x++],e=z[x++],$.quadraticCurveTo(V.x,A?-V.y:V.y,e.x,A?-e.y:e.y)):4===Y?(V=z[x++],e=z[x++],Q=z[x++],$.bezierCurveTo(V.x,A?-V.y:V.y,e.x,A?-e.y:e.y,Q.x,A?-Q.y:Q.y)):5===Y&&$.closePath();N&&5!==Y&&$.closePath()}else{var U,v,l,B=z.length;if(B>0){for(U=z[0],$.moveTo(U.x,A?-U.y:U.y),v=1;B>v;v++)l=z[v],$.lineTo(l.x,A?-l.y:l.y);N&&$.closePath()}}},$m=function(p,I,B,v){if(Np(p)&&(p=p._as),Np(I)&&(I=I._as),I&&I.length){B=B||Ff;for(var W,P,F,Y,z,k,b,i,s=[],n=N,u=0,H=0,O=I.length;O>H;H++)if(W=I[H],1===W)s.push(n=[]),n.push(p[u++]);else if(2===W)n.push(p[u++]);else if(3===W){for(P=n[n.length-1],F=p[u++],Y=p[u++],k=1;B>k;k++)b=xs(k/B,P.x,F.x,Y.x),i=xs(k/B,P.y,F.y,Y.y),n.push({x:b,y:i,b:!0});
n.push(Y)}else if(4===W){for(P=n[n.length-1],F=p[u++],Y=p[u++],z=p[u++],k=1;B>k;k++)b=uk(k/B,P.x,F.x,Y.x,z.x),i=uk(k/B,P.y,F.y,Y.y,z.y),n.push({x:b,y:i,b:!0});n.push(z)}else 5===W&&n.push(n[0]);return v&&5!==W&&n&&n.length>2&&n.push(n[0]),s}return v&&p.length>2&&(p=p.slice(),p.push(p[0])),p?[p]:[]},Tn=function(h,d,r,G,v,N){var a,$,m,c=_f(d),Y=G,Z=c[0],s=c[1],B=c[2];if(r){var C=_f(r);a=C[0]-Z,$=C[1]-s,m=C[2]-B}else a=255-Z,$=255-s,m=255-B;for(N||(N=G>10?1:.5,N=1>v?J(N/v,2):N),h.save(),h.shadowOffsetX=0,h.shadowOffsetY=0,h.shadowBlur=0,h.shadowColor=0;(G-=N)>0;){var w=1-G/Y,g=Z+a*w,o=s+$*w,X=B+m*w;g=J(p(g),255),o=J(p(o),255),X=J(p(X),255),h.strokeStyle="rgb("+g+","+o+","+X+")",h.lineWidth=G,h.stroke()}h.restore()},yl=function(){if(Xl&&k){var D=k+""||Le;dr=D.indexOf(xc.substr(0,2))>0&&D.indexOf(nc+nc.substr(1,1))>1?!0:!1}var L={};return function(T,N){var I=T+"-"+N,B=L[I];if(B)return B;var b,u,l,w=_f(T);return 0>N?(N=(100+N)/100,b=p(w[0]*N),u=p(w[1]*N),l=p(w[2]*N)):(N/=100,b=w[0],u=w[1],l=w[2],b+=(255-b)*N,u+=(255-u)*N,l+=(255-l)*N,b=J(p(b),255),u=J(p(u),255),l=J(p(l),255)),L[I]="rgb("+b+","+u+","+l+")"}}(),no=function(z,Q,B,o,h,M){M&&(z.fillStyle=M),z.beginPath(),z.rect(Q,B,o,h),z.fill()},Uq=function(m,W,e,x,B,I,K){m.beginPath(),Ml[W](m,e.x,e.y,e.width,e.height,x,B,I,K)},Zn=function(h,P,y,$,z){var U=Ml[y];h.fillStyle=U?U(h,P,$?$:af,z.x,z.y,z.width,z.height):P},_k=function(r,v,J,K,f,U){r.fillStyle=Pj(r,v,J,K,f,U)},sh=function(O,v,U,B,h,l){O.strokeStyle=Pj(O,v,U,B,h,l)},Pj=function(h,Y,Z,Q,M,B){var D;try{if(!Y.tagName&&Y.comps){Y._cacheImage_||(Y._cacheImage_={});var l;l="override"===Q?"colors_override":"override_rgb"===Q?"colors_override_rgb":"override_a"===Q?"colors_override_a":"colors",Y._cacheImage_[l]||(Y._cacheImage_[l]={__count__:0});var J=Y._cacheImage_[l][Z];J||(Y._cacheImage_[l].__count__>F.imageCacheThreshold&&(Y._cacheImage_[l]={__count__:0}),J=y.Default.toCanvas(Y,fm(Y),Oo(Y),null,M,B,Z,null,Q),Y._cacheImage_[l][Z]=J,Y._cacheImage_[l].__count__++),Y=J}D=h.createPattern(Y,"repeat")}catch(k){D="black"}return D},gh=function(K){var e,C,u=[],g=0,k=K.length;for(e=0;65>e;e++)u[e]=e;for(e=0;65>e;e++)g=(g+u[e]+K.charCodeAt(e%k))%65,C=u[e],u[e]=u[g],u[g]=C;for(e=0;65>e;e++)u[e]=ik[u[e]];return u.join("")},Vq=function(_){for(var p=8+fl.randomInt(8),I=ik[8*fl.randomInt(8)+(p-8)],q="",C=0;p>C;C++)q+=ik[fl.randomInt(64)];var G=gh(q+D+Te+Fo);return I+q+Ll.encode(_,G)},wo=function(G){var x=G[0],m=ik.indexOf(x);if(0>m)return"";m=8+(7&m);var U=G.slice(1,1+m),l=gh(U+D+Te+Fo);return Ll.decode(G,l,1+m)},od=function(_,U,E,G,z,S,m){_.save(),_.translate(U,E),_.scale(1,m/S),_.arc(0,0,S,G,z),_.restore()},id=function(e,y,F,_,f,m,R,T){var X,Q,i,n,O,o,d,M,r,A,S;if(u(f)>2*G&&(f=2*G),O=p(u(f)/(G/4)),X=f/O,Q=-X,i=-_,O>0){o=y+s(_)*m,d=F+W(-_)*R,T?e.lineTo(o,d):e.moveTo(o,d);for(var k=0;O>k;k++)i+=Q,n=i-Q/2,M=y+s(i)*m,r=F+W(i)*R,A=y+s(n)*(m/s(Q/2)),S=F+W(n)*(R/s(Q/2)),e.quadraticCurveTo(A,S,M,r)}},Nm=function(B,v,f,s,N,g,j,I,F){6===arguments.length&&(hr(g)?(I=g[1],F=g[2],j=g[3],g=g[0]):(j=g,I=g,F=g));var t=v+s,i=f+N,q=N>s?2*s:2*N;return g=q>g?g:q,j=q>j?j:q,I=q>I?I:q,F=q>F?F:q,B.roundRect?(B.roundRect(v,f,s,N,[g,j,F,I]),void 0):(B.moveTo(v+s/2,f),B.arcTo(t,f,t,i,j),B.arcTo(t,i,v,i,F),B.arcTo(v,i,v,f,I),B.arcTo(v,f,t,f,g),B.lineTo(v+s/2,f),void 0)},Jq=function(p,L,J,v,K,I,h){L&&(J=c(J),v=c(v),h||(h=1),p.fillStyle=L,p.beginPath(),p.rect(J,v,h,I),p.rect(J,v,K,h),I-h>0&&p.rect(J,v+I-h,K,h),K-h>0&&p.rect(J+K-h,v,h,I),p.fill())},Mi=function(G,S,W,c){var f=c.x,I=c.y,i=c.width,Z=c.height;if(!(!S||!W||0>=i||0>=Z)){var h,A=Do(S),k=Gg(S),p=W>0;1===W||-1===W?(G.fillStyle=p?A:k,G.beginPath(),G.rect(f,I,1,Z),G.rect(f,I,i,1),G.fill(),G.fillStyle=p?k:A,G.beginPath(),G.rect(f,I+Z-1,i,1),G.rect(f+i-1,I,1,Z),G.fill()):(W=J(u(W),J(i/2,Z/2)),h=G.createLinearGradient(f,I,f+W,I),h.addColorStop(0,p?A:k),h.addColorStop(1,S),G.fillStyle=h,G.beginPath(),G.moveTo(f,I),G.lineTo(f+W,I+W),G.lineTo(f+W,I+Z-W),G.lineTo(f,I+Z),G.lineTo(f,I),G.fill(),h=G.createLinearGradient(f,I,f,I+W),h.addColorStop(0,p?A:k),h.addColorStop(1,S),G.fillStyle=h,G.beginPath(),G.moveTo(f,I),G.lineTo(f+W,I+W),G.lineTo(f+i-W,I+W),G.lineTo(f+i,I),G.lineTo(f,I),G.fill(),h=G.createLinearGradient(f,I+Z,f,I+Z-W),h.addColorStop(0,p?k:A),h.addColorStop(1,S),G.fillStyle=h,G.beginPath(),G.moveTo(f,I+Z),G.lineTo(f+W,I+Z-W),G.lineTo(f+i-W,I+Z-W),G.lineTo(f+i,I+Z),G.lineTo(f,I+Z),G.fill(),h=G.createLinearGradient(f+i,I,f+i-W,I),h.addColorStop(0,p?k:A),h.addColorStop(1,S),G.fillStyle=h,G.beginPath(),G.moveTo(f+i,I),G.lineTo(f+i-W,I+W),G.lineTo(f+i-W,I+Z-W),G.lineTo(f+i,I+Z),G.lineTo(f+i,I),G.fill())}},Wo=function(Z,m,N,W,i,E,H){var p=Z.createLinearGradient(W,i,E,H);return p.addColorStop(0,N),p.addColorStop(1,m),p},ee=function(W,t,f,A,C,X,S){var M=W.createLinearGradient(A,C,X,S);return M.addColorStop(0,t),M.addColorStop(.5,f),M.addColorStop(1,t),M},ph=function(K,n,C,$,Y,v,F){var w=K.createLinearGradient($,Y,v,F);return w.addColorStop(0,n),w.addColorStop(1/3,C),w.addColorStop(2/3,n),w.addColorStop(1,C),w},ep=function(N,i,l,f,L,M,Q,h,T){var a=N.createRadialGradient(f+M*h,L+Q*T,J(M,Q)/24,f+M/2,L+Q/2,n(M,Q)/2);return a.addColorStop(0,l),a.addColorStop(1,i),a},Gd=[0,-1,.22451398828979272,-.30901699437494734,.9510565162951535,-.30901699437494745,.3632712640026804,.11803398874989468,.5877852522924731,.8090169943749473,-1.1102230246251565e-16,.38196601125010515,-.587785252292473,.8090169943749475,-.3632712640026805,.1180339887498949,-.9510565162951536,-.3090169943749473,-.22451398828979285,-.30901699437494734],Ml={polygon:function(K,l,B,a,j,m,c,H){(m==N||3>m)&&(m=6),c==N&&(c=0),H==N&&(H=!0);var o,X=J(a,j),$=X/2,q=new of(l+a/2,B+j/2),e=new of,U=0,f=2*G/m,M=new of($,$);if(H===!1&&M.multiply({x:a/X,y:j/X}),0===c)for(o=0;m>o;o++)e.set(s(U),W(U)).multiply(M).add(q),0===o?K.moveTo(e.x,e.y):K.lineTo(e.x,e.y),U+=f;else{var y=[];for(o=0;2>o;o++)y.push(new of(s(U),W(U)).multiply(M).add(q)),U+=f;var z=y.shift(),p=y[0],d=new of(s(U),W(U)).multiply(M).add(q),A=z.clone().sub(p),Q=d.clone().sub(p),Z=A.clone().normalize().dot(Q.clone().normalize()),S=Math.sqrt((1-Z)/(1+Z)),V=c/S;for(A.setLength(V).add(p),K.moveTo(A.x,A.y),o=0;m>o;o++)y.push(new of(s(U),W(U)).multiply(M).add(q)),U+=f,z=y.shift(),p=y[0],K.arcTo(z.x,z.y,p.x,p.y,c)}K.closePath()},arc:function(F,p,Q,P,Y,I,h,S,W){I==N&&(I=G),h==N&&(h=f),S==N&&(S=!0);var T=p+P/2,M=Q+Y/2;S&&F.moveTo(T,M),W?od(F,T,M,I,h,P/2,Y/2):F.arc(T,M,J(P,Y)/2,I,h),S&&F.closePath()},rect:function(K,u,m,q,W){K.rect(u,m,q,W)},circle:function(s,y,K,U,r){s.arc(y+U/2,K+r/2,J(U,r)/2,0,f,!0)},oval:function(T,g,Z,H,X){od(T,g+H/2,Z+X/2,0,f,H/2,X/2)},roundRect:function(B,y,j,u,_,b){b==N&&(b=J(J(u,_)/4,8)),Nm(B,y,j,u,_,b),B.closePath()},star:function(x,u,s,k,n){var y=2*k,T=2*n,W=u+k/2,t=s+n/2;x.moveTo(W-y/4,t-T/12),x.lineTo(u+.306*k,s+.579*n),x.lineTo(W-y/6,t+T/4),x.lineTo(u+k/2,s+.733*n),x.lineTo(W+y/6,t+T/4),x.lineTo(u+.693*k,s+.579*n),x.lineTo(W+y/4,t-T/12),x.lineTo(u+.611*k,s+.332*n),x.lineTo(W+0,t-T/4),x.lineTo(u+.388*k,s+.332*n),x.closePath()},pentagram:function(l,Z,W,X,y){var J=.5*y,j=Z+.5*X,$=W+J,K=.5257311121191336*X;K>J&&(K=J);var c=Gd,I=0;for(l.moveTo(j+K*c[I++],$+K*c[I++]);20>I;)l.lineTo(j+K*c[I++],$+K*c[I++]);l.closePath()},triangle:function(l,r,h,J,d){l.moveTo(r+J/2,h),l.lineTo(r+J,h+d),l.lineTo(r,h+d),l.closePath()},hexagon:function(e,Z,A,h,N){e.moveTo(Z,A+N/2),e.lineTo(Z+h/4,A+N),e.lineTo(Z+3*h/4,+A+N),e.lineTo(Z+h,A+N/2),e.lineTo(Z+3*h/4,A),e.lineTo(Z+h/4,A),e.closePath()},pentagon:function(U,f,M,w,A){var O=2*w,g=2*A,I=f+w/2,W=M+A/2;U.moveTo(I-O/4,W-g/12),U.lineTo(I-O/6,W+g/4),U.lineTo(I+O/6,W+g/4),U.lineTo(I+O/4,W-g/12),U.lineTo(I+0,W-g/4),U.closePath()},diamond:function(Q,h,Y,p,c){Q.moveTo(h+p/2,Y),Q.lineTo(h,Y+c/2),Q.lineTo(h+p/2,Y+c),Q.lineTo(h+p,Y+c/2),Q.closePath()},rightTriangle:function(O,o,E,Q,R){O.moveTo(o,E),O.lineTo(o+Q,E+R),O.lineTo(o,E+R),O.closePath()},parallelogram:function(Y,i,w,g,_){var R=g/4;Y.moveTo(i+R,w),Y.lineTo(i+g,w),Y.lineTo(i+g-R,w+_),Y.lineTo(i,w+_),Y.closePath()},trapezoid:function(m,N,j,B,n){var p=B/4;m.moveTo(N+p,j),m.lineTo(N+B-p,j),m.lineTo(N+B,j+n),m.lineTo(N,j+n),m.closePath()},"linear.southwest":function(q,E,L,g,m,n,G){return Wo(q,E,L,g,m+G,g+n,m)},"linear.southeast":function(q,G,L,F,P,W,a){return Wo(q,G,L,F+W,P+a,F,P)},"linear.northwest":function(t,J,E,D,m,s,G){return Wo(t,J,E,D,m,D+s,m+G)},"linear.northeast":function(s,W,y,q,N,b,x){return Wo(s,W,y,q+b,N,q,N+x)},"linear.north":function(E,o,$,m,K,G,s){return Wo(E,o,$,m,K,m,K+s)},"linear.south":function(H,k,t,E,q,P,Z){return Wo(H,k,t,E,q+Z,E,q)},"linear.west":function(Q,G,m,y,_,L){return Wo(Q,G,m,y,_,y+L,_)},"linear.east":function(Z,D,u,V,Q,A){return Wo(Z,D,u,V+A,Q,V,Q)},"radial.center":function(k,s,d,B,v,A,q){return ep(k,s,d,B,v,A,q,.5,.5)},"radial.southwest":function(u,v,c,k,V,G,W){return ep(u,v,c,k,V,G,W,.25,.75)},"radial.southeast":function(u,c,M,z,_,Z,j){return ep(u,c,M,z,_,Z,j,.75,.75)},"radial.northwest":function(B,k,t,C,V,s,W){return ep(B,k,t,C,V,s,W,.25,.25)},"radial.northeast":function(w,Z,G,K,m,W,g){return ep(w,Z,G,K,m,W,g,.75,.25)},"radial.north":function(j,T,m,_,f,i,z){return ep(j,T,m,_,f,i,z,.5,.25)},"radial.south":function($,U,t,c,y,O,v){return ep($,U,t,c,y,O,v,.5,.75)},"radial.west":function(V,F,C,T,Z,A,H){return ep(V,F,C,T,Z,A,H,.25,.5)},"radial.east":function(x,Q,c,G,n,v,E){return ep(x,Q,c,G,n,v,E,.75,.5)},"spread.horizontal":function(R,k,q,g,p,O){return ee(R,k,q,g,p,g+O,p)},"spread.vertical":function(M,Z,q,A,V,h,r){return ee(M,Z,q,A,V,A,V+r)},"spread.diagonal":function(e,Z,r,J,B,x,C){return ee(e,Z,r,J+x,B,J,B+C)},"spread.antidiagonal":function(H,C,q,A,B,r,x){return ee(H,C,q,A,B,A+r,B+x)},"spread.north":function(j,C,D,F,W,V,E){return ph(j,C,D,F,W-E/4,F,W+E+E/4)},"spread.south":function(R,f,t,C,E,A,i){return ph(R,t,f,C,E-i/4,C,E+i+i/4)},"spread.west":function(A,L,V,Y,u,v){return ph(A,L,V,Y-v/4,u,Y+v+v/4,u)},"spread.east":function(g,X,m,t,K,P){return ph(g,m,X,t-P/4,K,t+P+P/4,K)}},Br=function(h,t,l){return new zg(h).tf(t,l)},sl=function(H){var h=H.touches[0],q=H.touches[1],n=h.clientX,G=h.clientY,C=q.clientX,V=q.clientY;return U((n-C)*(n-C)+(G-V)*(G-V))},As=function(Y){var r=Y.touches[0],$=Y.touches[1],j=r.clientX,c=r.clientY,N=$.clientX,_=$.clientY;return{x:(j+N)/2,y:(c+_)/2}},On=(function(){for(var c=0,z=Zh.split(""),C=0;C<z.length;C++)c=10*Oc(z[C])+c;return ni(w[am.toString(8*C)+Yn.substr(C)+3],w[am.toString(8*C)+Yn.substr(C)+4]),c}(),function(d,e,j){for(var k=0;k<j.size();k++){var C=j.get(k);d.co(C)&&e.add(C)}for(k=0;k<j.size();k++)C=j.get(k),On(d,e,C._children)}),Nl=function($,q,W){for(var p=0;p<W.size();p++){var T=W.get(W.size()-1-p);$.co(T)&&q.add(T)}for(p=0;p<W.size();p++)T=W.get(p),Nl($,q,T._children)},Km=function(r,e,g){for(var M=!1,Q=0;Q<g.size();Q++){var i=g.get(Q);r.co(i)?M&&e.add(i):M=1}for(Q=0;Q<g.size();Q++)i=g.get(Q),Km(r,e,i._children)},bb=function(_,m,A){for(var z=!1,M=0;M<A.size();M++){var h=A.get(A.size()-1-M);_.co(h)?z&&m.add(h):z=!0}for(M=0;M<A.size();M++)h=A.get(M),bb(_,m,h._children)},vs=F.moveDatas=function(y,r,Q,n){var U=n==N;if(0!==r||0!==Q||!U&&0!==n){var q=!0,L=[];if(y.forEach(function(c){q&&(c._69O||Ln(c)||Ym(c))&&(q=!1)}),q)L=y;else{var m={},K={};y.forEach(function(u){m[u._id]=!0});var J={},v=function(Z){var X=Z._id;return m[X]?(L.push(Z),J[X]=!0):J[X]=!1},$=function(k){var s=k._id;if(K[s])return v(k);var O=J[s];if(O!==I)return O;var l=k._parent;if(l&&(Ym(l)||Ln(l))&&$(l))return J[s]=!0;var X=k._host;return X&&(K[s]=s,O=$(X),K[s]=I,O)?J[s]=!0:v(k)};y.forEach(function(K){$(K)})}L.forEach(function(h){if(cl(h))U?h.translate(r,Q):h.translate3d(r,Q,n);else{var d=h.s(nb);if(!d||d.isEmpty())return;var p=new Ik;d.each(function(H){H=iq(H),U?(H.x+=r,H.y+=Q):(H.x+=r,H.y+=n,H.e==N?H.e=Q:H.e+=Q),p.add(H)}),h.s(nb,p)}})}},Pg=function(){function A(N,g){return g===N.substring(0,g.length)?!0:!1}function g(z){return parseFloat(z)||0}function m(L,S){if(S==I&&(S=new Ic),A(L,"matrix3d")){var R=L.substring(9,L.length-1).split(",");R=R.map(g),S.fromArray(R)}else if(A(L,"matrix")){var R=L.substring(7,L.length-1).split(",");R=R.map(g),S.el[0]=R[0],S.el[1]=R[1],S.el[2]=0,S.el[3]=0,S.el[4]=R[2],S.el[5]=R[3],S.el[6]=0,S.el[7]=0,S.el[8]=0,S.el[9]=0,S.el[10]=1,S.el[11]=0,S.el[12]=R[4],S.el[13]=R[5],S.el[14]=0,S.el[15]=1}return S}function H(B,x){x==I&&(x=new Vg);var P=B.split(/\s+/);return P=P.map(g),x.set(P[0]||0,P[1]||0,P[2]||0),x}var i,l,Q,N,b,h=function(K,M){i||(i=new Ic,l=new Vg,Q=new Ic,N=new Ic,b=new Ic),M==I&&(M=new Ic);var U=getComputedStyle(K);U.transform&&"none"!==U.transform&&(m(U.transform,i),H(U.transformOrigin,l),N.setPosition(l),l.negate(),b.setPosition(l),(ts||"preserve-3d"!==U.transformStyle)&&(i.el[8]=0,i.el[9]=0,i.el[10]=1,i.el[11]=0),M.multiplyMatrices(b,M),M.multiplyMatrices(i,M),M.multiplyMatrices(N,M)),!ts&&U.perspective&&"none"!==U.perspective&&(Q.el[11]=-1/g(U.perspective),H(U.perspectiveOrigin,l),N.setPosition(l),l.negate(),b.setPosition(l),M.multiplyMatrices(b,M),M.multiplyMatrices(Q,M),M.multiplyMatrices(N,M));for(var y=K.offsetParent,R=K.offsetLeft,G=K.offsetTop,j=K.parentElement;j&&j!==y;){var v=getComputedStyle(j);if("none"!==v.transform||"none"!==v.perspective)break;j=j.parentElement}return j==I&&K!==K.ownerDocument.documentElement&&"fixed"!==U.position&&(j=K.ownerDocument.documentElement),y!=I&&y!=j&&(R-=j.offsetLeft,G-=j.offsetTop),j&&(R-=j.scrollLeft,G-=j.scrollTop),l.set(R,G,0),N.setPosition(l),M.multiplyMatrices(N,M),j&&h(j,M),M};return function(G,W){var b=G.parentElement;if(b){var E=b.updateAppendMatrix;if(E){delete b.updateAppendMatrix;var z=new Ic;h(b,z);var Z=new Ic;Z.getInverse(z),b._matrixAppend=Z,b._maxrixPreAppend=z}return W?b._matrixAppend:b._maxrixPreAppend}}}(),sc=function(M,$){for(;M&&!M.hasOwnProperty($);)M=C.getPrototypeOf(M);return M&&C.getOwnPropertyDescriptor(M,$)},ii=C.getPrototypeOf?function(k,i,T){var m=sc(i,T);m&&C.defineProperty(k,T,m)}:function(S,E,h){S[h]=E[h]},Dc={1:29,2:30,3:31,4:32,5:33,6:26,7:27,8:28,9:21,10:22,11:23,12:24,13:25,14:14,15:15,16:16,17:17,18:18,19:19,20:20,21:9,22:10,23:11,24:12,25:13,26:6,27:7,28:8,29:1,30:2,31:3,32:4,33:5,34:36,35:37,36:34,37:35,38:54,39:55,40:52,41:53,42:50,43:51,44:49,50:42,51:43,52:40,53:41,54:38,55:39},Sh=function(){var i={1:function(M,B){return{x:M.x-B.width/2,y:M.y-B.height/2}},2:function(Y,V){return{x:Y.x+V.width/2,y:Y.y-V.height/2}},3:function(V,r){return{x:V.x+V.width/2,y:V.y-r.height/2}},4:function(R,t){return{x:R.x+R.width-t.width/2,y:R.y-t.height/2}},5:function(G,$){return{x:G.x+G.width+$.width/2,y:G.y-$.height/2}},6:function(l){return{x:l.x,y:l.y}},7:function(Z){return{x:Z.x+Z.width/2,y:Z.y}},8:function(v){return{x:v.x+v.width,y:v.y}},9:function(l,R){return{x:l.x-R.width/2,y:l.y+R.height/2}},10:function(J,s){return{x:J.x+s.width/2,y:J.y+s.height/2}},11:function(W,D){return{x:W.x+W.width/2,y:W.y+D.height/2}},12:function(z,q){return{x:z.x-q.width/2+z.width,y:z.y+q.height/2}},13:function(N,O){return{x:N.x+N.width+O.width/2,y:N.y+O.height/2}},14:function(V,s){return{x:V.x-s.width/2,y:V.y+V.height/2}},15:function(y){return{x:y.x,y:y.y+y.height/2}},16:function(l,b){return{x:l.x+b.width/2,y:l.y+l.height/2}},17:function(e){return{x:e.x+e.width/2,y:e.y+e.height/2}},18:function(h,W){return{x:h.x+h.width-W.width/2,y:h.y+h.height/2}},19:function(J){return{x:J.x+J.width,y:J.y+J.height/2}},20:function(d,o){return{x:d.x+d.width+o.width/2,y:d.y+d.height/2}},21:function(W,N){return{x:W.x-N.width/2,y:W.y+W.height-N.height/2}},22:function(Y,o){return{x:Y.x+o.width/2,y:Y.y+Y.height-o.height/2}},23:function(u,f){return{x:u.x+u.width/2,y:u.y+u.height-f.height/2}},24:function(E,g){return{x:E.x+E.width-g.width/2,y:E.y+E.height-g.height/2}},25:function(A,C){return{x:A.x+A.width+C.width/2,y:A.y+A.height-C.height/2}},26:function(M){return{x:M.x,y:M.y+M.height}},27:function(D){return{x:D.x+D.width/2,y:D.y+D.height}},28:function(t){return{x:t.x+t.width,y:t.y+t.height}},29:function(W,K){return{x:W.x-K.width/2,y:W.y+W.height+K.height/2}},30:function(v,O){return{x:v.x+O.width/2,y:v.y+v.height+O.height/2}},31:function(a,r){return{x:a.x+a.width/2,y:a.y+a.height+r.height/2}},32:function(H,q){return{x:H.x+H.width-q.width/2,y:H.y+H.height+q.height/2}},33:function(u,n){return{x:u.x+u.width+n.width/2,y:u.y+u.height+n.height/2}},34:function(m,N){return{x:m.x,y:m.y-N.height/2}},35:function(c,W){return{x:c.x+c.width,y:c.y-W.height/2}},36:function(Z,w){return{x:Z.x,y:Z.y+Z.height+w.height/2}},37:function(m,e){return{x:m.x+m.width,y:m.y+m.height+e.height/2}},38:function(X,j){return{x:X.x+X.width/4,y:X.y-j.height/2}},39:function(j,z){return{x:j.x+3*j.width/4,y:j.y-z.height/2}},40:function(G){return{x:G.x+G.width/4,y:G.y}},41:function(m){return{x:m.x+3*m.width/4,y:m.y}},42:function(b,y){return{x:b.x+b.width/4,y:b.y+y.height/2}},43:function(d,W){return{x:d.x+3*d.width/4,y:d.y+W.height/2}},44:function(X,P){return{x:X.x+X.width/2,y:X.y+X.height/2-P.height/2}},45:function(u){return{x:u.x+u.width/4,y:u.y+u.height/2}},46:function(u,K){return{x:u.x+u.width/2-K.width/2,y:u.y+u.height/2}},47:function(r,u){return{x:r.x+r.width/2+u.width/2,y:r.y+r.height/2}},48:function(Y){return{x:Y.x+3*Y.width/4,y:Y.y+Y.height/2}},49:function(Q,n){return{x:Q.x+Q.width/2,y:Q.y+Q.height/2+n.height/2}},50:function(G,t){return{x:G.x+G.width/4,y:G.y+G.height-t.height/2}},51:function(c,r){return{x:c.x+3*c.width/4,y:c.y+c.height-r.height/2}},52:function(u){return{x:u.x+u.width/4,y:u.y+u.height}},53:function(G){return{x:G.x+3*G.width/4,y:G.y+G.height}},54:function(C,B){return{x:C.x+C.width/4,y:C.y+C.height+B.height/2}},55:function(D,f){return{x:D.x+3*D.width/4,y:D.y+D.height+f.height/2}}};return kf(w)?function(w,E,t){return i[w](E,t?t:ro)}:void 0}();xo(B,{highlight:"#1ABC9C",label:"#000",labelSelect:"#FFF",transparent:"rgba(0,0,0,0.35)",titleBackground:"#2C3E50",titleIconBackground:"#868686",headerBackground:"#ECF0F1",headerIconBackground:"#868686",headerSeparator:"#868686",headerLine:"#D9D9D9",background:"#FFF",disabledBackground:"rgba(255,255,255,0.65)",toolTipBackground:"#FFFFE0",rectSelectBorder:"#45C4F9",rectSelectBackground:"rgba(0,0,0,0.35)",editPointBorder:"#2C3E50",editPointBackground:"#D9D9D9",dash:"#2C3E50",groupBackground:"#ECF0F1",groupTitleBackground:"#2C3E50",gridBackground:"#D9D9D9",gridCellBorderColor:"#868686",gridBlockColor:"#868686",reverse:"#868686",contentIconBackground:"#868686",contentLine:"#D9D9D9",widgetBackground:"#ECF0F1",widgetBorder:"#D9D9D9",widgetIconBackground:"#868686",widgetIconBorder:"#868686",widgetIconGradient:"#D9D9D9",widgetIconHighlight:"#43AFF1",imageBackground:"#3498DB",imageGradient:"#FFF",chart:["#2f7ed8","#0d233a","#8bbc21","#910000","#1aadce","#492970","#f28f43","#77a1e5","#c42525","#a6c96a"]},!0);var ap=B.reverse,Sg=B.transparent,wj=B.rectSelectBackground,Lp=B.dash,Od=B.titleBackground,Up=B.titleIconBackground,jo=B.headerBackground,pn=B.headerIconBackground,Eg=B.headerSeparator,Be=B.headerLine,uj=B.contentIconBackground,Pd=B.contentLine,dn=(B.widgetIconHighlight,B.widgetIconBorder),Cs=(B.widgetIconGradient,B.imageBackground),af=B.imageGradient,Bg=B.highlight,Eo=B.label,uq=B.labelSelect;if(Xo&&!w.shutAlert1){var gc=new Date,Jl=Xo.split("-"),op=new Date(gc.getFullYear(),gc.getMonth(),gc.getDate()),Xo=new Date(Oc(Jl[0],10),Oc(Jl[1],10)-1,Oc(Jl[2],10)),ad=op.getTime(),ig=Xo.getTime(),$h=D+"_try",gf=w.alert;try{var mf=w.localStorage;if(mf&&gf)if(ig>ad&&1728e6>ig-ad){var Cp=(ig-ad)/864e5;mf&&mf[$h]!=Cp&&(mf[$h]=Cp,w.htWillExpire?gf(w.htWillExpire.replace("{{day}}",Cp)):gf("HT for Web free trial license will expire in "+Cp+" days, please apply for a new license!"))}else ad>=ig&&(w.htExpired?gf(w.htExpired):gf("Your free trial of HT for Web has expired!")),mf&&delete mf[$h]}catch(Ar){}}Math.sign===I&&(Math.sign=function(J){return 0>J?-1:J>0?1:+J});var ik="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Ll={encode:function(C,F){var N,L,m,e,l,b,o,T="",H=0;for(C=unescape(encodeURIComponent(C));H<C.length;)N=C.charCodeAt(H++),L=C.charCodeAt(H++),m=C.charCodeAt(H++),e=N>>2,l=(3&N)<<4|L>>4,b=(15&L)<<2|m>>6,o=63&m,isNaN(L)?b=o=64:isNaN(m)&&(o=64),T=T+F.charAt(e)+F.charAt(l)+F.charAt(b)+F.charAt(o);return T},decode:function(D,K,N){for(var t,T,P,F,b,V,x,e="",z=N||0;z<D.length;)F=K.indexOf(D.charAt(z++)),b=K.indexOf(D.charAt(z++)),V=K.indexOf(D.charAt(z++)),x=K.indexOf(D.charAt(z++)),t=F<<2|b>>4,T=(15&b)<<4|V>>2,P=(3&V)<<6|x,e+=String.fromCharCode(t),64!=V&&(e+=String.fromCharCode(T)),64!=x&&(e+=String.fromCharCode(P));return e=decodeURIComponent(escape(e))},_utf8_encode:function(k){k=k.replace(/\r\n/g,"\n");for(var S="",Q=0;Q<k.length;Q++){var w=k.charCodeAt(Q);128>w?S+=String.fromCharCode(w):w>127&&2048>w?(S+=String.fromCharCode(192|w>>6),S+=String.fromCharCode(128|63&w)):(S+=String.fromCharCode(224|w>>12),S+=String.fromCharCode(128|63&w>>6),S+=String.fromCharCode(128|63&w))}return S},_utf8_decode:function(z){for(var O="",T=0,S=0,o=0,B=0;T<z.length;)S=z.charCodeAt(T),128>S?(O+=String.fromCharCode(S),T++):S>191&&224>S?(o=z.charCodeAt(T+1),O+=String.fromCharCode((31&S)<<6|63&o),T+=2):(o=z.charCodeAt(T+1),B=z.charCodeAt(T+2),O+=String.fromCharCode((15&S)<<12|(63&o)<<6|63&B),T+=3);return O}},Ui=[],Fg=[],fl=y.Math={generateUUID:function(){for(var W=[],i=0;256>i;i++)W[i]=(16>i?"0":"")+i.toString(16).toUpperCase();return function(){var F=0|4294967295*Math.random(),Y=0|4294967295*Math.random(),o=0|4294967295*Math.random(),Z=0|4294967295*Math.random();return W[255&F]+W[255&F>>8]+W[255&F>>16]+W[255&F>>24]+"-"+W[255&Y]+W[255&Y>>8]+"-"+W[64|15&Y>>16]+W[255&Y>>24]+"-"+W[128|63&o]+W[255&o>>8]+"-"+W[255&o>>16]+W[255&o>>24]+W[255&Z]+W[255&Z>>8]+W[255&Z>>16]+W[255&Z>>24]}}(),clamp:function(z,W,L){return Math.max(W,Math.min(L,z))},fequal:function(L,B,l){return null==l&&(l=1e-8),Math.abs(L-B)<l},generateIncreasingID:function(){var M=0;return function(){return++M}}(),encodeBase64:function(h,u){return Ll.encode(h,u||ik)},decodeBase64:function(j,k){return Ll.decode(j,k||ik)},randomArray:function(T,Q){Q=Q||T.length;for(var p=Q-1;p>0;p--){var m=Math.floor(Math.random()*(p+1)),e=T[p];T[p]=T[m],T[m]=e}return T},randomInt:function(W,e){return e===I&&(e=W,W=0),W+Math.floor(Math.random()*(e-W))},randomFloat:function(R,p){return p===I&&(p=R,R=0),R+Math.random()*(p-R)},isPOT:function(q){return q>0&&0===(q-1&q)},nearestPOT:function(W){if(!W)return 1;var Q=W;Q--,Q|=Q>>1,Q|=Q>>2,Q|=Q>>4,Q|=Q>>8,Q|=Q>>16,Q++;var C=Q>>1;return W-C>Q-W?Q:C},requestMatrix4:function(){return Ui.length>0?Ui.pop():new fl.Matrix4},releaseMatrix4:function($){Ui.push($)},requestVector3:function(){return Fg.length>0?Fg.pop():new fl.Vector3},releaseVector3:function(v){Fg.push(v)}},Xn=y.Matrix=y.Math.Matrix2d=function(R,I,w,Q,H){this.setFromTransform(R,I,w,Q,H)},zg=Xn;Xn.prototype={},Xn.prototype.constructor=Xn,Xn.prototype.set=function(s,W,V,D,Y,n){return this.a=s,this.b=W,this.c=V,this.d=D,this.tx=Y,this.ty=n,this},Xn.prototype.setFromTransform=function(J,k,X,z,w){var C=this;if(J===I)return C.a=1,C.b=0,C.c=0,C.d=1,C.tx=0,C.ty=0,void 0;var G,h;return J?(G=W(J),h=s(J)):(G=0,h=1),z=z||1,w=w||1,C.a=h*z,C.b=G*z,C.c=-G*w,C.d=h*w,C.tx=k||0,C.ty=X||0,C},Xn.prototype.apply=function(T,$){$=$||new of;var K=T.x,u=T.y;return $.x=this.a*K+this.c*u+this.tx,$.y=this.b*K+this.d*u+this.ty,$},Xn.prototype.applyInverse=function(L,a){a=a||new of;var V=1/(this.a*this.d+this.c*-this.b),p=L.x,n=L.y;return a.x=this.d*V*p+-this.c*V*n+(this.ty*this.c-this.tx*this.d)*V,a.y=this.a*V*n+-this.b*V*p+(-this.ty*this.a+this.tx*this.b)*V,a},Xn.prototype.translate=function(b,v){return this.tx+=b,this.ty+=v,this},Xn.prototype.scale=function(t,L){return this.a*=t,this.d*=L,this.c*=t,this.b*=L,this.tx*=t,this.ty*=L,this},Xn.prototype.rotate=function(Y){var Z=Math.cos(Y),L=Math.sin(Y),q=this.a,X=this.c,I=this.tx;return this.a=q*Z-this.b*L,this.b=q*L+this.b*Z,this.c=X*Z-this.d*L,this.d=X*L+this.d*Z,this.tx=I*Z-this.ty*L,this.ty=I*L+this.ty*Z,this},Xn.prototype.appendTranslate=function(S,b){return this.tx+=this.a*S+this.c*b,this.ty+=this.b*S+this.d*b,this},Xn.prototype.appendScale=function(x,c){return this.a*=x,this.d*=c,this.c*=c,this.b*=x,this},Xn.prototype.appendRotate=function(K){if(!K)return this;var p=Math.cos(K),k=Math.sin(K),n=this.a,$=this.b;return this.a=n*p+this.c*k,this.b=$*p+this.d*k,this.c=-n*k+this.c*p,this.d=-$*k+this.d*p,this},Xn.prototype.append=function(i){var Y=this.a,H=this.b,m=this.c,y=this.d;return this.a=i.a*Y+i.b*m,this.b=i.a*H+i.b*y,this.c=i.c*Y+i.d*m,this.d=i.c*H+i.d*y,this.tx=i.tx*Y+i.ty*m+this.tx,this.ty=i.tx*H+i.ty*y+this.ty,this},Xn.prototype.setTransform=function(S,F,J,H,W,L,s,N,T){var $,a,l,y,V,r,k,i,p,B;return V=Math.sin(s),r=Math.cos(s),k=Math.cos(T),i=Math.sin(T),p=-Math.sin(N),B=Math.cos(N),$=r*W,a=V*W,l=-V*L,y=r*L,this.a=k*$+i*l,this.b=k*a+i*y,this.c=p*$+B*l,this.d=p*a+B*y,this.tx=S+(J*$+H*l),this.ty=F+(J*a+H*y),this},Xn.prototype.prepend=function(Z){var X=this.tx;if(1!==Z.a||0!==Z.b||0!==Z.c||1!==Z.d){var s=this.a,c=this.c;this.a=s*Z.a+this.b*Z.c,this.b=s*Z.b+this.b*Z.d,this.c=c*Z.a+this.d*Z.c,this.d=c*Z.b+this.d*Z.d}return this.tx=X*Z.a+this.ty*Z.c+Z.tx,this.ty=X*Z.b+this.ty*Z.d+Z.ty,this},Xn.prototype.transform=Xn.prototype.prepend,Xn.prototype.invert=function(){var U=this.a,I=this.b,Y=this.c,P=this.d,S=this.tx,V=U*P-I*Y;return this.a=P/V,this.b=-I/V,this.c=-Y/V,this.d=U/V,this.tx=(Y*this.ty-P*S)/V,this.ty=-(U*this.ty-I*S)/V,this},Xn.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},Xn.prototype.clone=function(){var A=new Xn;return A.a=this.a,A.b=this.b,A.c=this.c,A.d=this.d,A.tx=this.tx,A.ty=this.ty,A},Xn.prototype.copy=function(g){return g.a=this.a,g.b=this.b,g.c=this.c,g.d=this.d,g.tx=this.tx,g.ty=this.ty,g},Xn.prototype.tf=function(W,x){1===arguments.length&&(x=W.y,W=W.x);var u=this;return{x:u.a*W+u.c*x+u.tx,y:u.b*W+u.d*x+u.ty}},Xn.prototype.toArray=function(){return[this.a,this.b,this.c,this.d,this.tx,this.ty]},Xn.prototype.fromArray=function(Q){return this.a=Q[0],this.b=Q[1],this.c=Q[2],this.d=Q[3],this.tx=Q[4],this.ty=Q[5],this},Xn.prototype.toArray9=function(){return[this.a,this.b,0,this.c,this.d,0,this.tx,this.ty,1]},Xn.prototype.tfi=function(h,n){1===arguments.length&&(n=h.y,h=h.x);var D=this,F=1/(D.a*D.d+D.c*-D.b);return{x:D.d*F*h+-D.c*F*n+(D.ty*D.c-D.tx*D.d)*F,y:D.a*F*n+-D.b*F*h+(-D.ty*D.a+D.tx*D.b)*F}},Xn.prototype.decompose=function(){var O=this,A=O.a,g=O.b,i=O.c,z=O.d,C=Math.sqrt(A*A+g*g),v=Math.sqrt(i*i+z*z),t=A*z-g*i;return 0>t&&(z>A?C=-C:v=-v),C&&(A*=1/C,g*=1/C),v&&(i*=1/v,z*=1/v),{translateX:O.tx,translateY:O.ty,rotation:Math.atan2(g,A),scaleX:C,scaleY:v}},Xn.IDENTITY=new Xn,Xn.TEMP_MATRIX=new Xn;var $i=y.Math.Quaternion=function(r,Z,v,t){this.set(r,Z,v,t)};C.assign($i.prototype,{set:function(T,K,s,w){var E=this;return E._x=T||0,E._y=K||0,E._z=s||0,E._w=w!==I?w:1,E},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(R){var I=this;return I._x=R._x,I._y=R._y,I._z=R._z,I._w=R._w,I},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this},dot:function(K){return this._x*K._x+this._y*K._y+this._z*K._z+this._w*K._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var D=this.length();return 0===D?(this._x=0,this._y=0,this._z=0,this._w=1):(D=1/D,this._x=this._x*D,this._y=this._y*D,this._z=this._z*D,this._w=this._w*D),this},fromArray:function(o,y){y===I&&(y=0);var g=this;return g._x=o[y],g._y=o[y+1],g._z=o[y+2],g._w=o[y+3],this},slerp:function(o,H){if(0===H)return this;if(1===H)return this.copy(o);var s=this._x,S=this._y,k=this._z,K=this._w,g=K*o._w+s*o._x+S*o._y+k*o._z;if(0>g?(this._w=-o._w,this._x=-o._x,this._y=-o._y,this._z=-o._z,g=-g):this.copy(o),g>=1)return this._w=K,this._x=s,this._y=S,this._z=k,this;var t=Math.sqrt(1-g*g);if(Math.abs(t)<.001)return this._w=.5*(K+this._w),this._x=.5*(s+this._x),this._y=.5*(S+this._y),this._z=.5*(k+this._z),this;var x=Math.atan2(t,g),X=Math.sin((1-H)*x)/t,q=Math.sin(H*x)/t;return this._w=K*X+this._w*q,this._x=s*X+this._x*q,this._y=S*X+this._y*q,this._z=k*X+this._z*q,this},setFromAxisAngle:function(f,e){var E=e/2,p=Math.sin(E);return this._x=f.x*p,this._y=f.y*p,this._z=f.z*p,this._w=Math.cos(E),this},setFromEuler:function(X){var R=X._x,g=X._y,W=X._z,$=X._order,v=Math.cos,p=Math.sin,a=v(R/2),U=v(g/2),G=v(W/2),q=p(R/2),x=p(g/2),Y=p(W/2);return"XYZ"===$?(this._x=q*U*G+a*x*Y,this._y=a*x*G-q*U*Y,this._z=a*U*Y+q*x*G,this._w=a*U*G-q*x*Y):"YXZ"===$?(this._x=q*U*G+a*x*Y,this._y=a*x*G-q*U*Y,this._z=a*U*Y-q*x*G,this._w=a*U*G+q*x*Y):"ZXY"===$?(this._x=q*U*G-a*x*Y,this._y=a*x*G+q*U*Y,this._z=a*U*Y+q*x*G,this._w=a*U*G-q*x*Y):"ZYX"===$?(this._x=q*U*G-a*x*Y,this._y=a*x*G+q*U*Y,this._z=a*U*Y-q*x*G,this._w=a*U*G+q*x*Y):"YZX"===$?(this._x=q*U*G+a*x*Y,this._y=a*x*G+q*U*Y,this._z=a*U*Y-q*x*G,this._w=a*U*G-q*x*Y):"XZY"===$&&(this._x=q*U*G-a*x*Y,this._y=a*x*G-q*U*Y,this._z=a*U*Y+q*x*G,this._w=a*U*G+q*x*Y),this},setFromRotationMatrix:function(i){var e,Q=i.el,Z=Q[0],g=Q[4],G=Q[8],T=Q[1],K=Q[5],O=Q[9],k=Q[2],_=Q[6],c=Q[10],U=Z+K+c;return U>0?(e=.5/Math.sqrt(U+1),this._w=.25/e,this._x=(_-O)*e,this._y=(G-k)*e,this._z=(T-g)*e):Z>K&&Z>c?(e=2*Math.sqrt(1+Z-K-c),this._w=(_-O)/e,this._x=.25*e,this._y=(g+T)/e,this._z=(G+k)/e):K>c?(e=2*Math.sqrt(1+K-Z-c),this._w=(G-k)/e,this._x=(g+T)/e,this._y=.25*e,this._z=(O+_)/e):(e=2*Math.sqrt(1+c-Z-K),this._w=(T-g)/e,this._x=(G+k)/e,this._y=(O+_)/e,this._z=.25*e),this},setFromToVectors:function(){var h,D;return function(c,q){return h===I&&(h=new Vg),D=c.dot(q)+1,1e-7>D?(D=0,Math.abs(c.x)>Math.abs(c.z)?h.set(-c.y,c.x,0):h.set(0,-c.z,c.y)):h.crossVectors(c,q),this._x=h.x,this._y=h.y,this._z=h.z,this._w=D,this.normalize()}}(),setFromUnitVectors:function(){var R,E,b=1e-6;return function(M,J){return R===I&&(R=new Vg),E=M.dot(J)+1,b>E?(E=0,Math.abs(M.x)>Math.abs(M.z)?R.set(-M.y,M.x,0):R.set(0,-M.z,M.y)):R.crossVectors(M,J),this._x=R.x,this._y=R.y,this._z=R.z,this._w=E,this.normalize()}}(),multiply:function(B){return this.multiplyQuaternions(this,B)},premultiply:function(t){return this.multiplyQuaternions(t,this)},multiplyQuaternions:function(n,r){var q=n._x,y=n._y,W=n._z,R=n._w,N=r._x,Y=r._y,l=r._z,p=r._w;return this._x=q*p+R*N+y*l-W*Y,this._y=y*p+R*Y+W*N-q*l,this._z=W*p+R*l+q*Y-y*N,this._w=R*p-q*N-y*Y-W*l,this},toArray:function(h,G){return h||(h=[]),G=G||0,h[G]=this._x,h[G+1]=this._y,h[G+2]=this._z,h[G+3]=this._w,h}});var Ye=y.Math.Vector4=function(V,P,D,F){this.x=V||0,this.y=P||0,this.z=D||0,this.w=F!==I?F:1};C.assign(Ye.prototype,{isVector4:!0,set:function(i,U,I,n){return this.x=i,this.y=U,this.z=I,this.w=n,this},setScalar:function(Y){return this.x=Y,this.y=Y,this.z=Y,this.w=Y,this},setX:function(C){return this.x=C,this},setY:function(G){return this.y=G,this},setZ:function(l){return this.z=l,this},setW:function(E){return this.w=E,this},setComponent:function(q,D){switch(q){case 0:this.x=D;break;case 1:this.y=D;break;case 2:this.z=D;break;case 3:this.w=D;break;default:throw new Error("index is out of range: "+q)}return this},getComponent:function(m){switch(m){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+m)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(H){return this.x=H.x,this.y=H.y,this.z=H.z,this.w=H.w!==I?H.w:1,this},add:function(R,u){return u!==I?this.addVectors(R,u):(this.x+=R.x,this.y+=R.y,this.z+=R.z,this.w+=R.w,this)},addScalar:function(U){return this.x+=U,this.y+=U,this.z+=U,this.w+=U,this},addVectors:function(v,q){return this.x=v.x+q.x,this.y=v.y+q.y,this.z=v.z+q.z,this.w=v.w+q.w,this},addScaledVector:function(Y,e){return this.x+=Y.x*e,this.y+=Y.y*e,this.z+=Y.z*e,this.w+=Y.w*e,this},sub:function(O,W){return W!==I?this.subVectors(O,W):(this.x-=O.x,this.y-=O.y,this.z-=O.z,this.w-=O.w,this)},subScalar:function(n){return this.x-=n,this.y-=n,this.z-=n,this.w-=n,this},subVectors:function(I,c){return this.x=I.x-c.x,this.y=I.y-c.y,this.z=I.z-c.z,this.w=I.w-c.w,this},multiplyScalar:function(D){return this.x*=D,this.y*=D,this.z*=D,this.w*=D,this},applyMatrix4:function(M){var S=this.x,I=this.y,H=this.z,O=this.w,j=M.el;
return this.x=j[0]*S+j[4]*I+j[8]*H+j[12]*O,this.y=j[1]*S+j[5]*I+j[9]*H+j[13]*O,this.z=j[2]*S+j[6]*I+j[10]*H+j[14]*O,this.w=j[3]*S+j[7]*I+j[11]*H+j[15]*O,this},divideScalar:function(G){return this.multiplyScalar(1/G)},setAxisAngleFromQuaternion:function(f){this.w=2*Math.acos(f.w);var b=Math.sqrt(1-f.w*f.w);return 1e-4>b?(this.x=1,this.y=0,this.z=0):(this.x=f.x/b,this.y=f.y/b,this.z=f.z/b),this},setAxisAngleFromRotationMatrix:function(S){var B,W,w,q,$=.01,J=.1,O=S.el,g=O[0],n=O[4],x=O[8],e=O[1],M=O[5],G=O[9],T=O[2],b=O[6],P=O[10];if(Math.abs(n-e)<$&&Math.abs(x-T)<$&&Math.abs(G-b)<$){if(Math.abs(n+e)<J&&Math.abs(x+T)<J&&Math.abs(G+b)<J&&Math.abs(g+M+P-3)<J)return this.set(1,0,0,0),this;B=Math.PI;var j=(g+1)/2,C=(M+1)/2,l=(P+1)/2,d=(n+e)/4,p=(x+T)/4,N=(G+b)/4;return j>C&&j>l?$>j?(W=0,w=.707106781,q=.707106781):(W=Math.sqrt(j),w=d/W,q=p/W):C>l?$>C?(W=.707106781,w=0,q=.707106781):(w=Math.sqrt(C),W=d/w,q=N/w):$>l?(W=.707106781,w=.707106781,q=0):(q=Math.sqrt(l),W=p/q,w=N/q),this.set(W,w,q,B),this}var f=Math.sqrt((b-G)*(b-G)+(x-T)*(x-T)+(e-n)*(e-n));return Math.abs(f)<.001&&(f=1),this.x=(b-G)/f,this.y=(x-T)/f,this.z=(e-n)/f,this.w=Math.acos((g+M+P-1)/2),this},min:function(M){return this.x=Math.min(this.x,M.x),this.y=Math.min(this.y,M.y),this.z=Math.min(this.z,M.z),this.w=Math.min(this.w,M.w),this},max:function(i){return this.x=Math.max(this.x,i.x),this.y=Math.max(this.y,i.y),this.z=Math.max(this.z,i.z),this.w=Math.max(this.w,i.w),this},clamp:function(O,A){return this.x=Math.max(O.x,Math.min(A.x,this.x)),this.y=Math.max(O.y,Math.min(A.y,this.y)),this.z=Math.max(O.z,Math.min(A.z,this.z)),this.w=Math.max(O.w,Math.min(A.w,this.w)),this},clampScalar:function(){var S,W;return function(R,A){return S===I&&(S=new Ye,W=new Ye),S.set(R,R,R,R),W.set(A,A,A,A),this.clamp(S,W)}}(),clampLength:function(M,L){var v=this.length();return this.divideScalar(v||1).multiplyScalar(Math.max(M,Math.min(L,v)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(C){return this.x*C.x+this.y*C.y+this.z*C.z+this.w*C.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(Z){return this.normalize().multiplyScalar(Z)},lerp:function(l,M){return this.x+=(l.x-this.x)*M,this.y+=(l.y-this.y)*M,this.z+=(l.z-this.z)*M,this.w+=(l.w-this.w)*M,this},lerpVectors:function(m,W,o){return this.subVectors(W,m).multiplyScalar(o).add(m)},equals:function(W){return W.x===this.x&&W.y===this.y&&W.z===this.z&&W.w===this.w},fromArray:function(W,P){return P===I&&(P=0),this.x=W[P],this.y=W[P+1],this.z=W[P+2],this.w=W[P+3],this},toArray:function(P,v){return P===I&&(P=[]),v===I&&(v=0),P[v]=this.x,P[v+1]=this.y,P[v+2]=this.z,P[v+3]=this.w,P},fromBufferAttribute:function(d,E){return this.x=d.getX(E),this.y=d.getY(E),this.z=d.getZ(E),this.w=d.getW(E),this}});var Vg=y.Math.Vector3=function(X,n,l){X===I?(this.x=0,this.y=0,this.z=0):"object"==typeof X?this.copy(X):this.set(X,n==I?X:n,l==I?X:l)},zh=y.Math.Vector3;C.assign(Vg.prototype,{isNaN:function(){return isNaN(this.x)||isNaN(this.y)||isNaN(this.z)},set:function($,s,j){return this.x=$,this.y=s,this.z=j,this},equals:function(J){return J&&this.x===J.x&&this.y===J.y&&this.z===J.z},setScalar:function(T){return this.x=T,this.y=T,this.z=T,this},setX:function(x){return this.x=x,this},setY:function(s){return this.y=s,this},setZ:function(j){return this.z=j,this},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(s){return s.x===I?(this.x=s[0],this.y=s[1],this.z=s[2]):(this.x=s.x,this.y=s.y,this.z=s.z||0),this},add:function(N){return this.x+=N.x,this.y+=N.y,this.z+=N.z,this},addScalar:function(D){return this.x+=D,this.y+=D,this.z+=D,this},addVectors:function($,H){return this.x=$.x+H.x,this.y=$.y+H.y,this.z=$.z+H.z,this},addScaledVector:function(e,b){return this.x+=e.x*b,this.y+=e.y*b,this.z+=e.z*b,this},sub:function(B){return this.x-=B.x,this.y-=B.y,this.z-=B.z,this},subScalar:function(x){return this.x-=x,this.y-=x,this.z-=x,this},subVectors:function(C,O){return this.x=C.x-O.x,this.y=C.y-O.y,this.z=C.z-O.z,this},divide:function(Q){return this.x/=Q.x,this.y/=Q.y,this.z/=Q.z,this},multiply:function(x){return this.x*=x.x,this.y*=x.y,this.z*=x.z,this},multiplyScalar:function(A){return this.x*=A,this.y*=A,this.z*=A,this},divideScalar:function(D){if(0!==D){var L=1/D;this.x*=L,this.y*=L,this.z*=L}else this.x=0,this.y=0,this.z=0;return this},distanceTo:function(N){return Math.sqrt(this.distanceToSquared(N))},distanceToSquared:function(T){var V=this.x-T.x,F=this.y-T.y,B=this.z-T.z;return V*V+F*F+B*B},distanceToSquared2:function($){var u=this.x-$[0],T=this.y-$[1],C=this.z-$[2];return u*u+T*T+C*C},divideVectors:function(O,y){return this.x=O.x/y.x,this.y=O.y/y.y,this.z=O.z/y.z,this},multiplyVectors:function(Z,$){return this.x=Z.x*$.x,this.y=Z.y*$.y,this.z=Z.z*$.z,this},transformDirection:function(C){var u=this.x,k=this.y,z=this.z,l=C.el;return this.x=l[0]*u+l[4]*k+l[8]*z,this.y=l[1]*u+l[5]*k+l[9]*z,this.z=l[2]*u+l[6]*k+l[10]*z,this.normalize()},applyAxisAngle:function(){var d=new $i;return function(H,y){return this.applyQuaternion(d.setFromAxisAngle(H,y))}}(),applyEuler:function(){var N=new $i;return function(F){return this.applyQuaternion(N.setFromEuler(F))}}(),applyQuaternion:function(M){var X=this.x,U=this.y,O=this.z,L=M._x,h=M._y,H=M._z,$=M._w,T=$*X+h*O-H*U,z=$*U+H*X-L*O,b=$*O+L*U-h*X,t=-L*X-h*U-H*O;return this.x=T*$+t*-L+z*-H-b*-h,this.y=z*$+t*-h+b*-L-T*-H,this.z=b*$+t*-H+T*-h-z*-L,this},applyMatrix4:function(C){var L=this.x,o=this.y,D=this.z,s=C.el,F=1/(s[3]*L+s[7]*o+s[11]*D+s[15]);return this.x=(s[0]*L+s[4]*o+s[8]*D+s[12])*F,this.y=(s[1]*L+s[5]*o+s[9]*D+s[13])*F,this.z=(s[2]*L+s[6]*o+s[10]*D+s[14])*F,this},applyMatrix3:function(i){var S=this.x,C=this.y,N=this.z,w=i.el;return this.x=w[0]*S+w[3]*C+w[6]*N,this.y=w[1]*S+w[4]*C+w[7]*N,this.z=w[2]*S+w[5]*C+w[8]*N,this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},reflect:function(){var Z=new Vg;return function(u){return this.sub(Z.copy(u).multiplyScalar(2*this.dot(u)))}}(),dot:function(P){return this.x*P.x+this.y*P.y+this.z*P.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){var r=this.length();return r?this.multiplyScalar(1/r):this},setLength:function(w){return this.normalize().multiplyScalar(w)},fromArray:function(h,L){return L===I&&(L=0),this.x=h[L],this.y=h[L+1],this.z=h[L+2],this},toArray:function(q,$){return q===I&&(q=[0,0,0]),$===I&&($=0),q[$]=this.x,q[$+1]=this.y,q[$+2]=this.z,q},cross:function(K){return this.crossVectors(this,K)},angleTo:function(I){var K=this.dot(I)/Math.sqrt(this.lengthSq()*I.lengthSq());return K>1||-1>K?0:Math.acos(K)},lerp:function(R,c){return this.x+=(R.x-this.x)*c,this.y+=(R.y-this.y)*c,this.z+=(R.z-this.z)*c,this},lerpVectors:function(i,l,d){return this.subVectors(l,i).multiplyScalar(d).add(i)},crossVectors:function(m,B){var D=m.x,h=m.y,o=m.z,U=B.x,C=B.y,M=B.z;return this.x=h*M-o*C,this.y=o*U-D*M,this.z=D*C-h*U,this},min:function(q){return this.x=Math.min(this.x,q.x),this.y=Math.min(this.y,q.y),this.z=Math.min(this.z,q.z),this},max:function(i){return this.x=Math.max(this.x,i.x),this.y=Math.max(this.y,i.y),this.z=Math.max(this.z,i.z),this},setFromMatrixPosition:function(y){return this.setFromMatrixColumn(y,3)},setFromMatrixScale:function(t){var Z=this.setFromMatrixColumn(t,0).length(),f=this.setFromMatrixColumn(t,1).length(),S=this.setFromMatrixColumn(t,2).length();return this.x=Z,this.y=f,this.z=S,this},setFromMatrixColumn:function(Q,D){return this.fromArray(Q.el,4*D)}}),Vg.UP=new Vg(0,1,0),Vg.AxisX=new Vg(1,0,0),Vg.AxisY=new Vg(0,1,0),Vg.AxisZ=new Vg(0,0,1),Vg.normalizeArray=function(){var C=new Vg;return function(E){return C.copy(E).normalize().toArray()}}();var of=y.Math.Vector2=function(G,U,q){"object"==typeof G&&(G.x!=I?(U=G.y,q=G.e,G=G.x):(q=G[2],U=G[1],G=G[0])),this.set(G||0,U||0,q)};of.prototype={},of.prototype.constructor=of;var yg=of;C.defineProperties(of.prototype,{width:{get:function(){return this.x},set:function(K){this.x=K}},height:{get:function(){return this.y},set:function(N){this.y=N}}}),of.prototype.clone=function(){return new of(this.x,this.y,this.e)},of.prototype.copy=function(L){return this.set(L.x,L.y,L.e),this},of.prototype.equals=function(G){return G.x===this.x&&G.y===this.y&&G.e===this.e},of.prototype.set=function(u,f,O){return this.x=u||0,this.y=f||(0!==f?this.x:0),O!=I&&(this.e=O),this},of.prototype.setScalar=function(Q){return this.x=Q,this.y=Q,this.e=Q,this},of.prototype.setX=function(v){return this.x=v||0,this},of.prototype.setY=function(n){return this.y=n||0,this},of.prototype.setE=function(O){return this.e=O||0,this},of.prototype.add=function(X){return this.x+=X.x,this.y+=X.y,this},of.prototype.addVectors=function(r,Y){return this.x=r.x+Y.x,this.y=r.y+Y.y,this},of.prototype.addScalar=function(c){return this.x+=c,this.y+=c,this},of.prototype.addScaledVector=function(d,g){return this.x+=d.x*g,this.y+=d.y*g,this},of.prototype.sub=function(J){return this.x-=J.x,this.y-=J.y,this},of.prototype.subScalar=function(M){return this.x-=M,this.y-=M,this},of.prototype.subVectors=function(s,Z){return this.x=s.x-Z.x,this.y=s.y-Z.y,this},of.prototype.multiply=function(C){return this.x*=C.x,this.y*=C.y,this},of.prototype.multiplyScalar=function(H){return this.x*=H,this.y*=H,this},of.prototype.divide=function(v){return this.x/=v.x,this.y/=v.y,this},of.prototype.divideScalar=function(y){return this.multiplyScalar(1/y)},of.prototype.min=function(B){return this.x=Math.min(this.x,B.x),this.y=Math.min(this.y,B.y),this},of.prototype.max=function(k){return this.x=Math.max(this.x,k.x),this.y=Math.max(this.y,k.y),this},of.prototype.fromArray=function(X,W){return W===I&&(W=0),this.x=X[W],this.y=X[W+1],this},of.prototype.clamp=function(C,d){return this.x=Math.max(C.x,Math.min(d.x,this.x)),this.y=Math.max(C.y,Math.min(d.y,this.y)),this},of.prototype.clampScalar=function(){var U,H;return function(B,a){return U===I&&(U=new of,H=new of),U.set(B,B),H.set(a,a),this.clamp(U,H)}}(),of.prototype.clampLength=function(A,O){var M=this.length();return this.multiplyScalar(Math.max(A,Math.min(O,M))/M)},of.prototype.dot=function(z){return this.x*z.x+this.y*z.y},of.prototype.cross=function(B){return this.x*B.y-this.y*B.x},of.prototype.lengthSq=function(){return this.x*this.x+this.y*this.y},of.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},of.prototype.normalize=function(){return this.divideScalar(this.length())},of.prototype.angle=function(){var B=Math.atan2(this.y,this.x);return 0>B&&(B+=2*Math.PI),B},of.prototype.distanceTo=function(l){return Math.sqrt(this.distanceToSquared(l))},of.prototype.distanceToSquared=function(m){var N=this.x-m.x,A=this.y-m.y;return N*N+A*A},of.prototype.isNearEnough=function(s){return this.distanceToSquared(s)<1e-8},of.prototype.setLength=function(J){var h=this.length();return h?this.multiplyScalar(J/h):this},of.prototype.lerp=function(q,n){return this.x+=(q.x-this.x)*n,this.y+=(q.y-this.y)*n,"number"==typeof q.e&&"number"==typeof this.e&&(this.e+=(q.e-this.e)*n),this},of.prototype.lerpVectors=function(P,O,C){return this.subVectors(O,P).multiplyScalar(C).add(P)},of.prototype.rotateAround=function(J,n){var m=J?J.x:0,T=J?J.y:0,h=Math.cos(n),D=Math.sin(n),V=this.x-m,v=this.y-T;return this.x=V*h-v*D+m,this.y=V*D+v*h+T,this};var ns=y.Math.Matrix3=function(){this.el=[1,0,0,0,1,0,0,0,1]};C.assign(ns.prototype,{isMatrix3:!0,set:function(h,L,g,c,O,P,A,j,e){var E=this.el;return E[0]=h,E[1]=c,E[2]=A,E[3]=L,E[4]=O,E[5]=j,E[6]=g,E[7]=P,E[8]=e,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.el)},copy:function(T){var Z=this.el,C=T.el;return Z[0]=C[0],Z[1]=C[1],Z[2]=C[2],Z[3]=C[3],Z[4]=C[4],Z[5]=C[5],Z[6]=C[6],Z[7]=C[7],Z[8]=C[8],this},setFromMatrix4:function(S){var I=S.el;return this.set(I[0],I[4],I[8],I[1],I[5],I[9],I[2],I[6],I[10]),this},applyToBufferAttribute:function(){var K=new Vg;return function(g){for(var W=0,b=g.count;b>W;W++)K.x=g.getX(W),K.y=g.getY(W),K.z=g.getZ(W),K.applyMatrix3(this),g.setXYZ(W,K.x,K.y,K.z);return g}}(),multiply:function(G){return this.multiplyMatrices(this,G)},premultiply:function(Y){return this.multiplyMatrices(Y,this)},multiplyMatrices:function(v,j){var t=v.el,D=j.el,C=this.el,n=t[0],c=t[3],N=t[6],R=t[1],H=t[4],Q=t[7],P=t[2],g=t[5],p=t[8],V=D[0],U=D[3],Y=D[6],d=D[1],f=D[4],A=D[7],x=D[2],F=D[5],m=D[8];return C[0]=n*V+c*d+N*x,C[3]=n*U+c*f+N*F,C[6]=n*Y+c*A+N*m,C[1]=R*V+H*d+Q*x,C[4]=R*U+H*f+Q*F,C[7]=R*Y+H*A+Q*m,C[2]=P*V+g*d+p*x,C[5]=P*U+g*f+p*F,C[8]=P*Y+g*A+p*m,this},multiplyScalar:function(N){var s=this.el;return s[0]*=N,s[3]*=N,s[6]*=N,s[1]*=N,s[4]*=N,s[7]*=N,s[2]*=N,s[5]*=N,s[8]*=N,this},determinant:function(){var h=this.el,s=h[0],m=h[1],t=h[2],M=h[3],L=h[4],j=h[5],Q=h[6],n=h[7],e=h[8];return s*L*e-s*j*n-m*M*e+m*j*Q+t*M*n-t*L*Q},getInverse:function(P){var s=P.el,v=this.el,C=s[0],U=s[1],p=s[2],d=s[3],Q=s[4],n=s[5],D=s[6],L=s[7],y=s[8],R=y*Q-n*L,I=n*D-y*d,h=L*d-Q*D,j=C*R+U*I+p*h;if(0===j)return this.identity();var T=1/j;return v[0]=R*T,v[1]=(p*L-y*U)*T,v[2]=(n*U-p*Q)*T,v[3]=I*T,v[4]=(y*C-p*D)*T,v[5]=(p*d-n*C)*T,v[6]=h*T,v[7]=(U*D-L*C)*T,v[8]=(Q*C-U*d)*T,this},transpose:function(){var B,P=this.el;return B=P[1],P[1]=P[3],P[3]=B,B=P[2],P[2]=P[6],P[6]=B,B=P[5],P[5]=P[7],P[7]=B,this},getNormalMatrix:function(Z){return this.setFromMatrix4(Z).getInverse(this).transpose()},transposeIntoArray:function(s){var C=this.el;return s[0]=C[0],s[1]=C[3],s[2]=C[6],s[3]=C[1],s[4]=C[4],s[5]=C[7],s[6]=C[2],s[7]=C[5],s[8]=C[8],this},setUvTransform:function(d,c,i,K,h,H,u){var R=Math.cos(h),m=Math.sin(h);this.set(i*R,i*m,-i*(R*H+m*u)+H+d,-K*m,K*R,-K*(-m*H+R*u)+u+c,0,0,1)},scale:function(l,P){var r=this.el;return r[0]*=l,r[3]*=l,r[6]*=l,r[1]*=P,r[4]*=P,r[7]*=P,this},rotate:function($){var K=Math.cos($),k=Math.sin($),R=this.el,H=R[0],L=R[3],l=R[6],e=R[1],M=R[4],o=R[7];return R[0]=K*H+k*e,R[3]=K*L+k*M,R[6]=K*l+k*o,R[1]=-k*H+K*e,R[4]=-k*L+K*M,R[7]=-k*l+K*o,this},translate:function(m,K){var C=this.el;return C[0]+=m*C[2],C[3]+=m*C[5],C[6]+=m*C[8],C[1]+=K*C[2],C[4]+=K*C[5],C[7]+=K*C[8],this},equals:function(x){for(var A=this.el,k=x.el,b=0;9>b;b++)if(A[b]!==k[b])return!1;return!0},fromArray:function(R,M){M===I&&(M=0);for(var c=0;9>c;c++)this.el[c]=R[c+M];return this},toArray:function(w,T){w===I&&(w=[]),T===I&&(T=0);var G=this.el;return w[T]=G[0],w[T+1]=G[1],w[T+2]=G[2],w[T+3]=G[3],w[T+4]=G[4],w[T+5]=G[5],w[T+6]=G[6],w[T+7]=G[7],w[T+8]=G[8],w}});var hn=y.Math.Plane=function(x,g){this.normal=x!==I?x:new Vg(1,0,0),this.constant=g!==I?g:0};C.assign(hn.prototype,{set:function(a,j){return this.normal.copy(a),this.constant=j,this},setComponents:function(M,S,d,G){return this.normal.set(M,S,d),this.constant=G,this},setFromNormalAndCoplanarPoint:function(C,e){return this.normal.copy(C),this.constant=-e.dot(this.normal),this},setFromCoplanarPoints:function(){var R=new Vg,P=new Vg;return function(B,C,Z){var b=R.subVectors(Z,C).cross(P.subVectors(B,C)).normalize();return this.setFromNormalAndCoplanarPoint(b,B),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(B){return this.normal.copy(B.normal),this.constant=B.constant,this},normalize:function(){var C=1/this.normal.length();return this.normal.multiplyScalar(C),this.constant*=C,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(O){return this.normal.dot(O)+this.constant},distanceToSphere:function(h){return this.distanceToPoint(h.center)-h.radius},projectPoint:function(C,c){return c===I&&(c=new Vg),c.copy(this.normal).multiplyScalar(-this.distanceToPoint(C)).add(C)},intersectLine:function(){var c=new Vg;return function(k,l){l===I&&(l=new Vg);var H=k.delta(c),a=this.normal.dot(H);if(0===a)return 0===this.distanceToPoint(k.start)?l.copy(k.start):I;var z=-(k.start.dot(this.normal)+this.constant)/a;return 0>z||z>1?I:l.copy(H).multiplyScalar(z).add(k.start)}}(),intersectsLine:function(a){var g=this.distanceToPoint(a.start),v=this.distanceToPoint(a.end);return 0>g&&v>0||0>v&&g>0},intersectsBox:function(G){return G.intersectsPlane(this)},intersectsSphere:function(T){return T.intersectsPlane(this)},coplanarPoint:function(p){return p===I&&(p=new Vg),p.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var r=new Vg,_=new ns;return function(T,W){var x=W||_.getNormalMatrix(T),K=this.coplanarPoint(r).applyMatrix4(T),o=this.normal.applyMatrix3(x).normalize();return this.constant=-K.dot(o),this}}(),translate:function(S){return this.constant-=S.dot(this.normal),this},equals:function(K){return K.normal.equals(this.normal)&&K.constant===this.constant}});var lk=y.Math.Ray=function(t,k){this.origin=t!==I?t.clone():new Vg,this.direction=k!==I?k.clone():new Vg};C.assign(lk.prototype,{set:function(g,e){return this.origin.copy(g),this.direction.copy(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(n){return this.origin.copy(n.origin),this.direction.copy(n.direction),this.maxHitLen=n.maxHitLen,this},at:function(v,U){var I=U||new Vg;return I.copy(this.direction).multiplyScalar(v).add(this.origin)},setMaxHitLength:function(c){this.maxHitLen=c},lookAt:function(X){return this.direction.copy(X).sub(this.origin).normalize(),this},applyMatrix4:function(x){var c=this.maxHitLen;if(c){var r=this.direction.clone().multiplyScalar(c).add(this.origin);r.applyMatrix4(x)}return this.origin.applyMatrix4(x),this.direction.transformDirection(x),c&&(this.maxHitLen=this.origin.distanceTo(r)),this},distanceToPlane:function(O){var m=O.normal.dot(this.direction);if(0===m)return 0===O.distanceToPoint(this.origin)?0:null;var J=-(this.origin.dot(O.normal)+O.constant)/m;return J>=0?J:null},intersectPlane:function(Z,G){var y=this.distanceToPlane(Z);return null===y?null:this.at(y,G)},intersectSphere:function(){var H=new Vg;return function(k,K){H.subVectors(k.center,this.origin);var x=H.dot(this.direction),A=H.dot(H)-x*x,e=k.radius*k.radius;if(A>e)return null;var E=Math.sqrt(e-A),n=x-E,B=x+E;return 0>n&&0>B?null:0>n?this.at(B,K):this.at(n,K)}}(),intersectEllipsoid:function(){var G=new Vg,l=new Vg;return function(d,q){G.subVectors(d.center,this.origin),G.divide(d.radius),l.divideVectors(this.direction,d.radius);var c=l.lengthSq(),W=G.dot(l),s=G.dot(G)*c-W*W;if(s>c)return null;var o=Math.sqrt(c-s),B=(W-o)/c,f=(W+o)/c;return 0>B&&0>f?null:0>B?this.at(f,q):this.at(B,q)}}(),intersectBox:function(k,w){var U,x,J,$,T,i,D=1/this.direction.x,d=1/this.direction.y,I=1/this.direction.z,O=this.origin;if(D>=0?(U=(k.min.x-O.x)*D,x=(k.max.x-O.x)*D):(U=(k.max.x-O.x)*D,x=(k.min.x-O.x)*D),d>=0?(J=(k.min.y-O.y)*d,$=(k.max.y-O.y)*d):(J=(k.max.y-O.y)*d,$=(k.min.y-O.y)*d),U>$||J>x)return null;if((J>U||U!==U)&&(U=J),(x>$||x!==x)&&(x=$),I>=0?(T=(k.min.z-O.z)*I,i=(k.max.z-O.z)*I):(T=(k.max.z-O.z)*I,i=(k.min.z-O.z)*I),U>i||T>x)return null;if((T>U||U!==U)&&(U=T),(x>i||x!==x)&&(x=i),0>x)return null;var P=U>=0?U:x,v=this.maxHitLen;return v&&P>v?null:this.at(P,w)},intersectTriangle:function(){var t=new Vg,R=new Vg,K=new Vg,i=new Vg;return function(E,T,J,l,Q){R.subVectors(T,E),K.subVectors(J,E),i.crossVectors(R,K);var e,L=this.direction.dot(i);if(L>0){if(l)return null;e=1}else{if(!(0>L))return null;e=-1,L=-L}t.subVectors(this.origin,E);var _=e*this.direction.dot(K.crossVectors(t,K));if(0>_)return null;var v=e*this.direction.dot(R.cross(t));if(0>v||_+v>L)return null;var S=-e*t.dot(i);if(0>S)return null;var P=S/L,$=this.maxHitLen;return $&&P>$?null:this.at(P,Q)}}()});var em=y.Math.Box3=function(K,O){this.min=K!==I?K:new Vg(1/0,1/0,1/0),this.max=O!==I?O:new Vg(-1/0,-1/0,-1/0)};C.assign(em.prototype,{set:function(Y,y){return this.min.copy(Y),this.max.copy(y),this},setFromArray:function(x){for(var a=1/0,U=1/0,Y=1/0,c=-1/0,C=-1/0,s=-1/0,e=0,K=x.length;K>e;e+=3){var E=x[e],V=x[e+1],N=x[e+2];a>E&&(a=E),U>V&&(U=V),Y>N&&(Y=N),E>c&&(c=E),V>C&&(C=V),N>s&&(s=N)}return this.min.set(a,U,Y),this.max.set(c,C,s),this},setFromPoints:function(y){this.makeEmpty();for(var J=0,I=y.length;I>J;J++)this.expandByPoint(y[J]);return this},clone:function(){return(new this.constructor).copy(this)},intersectsBox:function(U){return U.max.x<this.min.x||U.min.x>this.max.x||U.max.y<this.min.y||U.min.y>this.max.y||U.max.z<this.min.z||U.min.z>this.max.z?!1:!0},copy:function(y){return this.min.copy(y.min),this.max.copy(y.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},expandByPoint:function(q){return this.min.min(q),this.max.max(q),this},expandByBox:function(y){return this.min.min(y.min),this.max.max(y.max),this},applyMatrix4:function(){var d=[new Vg,new Vg,new Vg,new Vg,new Vg,new Vg,new Vg,new Vg];return function(z){return this.isEmpty()?this:(d[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(z),d[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(z),d[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(z),d[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(z),d[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(z),d[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(z),d[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(z),d[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(z),this.setFromPoints(d),this)}}()});var Xm=y.Math.Sphere=function(p,v){this.center=p!==I?p:new Vg,this.radius=v!==I?v:0};C.assign(Xm.prototype,{set:function(h,K){return this.center.copy(h),this.radius=K,this},setFromPoints:function(){var z=new em;return function(E,r){var e=this.center;r!==I?e.copy(r):z.setFromPoints(E).getCenter(e);for(var h=0,O=0,L=E.length;L>O;O++)h=Math.max(h,e.distanceToSquared(E[O]));return this.radius=Math.sqrt(h),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(l){return this.center.copy(l.center),this.radius=l.radius,this},empty:function(){return this.radius<=0},containsPoint:function(z){return z.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(j){return j.distanceTo(this.center)-this.radius},intersectsSphere:function(T){var s=this.radius+T.radius;return T.center.distanceToSquared(this.center)<=s*s},intersectsBox:function(F){return F.intersectsSphere(this)},intersectsPlane:function(h){return Math.abs(h.distanceToPoint(this.center))<=this.radius},clampPoint:function(j,J){var p=this.center.distanceToSquared(j);return J===I&&(J=new Vg),J.copy(j),p>this.radius*this.radius&&(J.sub(this.center).normalize(),J.multiplyScalar(this.radius).add(this.center)),J},getBoundingBox:function(i){return i===I&&(i=new em),i.set(this.center,this.center),i.expandByScalar(this.radius),i},applyMatrix4:function(N){return this.center.applyMatrix4(N),this.radius=this.radius*N.getMaxScaleOnAxis(),this},translate:function(V){return this.center.add(V),this},equals:function(t){return t.center.equals(this.center)&&t.radius===this.radius}});var wr=y.Math.Frustum=function(v,S,q,t,j,G){this.planes=[v!==I?v:new hn,S!==I?S:new hn,q!==I?q:new hn,t!==I?t:new hn,j!==I?j:new hn,G!==I?G:new hn]};C.assign(wr.prototype,{set:function(X,r,Y,W,u,G){var _=this.planes;return _[0].copy(X),_[1].copy(r),_[2].copy(Y),_[3].copy(W),_[4].copy(u),_[5].copy(G),this},clone:function(){return(new this.constructor).copy(this)},copy:function(h){for(var T=this.planes,f=0;6>f;f++)T[f].copy(h.planes[f]);return this},setFromMatrix:function(w){var v=this.planes,C=w.el,K=C[0],p=C[1],$=C[2],I=C[3],O=C[4],q=C[5],_=C[6],V=C[7],h=C[8],G=C[9],J=C[10],o=C[11],U=C[12],f=C[13],k=C[14],j=C[15];return v[0].setComponents(I-K,V-O,o-h,j-U).normalize(),v[1].setComponents(I+K,V+O,o+h,j+U).normalize(),v[2].setComponents(I+p,V+q,o+G,j+f).normalize(),v[3].setComponents(I-p,V-q,o-G,j-f).normalize(),v[4].setComponents(I-$,V-_,o-J,j-k).normalize(),v[5].setComponents(I+$,V+_,o+J,j+k).normalize(),this},intersectsObject:function(){var r=new Xm;return function(M){var V=M.geometry;return null===V.boundingSphere&&V.computeBoundingSphere(),r.copy(V.boundingSphere).applyMatrix4(M.matrixWorld),this.intersectsSphere(r)}}(),intersectsSprite:function(){var u=new Xm;return function(p){return u.center.set(0,0,0),u.radius=.7071067811865476,u.applyMatrix4(p.matrixWorld),this.intersectsSphere(u)}}(),intersectsSphere:function(D){for(var P=this.planes,B=D.center,x=-D.radius,k=0;6>k;k++){var F=P[k].distanceToPoint(B);if(x>F)return!1}return!0},intersectsBox:function(){var P=new Vg;return function(Z){for(var h=this.planes,m=0;6>m;m++){var p=h[m];if(P.x=p.normal.x>0?Z.max.x:Z.min.x,P.y=p.normal.y>0?Z.max.y:Z.min.y,P.z=p.normal.z>0?Z.max.z:Z.min.z,p.distanceToPoint(P)<0)return!1}return!0}}(),containsPoint:function(x){for(var H=this.planes,p=0;6>p;p++)if(H[p].distanceToPoint(x)<0)return!1;return!0}});var Ic=y.Math.Matrix4=function(){this.el=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]};C.assign(Ic.prototype,{isMatrix4:!0,set:function(y,X,p,L,o,v,b,O,x,S,U,H,h,t,F,f){var e=this.el;return e[0]=y,e[4]=X,e[8]=p,e[12]=L,e[1]=o,e[5]=v,e[9]=b,e[13]=O,e[2]=x,e[6]=S,e[10]=U,e[14]=H,e[3]=h,e[7]=t,e[11]=F,e[15]=f,this},clone:function(){return(new Ic).fromArray(this.el)},fromArray:function(x,A){A===I&&(A=0);for(var P=this.el,B=0;16>B;B++)P[B]=x[B+A];return this},getElements:function(){return this.el},scale:function(r){var O=this.el,p=r.x,b=r.y,Q=r.z;return O[0]*=p,O[4]*=b,O[8]*=Q,O[1]*=p,O[5]*=b,O[9]*=Q,O[2]*=p,O[6]*=b,O[10]*=Q,O[3]*=p,O[7]*=b,O[11]*=Q,this},translate:function(h){var $=this.el,D=h.x||0,O=h.y||0,Z=h.z||0;return $[12]+=$[0]*D+$[4]*O+$[8]*Z,$[13]+=$[1]*D+$[5]*O+$[9]*Z,$[14]+=$[2]*D+$[6]*O+$[10]*Z,$[15]+=$[3]*D+$[7]*O+$[11]*Z,this},makeRotationFromEuler:function(R){var l=this.el,H=R._x,r=R._y,W=R._z,V=R._order,Y=Math.cos(H),O=Math.sin(H),I=Math.cos(r),$=Math.sin(r),q=Math.cos(W),k=Math.sin(W);if("XYZ"===V){var K=Y*q,T=Y*k,o=O*q,i=O*k;l[0]=I*q,l[4]=-I*k,l[8]=$,l[1]=T+o*$,l[5]=K-i*$,l[9]=-O*I,l[2]=i-K*$,l[6]=o+T*$,l[10]=Y*I}else if("YXZ"===V){var N=I*q,P=I*k,M=$*q,F=$*k;l[0]=N+F*O,l[4]=M*O-P,l[8]=Y*$,l[1]=Y*k,l[5]=Y*q,l[9]=-O,l[2]=P*O-M,l[6]=F+N*O,l[10]=Y*I}else if("ZXY"===V){var N=I*q,P=I*k,M=$*q,F=$*k;l[0]=N-F*O,l[4]=-Y*k,l[8]=M+P*O,l[1]=P+M*O,l[5]=Y*q,l[9]=F-N*O,l[2]=-Y*$,l[6]=O,l[10]=Y*I}else if("ZYX"===V){var K=Y*q,T=Y*k,o=O*q,i=O*k;l[0]=I*q,l[4]=o*$-T,l[8]=K*$+i,l[1]=I*k,l[5]=i*$+K,l[9]=T*$-o,l[2]=-$,l[6]=O*I,l[10]=Y*I}else if("YZX"===V){var Q=Y*I,c=Y*$,U=O*I,y=O*$;l[0]=I*q,l[4]=y-Q*k,l[8]=U*k+c,l[1]=k,l[5]=Y*q,l[9]=-O*q,l[2]=-$*q,l[6]=c*k+U,l[10]=Q-y*k}else if("XZY"===V){var Q=Y*I,c=Y*$,U=O*I,y=O*$;l[0]=I*q,l[4]=-k,l[8]=$*q,l[1]=Q*k+y,l[5]=Y*q,l[9]=c*k-U,l[2]=U*k-c,l[6]=O*q,l[10]=y*k+Q}return l[3]=0,l[7]=0,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,this},makeRotationFromQuaternion:function(v){var K=this.el,f=v._x,b=v._y,x=v._z,t=v._w,r=f+f,I=b+b,H=x+x,S=f*r,y=f*I,W=f*H,N=b*I,m=b*H,l=x*H,Q=t*r,$=t*I,i=t*H;return K[0]=1-(N+l),K[4]=y-i,K[8]=W+$,K[1]=y+i,K[5]=1-(S+l),K[9]=m-Q,K[2]=W-$,K[6]=m+Q,K[10]=1-(S+N),K[3]=0,K[7]=0,K[11]=0,K[12]=0,K[13]=0,K[14]=0,K[15]=1,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},getInverse:function(I){var $=this.el,B=I.el,v=B[0],W=B[1],l=B[2],J=B[3],c=B[4],K=B[5],N=B[6],L=B[7],M=B[8],R=B[9],T=B[10],S=B[11],G=B[12],D=B[13],F=B[14],h=B[15],Y=R*F*L-D*T*L+D*N*S-K*F*S-R*N*h+K*T*h,r=G*T*L-M*F*L-G*N*S+c*F*S+M*N*h-c*T*h,Q=M*D*L-G*R*L+G*K*S-c*D*S-M*K*h+c*R*h,m=G*R*N-M*D*N-G*K*T+c*D*T+M*K*F-c*R*F,p=v*Y+W*r+l*Q+J*m;if(0===p)return this.identity();var V=1/p;return $[0]=Y*V,$[1]=(D*T*J-R*F*J-D*l*S+W*F*S+R*l*h-W*T*h)*V,$[2]=(K*F*J-D*N*J+D*l*L-W*F*L-K*l*h+W*N*h)*V,$[3]=(R*N*J-K*T*J-R*l*L+W*T*L+K*l*S-W*N*S)*V,$[4]=r*V,$[5]=(M*F*J-G*T*J+G*l*S-v*F*S-M*l*h+v*T*h)*V,$[6]=(G*N*J-c*F*J-G*l*L+v*F*L+c*l*h-v*N*h)*V,$[7]=(c*T*J-M*N*J+M*l*L-v*T*L-c*l*S+v*N*S)*V,$[8]=Q*V,$[9]=(G*R*J-M*D*J-G*W*S+v*D*S+M*W*h-v*R*h)*V,$[10]=(c*D*J-G*K*J+G*W*L-v*D*L-c*W*h+v*K*h)*V,$[11]=(M*K*J-c*R*J-M*W*L+v*R*L+c*W*S-v*K*S)*V,$[12]=m*V,$[13]=(M*D*l-G*R*l+G*W*T-v*D*T-M*W*F+v*R*F)*V,$[14]=(G*K*l-c*D*l-G*W*N+v*D*N+c*W*F-v*K*F)*V,$[15]=(c*R*l-M*K*l+M*W*N-v*R*N-c*W*T+v*K*T)*V,this},invert:function(){return this.getInverse(this)},makeRotationAxis:function(d,x){var Q=Math.cos(x),o=Math.sin(x),j=1-Q,w=d.x,X=d.y,i=d.z,Z=j*w,K=j*X;return this.set(Z*w+Q,Z*X-o*i,Z*i+o*X,0,Z*X+o*i,K*X+Q,K*i-o*w,0,Z*i-o*X,K*i+o*w,j*i*i+Q,0,0,0,0,1),this},multiply:function(h){return this.multiplyMatrices(this,h)},premultiply:function(f){return this.multiplyMatrices(f,this)},multiplyMatrices:function(l,o){var Z=l.el,j=o.el,c=this.el,$=Z[0],S=Z[4],y=Z[8],_=Z[12],w=Z[1],v=Z[5],t=Z[9],X=Z[13],e=Z[2],Q=Z[6],s=Z[10],q=Z[14],C=Z[3],I=Z[7],A=Z[11],i=Z[15],Y=j[0],P=j[4],T=j[8],z=j[12],G=j[1],h=j[5],W=j[9],m=j[13],x=j[2],U=j[6],H=j[10],R=j[14],u=j[3],L=j[7],n=j[11],E=j[15];return c[0]=$*Y+S*G+y*x+_*u,c[4]=$*P+S*h+y*U+_*L,c[8]=$*T+S*W+y*H+_*n,c[12]=$*z+S*m+y*R+_*E,c[1]=w*Y+v*G+t*x+X*u,c[5]=w*P+v*h+t*U+X*L,c[9]=w*T+v*W+t*H+X*n,c[13]=w*z+v*m+t*R+X*E,c[2]=e*Y+Q*G+s*x+q*u,c[6]=e*P+Q*h+s*U+q*L,c[10]=e*T+Q*W+s*H+q*n,c[14]=e*z+Q*m+s*R+q*E,c[3]=C*Y+I*G+A*x+i*u,c[7]=C*P+I*h+A*U+i*L,c[11]=C*T+I*W+A*H+i*n,c[15]=C*z+I*m+A*R+i*E,this},lookAt:function(){var X=new Vg;return function(x,b,w){return X.subVectors(x,b),this.lookAtDirection(X,w)}}(),lookAtDirection:function(){var S=new Vg,q=new Vg,o=new Vg;return function(U,u){u||(u=Vg.UP);var A=this.el;return o.copy(U),0===o.lengthSq()&&(o.z=1),o.normalize(),S.crossVectors(u,o),0===S.lengthSq()&&(1===Math.abs(u.z)?o.x+=1e-4:o.z+=1e-4,o.normalize(),S.crossVectors(u,o)),S.normalize(),q.crossVectors(o,S),A[0]=S.x,A[4]=q.x,A[8]=o.x,A[1]=S.y,A[5]=q.y,A[9]=o.y,A[2]=S.z,A[6]=q.z,A[10]=o.z,this}}(),extractScale:function(){var G;return function(q){G===I&&(G=new Vg),q===I&&(q=new Vg);var V=G.setFromMatrixColumn(this,0).length(),K=G.setFromMatrixColumn(this,1).length(),H=G.setFromMatrixColumn(this,2).length();return q.set(V,K,H),q}}(),extractRotation:function(){var g;return function(v){g===I&&(g=new Vg),v===I&&(v=new Ic);var l=this.el,D=v.el,T=1/g.setFromMatrixColumn(v,0).length(),E=1/g.setFromMatrixColumn(v,1).length(),n=1/g.setFromMatrixColumn(v,2).length();return l[0]=D[0]*T,l[1]=D[1]*T,l[2]=D[2]*T,l[4]=D[4]*E,l[5]=D[5]*E,l[6]=D[6]*E,l[8]=D[8]*n,l[9]=D[9]*n,l[10]=D[10]*n,this}}(),multiplyScalar:function(b){var s=this.el;return s[0]*=b,s[4]*=b,s[8]*=b,s[12]*=b,s[1]*=b,s[5]*=b,s[9]*=b,s[13]*=b,s[2]*=b,s[6]*=b,s[10]*=b,s[14]*=b,s[3]*=b,s[7]*=b,s[11]*=b,s[15]*=b,this},getPosition:function(O){return O===I&&(O=new Vg),O.setFromMatrixColumn(this,3)},setPosition:function(G){var g=this.el;return g[12]=G.x,g[13]=G.y,g[14]=G.z,this},copyPosition:function(B){var L=this.el,i=B.el;return L[12]=i[12],L[13]=i[13],L[14]=i[14],this},toArray:function(v,y){v===I&&(v=[]),y===I&&(y=0);var x=this.el;return v[y]=x[0],v[y+1]=x[1],v[y+2]=x[2],v[y+3]=x[3],v[y+4]=x[4],v[y+5]=x[5],v[y+6]=x[6],v[y+7]=x[7],v[y+8]=x[8],v[y+9]=x[9],v[y+10]=x[10],v[y+11]=x[11],v[y+12]=x[12],v[y+13]=x[13],v[y+14]=x[14],v[y+15]=x[15],v},determinant:function(){var P=this.el,W=P[0],U=P[4],z=P[8],H=P[12],p=P[1],t=P[5],S=P[9],q=P[13],e=P[2],F=P[6],k=P[10],N=P[14],n=P[3],A=P[7],b=P[11],J=P[15];
return n*(+H*S*F-z*q*F-H*t*k+U*q*k+z*t*N-U*S*N)+A*(+W*S*N-W*q*k+H*p*k-z*p*N+z*q*e-H*S*e)+b*(+W*q*F-W*t*N-H*p*F+U*p*N+H*t*e-U*q*e)+J*(-z*t*e-W*S*F+W*t*k+z*p*F-U*p*k+U*S*e)},copy:function(s){var n=this.el,h=s.el;return n[0]=h[0],n[1]=h[1],n[2]=h[2],n[3]=h[3],n[4]=h[4],n[5]=h[5],n[6]=h[6],n[7]=h[7],n[8]=h[8],n[9]=h[9],n[10]=h[10],n[11]=h[11],n[12]=h[12],n[13]=h[13],n[14]=h[14],n[15]=h[15],this},compose:function(O,C,H){var A=this.el,S=C._x,Q=C._y,i=C._z,p=C._w,r=S+S,m=Q+Q,e=i+i,x=S*r,c=S*m,I=S*e,G=Q*m,D=Q*e,g=i*e,t=p*r,f=p*m,u=p*e,J=H.x,W=H.y,v=H.z;return A[0]=(1-(G+g))*J,A[1]=(c+u)*J,A[2]=(I-f)*J,A[3]=0,A[4]=(c-u)*W,A[5]=(1-(x+g))*W,A[6]=(D+t)*W,A[7]=0,A[8]=(I+f)*v,A[9]=(D-t)*v,A[10]=(1-(x+G))*v,A[11]=0,A[12]=O.x,A[13]=O.y,A[14]=O.z,A[15]=1,this},decompose:function(){var r=new Vg,I=new Ic;return function(Y,v,K){var A=this.el,U=r.set(A[0],A[1],A[2]).length(),M=r.set(A[4],A[5],A[6]).length(),F=r.set(A[8],A[9],A[10]).length(),q=this.determinant();0>q&&(U=-U),Y.x=A[12],Y.y=A[13],Y.z=A[14],I.copy(this);var L=1/U,V=1/M,C=1/F;return I.el[0]*=L,I.el[1]*=L,I.el[2]*=L,I.el[4]*=V,I.el[5]*=V,I.el[6]*=V,I.el[8]*=C,I.el[9]*=C,I.el[10]*=C,v.setFromRotationMatrix(I),K.x=U,K.y=M,K.z=F,this}}(),equals:function(E){for(var p=this.el,R=E.el,c=0;16>c;c++)if(p[c]!==R[c])return!1;return!0}}),new Ic,new Ic;var ed=y.Math.Triangle=function(J,H,u){this.a=J!==I?J:new Vg,this.b=H!==I?H:new Vg,this.c=u!==I?u:new Vg};C.assign(ed,{barycoordFromPoint:function(){var z=new Vg,M=new Vg,a=new Vg;return function(y,v,b,p,c){z.subVectors(p,v),M.subVectors(b,v),a.subVectors(y,v);var m=z.dot(z),n=z.dot(M),E=z.dot(a),H=M.dot(M),L=M.dot(a),T=m*H-n*n,o=c||new Vg;if(0===T)return o.set(-2,-1,-1);var k=1/T,J=(H*E-n*L)*k,C=(m*L-n*E)*k;return o.set(1-J-C,C,J)}}(),uvIntersection:function(){var U=new Vg;return function(H,w,R,F,I,y,A){return ed.barycoordFromPoint(H,w,R,F,U),I.multiplyScalar(U.x),y.multiplyScalar(U.y),A.multiplyScalar(U.z),I.add(y).add(A),I.clone()}}()});var Ji=y.Math.Euler=function(w,F,q,X,r){this.set(w,F,q,X,r)};Ji.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],Ji.DefaultOrder="XYZ",Ji.ReverseOrder=function(){var l={xyz:"ZYX",xzy:"YZX",yxz:"ZXY",yzx:"XZY",zxy:"YXZ",zyx:"XYZ"};return function(R){return l[R]}}(),C.defineProperties(Ji.prototype,{x:{get:function(){return this._x},set:function(O){this._x=O,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(O){this._y=O,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(r){this._z=r,this.onChangeCallback()}},order:{get:function(){return this._order},set:function(K){this._order=K,this.onChangeCallback()}}}),C.assign(Ji.prototype,{set:function(G,p,s,k,w){return hr(G)&&(w=s,k=p,s=G[2],p=G[1],G=G[0]),k?w&&(k=Ji.ReverseOrder(k)):k="ZYX",this._x=G||0,this._y=p||0,this._z=s||0,this._order=k||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(K){return this._x=K._x,this._y=K._y,this._z=K._z,this._order=K._order,this.onChangeCallback(),this},setFromRotationMatrix:function(V,x,t){var I=y.Math.clamp,k=V.el||V,Z=k[0],L=k[4],b=k[8],m=k[1],D=k[5],Q=k[9],_=k[2],K=k[6],z=k[10];return x=x||this._order,"XYZ"===x?(this._y=Math.asin(I(b,-1,1)),Math.abs(b)<.99999?(this._x=Math.atan2(-Q,z),this._z=Math.atan2(-L,Z)):(this._x=Math.atan2(K,D),this._z=0)):"YXZ"===x?(this._x=Math.asin(-I(Q,-1,1)),Math.abs(Q)<.99999?(this._y=Math.atan2(b,z),this._z=Math.atan2(m,D)):(this._y=Math.atan2(-_,Z),this._z=0)):"ZXY"===x?(this._x=Math.asin(I(K,-1,1)),Math.abs(K)<.99999?(this._y=Math.atan2(-_,z),this._z=Math.atan2(-L,D)):(this._y=0,this._z=Math.atan2(m,Z))):"ZYX"===x?(this._y=Math.asin(-I(_,-1,1)),Math.abs(_)<.99999?(this._x=Math.atan2(K,z),this._z=Math.atan2(m,Z)):(this._x=0,this._z=Math.atan2(-L,D))):"YZX"===x?(this._z=Math.asin(I(m,-1,1)),Math.abs(m)<.99999?(this._x=Math.atan2(-Q,D),this._y=Math.atan2(-_,Z)):(this._x=0,this._y=Math.atan2(b,z))):"XZY"===x?(this._z=Math.asin(-I(L,-1,1)),Math.abs(L)<.99999?(this._x=Math.atan2(K,D),this._y=Math.atan2(b,Z)):(this._x=Math.atan2(-Q,z),this._y=0)):console.warn("unsupported order: "+x),this._order=x,t!==!1&&this.onChangeCallback(),this},setFromQuaternion:function(){var B=new Ic;return function(V,E,f){return B.makeRotationFromQuaternion(V),this.setFromRotationMatrix(B,E,f)}}(),setFromVector3:function(f,S){return this.set(f.x,f.y,f.z,S||this._order)},reorder:function(){var m=new $i;return function(Z){return m.setFromEuler(this),this.setFromQuaternion(m,Z)}}(),equals:function(H){return H._x===this._x&&H._y===this._y&&H._z===this._z&&H._order===this._order},fromArray:function(X){return this._x=X[0],this._y=X[1],this._z=X[2],X[3]!==I&&(this._order=X[3]),this.onChangeCallback(),this},toArray:function(t,Z){return t===I&&(t=[]),Z===I&&(Z=0),t[Z]=this._x,t[Z+1]=this._y,t[Z+2]=this._z,t[Z+3]=this._order,t},toVector3:function(L){return L?L.set(this._x,this._y,this._z):new Vg(this._x,this._y,this._z)},onChange:function(w){return this.onChangeCallback=w,this},onChangeCallback:function(){}});var Wn={ms_ac:function(t,S){for(var U=S.ms_ac,l=0;l<U.length;l++)pc(t,U[l])},ms_listener:function(s){s.addListeners=function(){var u=this,N=co;F.mockTouch&&(N=Zc.concat(nm).concat(Ne)),u.__events__=N;for(var q=0,J=N.length;J>q;q++){var h=N[q];"wheel"===h&&!u.handle_wheel&&u.handle_mousewheel&&(u.handle_wheel=function(C){fr(u,C)}),u["handle_"+h]&&An(h,u.getView(),u)}},s.removeListeners=function(){var t=this,G=t.__events__;if(G){t.__events__=I;for(var R=0,P=G.length;P>R;R++)t["handle_"+G[R]]&&bg(G[R],t.getView(),t)}}},ms_fire:function(v){v.mp=function(e,o,R){this.addPropertyChangeListener(e,o,R)},v.ump=function(p,B){this.removePropertyChangeListener(p,B)},v.fp=function(x,R,z,K,V){return this.firePropertyChange(x,R,z,K,V)},v.addPropertyChangeListener=function(O,v,G){var D=this;D._62I||(D._62I=new vl),D._62I.add(O,v,G)},v.removePropertyChangeListener=function(i,L){this._62I&&this._62I.remove(i,L)},v.firePropertyChange=function($,y,u,F,f){if(F){if(F(y,u))return!1}else if(y===u)return!1;var K=this,d=f||{};return d.property=$,d.oldValue=y,d.newValue=u,d.source=K,d.data=K,K._62I&&K._62I.fire(d),K.onPropertyChanged&&K.onPropertyChanged(d),!0}},ms_attr:function(J){J.a=function($,r){var e=this;if(2===arguments.length)e.setAttr($,r);else{if(!Go($))return e.getAttr($);for(var y in $)e.setAttr(y,$[y])}return e},J.getAttr=function(H,E){if(E===I&&(E=1),this._attrObject&&H in this._attrObject)return this._attrObject[H];if(this.getImage){var k=this.getImage();if(Je(k)&&(k=Bn[k]),Go(k)&&"dataBindings"in k)for(var G=k.dataBindings,Q=G.length-1;Q>=0;Q--){var _=G[Q];if(_.attr===H){if("defaultValue"in _)return _.defaultValue;break}}}return E?r[H]:I},J.setAttr=function(F,u){var E=this;E._attrObject||(E._attrObject={});var B=E._attrObject[F];u===I?delete E._attrObject[F]:E._attrObject[F]=u,E.fp&&E.fp("a:"+F,B,u)&&E.onAttrChanged&&E.onAttrChanged(F,B,u)},J.getSerializableAttrs=function(){var R,f={};for(R in this._attrObject)f[R]=1;return f}},ms_bnb:function(q){q.getBodyColor=function(S){return S.s("body.color")},q.getBorderColor=function(m){return m.s("border.color")}},_51o:function(e){e.mi=function(f,S,l){this.addInteractorListener(f,S,l)},e.umi=function(W,C){this.removeInteractorListener(W,C)},e.fi=function(Y){this.fireInteractorEvent(Y)},e.addInteractorListener=function(R,W,A){var Z=this;Z._63I||(Z._63I=new vl),Z._63I.add(R,W,A)},e.removeInteractorListener=function(b,i){this._63I&&this._63I.remove(b,i)},e.fireInteractorEvent=function($){this._63I&&this._63I.fire($)},e.setInteractors=function(y){var c=this,C=c._interactors;C&&C.each(function(v){v.tearDown()}),hr(y)&&(y=new Ik(y)),c._interactors=y,y&&y.each(function(C){C.setUp()}),c.fp("interactors",C,y),c.invalidateSelection()},e.getInteractors=function(){return this._interactors}},_49o:function(X){X._44O=N,X._45O=N,X.getTopPainters=function(){return this._44O},X.getBottomPainters=function(){return this._45O},X.addTopPainter=function(L){var h=this;h._44O||(h._44O=new Ik),h._44O.contains(L)||(h._44O.add(L),h.redraw&&h.redraw())},X.removeTopPainter=function(R){var $=this;$._44O&&($._44O.remove(R),$.redraw&&$.redraw())},X.addBottomPainter=function(P){var Y=this;Y._45O||(Y._45O=new Ik),Y._45O.contains(P)||(Y._45O.add(P),Y.redraw&&Y.redraw())},X.removeBottomPainter=function(X){var s=this;s._45O&&(s._45O.remove(X),s.redraw&&s.redraw())},X._93db=function(G,e){var I=this;I._45O&&I._45O.each(function(r){r.draw?r.draw(G,e):r.call(I,G,e)})},X._92db=function(R,a){var U=this;U._44O&&U._44O.each(function(t){t.draw?t.draw(R,a):t.call(U,R,a)})}},ms_sm:function(T){T.sm=function(){return this.getSelectionModel()},T.setSelectableFunc=function(I){this.sm().setFilterFunc(I)},T.getSelectableFunc=function(){return this.sm().getFilterFunc()},T.getSelectionModel=function(){var S=this;return S._selectionModel?S._selectionModel:S.dm().sm()},T.isSelectionModelShared=function(){return!this._selectionModel},T.setSelectionModelShared=function(F){var U=this,s=U.sm(),G=!U._selectionModel,z=U.handleSelectionChange,L=U.dm();G!==F&&(U.invalidateSelection&&U.invalidateSelection(),F?(L.sm().ms(z,U),U._selectionModel.ums(z,U),U._selectionModel.dispose(),U._selectionModel=N):(L.sm().ums(z,U),U._selectionModel=new zr(L),U._selectionModel.ms(z,U)),U.onSelectionModelSharedChanged(),U.fp("selectionModelShared",G,F),U.fireViewEvent({kind:"selectionModelSharedChange",oldValue:G,newValue:F,oldSelectionModel:s,newSelectionModel:U.sm()}))},T.onSelectionModelSharedChanged=function(){var z=this;z.redraw(),z.invalidateSelection&&z.invalidateSelection()},T.removeSelection=function(){var u=this.dm();u.beginTransaction(),this.sm().toSelection().each(u.remove,u),u.endTransaction()},T.selectAll=function(){var D=this;D.sm().ss(D.dm().toDatas(function(b){return D.isVisible(b)&&D.isSelectable(b)}))},T.isSelected=function(v){return this.sm().co(v)},T.isSelectedById=function(O){var n=this.dm().getDataById(O);return n?this.isSelected(n):!1},T.isSelectable=function(e){return this.sm().isSelectable(e)}},ms_tx:function(o){o._64I=0,o._65O=0,o.isScrollable=function(){return this.getWidth()<this._64I},o._40o=function(){return this.isScrollable()},o.getLogicalPoint=function(P){return qh(P,this._canvas||this._view,this.tx(),this.ty?this.ty():0)},o.tx=function(O){return O===I?this.getTranslateX():(this.setTranslateX(O),void 0)},o.getTranslateX=function(){return this._65O},o.setTranslateX=function(b){var s=this,q=s.getWidth()-s._64I;q>b&&(b=q),b>0&&(b=0),b=c(b);var r=s._65O;s._65O=b,s.fp(mi,r,b)}},ms_ty:function(h){h._23Q=0,h._66O=0,h._41o=function(){return this.getHeight()<this._23Q},h.getLogicalPoint=function(o){return qh(o,this._canvas||this._view,this.tx?this.tx():0,this.ty())},h.ty=function(s){return s===I?this.getTranslateY():(this.setTranslateY(s),void 0)},h.getTranslateY=function(){return this._66O},h.setTranslateY=function(M){var l=this,N=l.getHeight()-l._23Q;N>M&&(M=N),M>0&&(M=0),M=c(M);var D=l._66O;l._66O=M,l.fp(fk,D,M)}},ms_txy:function(d){d._65O=0,d._66O=0,d.tx=function(Y){return Y===I?this.getTranslateX():(this.setTranslateX(Y),void 0)},d.ty=function(k){return k===I?this.getTranslateY():(this.setTranslateY(k),void 0)},d.onTranslateEnded=function(){},d.setTranslate=function(s,o,z){var Q=this;if(z=Qd(z)){Q._65I&&Q._65I.stop(!0);var x=Q.tx(),c=Q.ty();z.action=function(g){Q.setTranslate(x+(s-x)*g,c+(o-c)*g)},z._37o=function(){delete Q._66I,delete Q._65I,Q.onTranslateEnded()},Q._66I=1,Q._65I=Pc(z)}else Q.tx(s),Q.ty(o)},d.getTranslateX=function(){return this._65O},d.setTranslateX=function(j){var y=this;j=y.adjustTranslateX(j);var N=y._65O;y._65O=j,y.fp(mi,N,j)},d.getTranslateY=function(){return this._66O},d.setTranslateY=function(W){var t=this;W=t.adjustTranslateY(W);var p=t._66O;t._66O=W,t.fp(fk,p,W)},d.adjustTranslateX=function(Z){return c(Z)},d.adjustTranslateY=function(D){return c(D)},d.translate=function(f,m,U){this.setTranslate(this.tx()+f,this.ty()+m,U)},d.getLogicalPoint=function(M){var s=this;return qh(M,this._canvas||s._view,s.tx(),s.ty())}},ms_dm:function(h){h.dm=function(U){return U?(this.setDataModel(U),void 0):this.getDataModel()},h.getDataModel=function(){return this._dataModel}},ms_lp:function(A){A.lp=function(q){return this.getLogicalPoint(q)}},ms_v:function(u){u._disabled=!1,u.setDisabled=function(H,G){var j=this,C=j._disabled;C!==H&&(C&&(Yf(j._63O),delete j._63O),H&&(Em(j._view,j._63O=mm(G)),j.iv()),j._disabled=H,j.fp("disabled",C,H))},u.isDisabled=function(){return this._disabled},u.getDisabledDiv=function(){return this._63O},u.getView=function(){return this._view},u.addToDOM=function(c){var C=this,z=C.getView(),i=z.style;c=c||H.body,c.appendChild(z),i.left="0",i.right="0",i.top="0",i.bottom="0",q(w,"resize",function(){C.iv()}),C.iv()},u.setCursor=function(P){"default"===P&&(P=this._defaultCursor||P);var W=this.getView().style;W.cursor=P,W.cursor="-webkit-"+P,W.cursor="-moz-"+P},u.getWidth=function(){return this._view.clientWidth},u.getHeight=function(){return this._view.clientHeight},u.setWidth=function(R){var T=this;T._view.style.width=R+ps,T.iv(),T.fp&&T.fp(Tp,N,R)},u.setHeight=function(F){var j=this;j._view.style.height=F+ps,j.iv(),j.fp&&j.fp(nf,N,F)},u.setFocus=function(p){var t=this,I=t._currentEditor;return p&&I&&(I.getView&&(I=I.getView()),I.contains(p.target))?!1:(Re(t._view),t.endEditing&&t.endEditing(),t.fireViewEvent("focus"),!0)},u.iv=function(C){this.invalidate(C)},u.invalidate=function(C){var r=this;r._68I||(r._68I=1,r._ivTimerId=hh(r._validateImpl,r,N,C),r._ivTimerDelay=C,r.onInvalidated&&r.onInvalidated(),r.fireViewEvent("invalidate"))},u.validate=function(){var e=this._ivTimerId,Z=this._ivTimerDelay;this._validateImpl()!==!1&&e&&Vm(e,Z)},u._validateImpl=function(){var K=this,k=K._view;if(!K._68I)return!1;if(delete K._68I,k.parentNode)if(0===k.offsetWidth&&0===k.offsetHeight&&K._67I!==N)K._67I===I&&(K._67I=F.reinvalidateCount),K._67I>0?K._67I--:K._67I=N,K.iv();else{K.fireViewEvent("beginValidate"),K.validateImpl(),K.onValidated&&K.onValidated(),K.fireViewEvent("validate");var T=K._63O;T&&(k.lastChild!==T&&(Yf(T),Em(k,T)),Xd(T,0,0,K.getWidth(),K.getHeight())),ib(K),Am(K),vk(K)}},u.layout=function(N,c,q,U){1===arguments.length?Xd(this,N):Xd(this,N,c,q,U)},u.addViewListener=function(u,A,J){var P=this;P._67O||(P._67O=new vl),P._67O.add(u,A,J)},u.removeViewListener=function(z,l){this._67O.remove(z,l)},u.fireViewEvent=function(m){var y=this;y._67O&&(Je(m)&&(m={kind:m}),y._67O.fire(m)),F.viewListener&&F.viewListener(y,m)}},ms_tip:function(v){v.setToolTipEnabled=function(k){var C=this;k?Hi||C._13o||(C.enableToolTip(),C.fp("toolTipEnabled",!1,!0)):C._13o&&(C.disableToolTip(),C.fp("toolTipEnabled",!0,!1))},v.isToolTipEnabled=function(){return!!this._13o},v.enableToolTip=function(){var u=this;if(!Hi&&!u._13o){u._13o=function(b){if(!b.toolTipView){b.toolTipView=u;var x=u.getToolTip(b);x!=N?(F.toolTipContinual&&F.isToolTipShowing()?eq(b,x):(to(),Jn={timeout:Jo(kn,xl),e:b,info:x}),Mn={e:b,view:u}):to()}};var x=u.getView();q(x,Po,u._13o),q(x,"mouseleave",F.hideToolTip)}},v.disableToolTip=function(){var N=this;if(N._13o){var $=N.getView();V($,Po,N._13o),V($,"mouseleave",F.hideToolTip),delete N._13o}},v.getToolTip=function(S){var F=this;if(F.getDataAt){var g=F.getDataAt(S);return g?g.getToolTip():N}return F.getValue?F.getValue():void 0}},_52o:function(V){V._zoom=1,V._29I=ro,V.zoomIn=function(K,J){this.setZoom(this._zoom*mc,K,J)},V.zoomOut=function(o,s){this.setZoom(this._zoom/mc,o,s)},V.zoomReset=function(d,v){this.setZoom(1,d,v)},V.scrollZoomIn=function(Q){this.setZoom(this._zoom*Bi,N,Q)},V.scrollZoomOut=function(c){this.setZoom(this._zoom/Bi,N,c)},V.pinchZoomIn=function(I){this.setZoom(this._zoom*zs,N,I)},V.pinchZoomOut=function(J){this.setZoom(this._zoom/zs,N,J)},V.adjustZoom=function(r){return Nq>r?Nq:r>pe?pe:r},V.getZoom=function(){return this._zoom},V.setZoom=function(i,$,s){var v=this;if($=Qd($)){v._14o&&v._14o.stop(!0);var K=v._zoom;$.action=function(n){v._96O(K+(i-K)*n,s)},$._37o=function(){delete v._zooming,delete v._14o,v.onZoomEnded()},v._zooming=1,v._14o=Pc($)}else v._96O(i,s)},V._96O=function(k,R){var L=this;if(k=L.adjustZoom(k),k!==L._zoom){L.validate();var V=L._29I,D=L._zoom;0!==V.width&&0!==V.height&&(R=R?R:{x:V.x+V.width/2,y:V.y+V.height/2},L.tx((R.x-V.x)*D-R.x*k),L.ty((R.y-V.y)*D-R.y*k)),L._zoom=k,L.fp("zoom",D,k)}}},ms_edge:function(M){M._2I=function(E){var l=this;l._44I||(l._44I=new Ik),l._42I||(l._42I=new Ik),l._44I.add(E),l._42I.add(E),l._20I()},M._4I=function(P){var y=this;y._44I||(y._44I=new Ik),y._43I||(y._43I=new Ik),y._44I.add(P),y._43I.add(P),y._20I()},M._16I=function(z){var n=this;n._44I.remove(z),n._42I.remove(z),n._44I.isEmpty()&&delete n._44I,n._42I.isEmpty()&&delete n._42I,n._20I()},M._18I=function(z){var g=this;g._44I.remove(z),g._43I.remove(z),g._44I.isEmpty()&&delete g._44I,g._43I.isEmpty()&&delete g._43I,g._20I()},M._20I=function(){var u=this;if(delete u._45I,!u._44I||u._44I.isEmpty())return delete u._70O,void 0;var S;u._44I.each(function($){$.isLooped()&&(S||(S={}),S[$._id]||(u._45I||(u._45I=new Ik),u._45I.add($),S[$._id]=$))}),S?(u._70O=new Ik,u._44I.each(function(r){S[r._id]?"A"===S[r._id]||(S[r._id]="A",u._70O.add(r)):u._70O.add(r)})):u._70O=u._44I},M.hasAgentEdges=function(){return!!this._49I&&!this._49I.isEmpty()},M.getSourceAgentEdges=function(){return this._46I},M.getTargetAgentEdges=function(){return this._47I},M._1I=function(w){var X=this;X._46I||(X._46I=new Ik),X._48I||(X._48I=new Ik),X._46I.add(w),X._48I.add(w),X._19I()},M._3I=function(o){var V=this;V._47I||(V._47I=new Ik),V._48I||(V._48I=new Ik),V._47I.add(o),V._48I.add(o),V._19I()},M._15I=function(h){var q=this;q._46I.remove(h),q._48I.remove(h),q._46I.isEmpty()&&delete q._46I,q._48I.isEmpty()&&delete q._48I,q._19I()},M._17I=function(c){var R=this;R._47I.remove(c),R._48I.remove(c),R._47I.isEmpty()&&delete R._47I,R._48I.isEmpty()&&delete R._48I,R._19I()},M._19I=function(){var x=this;delete x._49I;var z=x._48I;if(z&&!z.isEmpty()){var m={};z.each(function(C){m[C._id]?x._49I||(x._49I=new Ik):m[C._id]=C}),x._49I?z.each(function(w){m[w._id]&&(x._49I.add(w),delete m[w._id])}):x._49I=z}},M.getLoopedEdges=function(){return this._45I},M.getEdges=function(){return this._70O},M.getAgentEdges=function(){return this._49I},M.getSourceEdges=function(){return this._42I},M.getTargetEdges=function(){return this._43I},M._8I=function(){this._70O&&this._70O.each(function(r){r._7I()})}}};xo(F,{getVersion:function(){return"7.3.1-dev5"}},!0);var le=function(r){return r.devicePixelRatio?r.devicePixelRatio:r.screen&&r.screen.logicalXDPI?r.screen.deviceXDPI/r.screen.logicalXDPI:1};xo(F,{numberDigits:5,crossOrigin:"",baseZIndex:I,isTouchable:Hi,mockTouch:!0,devicePixelRatio:le(w),reinvalidateCount:3,hitMaxArea:3e3,imageCacheThreshold:20,autoMakeVisible:!0,autoHideScrollBar:!0,disabledOpacity:.4,disabledBackground:B.disabledBackground,forceHierarchicalSerialization:!0,extractBatchTranslation:!1,extractShapeTranslation:!1,extractPolylineTranslation:!1,extractVerticesTranslation:!1,envmapProbeMinWaitTime:300,envmapProbeMaxWaitTime:25e3,EnvmapTextureSize:1024,hoverDelay:600,clickDelay:200,toolTipDelay:800,toolTipContinual:!1,getDragger:function(){return br},lineCap:"butt",lineJoin:"round",imageGradient:"linear.northeast",dashPattern:[16,16],blockMinSize:1,textExtraWidth:4,encodeStringKey:null,doubleClickSpeed:500,doubleClickRange:1,doubleTouchRange:20,touchMoveThreshold:10,animDuration:200,animEasing:function(F){return F*F},labelColor:Eo,labelSelectColor:uq,labelFont:"12px arial, sans-serif",widgetIndent:Hi?30:20,widgetRowHeight:Hi?30:20,widgetHeaderHeight:Hi?32:22,widgetTitleHeight:Hi?34:24,scrollBarColor:Sg,scrollBarSize:7,scrollBarTimeout:1e3,scrollBarMinLength:20,scrollBarInteractiveSize:Hi?32:16,zoomIncrement:1.3,scrollZoomIncrement:1.05,pinchZoomIncrement:1.08,pinchZoomThreshold:1,zoomMax:20,zoomMin:.01,segmentResolution:12,shapeResolution:24,shapeSide:24,intersectionLineRect:mq,intersectionLineLine:Gh,isEnter:Uc,isEsc:zi,isDelete:Wk,isSpace:En,isLeft:jr,isUp:cb,isRight:wk,isDown:Yd,isTouchEvent:Qm,getTarget:El,isString:Je,isNumber:dm,isBoolean:xj,isArray:hr,isSelectAll:cr,isFunction:Cc,isObject:Go,getPropertyValue:oh,setPropertyValue:hc,addMethod:xo,createGradient:function(o,k,u,T,f,l,I,A){var S=Ml[k];return S(o,u,T,f,l,I,A)},appendToScreen:function(i){i=i.getView?i.getView():i,(H.fullscreenElement||H.mozFullScreenElement||H.webkitFullscreenElement||H.msFullscreenElement||H.body).appendChild(i)},encodeString:function(T){return y.Math.encodeBase64(T,F.encodeStringKey)},decodeString:function(W){return y.Math.decodeBase64(W,F.encodeStringKey)},findView:function(I){var z=function(D,v){var r=v._ht;r&&D.push(r);var J=v.children,C=J.length;if(C)for(var I=0;C>I;I++)z(D,J[I])},c=[];z(c,H.body);var V=function(l,i){for(var $="2d"===i?Nf.GraphView:Lq.Graph3dView,X=0,e=l.length;e>X;X++)if(l[X]instanceof $)return c[X];return null};return"all"===I?c:"2d"===I?V(c,"2d"):"3d"===I?V(c,"3d"):V(c,"3d")||V(c,"2d")},toggleFullscreen:function(u){var E=u.getView();if(H.fullscreenElement||H.mozFullScreenElement||H.webkitFullscreenElement||H.msFullscreenElement)H.exitFullscreen?H.exitFullscreen():H.msExitFullscreen?H.msExitFullscreen():H.mozCancelFullScreen?H.mozCancelFullScreen():H.webkitExitFullscreen&&H.webkitExitFullscreen();else{var z=!0;if(u.isSelfViewEvent){var o=u.getX(),k=u.getY(),m=u.getWidth(),R=u.getHeight(),x=E.style.background,$=E.style.backgroundColor;x||$||(E.style.backgroundColor="white"),E.requestFullscreen?E.requestFullscreen():E.msRequestFullscreen?E.msRequestFullscreen():E.mozRequestFullScreen?E.mozRequestFullScreen():E.webkitRequestFullscreen&&E.webkitRequestFullscreen();var X=setInterval(function(){if(E!==(H.fullscreenElement||H.mozFullScreenElement||H.webkitFullscreenElement||H.msFullscreenElement))clearInterval(X),u.setX(o),u.setY(k),u.setWidth(m),u.setHeight(R),u._fullscreen=!1,E.style.oldBackgroundColor=$,u.iv();else{var a=y.Default.getWindowInfo();(z||a.width!==u.getWidth()||a.height!==u.getHeight())&&(u.setX(a.left),u.setY(a.top),u.setWidth(a.width),u.setHeight(a.height),u._fullscreen=!0,u.iv(),z=!1)}},500)}else{var b=E.style.left,A=E.style.top,m=E.style.width,R=E.style.height,x=E.style.background,$=E.style.backgroundColor;x||$||(E.style.backgroundColor="white"),E.requestFullscreen?E.requestFullscreen():E.msRequestFullscreen?E.msRequestFullscreen():E.mozRequestFullScreen?E.mozRequestFullScreen():E.webkitRequestFullscreen&&E.webkitRequestFullscreen();var X=setInterval(function(){if(E!==(H.fullscreenElement||H.mozFullScreenElement||H.webkitFullscreenElement||H.msFullscreenElement))clearInterval(X),E.style.left=b,E.style.top=A,E.style.width=m,E.style.height=R,E.style.oldBackgroundColor=$,u.iv();else{var r=y.Default.getWindowInfo();(z||r.width!==u.getWidth()||r.height!==u.getHeight())&&(Xd(u),z=!1)}},500)}}},appendTimeStamp:function(c){return c},setCompType:function(V,n){Je(n)&&n.substr(0,12)==fp&&(n=F.parse(n)),Cc(n)||Go(n)?Rn[V]=n:Fr(V)},getCompType:function(G){var d=Rn[G];return d===I&&Jp.test(G)&&Fr(G),d},getCompTypeMap:function(){return Rn},drawCompType:function(K,W,o,i,$,J){K(W,o,i,$,J)},numberListener:function(){var q={46:1,8:1,9:1,27:1,13:1,109:1,110:1,189:1,190:1};return function(G){var d=G.keyCode;q[d]||65===d&&F.isCtrlDown(G)||86===d&&F.isCtrlDown(G)||67===d&&F.isCtrlDown(G)||88===d&&F.isCtrlDown(G)||d>=35&&40>=d||(G.shiftKey||48>d||d>57)&&(96>d||d>105)&&G.preventDefault()}}(),ignoreKeyCodes:[122,123],preventDefault:function(m){var N=m.target.tagName;("DIV"===N||"CANVAS"===N)&&!(F.ignoreKeyCodes.indexOf(m.keyCode)>=0)&&("keydown"!==m.type||jr(m)||wk(m)||cb(m)||Yd(m)||Wk(m)||65===m.keyCode&&(m.metaKey||m.ctrlKey))&&m.cancelable===!0&&(m.preventDefault(),m.preventManipulation&&m.preventManipulation())},getWindowInfo:function(){var j=H.documentElement,V=j&&(j.scrollLeft||j.scrollTop)?j:H.body;return{target:V,left:V.scrollLeft,top:V.scrollTop,width:w.innerWidth||V.clientWidth,height:w.innerHeight||V.clientHeight}},isDragging:function(){return!!br},isLeftButton:function(c){return Qm(c)?!0:0===c.button},isMiddleButton:function(P){return Qm(P)?!1:P&&(1===P.button||4&(P.buttons||0))},isRightButton:function(F){return Qm(F)?!1:F&&(2===F.button||2&(F.buttons||0))},isInput:function(j){if(!j)return!1;var f=j.tagName;return"INPUT"===f||"TEXTAREA"===f||"SELECT"===f},getTouchCount:function(W){return Qm(W)?W.touches.length:1},isDoubleClick:function(){function w(z){z.details=0,z.timeout=null,z.lastPoint=null}var b={};return fg=new Vo,Xk=fg.getTime(),function(O){if(hm(O)>1)return!1;var S=O.button==N?"":O.button,x=O.type+S,f=x+"_isDoubleClick",p=b[x];if(p||(p=b[x]={details:0,timeout:null,lastPoint:null}),O[f]===I){O[f]=!0;var r=oc(O);p.timeout&&(wc(p.timeout),p.timeout=null);var J=Qm(O)?F.doubleTouchRange:F.doubleClickRange;p.lastPoint&&So(p.lastPoint,r)>J&&w(p),p.lastPoint=r,p.details++,p.timeout=Jo(function(){w(this)}.bind(p),F.doubleClickSpeed)}return 2===p.details}}(),isShiftDown:function(J){return J?J.shiftKey:Hf["16"]},isCtrlDown:function(m){return m?Uf?m.metaKey:m.ctrlKey:Uf?Hf["91"]:Hf["17"]},getClientPoint:function(Y){return Qm(Y)&&(Y=_r(Y)),{x:Y.clientX,y:Y.clientY}},isMouseEvent:function(C){return C instanceof MouseEvent||0===C.type.indexOf("mouse")},getTargetElement:function(T){var n,Q=Jj(T);if(n=F.isMouseEvent(T)||!H.elementFromPoint?T.target:H.elementFromPoint(Q.x,Q.y),ts&&H.elementFromPoint){for(var C=[],v=[];"none"===n.style.pointerEvents;)C.push(n),v.push(n.style.display||""),n.style.display="none",n=H.elementFromPoint(Q.x,Q.y);C.forEach(function(e,$){e.style.display=v[$]})}return n},getPagePoint:function(b){return Qm(b)&&(b=_r(b)),{x:b.pageX,y:b.pageY}},createObject:function(R,B){var G=new R;for(var p in B){var U=B[p];if(Cc(U))G[p]=U;else if(0===p.indexOf("s:"))G.s(p.substr(2),B[p]);else if(0===p.indexOf("a:"))G.a(p.substr(2),B[p]);else{var D=vb(p),U=B[p];G[D]?(G[D](U),"setToolTip"===D&&G.enableToolTip&&G.enableToolTip()):G[p]=U}}return G},setImage:function(p,R,y,s){var M=arguments.length;4===M?pg(p,s,R,y):2===M?Je(R)?R.substr(0,12)==fp?Tr(p,F.parse(R)):pg(p,R):Tr(p,R):1===M&&pg(p,p)},getImage:function(h,O,w){var U;if(h==N)return N;if(Go(h)?U=h:(U=Bn[h],h&&U===I&&(lq&&lq[h]||pg(h,h))),O&&U&&U.tagName){var o;o="override"===w?"colors_override":"override_rgb"===w?"colors_override_rgb":"override_a"===w?"colors_override_a":"colors",U[o]||(U[o]={__count__:0});var $=U[o][O];return $||(U[o].__count__>F.imageCacheThreshold&&(U[o]={__count__:0}),$=Zb(U,Ng(O),U.width,U.height,w),U[o][O]=$,U[o].__count__++),$}return U},isImageComplete:function(Q,q,r){var P=Fp(Q);if(!P)return!1;if(P.tagName)return P.complete;for(var d,Q,E,C=P.comps,j=!0,y=0,O=C.length;O>y;y++)if(d=C[y],E=d.type,"image"===d.type){Q=d.name,Q&&Q.func&&(Q=Aq(Q,q));var M=Gl(Q,q,r);if(!M){j=!1;break}}else if(Jp.test(E)&&F.getCompType(E)===I){j=!1,Fr(E);break}return j},getId:function(){var V=1;return function(){return++V}}(),callLater:function(N,U,V,X){var p=function(){N.apply(U,V)};return X?Jo(p,X):w.requestAnimationFrame(p)},cancelLater:function(I,x){x?wc(I):w.cancelAnimationFrame(I)},clone:function(O){if(null==O||"object"!=typeof O)return O;if(O instanceof Date){var T=new Date;return T.setTime(O.getTime()),T}if(O instanceof Array){for(var T=[],B=0,j=O.length;j>B;B++)T[B]=iq(O[B]);return T}if(O instanceof Ik){for(var T=new Ik,B=0,j=O.length;j>B;B++)T.set(B,iq(O.get(B)));return T}if(O instanceof dd)return O;if(O instanceof _h){var T=new _h;return T.deserialize(O.serialize()),T}if(O instanceof C){var T={};for(var x in O)O.hasOwnProperty(x)&&(T[x]=iq(O[x]));return T}return O},callWhenLoaded:function(Y,E){E=E||100;var i=Yh(Y,E);el||(el={}),el[i]={tick:i,cb:Y,delay:E}},beforeLoadURL:function(_,c){if(el){var M={};for(var c in el){var g=el[c];wc(g.tick);var O=Yh(g.cb,g.delay);M[O]={tick:O,delay:g.delay,cb:g.cb}}el=M}return F.convertURL?F.convertURL(_,c):_},convertURL:function(f){return f},handleRefGraphLoaded:function(){},handleCompTypeLoaded:function(){},handleImageLoaded:function(){},handleUnfoundImage:function(){return F.getImage("default_blank")},resizeImage:function(E,C,k,L){k||(k=C),L||(L=Qb());var i=L.getContext("2d");return Nc(L,C,k,1),i.drawImage(E,0,0,C,k),L},resizeImagePOT:function(r,C,V){if(!r||!r.tagName)return r;var w=r.width,H=r.height;if(!w||!H)return r;if(fl.isPOT(w)&&fl.isPOT(H)&&(!C||w===H))return r;var M,g;return C?g=M=fl.nearestPOT(Math.min(w,H)):(M=fl.nearestPOT(w),g=fl.nearestPOT(H)),F.resizeImage(r,M,g,V)},sortFunc:function(a,p){if(a===p)return 0;if(a==N&&p!=N)return 1;if(a!=N&&p==N)return-1;if(a==N&&p==N)return 0;var k,s=typeof a,U=typeof p;return s===Rq&&U===Rq?k=a.localeCompare(p):s===ef&&U===ef&&(k=a-p),k===I&&(k=(""+a).localeCompare(""+p)),k>0?1:0>k?-1:0},getClassMap:function(){return js},getClass:function(S){if(Je(S)){var z,J=js[S];if(!J){z=S.split("."),J=w;for(var V=0;V<z.length;V++)J=J[z[V]];js[S]=J}return J}return S},def:function(b,x,j){var C,p,L,i=function(){};if(i.prototype=x.prototype,C=new i,Je(b)){if(js[b])throw"'"+b+"' already defined";L=gb(b),C.getClassName=function(){return b}}else L=b;if(C.constructor=L,C.getClass=function(){return L},C.getSuperClass=function(){return x},j)for(p in j)Wn[p]&&Wn.hasOwnProperty(p)?Wn[p](C,j):ii(C,j,p);L.prototype=C,L.superClass=x.prototype},startAnim:function(){var S=function(S){S.duration&&(S.startTime=Hd()),S.timeId=hh(S.tick,N,N,S.interval)};return function(X){return X=iq(X),X.easing=X.easing||F.animEasing,X.duration||X.frames||(X.duration=F.animDuration),X.t=0,X.duration?X.interval=0:(X.frame=0,X.interval=X.interval||10),X.tick=function(){if(X.duration){var g=(Hd()-X.startTime)/X.duration;if(g>1&&(g=1),X.t=g,X.action(X.easing(g),g),!X.isRunning())return;1===g?X.stop():X._isPaused||(X.timeId=hh(X.tick))}else{if(X.frame++,g=X.t=X.frame/X.frames,X.action(X.easing(g),g),!X.isRunning())return;X.frame<X.frames?X._isPaused||(X.timeId=hh(X.tick,N,N,X.interval)):X.stop()}},X.resume=function(){X._isPaused&&(delete X._isPaused,X.duration?X.t<1&&(X.startTime=Hd()-X.duration*X.t,X.timeId=hh(X.tick)):X.frame<X.frames&&(X.timeId=hh(X.tick,N,N,X.interval)))},X.pause=function(){Vm(X.timeId,!X.duration),X._isPaused=!0},X.isPaused=function(){return this._isPaused},X.stop=function(f){X.isRunning()&&(Vm(X.timeId,!X.duration),delete X.timeId,X.duration?X.t<1&&f&&(X.t=1,X.action(X.easing(1),1)):X.frame<X.frames&&f&&(X.frame=X.frames,X.action(X.easing(1),1)),X._37o&&X._37o(),X.finishFunc&&X.finishFunc())},X.isRunning=function(){return X.timeId!=N},X.delay?hh(S,N,[X],X.delay):S(X),X}}(),getTextSize:function(){var s={},Y=H?Qb().getContext("2d"):N;return function(m,t){Y.font=m?m:Qf;var p=s[Y.font];return p||(p=2*Y.measureText("e").width+4,s[Y.font]=p),{width:Y.measureText(t).width+F.textExtraWidth,height:p}}}(),drawText:function(w,E,h,o,j,O,X,r,Z,u,J){if(E!=N){var b=ce(h,E),G={};G.y=u&&u!==_p?u===nc?O+b.height/2:O+r-b.height/2:O+r/2,G.x=Z&&Z!==hp?Z===Il?j+X-b.width/2:j+X/2:j+b.width/2,fo(w,E,G,h,o),J&&jc(w,E,h,o,G.x,G.y,b.width,J)}},getDistance:function(B,M){var G=B.length;return M?3===G?U(Bp(B[0]-M[0])+Bp(B[1]-M[1])+Bp(B[2]-M[2])):2===G?U(Bp(B[0]-M[0])+Bp(B[1]-M[1])):B.z===I?U(Bp(M.x-B.x)+Bp(M.y-B.y)):U(Bp(M.x-B.x)+Bp(M.y-B.y)+Bp(M.z-B.z)):3===G?U(Bp(B[0])+Bp(B[1])+Bp(B[2])):2===G?U(Bp(B[0])+Bp(B[1])):void 0},brighter:function(f,_){return 0>_&&(_=-_),yl(f,_?_:40)},darker:function(y,v){return v>0&&(v=-v),yl(y,v?v:-40)},unionPoint:function(m,z){if(!m)return N;if(2===arguments.length)return m&&z?{x:J(m.x,z.x),y:J(m.y,z.y),width:u(m.x-z.x),height:u(m.y-z.y)}:N;var c=m;if(c._as&&(c=c._as),c.length===I)return N;var $=c.length;if(0>=$)return N;for(var k=1,X=c[0],l={x:X.x,y:X.y,width:0,height:0};$>k;k++){X=c[k];var B=J(l.x,X.x),A=n(l.x+l.width,X.x),t=J(l.y,X.y),F=n(l.y+l.height,X.y);l.x=B,l.y=t,l.width=A-B,l.height=F-t}return l},unionRect:function(T,A){if(T&&!A)return iq(T);if(!T&&A)return iq(A);if(T&&A){var K={x:J(T.x,A.x),y:J(T.y,A.y)};return K.width=n(T.x+T.width,A.x+A.width)-K.x,K.height=n(T.y+T.height,A.y+A.height)-K.y,K}return N},containsPoint:function(I,H,e,k){if(k!=N&&1!==k){var D=I.x+I.width/2,L=I.y+I.height/2;I={x:D-I.width/2*k,y:L-I.height/2*k,width:I.width*k,height:I.height*k}}if(e){var Z=I.width/2,P=I.height/2,K=W(-e),w=s(-e),l=H.x-I.x-Z,c=H.y-I.y-P;
return H={x:w*l-K*c,y:K*l+w*c},zo({x:-Z,y:-P,width:I.width,height:I.height},H)}return!(!I||H.x<I.x||H.y<I.y||H.x>I.x+I.width||H.y>I.y+I.height)},containsRect:function(W,K){if(!W||!K)return!1;var l=K.x,G=K.y,S=K.width,Y=K.height,j=W.width,I=W.height;if(0>(j|I|S|Y))return!1;var k=W.x,P=W.y;if(k>l||P>G)return!1;if(j+=k,S+=l,l>=S){if(j>=k||S>j)return!1}else if(j>=k&&S>j)return!1;if(I+=P,Y+=G,G>=Y){if(I>=P||Y>I)return!1}else if(I>=P&&Y>I)return!1;return!0},intersectsRect:function(W,I){if(!W||!I)return!1;var E=I.width,U=I.height,S=W.width,Y=W.height;if(0>=S||0>=Y||0>=E||0>=U)return!1;var _=I.x,s=I.y,i=W.x,u=W.y;return S+=i,Y+=u,E+=_,U+=s,S>_&&Y>s&&E>i&&U>u},intersection:function(d,W){if(!d||!W)return N;var S=W.x,J=W.y,s=d.x,i=d.y,z=S,_=J,w=s,k=i;return z+=W.width,_+=W.height,w+=d.width,k+=d.height,s>S&&(S=s),i>J&&(J=i),z>w&&(z=w),_>k&&(_=k),z-=S,_-=J,0>=z||0>=_?N:{x:S,y:J,width:z,height:_}},grow:function(l,g,G){G===I&&(G=g),l.x-=g,l.y-=G,l.width=l.width+2*g,l.height=l.height+2*G},getScreenPoint:function(T,p,h,c,a,m,A){var $=h.getBoundingClientRect(),R=T*(m||1)-h.scrollLeft+(c||0),Z=p*(A||1)-h.scrollTop+(a||0),u=Pg(h,!1);if(u){var Q=new Vg(R,Z,0);return Q.applyMatrix4(u),console.log(Q),{x:Q.x,y:Q.y}}return{x:R+$.left,y:Z+$.top}},getLogicalPoint:function(S,M,V,n,h,L){var a,E,I=M.getBoundingClientRect();S.target?(Og(S)?Uf?Hf["91"]=!0:Hf["17"]=!0:Uf?Hf["91"]=!1:Hf["17"]=!1,Hf["16"]=oo(S)?!0:!1,S=Qm(S)?_r(S):S,a=S.clientX,E=S.clientY):(a=S.x,E=S.y);var O=Pg(M,!0);if(O){var K=new Vg(a,E,0);K.applyMatrix4(O);do{if(Math.abs(K.z)<=1e-6)break;var C=new Vg(a,E,1);if(C.applyMatrix4(matrix),Math.abs(C.z)<=1e-6){K=C;break}if(C.sub(K),Math.abs(C.z)<=1e-6)break;K.addScaledVector(C,-K.z/C.z)}while(!1);return{x:(K.x+M.scrollLeft-(V||0))/(h||1),y:(K.y+M.scrollTop-(n||0))/(L||1)}}return{x:(a-I.left+M.scrollLeft-(V||0))/(h||1),y:(E-I.top+M.scrollTop-(n||0))/(L||1)}},removeHTML:function(){var L;return function(O){return O&&O.getView&&(O=O.getView()),O&&O.parentNode?L===O?!0:(L=O,O.parentNode.removeChild(O),L=N,!0):!1}}(),getToolTipDiv:function(){if(!Ld){Ld=jg(),xp=jg();var Q=Ld.style;F.baseZIndex!=N&&(Q.zIndex=Oc(F.baseZIndex)+3+""),Q.whiteSpace="nowrap",Q.color=F.toolTipLabelColor,Q.background=F.toolTipBackground,Q.font=F.toolTipLabelFont,Q.padding="5px",Q.boxShadow="0px 0px 3px "+F.toolTipShadowColor}return Ld},isToolTipShowing:function(){return Ld&&Ld.parentNode?!0:xp&&xp.parentNode?!0:!1},updateToolTipContent:function(U,V){if(F.isToolTipShowing()&&(V||(V=Mn&&Mn.view),U===I&&V&&Mn.e&&(U=V.getToolTip(Mn.e)),U!=N)){var C;U.html?(U=U.html,C=xp):C=Ld,C.innerHTML=U}},hideToolTip:function(){if($k(),F.isToolTipShowing()){Yf(Ld),Yf(xp);var i=Mn&&Mn.view;i&&i.onHideToolTip&&i.onHideToolTip(),Mn=N}},showToolTip:function(Z,r,H){if(!Z||r==N)return to(),void 0;F.getToolTipDiv();var e,q;if(r.html?(r=r.html,e=xp,Yf(Ld)):(e=Ld,Yf(xp)),q=e.style,e.innerHTML="",r instanceof HTMLElement?e.appendChild(r):e.innerHTML=r,e.parentNode||y.Default.appendToScreen(e),Z.target){Z=Jj(Z);var P=yo(),c=Z.x,$=Z.y,n=Hi?60:12;if(Hi){var b=e.getBoundingClientRect();q.left=c-b.width/2+ps,q.top=$-b.height-n<P.top?$+n+ps:$-b.height-n+ps}else{q.left=c+n+ps,q.top=$+n+ps;var b=e.getBoundingClientRect();b.left+b.width>P.width&&(q.left=c-n-b.width+ps),b.top+b.height>P.height&&(q.top=$-n-b.height+ps),b.left<0&&(q.left=c+n+ps),b.top<0&&(q.top=$+n+ps)}}else q.left=Z.x+ps,q.top=Z.y+ps;$k(),H===I?H=Mn&&Mn.view:Mn={e:Z,view:H},H&&H.onShowToolTip&&H.onShowToolTip()},startDragging:function(y,U,j){j==I&&(j=!0),y!==br&&(br?j&&(Qm(U)?br.handleWindowTouchEnd(U):br.handleWindowMouseUp(U)):Qm(U)?(q(w,_j,cn),q(w,vn,ye),q(w,"blur",ye)):(q(w,Po,Rl),q(w,lj,Fb),q(w,"blur",Fb)),br=y)},getImageMap:function(){return Bn},toBoundaries:function(W,t,X,V){var p=[];return $m(W,t,X,V).forEach(function(C){var h=[];C.forEach(function(S){h.push(S.x,S.y)}),p.push(h)}),p},getCurrentKeyCodeMap:function(){return Hf},drawCenterImage:function(z,W,n,M,i,B,X,U){!i&&B&&B.isSelfViewEvent&&(i=B);var p=fm(W,i,B),j=Oo(W,i,B);He(z,W,c(n-p/2),c(M-j/2),p,j,i,B,X,U)},drawStretchImage:function(N,n,S,C,j,A,K,h,Z,B,l,e){!h&&Z&&Z.isSelfViewEvent&&(h=Z);var z,a=fm(n,h,Z,A),x=Oo(n,h,Z,K);"uniform"===S?(z=J(A/a,K/x),a*=z,x*=z,C+=c((A-a)/2),j+=c((K-x)/2),A=a,K=x):"centerUniform"===S&&((a>A||x>K)&&(z=J(A/a,K/x),a*=z,x*=z),C+=c((A-a)/2),j+=c((K-x)/2),A=a,K=x);var V=N.interactiveInfo;if(V){var w;if(w="center"===S?{x:C+A/2-a/2,y:j+K/2-x/2,width:a,height:x}:{x:C,y:j,width:A,height:K},V.rect){var r=V.compInfos,u=r.length;u&&(r[u-1].rect.image=n)}else V.rect=w}if("center"===S){var m=l!==!1&&(a>A||x>K);m&&(N.save(),N.beginPath(),N.rect(C,j,A,K),N.clip()),He(N,n,C+A/2-a/2,j+K/2-x/2,a,x,h,Z,B,e),m&&N.restore()}else He(N,n,C,j,A,K,h,Z,B,e)},toCanvas:function(I,j,s,n,r,K,J,h,f){I=Fp(I,J),j=j||fm(I,r),s=s||Oo(I,r);var R=Qb(),Z=tp(R);return h?(Nc(R,j,s,h),Z.scale(h,h)):Nc(R,j,s,1),wf(Z,I,n,0,0,j,s,r,K,J,f),I&&I.clampToEdge&&(R.clampToEdge=I.clampToEdge),Z.restore(),R},toGrayColor:function(s){if(!s)return s;var k=_f(s),$=c(.299*k[0]+.587*k[1]+.114*k[2]);return"rgba("+$+","+$+","+$+","+k[3]/255+")"},createGradientImage:function(U,R,e,p){for(var b=["L",0,0,U,0,1,0,0,1,0,0],F=0,D=Math.min(R.length,e.length);D>F;F++)b.push(e[F],R[F]);var f=y.Default.toCanvas({width:U,height:U,clampToEdge:!0,comps:[{type:"shape",rotation:p||0,points:[0,0,U,0,U,U,0,U],background:"#ffffff",gradientPack:b}]});return f},createElement:function(d,j,M,Y){var P=H.createElement(d);return Wb(P,j||B.widgetBorder,2),P.style.font=M?M:Qf,Y!=N&&(P.value=Y),F.onElementCreated&&F.onElementCreated(P),P},containedInView:function(w,m){var x=ul(m).getBoundingClientRect();return zo({x:x.left,y:x.top,width:x.width,height:x.height},oc(w))},isIsolating:function(){return vd>0},setIsolating:function(t){t?vd++:vd--},getMSMap:function(){return Wn},stringify:function(f,$,c){var A=Date.prototype.toJSON;Date.prototype.toJSON=function(){return"__ht__date"+this.getTime()};var G=_h.prototype.toJSON;_h.prototype.toJSON=function(){return"__ht__dataModel"+this.serialize(0)},$=c?0:$==N?2:$;var p=JSON.stringify(f,function(f,I){return"function"==typeof I?"__ht__"+(I.__ht__||I.toString()):dm(I)?pk(I):I instanceof y.List?"__ht__list"+(I.__ht__list||F.stringify(I._as)):I},$);return Date.prototype.toJSON=A,_h.prototype.toJSON=G,c&&(p=fp+Vq(p)),p},parse:function(R,j){return Je(R)?R.substr(0,12)!=fp||(R=wo(R.substr(12)),Je(R))?(j=j||{},JSON.parse(R,function(U,D){if(Je(D))if(j.ignoreFunction||"__ht__function"!=D.substr(0,14)){if(!j.ignoreDate&&"__ht__date"==D.substr(0,10))return new Date(Oc(D.substr(10)));if("__ht__list"===D.substr(0,10))return new Ik(F.parse(D.substr(10)));if(!j.ignoreDataModel&&"__ht__dataModel"===D.substr(0,15)){var r=new _h;return r.deserialize(F.parse(D.substr(15))),r}}else{var u=D.indexOf("{")+1,X=D.lastIndexOf("}"),N=D.indexOf("(")+1,M=D.indexOf(")");if(u&&X&&N&&M)try{var w=new Function(D.substring(N,M),D.substring(u,X));return w.__ht__=D.substr(6),w}catch(W){throw console.info("=== SyntaxError ===\n",D),W}}return D})):R:R},loadJS:function(l,L){L&&l.push(L);var n=l.shift();if(hr(n))l=n.contact(l),F.loadJS(l);else if(Cc(n))n(),F.loadJS(l);else if(Je(n)){var j=H.createElement("script");j.onload=function(){F.loadJS(l)},j.setAttribute("src",n),H.getElementsByTagName("head")[0].appendChild(j)}else l.length&&F.loadJS(l)},extendClass:function(e,z){var W=e.prototype;for(var J in z)Wn[J]&&Wn.hasOwnProperty(J)?Wn[J](W,z):W[J]=z[J]},toRoundedCorner:function(){function i(V,a,E){V.x=a.x,V.y=a.e||E,V.z=a.y}var x=new Vg,s=new Vg,V=new Vg,Q=new Vg;return function(C,m){var o,d=0;C.getPoints&&(d=C.getElevation(),C=C.getPoints()),o=C instanceof Ik?C:new Ik(C);var c=o.size();if(0>=m)return{points:o};var n=new Ik,O=new Ik,f=o.get(0);i(x,f,d),n.add(f),O.add(1);for(var X=1;c>X;X++)if(c>X+1){var w=o.get(X),Z=o.get(X+1);i(s,w,d),i(V,Z,d),Q.subVectors(x,s).setLength(Math.min(.99*Q.length(),m)).add(s),w.e!==I||f.e!==I?n.add({x:Q.x,y:Q.z,e:Q.y}):n.add({x:Q.x,y:Q.z}),n.add(w),Q.subVectors(V,s).setLength(Math.min(.99*Q.length(),m)).add(s),w.e!==I||Z.e!==I?n.add(f={x:Q.x,y:Q.z,e:Q.y}):n.add(f={x:Q.x,y:Q.z}),x.copy(Q),O.addAll([2,3])}else n.add(o.get(X)),O.add(2);return{points:n,segments:O}}}(),toColorData:_f,setCanvas:Nc,createDiv:jg,createDisabledDiv:mm,createView:vc,createCanvas:Qb,appendChild:Em,initContext:tp,checkLoadingImage:ib,translateAndScale:Cf,layout:Xd,getPosition:Sh,drawPoints:Qr,drawRoundRect:Nm,drawBorder:Jq,setFocus:Re,getter:Nr,setter:vb,isEmptyObject:kl,cameraPriority:function(){var G={skybox:0,main:1e4,top:1e7,infinity:1/0};return C.seal(C.defineProperties({},{skybox:{configurable:!1,enumerable:!1,get:function(){return G.skybox},set:function(g){if(g>=G.main)throw new RangeError("Skybox camera must have lower priority than the main camera.");G.skybox=Number(g)}},main:{configurable:!1,enumerable:!1,get:function(){return G.main},set:function(y){if(y<=G.skybox)throw new RangeError("Main camera must have higher priority than the skybox camera.");if(y>=G.top)throw new RangeError("Main camera must have lower priority than the top camera.");G.main=Number(y)}},top:{configurable:!1,enumerable:!1,get:function(){return G.top},set:function(c){if(c<=G.main)throw new RangeError("Top camera must have higher priority than the main camera.");G.top=Number(c)}}}))}(),addFontFace:function(){function M(H){var n=H.substr(H.lastIndexOf(".")+1);H=F.convertURL?F.convertURL(H):H;var G=f[n]||n;return{postfix:n,url:"url("+H+') format("'+G+'")'}}function m(c,z){return d[c.postfix]-d[z.postfix]}var f={ttf:"truetype",otf:"opentype",eot:"embedded-opentype"},d={eot:0,woff2:1,woff:2,ttf:3,otf:4};return function(A,C,$,K){if(A){K&&F.removeFontFace(A,!0);var u;if(u=Yl[A])return u.parentNode||H.head.appendChild(u),$&&$(u),void 0;if(Je(C)&&(C=[C]),C=C.filter(function(J){return Je(J)?J.length>0:!1}),0!==C.length){C=C.map(M);var d="";C.sort(m).forEach(function(q){d+=", "+q.url}),d=d.substr(2);var u=H.createElement("style");u.innerText='@font-face{font-family: "'+A+'";src: '+d+";}",H.head.appendChild(u),Yl[A]=u,$&&$(u)}}}}(),clearFontFace:function(){if(!kl(Yl)){for(var x in Yl)F.removeFontFace(x);Yl={}}},removeFontFace:function(T,k){if(T){var v=T;if(v.tagName){if(Yf(v),k){var m=[];for(var Z in Yl)Yl[Z]===v&&m.push(Z);var W=m.length;if(W>0)for(var V=0,W=m.length;W>V;V++)delete Yl[m[V]]}}else(v=Yl[T])&&(Yf(v),k&&delete Yl[T])}},getFontFaceMap:function(){return Yl},handleFontFacesLoaded:function(){}},!0),H&&H.fonts&&H.fonts.addEventListener&&H.fonts.addEventListener("loadingdone",function(z){F.handleFontFacesLoaded(z.fontfaces),F.findView("all").forEach(function(P){P.redraw?P.redraw():P.iv()})}),xo(v,{autoAdjustIndex:1,hierarchicalRendering:1,adjustChildrenToTop:1,autoHideScrollBar:1,autoUpdate:1,firstPersonMode:1,ortho:1,strict:1,stickToRight:1,instant:1,closePath:1,hierarchical:1,doubleClickToToggle:1,continuousLayout:1,syncSize:1},!0);var Zj=F.disabledOpacity,xl=F.toolTipDelay,Ep=F.devicePixelRatio,Jb=F.autoMakeVisible,pl=F.autoHideScrollBar,Pm=F.imageGradient,eq=F.showToolTip,to=F.hideToolTip,Wi=F.dashPattern,Ed=F.lineCap,Zl=F.lineJoin,xr=F.labelColor,Gb=F.labelSelectColor,Qf=F.labelFont,Gn=F.widgetIndent,nq=F.widgetRowHeight,sf=F.widgetHeaderHeight,Un=F.widgetTitleHeight,dg=F.scrollBarColor,cj=F.scrollBarSize,Th=F.scrollBarTimeout,Vf=F.scrollBarMinLength,Yb=F.scrollBarInteractiveSize,mc=F.zoomIncrement,Bi=F.scrollZoomIncrement,zs=F.pinchZoomIncrement,pe=F.zoomMax,Nq=F.zoomMin,Zm=F.createObject,vr=F.preventDefault,mg=F.setImage,Fp=F.getImage,Gl=F.isImageComplete,hl=F.drawCenterImage,wf=F.drawStretchImage,Nj=F.getId,hh=F.callLater,Vm=F.cancelLater,tf=F.sortFunc,iq=F.clone,gb=F.getClass,Pc=F.startAnim,Do=F.brighter,Gg=F.darker,Pr=F.drawText,ce=F.getTextSize,bs=F.isLeftButton,gd=F.isMiddleButton,nl=F.isRightButton,hm=F.getTouchCount,Jd=F.isDoubleClick,oo=F.isShiftDown,Og=F.isCtrlDown,oc=F.getClientPoint,Jj=F.getPagePoint,So=F.getDistance,Jf=F.unionPoint,pq=F.unionRect,zo=F.containsPoint,ng=F.containsRect,pd=F.intersectsRect,zc=F.intersection,yo=F.getWindowInfo,Oj=F.grow,qh=F.getLogicalPoint,df=F.getScreenPoint,Gp=F.startDragging,Yf=F.removeHTML,Yr=F.createElement,Ff=F.segmentResolution,Dr=F.shapeResolution,Xr=F.shapeSide,ri=F.def,Db=function(f,F,T){ri(D+"."+f,F,T)},Xi=function(F,m){F.childNodes.forEach(function(M){m(M),Xi(M,m)})};xo(F,{toolTipLabelColor:xr,toolTipLabelFont:Qf,toolTipBackground:B.toolTipBackground,toolTipShadowColor:Sg,debugTipLabelFont:Qf,debugTipLabelColor:xr,debugTipBackground:B.toolTipBackground,drawBreakableText:Vk,setDevicePixelRatio:function(M){Ep=F.devicePixelRatio="number"==typeof M?M:le(w),Xi(H.body,function(T){var c=T._ht;c&&c._canvas&&(Nc(c._canvas,c.getWidth(),c.getHeight()),c.redraw?c.redraw():c.iv())})},getPosition3dGap:function(){return Hh()}},!0);var Qq=1e-6,Xq="undefined"!=typeof Uint16Array?Uint16Array:Array,fs="undefined"!=typeof Uint32Array?Uint32Array:Xq,ub="undefined"!=typeof Float32Array?Float32Array:Array,Zo=function(R,a,k){var H=[R[0]-a[0],R[1]-a[1],R[2]-a[2]];if(k){var C=So(H);C>0&&(H[0]/=C,H[1]/=C,H[2]/=C)}return H},mk=function(){var e="charCodeAt",L=2*(2*Wj.length+1);for(var O in w)if(O===D+hp[0]+(ps.length+2)){var q=w[O];if(!q)break;for(var F=q.length,t=0;F>t;t++)if(q[t][e](0)===L&&q[t+1]!=N&&q[t+1]===ps[0]&&q[t+2]!=N&&q[t+2][e](0)===L){for(var a=t+3;F>a;a++)if(q[a][e](0)===L){if(0==q[a+1])for(var i,R=a+2;F>R;R++){if(q[R][e](0)===L){0==q[R-1]&&i&&(fh=i.substr(0,i.length-1));break}i==N?i=q[R]:i+=q[R]}break}break}break}return function(X){return[-X[0],-X[1],-X[2]]}}(),Cr=function(q,U){return 3===q.length?q[0]*U[0]+q[1]*U[1]+q[2]*U[2]:q[0]*U[0]+q[1]*U[1]},Gj=function(){var t=new Array(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Ol=Gj(),Sc=function($){var I=new Array(16);return I[0]=$[0],I[1]=$[1],I[2]=$[2],I[3]=$[3],I[4]=$[4],I[5]=$[5],I[6]=$[6],I[7]=$[7],I[8]=$[8],I[9]=$[9],I[10]=$[10],I[11]=$[11],I[12]=$[12],I[13]=$[13],I[14]=$[14],I[15]=$[15],I},ai=function(q,L){return q[0]=L[0],q[1]=L[1],q[2]=L[2],q[3]=L[3],q[4]=L[4],q[5]=L[5],q[6]=L[6],q[7]=L[7],q[8]=L[8],q[9]=L[9],q[10]=L[10],q[11]=L[11],q[12]=L[12],q[13]=L[13],q[14]=L[14],q[15]=L[15],q},Nh=function(H){return H[0]=1,H[1]=0,H[2]=0,H[3]=0,H[4]=0,H[5]=1,H[6]=0,H[7]=0,H[8]=0,H[9]=0,H[10]=1,H[11]=0,H[12]=0,H[13]=0,H[14]=0,H[15]=1,H},wq=function(v,l){var p=v[0],U=v[1],P=v[2];return v[0]=l[0]*p+l[4]*U+l[8]*P+l[12],v[1]=l[1]*p+l[5]*U+l[9]*P+l[13],v[2]=l[2]*p+l[6]*U+l[10]*P+l[14],v},mj=function(B,l){var U=B[0],f=B[1],g=B[2],X=B[3];return B[0]=l[0]*U+l[4]*f+l[8]*g+l[12]*X,B[1]=l[1]*U+l[5]*f+l[9]*g+l[13]*X,B[2]=l[2]*U+l[6]*f+l[10]*g+l[14]*X,B[3]=l[3]*U+l[7]*f+l[11]*g+l[15]*X,B},Ir=function(){var l,U,X,n,_=Wf(Df[1]+Df[7]),g=Wf(Df[0]+Df[3]-Df[10]),R=Wf(Df[8]+2),s=function(){return U=X.charAt(l),l+=1,U},z=function(){var c="";if(U===R)for(;s();){if(U===R)return s(),c;c+=U}else s()},u=function(){for(;U&&" ">=U;)s()},K=function(){var E,G={};if(U===_){if(s(),u(),U===g)return s(),G;for(;U;){if(E=z(),u(),s(),G[E]=n(),u(),U===g)return s(),G;s(),u()}}};return n=function(){switch(u(),U){case _:return K();default:return z()}},function(B){if(o={},B){var p;if(X=B,l=0,U=" ",p=n(),u(),!U)return p}}}(),gl=function(t,G){if(G){var b=W(G),A=s(G),H=t[4],q=t[5],J=t[6],F=t[7],d=t[8],r=t[9],R=t[10],I=t[11];t[4]=H*A+d*b,t[5]=q*A+r*b,t[6]=J*A+R*b,t[7]=F*A+I*b,t[8]=d*A-H*b,t[9]=r*A-q*b,t[10]=R*A-J*b,t[11]=I*A-F*b}},Rj=function(a,O){if(O){var I=W(O),K=s(O),o=a[0],$=a[1],P=a[2],B=a[3],q=a[8],k=a[9],L=a[10],h=a[11];a[0]=o*K-q*I,a[1]=$*K-k*I,a[2]=P*K-L*I,a[3]=B*K-h*I,a[8]=o*I+q*K,a[9]=$*I+k*K,a[10]=P*I+L*K,a[11]=B*I+h*K}},Dd=function(m,A){if(A){var i=W(A),U=s(A),n=m[0],g=m[1],H=m[2],G=m[3],f=m[4],u=m[5],a=m[6],R=m[7];m[0]=n*U+f*i,m[1]=g*U+u*i,m[2]=H*U+a*i,m[3]=G*U+R*i,m[4]=f*U-n*i,m[5]=u*U-g*i,m[6]=a*U-H*i,m[7]=R*U-G*i}},rg=function(g,W,w){return xm(N,w===!1?N:g.getFinalScale3d(),g.getFinalRotation3d(),g.getRotationMode(),g.p3(),N,W)},xm=function(o,l,A,v,W,n,K){return n||(n=Gj()),W&&Yc(n,W),ao(n,A,v),K&&Im(n,n,K),l&&gr(n,l),o&&Im(n,n,o),n},Hc=function(X,V,y){V=Oc(V),y=Oc(y);var F=this;F.g=X,F._84O=V,F._85O=y,F._70I=!0,F.F=0,F._83O=V+y,F.pen={x:0,y:0}},bo="lineDashOffset",nj="setLineDash",qj=function(x){for(var z in x)1===z.length&&(bo=x[z]);return z?1:0},bl=function(M,f,Z){return pi(f)?M:M[nj]?(M[nj](f),Z&&(M.lineDashOffset=Z),M):new Hc(M,f[0],f.length>1?f[1]:f[0])},Ai=function(G,D){!pi(D)&&G[nj]&&(G[nj](vj),G.lineDashOffset=0)};ri(Hc,C,{_69I:6,moveTo:function(R,Y){var i=this,h=i.pen;h.x=R,h.y=Y,i.g.moveTo(R,Y),i.start||(i.start={x:R,y:Y})},lineTo:function(L,v){var J=this,H=J.pen,Z=L-H.x,U=v-H.y,E=ge(U,Z),l=s(E),z=W(E),q=J._23O(H.x,H.y,L,v),B=J._85O,V=J._84O,K=J._83O;if(J.F){if(J.F>q)return J._70I?J._72I(L,v):J.moveTo(L,v),J.F-=q,void 0;if(J._70I?J._72I(H.x+l*J.F,H.y+z*J.F):J.moveTo(H.x+l*J.F,H.y+z*J.F),q-=J.F,J.F=0,J._70I=!J._70I,!q)return}var o=g(q/K);if(o){for(var u=l*V,F=z*V,I=l*B,n=z*B,A=0;o>A;A++)J._70I?(J._72I(H.x+u,H.y+F),J.moveTo(H.x+I,H.y+n)):(J.moveTo(H.x+I,H.y+n),J._72I(H.x+u,H.y+F));q-=K*o}J._70I?q>V?(J._72I(H.x+l*V,H.y+z*V),J.moveTo(L,v),J.F=B-(q-V),J._70I=!1):(J._72I(L,v),q===V?(J.F=0,J._70I=!J._70I):(J.F=V-q,J.moveTo(L,v))):q>B?(J.moveTo(H.x+l*B,H.y+z*B),J._72I(L,v),J.F=V-(q-B),J._70I=!0):(J.moveTo(L,v),q===B?(J.F=0,J._70I=!J._70I):J.F=B-q)},quadraticCurveTo:function(O,C,A,q){var L,D=this,h=D.pen,X=h.x,G=h.y,V=D._22O(X,G,O,C,A,q),z=0,d=0,J=D._85O,P=D._84O;if(D.F){if(D.F>V)return D._70I?D._71I(O,C,A,q):D.moveTo(A,q),D.F-=V,void 0;if(z=D.F/V,L=D._20O(X,G,O,C,A,q,z),D._70I?D._71I(L[2],L[3],L[4],L[5]):D.moveTo(L[4],L[5]),D.F=0,D._70I=!D._70I,!V)return}var c=V-V*z,Y=g(c/D._83O),Z=P/V,M=J/V;if(Y)for(var b=0;Y>b;b++)D._70I?(d=z+Z,L=D._21O(X,G,O,C,A,q,z,d),D._71I(L[2],L[3],L[4],L[5]),z=d,d=z+M,L=D._21O(X,G,O,C,A,q,z,d),D.moveTo(L[4],L[5])):(d=z+M,L=D._21O(X,G,O,C,A,q,z,d),D.moveTo(L[4],L[5]),z=d,d=z+Z,L=D._21O(X,G,O,C,A,q,z,d),D._71I(L[2],L[3],L[4],L[5])),z=d;c=V-V*z,D._70I?c>P?(d=z+Z,L=D._21O(X,G,O,C,A,q,z,d),D._71I(L[2],L[3],L[4],L[5]),D.moveTo(A,q),D.F=J-(c-P),D._70I=!1):(L=D._19O(X,G,O,C,A,q,z),D._71I(L[2],L[3],L[4],L[5]),V===P?(D.F=0,D._70I=!D._70I):(D.F=P-c,D.moveTo(A,q))):c>J?(d=z+M,L=D._21O(X,G,O,C,A,q,z,d),D.moveTo(L[4],L[5]),L=D._19O(X,G,O,C,A,q,d),D._71I(L[2],L[3],L[4],L[5]),D.F=P-(c-J),D._70I=!0):(D.moveTo(A,q),c===J?(D.F=0,D._70I=!D._70I):D.F=J-c)},bezierCurveTo:function(){var I=arguments;this.pen={x:I[4],y:I[5]},this.g.bezierCurveTo(I[0],I[1],I[2],I[3],I[4],I[5])},arc:function(l,c,H,z,w,A){A||(z=-z,w=-w),id(this,l,c,z,w-z,H,H,!1)},rect:function(o,d,y,e){var Z=this;Z.pen={x:o,y:d},Z.moveTo(o,d),Z.lineTo(o,d+e),Z.lineTo(o+y,d+e),Z.lineTo(o+y,d),Z.lineTo(o,d)},beginPath:function(){this.g.beginPath()},closePath:function(){this.lineTo(this.start.x,this.start.y)},_23O:function(a,r,k,R){var Y=k-a,i=R-r;return U(Y*Y+i*i)},_22O:function(Z,O,j,m,w,I,C){for(var Q,y,q,r,f,M,v,$=0,E=Z,h=O,a=C>0?C:this._69I,B=1;a>=B;B++)q=B/a,r=1-q,f=r*r,M=2*q*r,v=q*q,Q=f*Z+M*j+v*w,y=f*O+M*m+v*I,$+=this._23O(E,h,Q,y),E=Q,h=y;return $},_21O:function(A,f,l,h,w,B,u,O){var d=this;if(0===u)return d._20O(A,f,l,h,w,B,O);if(1===O)return d._19O(A,f,l,h,w,B,u);var Q=d._20O(A,f,l,h,w,B,O);return Q.push(u/O),d._19O.apply(d,Q)},_20O:function(I,r,y,H,g,W,K){if(1!==K){var Z=y+(g-y)*K,s=H+(W-H)*K;y=I+(y-I)*K,H=r+(H-r)*K,g=y+(Z-y)*K,W=H+(s-H)*K}return[I,r,y,H,g,W]},_19O:function(I,Z,R,$,D,C,S){if(1!==S){var c=I+(R-I)*S,T=Z+($-Z)*S;R+=(D-R)*S,$+=(C-$)*S,I=c+(R-c)*S,Z=T+($-T)*S}return[I,Z,R,$,D,C]},_72I:function(l,h){var C=this.pen;(l!==C.x||h!==C.y)&&(C.x=l,C.y=h,this.g.lineTo(l,h))},_71I:function(V,E,U,p){var z=this.pen;(V!==U||E!==p||U!==z.x||p!==z.y)&&(z.x=U,z.y=p,this.g.quadraticCurveTo(V,E,U,p))}}),Wn.ms_quickVisible=function(u){u._4BQ=!1,u._4CQ=function(m){var T=m._4EQ;return T!==I?T:T=m._4EQ=this._4FQ(m)},u._4DQ=function(B){if(!B)return this.dm().each(function(x){x._4EQ=I}),void 0;B._4EQ=I;var Q=this;if(B instanceof Jc||Ln(B)||B instanceof Wq||B.ISubGraph)B.eachChild(function(h){Q.invalidateQuickVisible(h)});else if(B.getEdges){var W=B.getEdges();W&&W.each(function(M){Q.invalidateQuickVisible(M)})}},u.enableQuickVisibleMode=function(){this._4BQ||(this._4BQ=!0,this._4FQ=this.isVisible,this.isVisible=this._4CQ,this.invalidateQuickVisible=this._4DQ)},u.disableQuickVisibleMode=function(){this._4BQ&&(this._4BQ=!1,this.isVisible=this._4FQ,this.invalidateQuickVisible=rp)},u.isQuickVisibleMode=function(){return this._4BQ},u.invalidateQuickVisible=rp},Ze=sr()+1,$q&&w.console&&Ze&&!0&&(w.navigator&&w.navigator.userAgent.toLowerCase().indexOf("chrome")>-1?w.console.log.apply(console,["Hightopo - Version："+y.Default.getVersion()+" - %cTrial：http://hightopo.com/request.html","color: #f00;"]):w.console.log("Hightopo - Version："+y.Default.getVersion()+" - Trial：http://hightopo.com/request.html"));var Tl=N,xd=N,Am=F.checkLoadingCompType=function(l){Tl&&!l._72O_&&(xd||(xd={}),xd[l._72O_=Nj()]=l)},Fr=function(I,B){if(B||(B=I),B&&(Tl||(Tl={}),!Tl[I])){var u=new Ge;if(Tl[B]={request:u,url:B},B=F.beforeLoadURL(B,I),B.data){var t=F.parse(B.data);he(I,t),F.handleCompTypeLoaded(I,t)}else{u.onload=function(){if(200===this.status||0===this.status){var X=F.parse(u.getResponseText());he(I,X),F.handleCompTypeLoaded(I,X)}else he(I,N)},u.onerror=function(){he(I,N)};var H={};H.url=encodeURI(B),H.sync=!1,u.send(H)}}},he=function(j,y){if(Rn[j]=y,delete Tl[j],kl(Tl)&&(Tl=N,xd)){for(var n in xd){var q=xd[n];q.invalidateAll&&q.invalidateAll(I,"compTypeLoaded",j),q.redraw&&q.redraw(),q.iv(),delete q._72O_}xd=N}if(y&&xd)for(var n in xd){var q=xd[n];q.invalidateAll&&q.invalidateAll(I,"compTypeLoading",j),q.redraw&&q.redraw(),q.iv()}},Nn=B.chart,re="",or=!0,es=F.compStack=[],xn=/^style@/,mr=/^attr@/,Zi=/^field@/,Vr={x:.5,y:.5},Mr=function(){or=!0},Cq=function(){return or},Dk=function($,Z,W){if(!$)return!1;var V;return W&&W.isImageFitSize&&(V=W.isImageFitSize(Z,$)),V==N&&(V=Aq($.fitSize,Z,W)),V},fm=function(t,$,b,V){if(!t)return 0;if(Dk(t,$,b)&&V)return V;var M=Aq(t.width,$,b);return null==M?20:M},Oo=function(P,w,y,r){if(!P)return 0;if(Dk(P,w,y)&&r)return r;var n=Aq(P.height,w,y);return null==n?20:n},Aq=function(Z,T,X){if(!Z||!Z.func)return Z;var E,S=Z.func,v=Z.value;return E=Cc(S)?X&&X.vectorDataBindingDisabled&&!Z.isSafeFunc?v:S(T,X):T instanceof dd||(y.ui?T instanceof y.ui.View:0)?mr.test(S)?T.a(re+S.slice(5)):xn.test(S)?T.s(re+S.slice(6)):Zi.test(S)?T[S.slice(6)]:T[S]?T[S](X):v:v,v!==I&&E==N?v:E},He=F.drawImage=function(){var m,g,P,$,U,T,o=3,D=6,M=function(u,W){u.getValue&&u.getValue.compType===W||(u.getValue=function(i){var P=K(u,i);if(P===I&&W.properties){var t=W.properties[i];t&&(P=t.defaultValue)}return P},u.getColor=function(w,v){return v===!0?k(w):k(u.getValue(w))},u.getValue.compType=W)},K=function(i,C,U){var A,X=!1;if(i.prefix&&g instanceof dd){var z=g.a(re+C);z!==I&&(X=!0,A=z)}return A===I&&(A=i[C]),A&&A.func&&(X=!0,A=Aq(A,g,P)),U&&(A=U(A),X||(i[C]=A)),A},k=function(B,d){var R;return R=d?K(B,d):B,m&&m.compGray&&R?F.toGrayColor(R):U&&R?Fn(R,U,T):R},L=function(S){if(hr(S)){for(var t=new Ik,K=S.length,w=0;K>w;w+=2)t.add({x:S[w],y:S[w+1]});S=t}return S},h=function(L){var d=K(L,"anchorX"),J=K(L,"anchorY");if(d!==I||J!==I)return{x:d===I?Vr.x:d,y:J===I?Vr.y:J};var f=K(L,"type"),e=K(L,"name");if("image"!==f||!e)return Vr;var C=Fp(e);return C&&C.anchorX!==I&&C.anchorY!==I?{x:C.anchorX,y:C.anchorY}:Vr},R=function(o,r){var U=K(o,Yp),y=h(o);if(hr(U)){var v=U.length,V=K(o,"relative"),m=r.width,u=r.height;if(4===v)U={x:U[0],y:U[1],width:U[2],height:U[3]},V&&(U.x*=m,U.y*=u,U.width*=m,U.height*=u);else if(3===v){var l=U[0];U={width:U[1],height:U[2]},V&&(U.width*=m,U.height*=u),"object"==typeof l?l.length&&(l={x:l[0],y:l[1]}):l=Sh(l,r,U),U.x=l.x-U.width*y.x,U.y=l.y-U.height*y.y}U.x+=K(o,"offsetX")||0,U.y+=K(o,"offsetY")||0,!V&&r.fitSize&&(U=H(o,U,r))}return U},H=function(w,D,E){if(D){var p,Z,g,n={x:D.x,y:D.y,width:D.width,height:D.height},H=h(w),e=K(w,"layoutH"),R=K(w,"layoutV"),V=1,Y=1,$=0,k=0,f=1,l=1;switch(e){case"left":break;case"right":n.x+=E.width-E.rw;break;case"center":n.x+=.5*(E.width-E.rw);break;case"scale":case"leftright":default:p=K(w,ek)||0,p&&($=Math.abs(k=Math.sin(p)),f=Math.abs(l=Math.cos(p))),"leftright"!==e?(V+=f*(E.widthScale-1),Y+=$*(E.widthScale-1)):(V+=n.width?f*(E.width-E.rw)/n.width:0,Y+=n.height?$*(E.width-E.rw)/n.height:0,Z=-Math.min(-H.x*l+H.y*k,-H.x*l-(1-H.y)*k,(1-H.x)*l+H.y*k,(1-H.x)*l-(1-H.y)*k))}switch(R){case"top":break;case"bottom":n.y+=E.height-E.rh;break;case"center":n.y+=.5*(E.height-E.rh);break;case"scale":case"topbottom":default:p==N&&(p=K(w,ek),p&&($=Math.abs(k=Math.sin(p)),f=Math.abs(l=Math.cos(p)))),"topbottom"!==R?(V+=$*(E.heightScale-1),Y+=f*(E.heightScale-1)):(V+=n.width?$*(E.height-E.rh)/n.width:0,Y+=n.height?f*(E.height-E.rh)/n.height:0,g=-Math.min(-H.x*k-H.y*l,-H.x*k+(1-H.y)*l,(1-H.x)*k-H.y*l,(1-H.x)*k+(1-H.y)*l))}return(1!==V||1!==Y)&&("scale"!==e&&e?"leftright"===e&&(n.x+=n.width*(1-V)*H.x+Z*(E.width-E.rw)):n.x+=n.x*(E.widthScale-1)+H.x*n.width*(E.widthScale-V),"scale"!==R&&R?"topbottom"===R&&(n.y+=n.height*(1-Y)*H.y+g*(E.height-E.rh)):n.y+=n.y*(E.heightScale-1)+H.y*n.height*(E.heightScale-Y),n.width*=V,n.height*=Y),n.width<0&&(n.width=0),n.height<0&&(n.height=0),n}},b=function(l){return hr(l)?new Ik(l):l},A=function(C,v,f,l,x,n,B){var Y=m.interactiveInfo,r=C.transform;if(r)return m.save(),m.setTransform(r.a,r.b,r.c,r.d,r.tx,r.ty),Y&&Y.compInfos.push({comp:C,rect:v,matrix:r.clone(),prefix:re,refRect:Y.refRect}),!0;x===I&&(x=1),n===I&&(n=1);var P=K(C,"clipPercentage"),E=ic(f,v);if(E&&!l&&1===x&&1===n&&P==I)return Y&&Y.compInfos.push({comp:C,rect:v,matrix:Y.matrix.clone(),prefix:re,refRect:Y.refRect}),!1;B=B||Vr;var c=v.x+v.width*B.x,N=v.y+v.height*B.y,H=f.x+f.width*B.x,e=f.y+f.height*B.y,o=f.width?x*(v.width/f.width):1,z=f.height?n*(v.height/f.height):1;if(m.save(),Y&&(Y.matrix.appendTranslate(c,N).appendRotate(l).appendScale(o,z).appendTranslate(-H,-e),Y.compInfos.push({comp:C,rect:v,matrix:Y.matrix.clone(),prefix:re,refRect:Y.refRect})),jf(m,c,N),je(m,l||0),$r(m,o,z),jf(m,-H,-e),P!=I){var T=zl(f,K(C,"clipDirection"),P);m.beginPath(),m.rect(T.x,T.y,T.width,T.height),m.clip()}return!0},t=function(){m.restore()},G=function(c,P,y){var Z=K(c,"path"),G=K(c,ek),p=K(c,"scaleX"),E=K(c,"scaleY"),T=h(c),W=N,I=Lj(null,Z);if(y||(y=c.unionRect,y||(y=Jf(I),c.path.func||(c.unionRect=y)),W=y),y){W||(W=c.unionRect,W||(W=Jf(I),c.path.func||(c.unionRect=W)));var B=A(c,y,W,G,p,E,T),X=K(c,"borderPattern"),x=bl(m,X),u=k(c,"background"),f=k(c,"borderColor"),U=K(c,"borderWidth"),Y=K(c,"gradient"),H=k(c,"gradientColor"),O=K(c,"border3d"),i=k(c,"border3dColor"),j=K(c,"border3dAccuracy"),g=m.lineJoin,l=m.lineCap;m.lineJoin=K(c,"borderJoin")||Zl,m.lineCap=K(c,"borderCap")||Ed,u?(Zn(m,u,Y,H,W),Lj(m,Z),m.fill(),x!==m&&Lj(m,Z)):Lj(m,Z);var e=K(c,"borderWidthAbsolute");if(e&&(m.save(),m.setTransform(1,0,0,1,0,0)),U&&f&&(m.lineWidth=U,m.strokeStyle=f,m.stroke(),O&&Tn(m,f,i,U,$,j)),Ai(m,X),K(c,"dash")){var D=K(c,"dashWidth")||U;if(D>0){X=K(c,"dashPattern")||Wi;var x=bl(m,X,K(c,"dashOffset")),n=k(c,"dashColor")||k(Lp);x!==m&&Lj(m,Z),m.strokeStyle=n,m.lineWidth=D,m.stroke(),K(c,"dash3d")&&Tn(m,n,k(c,"dash3dColor"),D,$,K(c,"dash3dAccuracy")),Ai(m,X)}}e&&m.restore(),P===Yp&&Mi(m,u,K(c,"depth"),W),m.lineJoin=g,m.lineCap=l,B&&t()}},x=function(s,V,i,E){var r=K(s,Xf,L),x=K(s,ek),C=h(s);if(r&&E.fitSize){var q=new Ik,f=Jf(r),d=H(s,f,E),F=f.x+C.x*f.width,p=f.y+C.y*f.height,Q=d.x+C.x*d.width,Y=d.y+C.y*d.height,c=f.width?d.width/f.width:1,B=f.height?d.height/f.height:1;r.each(function(r){q.add({x:Q+(r.x-F)*c,y:Y+(r.y-p)*B})}),r=q,s.unionRect=null}var R=K(s,"scaleX"),j=K(s,"scaleY"),n=V===Kb,_=N;if(!i&&n&&(i=s.unionRect,i||(i=Jf(r),s.points.func||(s.unionRect=i)),_=i),i){n?_||(_=s.unionRect,_||(_=Jf(r),s.points.func||(s.unionRect=_))):_=i;var W,M,u,J,l=A(s,i,_,x,R,j,C),v=K(s,"borderPattern"),Z=bl(m,v),D=k(s,"background"),G=Fp(K(s,"repeatImage"),U,T),O=K(s,"gradientPack"),y=K(s,"borderGradientPack"),a=k(s,"borderColor"),S=K(s,"borderWidth"),z=Fp(K(s,"borderRepeatImage"),U,T),X=K(s,"segments",b),w=K(s,"gradient"),o=k(s,"gradientColor"),e=K(s,"border3d"),Yr=k(s,"border3dColor"),oq=K(s,"border3dAccuracy"),ue=K(s,"closePath"),Zq=K(s,"fillRule")||"nonzero",_m=m.lineJoin,Mj=m.lineCap;if(m.lineJoin=K(s,"borderJoin")||Zl,m.lineCap=K(s,"borderCap")||Ed,n)if(D||G||O){var Rg=K(s,"fillClipPercentage");if(Rg!=I){var kf=zl(_,K(s,"fillClipDirection"),Rg);m.save(),m.beginPath(),m.rect(kf.x,kf.y,kf.width,kf.height),m.clip()}Qr(m,r,X,ue),O?hj(m,O,k,!1,_):G?_k(m,G,U,T,g,P):Zn(m,D,w,o,_),m.fill(Zq),O&&m.restore(),Rg!=I&&m.restore(),Z!==m&&Qr(Z,r,X,ue)}else Qr(Z,r,X,ue);else if("roundRect"===V?W=K(s,"cornerRadius"):"polygon"===V?(W=K(s,"polygonSide"),M=K(s,"cornerRadius"),u=K(s,"regular")):"arc"===V&&(W=K(s,"arcFrom"),M=K(s,"arcTo"),u=K(s,"arcClose"),J=K(s,"arcOval")),D||G||O){var Rg=K(s,"fillClipPercentage");if(Rg!=I){var kf=zl(_,K(s,"fillClipDirection"),Rg);m.save(),m.beginPath(),m.rect(kf.x,kf.y,kf.width,kf.height),m.clip()}Uq(m,V,_,W,M,u,J),O?hj(m,O,k,!1,_):G?_k(m,G,U,T,g,P):Zn(m,D,w,o,_),m.fill(Zq),O&&m.restore(),Rg!=I&&m.restore(),m!==Z&&Uq(Z,V,_,W,M,u,J)}else Uq(Z,V,_,W,M,u,J);var ag=K(s,"borderWidthAbsolute");if(ag&&(m.save(),m.setTransform(1,0,0,1,0,0)),S&&(a||z||y)&&(m.lineWidth=S,y?hj(m,y,k,!0,_):z?sh(m,z,U,T,g,P):m.strokeStyle=a,m.stroke(),y&&m.restore(),e&&Tn(m,a,Yr,S,$,oq)),Ai(m,v),K(s,"dash")){var yg=K(s,"dashWidth")||S;if(yg>0){v=K(s,"dashPattern")||Wi;var Z=bl(m,v,K(s,"dashOffset")),ip=k(s,"dashColor")||k(Lp);Z!==m&&(n?Qr(Z,r,X,ue):Uq(Z,V,_,W,M,u,J)),m.strokeStyle=ip,m.lineWidth=yg,m.stroke(),K(s,"dash3d")&&Tn(m,ip,k(s,"dash3dColor"),yg,$,K(s,"dash3dAccuracy")),Ai(m,v)}}ag&&m.restore(),V===Yp&&Mi(m,D,K(s,"depth"),_),m.lineJoin=_m,m.lineCap=Mj,l&&t()}},c=function(G,t){var H=U||K(G,uf),s=T||K(G,"blendMode"),c=K(G,"name"),Q=Fp(c,H,s);Q&&Q.cacheRule!=N&&(Q=Hl(m,Q,K(G,"stretch"),t.width,t.height,g,P,H)),Q?wf(m,Q,K(G,"stretch"),t.x,t.y,t.width,t.height,g,P,H,null,s):or=!1},z=function(I,Q){var t=K(I,"text");if(t!=N){t+="";var L,f=K(I,"gradientPack"),T=K(I,"gradient"),W=k(I,"gradientColor"),M=K(I,"font"),C=K(I,"vertical"),q=K(I,"verticalGap")||0,a=K(I,"align"),o=K(I,"vAlign"),j=K(I,"decoration"),u=K(I,"letterGap")||0,w=K(I,"wrap"),A=K(I,"borderWidth"),Y=K(I,"borderColor"),v=ce(M,t);if(f?(L=hj(m,f,k,!1,Q),m.restore()):L=k(I,uf),!f&&T&&(L=F.createGradient(m,T,L||F.labelColor,W||B.imageGradient,Q.x,Q.y,Q.width,Q.height)),A&&hr(Y)&&(Y=hj(m,Y,k,!1,Q),m.restore()),C){null==q&&(q=1);var H,P,G,r=[],_=[];H=w?dp(t,Q.height,M,u,C,q):[t],m.textBaseline=nc,m.font=M,H.forEach(function(P){for(var a=P.length,M=0,g=(a-1)*q,H=0;a>H;H++){var N=m.measureText(P[H]);r.push(N),g+=N.fontBoundingBoxDescent||v.height,M=n(M,N.width)}_.push({width:M,height:g})});var J=(H.length-1)*u;_.forEach(function(v){J+=v.width}),P=a&&a!==hp?a===Il?Q.x+Q.width-J:Q.x+(Q.width-J)/2:Q.x;var s=0;H.forEach(function(t,g){var b=_[g],l=t.length;G=o&&o!==_p?o===nc?Q.y:Q.y+Q.height-b.height:Q.y+(Q.height-b.height)/2;for(var h=0;l>h;h++){var i=t[h],D=r[s],K=D.fontBoundingBoxDescent||v.height;Kg(m,i,M,L,{x:P,y:G,width:b.width,height:K},lo,o,j,u,A,Y),G+=K+q,s++}P+=b.width+u})}else{var H=w?dp(t,Q.width,M,u,C,q):t.split("\n"),y=H.length;if(y>1){var D=ce(M,t),e=D.height,$=y*e+q*(y-1),h=iq(Q);return o&&o!==_p?o===yf&&(h.y=Q.y+Q.height-$):h.y=Q.y+(Q.height-$)/2,h.height=$,Vk(m,H,h,M,L,a||hp,j,u,A,Y),void 0}Kg(m,t,M,L,Q,a,o,j,u,A,Y)}}},u=function(x,p){Jq(m,k(x,uf),p.x,p.y,p.width,p.height,K(x,"width"))},d=function(M,D){var F=K(M,Lr),w=0;if(F&&(F.forEach(function(A){w+=A}),w>0)){for(var x=K(M,"colors")||Nn,G=K(M,"startAngle")||0,S=K(M,"hollow"),B=K(M,Yn),I=K(M,Oi),d=K(M,Hp),q=B?new Ik:N,i=D.x,E=D.y,v=D.width,O=D.height,r=i+v/2,T=E+O/2,u=J(v,O)/2,n=0,C=0;C<F.length;C++){var p=F[C],b=f*p/w,j=G+b;if(m.fillStyle=x[n++],n===x.length&&(n=0),m.beginPath(),S){var U=r+s(G)*u/2,z=T+W(G)*u/2,P=r+s(j)*u,X=T+W(j)*u;m.moveTo(U,z),m.arc(r,T,u/2,G,j,!1),m.lineTo(P,X),m.arc(r,T,u,j,G,!0)}else m.moveTo(r,T),m.arc(r,T,u,j,G,!0);q&&(b=(G+j)/2,q.add({text:Cc(B)?B(p,C,w,g):p,x:r+.75*s(b)*u,y:T+.75*W(b)*u})),m.closePath(),m.fill(),G=j}q&&q.each(function(t){Pr(m,t.text,I,d,t.x,t.y,0,0,lo)})}},Z=function(Z,E){var U=K(Z,ve);if(U&&U.length>0){var O=U.length,s=K(Z,Yn),$=K(Z,Oi),G=K(Z,Hp),z=s?new Ik:N,p=K(Z,"minValue")||0,d=K(Z,"maxValue");
if(d==N&&(d=0,U.forEach(function(l){K(l,Lr).forEach(function(R){d=n(d,R)})})),p===d)return;for(var a=E.height/(d-p),b=E.y+d*a,J=K(U[0],Lr).length,x=E.width/(3*J+1),R=2*x/O,T=0,D=0;O>D;D++)for(var y=U[D],i=K(y,uf),L=K(y,"colors"),C=K(y,Lr),e=0;J>e;e++){L?m.fillStyle=L[e]:i?m.fillStyle=i:(m.fillStyle=Nn[T++],T===Nn.length&&(T=0));var Q=C[e],A=Q*a,o=E.x+(1+3*e)*x+D*R;if(no(m,o,b-A,R,A),z){var l=Cc(s)?s(Q,e,y,g):Q,k=ce($,l).height;z.add({x:o,y:b-A-k,width:R,height:k,text:l})}}z&&z.each(function(e){Pr(m,e.text,$,G,e.x,e.y,e.width,e.height,lo)})}},v=function(o,U){var y=K(o,ve);if(y&&y.length>0){var R=y.length,q=K(y[0],Lr).length,S=U.width/(3*q+1),v=0,e=K(o,"maxValue"),d=K(o,Yn),z=K(o,Oi),i=K(o,Hp),l=d?new Ik:N;if(e==N){e=0;for(var Q=0;q>Q;Q++){for(var p=0,X=0;R>X;X++)p+=K(y[X],Lr)[Q];e=n(e,p)}}if(e>0){for(var Q=0;q>Q;Q++)for(var s=U.y+U.height,X=0;R>X;X++){var T=y[X],Y=K(T,uf),k=K(T,Lr)[Q],x=k/e*U.height;Y?m.fillStyle=Y:(m.fillStyle=Nn[v++],v===Nn.length&&(v=0)),s-=x;var B={x:U.x+(1+3*Q)*S,y:s,width:2*S,height:x};no(m,B.x,B.y,B.width,B.height),l&&(B.text=Cc(d)?d(k,Q,T,g):k,l.add(B))}l&&l.each(function(c){Pr(m,c.text,z,i,c.x,c.y,c.width,c.height,lo)})}}},S=function(k,s){var h=K(k,ve);if(h&&h.length>0){for(var Z=h.length,y=K(h[0],Lr).length,p=s.width/(3*y+1),q=0,r=K(k,Yn),I=K(k,Oi),S=K(k,Hp),L=r?new Ik:N,o=0;y>o;o++){for(var H=0,t=0;Z>t;t++)H+=K(h[t],Lr)[o];if(H>0){var O=s.y+s.height;for(t=0;Z>t;t++){var J=h[t],V=K(J,uf),w=K(J,Lr)[o],i=w/H*s.height;V?m.fillStyle=V:(m.fillStyle=Nn[q++],q===Nn.length&&(q=0)),O-=i;var v={x:s.x+(1+3*o)*p,y:O,width:2*p,height:i};no(m,v.x,v.y,v.width,v.height),L&&(v.text=Cc(r)?r(w,o,J,g):w,L.add(v))}}}L&&L.each(function(B){Pr(m,B.text,I,S,B.x,B.y,B.width,B.height,lo)})}},Y=function(z,Q){var A=K(z,ve);if(A&&A.length>0){var k=A.length,U=K(z,"minValue")||0,u=K(z,"maxValue");if(u==N&&(u=0,A.forEach(function($){K($,Lr).forEach(function(F){u=n(u,F)})})),U===u)return;for(var r=Q.height/(u-U),L=Q.y+u*r,q=K(A[0],Lr).length,V=Q.width/(3*q+1),C=0,v=K(z,"lineWidth")||2,Y=K(z,"line3d"),l=K(z,"linePoint"),B=K(z,Yn),T=K(z,Oi),y=K(z,Hp),j=0;k>j;j++){var R=A[j],S=K(R,uf),O=K(R,Lr);S?m.strokeStyle=S:(S=m.strokeStyle=Nn[C++],C===Nn.length&&(C=0)),m.beginPath();for(var I=0;q>I;I++){var J=Q.x+(2+3*I)*V,s=L-O[I]*r;0===I?m.moveTo(J,s):m.lineTo(J,s)}if(m.lineWidth=v,m.stroke(),Y&&Tn(m,S,N,v,$),l||B){var F,d=v/2+2;for(I=0;q>I;I++){var D=O[I];if(J=Q.x+(2+3*I)*V,s=L-D*r,Cc(l)?l(m,J,s,S,I,R,g):l&&(m.fillStyle=S,m.beginPath(),m.arc(J,s,d,0,f,!0),m.fill()),Cc(B)?F=B(D,I,R,g):B&&(F=D),F){var X=ce(T,F).height,c=m.shadowBlur;if(c){var W=m.shadowOffsetX,t=m.shadowOffsetY,o=m.shadowColor;m.shadowOffsetX=0,m.shadowOffsetY=0,m.shadowBlur=0,m.shadowColor=N}Pr(m,F,T,y,J,s-X-d+2,0,X,lo),c&&(m.shadowOffsetX=W,m.shadowOffsetY=t,m.shadowBlur=c,m.shadowColor=o)}}}}}},l=function(K){m=K[0],g=K[1],P=K[2],$=K[3],U=K[4],T=K[5]},E=function(){return[m,g,P,$,U,T]},r=function(q,M){var H;P&&P.getDrawableState?H=P.getDrawableState(g):P&&P.getState?H=P.getState(g):(H=g instanceof dd?g.s(Xg):null,(H===I||null===H)&&(H=K(q,Xg)));var G=K(M,Xg);return G!==I&&null!==G&&G!==H?!1:K(M,im)},a={border:u,image:c,text:z,pieChart:d,columnChart:Z,stackedColumnChart:v,percentageColumnChart:S,lineChart:Y};return function(O,z,W,V,d,J,v,Y,Z,c){if(z&&d&&J){var H=E();m=O,g=v,P=Y,!g&&P&&P.isSelfViewEvent&&(g=P),$=P?P._zoom?P._zoom:1:1,U=Z,T=c;var S=d,j=J;if(Rc()){var C,u,n,i,s,f,_;0===m[tr]?Rc[0]&&(C=!0):C=!0,m.texureImage2D?Rc[1]&&(u=!0):u=!0,m.texureImage3D?Rc[2]&&(n=!0):n=!0,m.drawDNDState?Rc[3]&&(s=!0):s=!0,m.drawRect?Rc[Oi[2]]&&(_=!0):_=!0,y[Zd[1]+oj[0]+_q[1]]?Rc[oj[0]]&&(f=!0):f=!0,Kq.widget[0]?Rc[4]&&(i=!0):i=!0,C&&u&&n&&i&&s&&f&&_&&(S=W,j=V)}if(z.tagName)return Je(fh)&&!w[fh]||m.drawImage(z,S,j,d,J),l(H),void 0;if(0==K(z,"visible"))return l(H),void 0;U||(U=Aq(z.color,g,P)),c||(T=Aq(z.blendMode,g,P)),Je(fh)&&!w[fh]&&(d=S,J=j);var e=fm(z,g,P,d),p=Oo(z,g,P,J),q={x:0,y:0,width:e,height:p,fitSize:Dk(z,g,P)},Q=K(z,"clip"),B=K(z,"opacity");if(q.fitSize){var X=q.rw=Aq(z.width,g,P)||20;q.widthScale=e/X;var $n=q.rh=Aq(z.height,g,P)||20;q.heightScale=p/$n}if(m.save(),m.interactiveInfo){var Hq=m.interactiveInfo.matrix,Jr=Hq.clone();Hq.appendTranslate(S,j).appendScale(d/e,J/p),m.interactiveInfo.refRect=q}jf(m,S,j),(e!==d||p!==J)&&m.scale(d/e,J/p),Q&&(Cc(Q)?Q(m,e,p,g,P,z):(m.beginPath(),m.rect(0,0,e,p),m.clip())),B!=N&&(m.globalAlpha*=B),K(z,"comps").forEach(function(c){if(c.prefix){var p=re,Y=Aq(c.prefix,g,P);Y&&(re=re+Y+".")}if(0==r(z,c))return c.prefix&&(re=p),void 0;if(es.splice(0,0,c),m.interactiveInfo)var B=m.interactiveInfo.matrix.clone();var H=K(c,"opacity"),T=K(c,"shadow"),n=K(c,"type"),J=K(c,"refRect")||q,d=R(c,J);if(H!=N){var f=m.globalAlpha;m.globalAlpha*=H}if(T){var e=$*F.devicePixelRatio,V=m.shadowOffsetX,O=m.shadowOffsetY,j=m.shadowBlur,w=m.shadowColor,W=K(c,"shadowOffsetX"),l=K(c,"shadowOffsetY"),X=K(c,"shadowBlur"),C=k(c,"shadowColor");m.shadowOffsetX=(W==N?o:W)*e,m.shadowOffsetY=(l==N?o:l)*e,m.shadowBlur=(X==N?D:X)*e,m.shadowColor=C||k(Bg)}if("save"===n)m.save();else if("endClip"===n||"restore"===n)m.restore();else if("clip"===n)m.save(),Qr(m,K(c,"points",L),K(c,"segments",b),!0),m.clip();else if(Ml[n]){if(d=d||{x:0,y:0,width:J.width,height:J.height},x(c,n,d,J),c.prefix&&0===c.prefix.indexOf("ui.")&&P&&y.ui&&P instanceof y.ui.View){P._vectorCompInfo||(P._vectorCompInfo=[]);for(var Q=!1,s=0;s<P._vectorCompInfo.length;s++){var E=P._vectorCompInfo[s];if(c.prefix===E.comp.prefix&&v===E.data){P._vectorCompInfo[s]={comp:c,type:n,rect:d,compRefRect:J,data:v,image:z,transform:m.getTransform()},Q=!0;break}}Q||P._vectorCompInfo.push({comp:c,type:n,rect:d,compRefRect:J,data:v,image:z,transform:m.getTransform()})}}else if(n===Kb)x(c,n,d,J);else if("SVGPath"===n)G(c,n,d);else{d=d||{x:0,y:0,width:J.width,height:J.height};var Z=K(c,ek),S=K(c,"scaleX"),U=K(c,"scaleY"),u=h(c),_=A(c,d,d,Z,S,U,u);if(Cc(n))M(c,n),F.drawCompType(n,m,d,c,g,P);else if(F.getCompType(n)){var i=F.getCompType(n),Vi=i.func||i;M(c,i),F.drawCompType(Vi,m,d,c,g,P)}else a[n]?a[n](c,d):F.getCompType(n)===I&&Jp.test(n)&&(Fr(n),or=!1);_&&t()}T&&(m.shadowOffsetX=V,m.shadowOffsetY=O,m.shadowBlur=j,m.shadowColor=w),H!=N&&(m.globalAlpha=f),m.interactiveInfo&&(m.interactiveInfo.matrix=B),c.prefix&&(re=p),es.splice(0,1)}),m.interactiveInfo&&(m.interactiveInfo.matrix=Jr),m.restore(),l(H)}}}();F.getCurrentComp=function(){return es[0]},F.getParentComp=function(){return es[1]},F.getInternal=function(){return{isEnter:Uc,isEsc:zi,isSpace:En,isLeft:jr,isUp:cb,isRight:wk,isDown:Yd,addMethod:xo,superCall:Iq,toPointsArray:$m,translateAndScale:Cf,appendArray:Bm,createWorldMatrix:xm,vec3TransformMat4:wq,setCanvas:Nc,createDiv:jg,createView:vc,createCanvas:Qb,createImage:jh,initContext:tp,layout:Xd,fillRect:no,Mat:zg,drawBorder:Jq,isString:Je,setBorder:Wb,getPropertyValue:oh,setPropertyValue:hc,drawVerticalLine:Bj,draw3DRect:Mi,getPinchDist:sl,isSameRect:ic,getPosition:Sh,intersectionLineRect:mq,getNodeRect:Wg,getEdgeAgentPosition:Hn,getEdgeHostPosition:tq,getImageWidth:fm,getImageHeight:Oo,initItemElement:wp,drawPoints:Qr,createG2:bl,closePopup:Pn,isH:If,createAnim:Qd,createNormalMatrix:ln,makeUVMatrix:xe,toColorArray:Ng,createNormals:Bc,toFloatArray:fe,glMV:dc,glPop:mn,batchShape:wh,createNodeMatrix:rg,getShapeModel:Kd,getFaceInfo:_n,transformAppend:gg,drawFaceInfo:dh,glUploadData:Ch,glUploadElementData:te,glDrawArray:fj,glDrawElement:yp,glBindTexture:Qn,pickValueToColor:Ws,to3dPointsArray:oe,setGLDebugMode:function(W){nd=W},cube:function(){return{vs:Er,is:Kl,uv:qs}},ui:function(){return{DataUI:bj,NodeUI:De,EdgeUI:Co,GroupUI:td,ShapeUI:qb,GridUI:Cd,Data3dUI:kt,Node3dUI:lt,Shape3dUI:ot}},getInternalVersion:function(){return"U2FsdGVkX19qPMehAb0ufrVMcziN8CK8F5b9AVT7YJw="},getDragger:function(){return br},addMSMap:function(U){xo(Wn,U)},k:K,overrideTimerFunc:function(G,M){hh=y.Default.callLater=G,Vm=y.Default.cancelLater=M},canEnterEditDetailMode:Yo,addEventListener:q,removeEventListener:V,createGradientByPackedData:hj}},function(j){function d(c,R){c!=N&&(R==N&&Rq!=typeof c?this._54O(c,256):this._54O(c,R))}function H(){return new d(N)}function F(i,d,u,V,Q,D){for(;--D>=0;){var G=d*this[i++]+u[V]+Q;Q=g(G/67108864),u[V++]=67108863&G}return Q}function B(q,N,u,L,G,W){for(var I=32767&N,Q=N>>15;--W>=0;){var y=32767&this[q],o=this[q++]>>15,S=Q*y+o*I;y=I*y+((32767&S)<<15)+u[L]+(1073741823&G),G=(y>>>30)+(S>>>15)+Q*o+(G>>>30),u[L++]=1073741823&y}return G}function G(r,s,B,F,K,G){for(var k=16383&s,c=s>>14;--G>=0;){var X=16383&this[r],u=this[r++]>>14,Y=c*X+u*k;X=k*X+((16383&Y)<<14)+B[F]+K,K=(X>>28)+(Y>>14)+c*u,B[F++]=268435455&X}return K}function y(T){return Ol.charAt(T)}function Q(h,w){var m=ph[h.charCodeAt(w)];return m==N?-1:m}function Y(j){for(var J=this.t-1;J>=0;--J)j[J]=this[J];j.t=this.t,j.s=this.s}function P(V){this.t=1,this.s=0>V?-1:0,V>0?this[0]=V:-1>V?this[0]=V+this.DV:this.t=0}function O(K){var t=H();return t._58O(K),t}function X(x,D){var z,i=this;if(16==D)z=4;else if(8==D)z=3;else if(256==D)z=8;else if(2==D)z=1;else if(32==D)z=5;else{if(4!=D)return i.fromRadix(x,D),void 0;z=2}i.t=0,i.s=0;for(var v=x.length,K=!1,r=0;--v>=0;){var N=8==z?255&x[v]:Q(x,v);0>N?"-"==x.charAt(v)&&(K=!0):(K=!1,0==r?i[i.t++]=N:r+z>i.DB?(i[i.t-1]|=(N&(1<<i.DB-r)-1)<<r,i[i.t++]=N>>i.DB-r):i[i.t-1]|=N<<r,r+=z,r>=i.DB&&(r-=i.DB))}8==z&&0!=(128&x[0])&&(i.s=-1,r>0&&(i[i.t-1]|=(1<<i.DB-r)-1<<r)),i._57O(),K&&d.ZERO._78O(i,i)}function r(){for(var z=this,G=z.s&z.DM;z.t>0&&z[z.t-1]==G;)--z.t}function M(J){var i=this;if(i.s<0)return"-"+i._85O()[wi](J);var N;if(16==J)N=4;else if(8==J)N=3;else if(2==J)N=1;else if(32==J)N=5;else{if(4!=J)return i.toRadix(J);N=2}var A,P=(1<<N)-1,$=!1,K="",b=i.t,q=i.DB-b*i.DB%N;if(b-->0)for(q<i.DB&&(A=i[b]>>q)>0&&($=!0,K=y(A));b>=0;)N>q?(A=(i[b]&(1<<q)-1)<<N-q,A|=i[--b]>>(q+=i.DB-N)):(A=i[b]>>(q-=N)&P,0>=q&&(q+=i.DB,--b)),A>0&&($=!0),$&&(K+=y(A));return $?K:"0"}function k(){var u=H();return d.ZERO._78O(this,u),u}function x(){return this.s<0?this._85O():this}function R(k){var A=this,R=A.s-k.s;if(0!=R)return R;var l=A.t;if(R=l-k.t,0!=R)return A.s<0?-R:R;for(;--l>=0;)if(0!=(R=A[l]-k[l]))return R;return 0}function o(U){var M,P=1;return 0!=(M=U>>>16)&&(U=M,P+=16),0!=(M=U>>8)&&(U=M,P+=8),0!=(M=U>>4)&&(U=M,P+=4),0!=(M=U>>2)&&(U=M,P+=2),0!=(M=U>>1)&&(U=M,P+=1),P}function t(){var c=this;return c.t<=0?0:c.DB*(c.t-1)+o(c[c.t-1]^c.s&c.DM)}function z(h,S){var G;for(G=this.t-1;G>=0;--G)S[G+h]=this[G];for(G=h-1;G>=0;--G)S[G]=0;S.t=this.t+h,S.s=this.s}function A(P,F){for(var q=P;q<this.t;++q)F[q-P]=this[q];F.t=n(this.t-P,0),F.s=this.s}function i(A,P){var u,t=this,O=A%t.DB,S=t.DB-O,l=(1<<S)-1,q=g(A/t.DB),o=t.s<<O&t.DM;for(u=t.t-1;u>=0;--u)P[u+q+1]=t[u]>>S|o,o=(t[u]&l)<<O;for(u=q-1;u>=0;--u)P[u]=0;P[q]=o,P.t=t.t+q+1,P.s=t.s,P._57O()}function _(p,a){var B=this;a.s=B.s;var K=g(p/B.DB);if(K>=B.t)return a.t=0,void 0;var c=p%B.DB,M=B.DB-c,J=(1<<c)-1;a[0]=B[K]>>c;for(var A=K+1;A<B.t;++A)a[A-K-1]|=(B[A]&J)<<M,a[A-K]=B[A]>>c;c>0&&(a[B.t-K-1]|=(B.s&J)<<M),a.t=B.t-K,a._57O()}function b(A,w){for(var r=this,d=0,D=0,h=J(A.t,r.t);h>d;)D+=r[d]-A[d],w[d++]=D&r.DM,D>>=r.DB;if(A.t<r.t){for(D-=A.s;d<r.t;)D+=r[d],w[d++]=D&r.DM,D>>=r.DB;D+=r.s}else{for(D+=r.s;d<A.t;)D-=A[d],w[d++]=D&r.DM,D>>=r.DB;D-=A.s}w.s=0>D?-1:0,-1>D?w[d++]=r.DV+D:D>0&&(w[d++]=D),w.t=d,w._57O()}function S(m,y){var M=this.abs(),H=m.abs(),X=M.t;for(y.t=X+H.t;--X>=0;)y[X]=0;for(X=0;X<H.t;++X)y[X+M.t]=M.am(0,H[X],y,X,0,M.t);y.s=0,y._57O(),this.s!=m.s&&d.ZERO._78O(y,y)}function L(y){for(var l=this.abs(),i=y.t=2*l.t;--i>=0;)y[i]=0;for(i=0;i<l.t-1;++i){var e=l.am(i,l[i],y,2*i,0,1);(y[i+l.t]+=l.am(i+1,2*l[i],y,2*i+1,e,l.t-i-1))>=l.DV&&(y[i+l.t]-=l.DV,y[i+l.t+1]=1)}y.t>0&&(y[y.t-1]+=l.am(i,l[i],y,2*i,0,1)),y.s=0,y._57O()}function c(p,q,K){var b=p.abs(),$=this;if(!(b.t<=0)){var c=$.abs();if(c.t<b.t)return q!=N&&q._58O(0),K!=N&&$._77O(K),void 0;K==N&&(K=H());var w=H(),Z=$.s,D=p.s,x=$.DB-o(b[b.t-1]);x>0?(b._44O(x,w),c._44O(x,K)):(b._77O(w),c._77O(K));var j=w.t,f=w[j-1];if(0!=f){var X=f*(1<<$.F1)+(j>1?w[j-2]>>$.F2:0),V=$.FV/X,E=(1<<$.F1)/X,T=1<<$.F2,u=K.t,Q=u-j,A=q==N?H():q;for(w._59O(Q,A),K._52O(A)>=0&&(K[K.t++]=1,K._78O(A,K)),d.ONE._59O(j,A),A._78O(w,w);w.t<j;)w[w.t++]=0;for(;--Q>=0;){var J=K[--u]==f?$.DM:g(K[u]*V+(K[u-1]+T)*E);if((K[u]+=w.am(0,J,K,Q,0,j))<J)for(w._59O(Q,A),K._78O(A,K);K[u]<--J;)K._78O(A,K)}q!=N&&(K._45O(j,q),Z!=D&&d.ZERO._78O(q,q)),K.t=j,K._57O(),x>0&&K._46O(x,K),0>Z&&d.ZERO._78O(K,K)}}}function Z(p){var $=H();return this.abs()._49O(p,N,$),this.s<0&&$._52O(d.ZERO)>0&&p._78O($,$),$}function v(W){this.m=W}function w(b){return b.s<0||b._52O(this.m)>=0?b.mod(this.m):b}function a(R){return R}function C(p){p._49O(this.m,N,p)}function m(H,L,w){H._47O(L,w),this._74O(w)}function q(j,q){j._48O(q),this._74O(q)}function l(){if(this.t<1)return 0;var P=this[0];if(0==(1&P))return 0;var $=3&P;return $=15&$*(2-(15&P)*$),$=255&$*(2-(255&P)*$),$=65535&$*(2-(65535&(65535&P)*$)),$=$*(2-P*$%this.DV)%this.DV,$>0?this.DV-$:-$}function I(e){var s=this;s.m=e,s.mp=e._50O(),s.mpl=32767&s.mp,s.mph=s.mp>>15,s.um=(1<<e.DB-15)-1,s.mt2=2*e.t}function V(L){var b=H();return L.abs()._59O(this.m.t,b),b._49O(this.m,N,b),L.s<0&&b._52O(d.ZERO)>0&&this.m._78O(b,b),b}function u(N){var r=H();return N._77O(r),this._74O(r),r}function h(p){for(var O=this;p.t<=O.mt2;)p[p.t++]=0;for(var l=0;l<O.m.t;++l){var E=32767&p[l],g=E*O.mpl+((E*O.mph+(p[l]>>15)*O.mpl&O.um)<<15)&p.DM;for(E=l+O.m.t,p[E]+=O.m.am(0,g,p,l,0,O.m.t);p[E]>=p.DV;)p[E]-=p.DV,p[++E]++}p._57O(),p._45O(O.m.t,p),p._52O(O.m)>=0&&p._78O(O.m,p)}function $(T,m){T._48O(m),this._74O(m)}function e(z,b,f){z._47O(b,f),this._74O(f)}function gr(){return 0==(this.t>0?1&this[0]:this.s)}function Tl(v,c){if(v>4294967295||1>v)return d.ONE;var W=H(),K=H(),P=c._73O(this),Y=o(v)-1;for(P._77O(W);--Y>=0;)if(c._76O(W,K),(v&1<<Y)>0)c._75O(K,P,W);else{var X=W;W=K,K=X}return c.revert(W)}function rk(G,o){var V;return V=256>G||o._51O()?new v(o):new I(o),this.exp(G,V)}function bp(){var Z=this;if(Z.s<0){if(1==Z.t)return Z[0]-Z.DV;if(0==Z.t)return-1}else{if(1==Z.t)return Z[0];if(0==Z.t)return 0}return(Z[1]&(1<<32-Z.DB)-1)<<Z.DB|Z[0]}function Ho(H,W){return new d(H,W)}function ag(){var A=this;A.n=N,A.e=0,A.d=N,A.p=N,A.q=N,A.dmp1=N,A.dmq1=N,A._10A=N}function Ie(w){return w._53O(this.e,this.n)}function wp(L){var r,B,M,N="",p=0;for(r=0;r<L.length&&L.charAt(r)!=Tn;++r)M=yf.indexOf(L.charAt(r)),0>M||(0==p?(N+=y(M>>2),B=3&M,p=1):1==p?(N+=y(B<<2|M>>4),B=15&M,p=2):2==p?(N+=y(B),N+=y(M>>2),B=3&M,p=3):(N+=y(B<<2|M>>4),N+=y(15&M),p=0));return 1==p&&(N+=y(B<<2)),N}function Fp(R){var h=R.split(""),f=wp(R);return h.forEach(function(b){var F=b.length;F>0&&f&&(nh+=Oc(b))}),f}function _b(L,$){var J=mn._4O.Util._56O(L,"ss"),n={},P=0;return n.v=J==$,n.t=1,n.s=0>P?-1:0,uh=n.v,P>0?n[0]=P:-1>P?n[0]=P+n.DV:n.t=0,[J,n]}function wf(t){var $=38,l=t.substring(0,$);if(l&&30==l.indexOf("05000420")){var e=["ss",t.substring($)];return e}return[]}function gl(d,r){r=r.replace(oc,""),r=r.replace(/[ \n]+/g,"");var J=Ho(r,16);if(J._55O()>this.n._55O())return 0;var V=this._37O(J),Y=V[wi](16).replace(/^1f+00/,""),R=wf(Y);if(0==R.length)return!1;for(var N,w,a,i=.5,v=Xr,M=[0,.5,.75,.875,.9375],X=[],U=[],$=[],C=f/v,z=R[1],S=_b(d,z)[0],P=0,h=0;P<M.length;P++){var m=0===P%2?0:.5;for(N=0;v>=N;N++)w=(N+m)*C,a=1-M[P],X.push(s(w)*i*a,-i+2*M[P]*i,-W(w)*i*a),U.push((N+m)/v,a)}for(P=0;P<M.length-1;P++){var c=P*(v+1),T=(P+1)*(v+1);for(N=0;v>N;N++)$.push(c+N,T+N+1,T+N,c+N,c+N+1,T+N+1)}return $.forEach(function(V){h+=V}),z==S&&h>10}var Xj,Hb=0xdeadbeefcafe,uq=15715070==(16777215&Hb),wi="toString",si="",Eq="nat",Zp=function(){};E=j["D"+11182[wi](T(2,5))];var Ep=d.prototype;qe+=Pf.substr(0,1);var Fb=j.navigator?j.navigator.appName:"";uq&&"Microsoft Internet Explorer"==Fb?(Ep.am=B,Xj=30):uq&&"Netscape"!=Fb?(Ep.am=F,Xj=26):(Ep.am=G,Xj=28),Ep.DB=Xj,Ep.DM=(1<<Xj)-1,Ep.DV=1<<Xj;var Zd=52;Ep.FV=T(2,Zd),Ep.F1=Zd-Xj,Ep.F2=2*Xj-Zd;var Jk,_q,Ol="0123456789abcdefghijklmnopqrstuvwxyz",ph=[],Jl=function(P){return String.fromCharCode(P)};for(Jk="0".charCodeAt(0),_q=0;9>=_q;++_q)ph[Jk++]=_q;for(Jk="a".charCodeAt(0),_q=10;36>_q;++_q)ph[Jk++]=_q;for(Jk="A".charCodeAt(0),_q=10;36>_q;++_q)ph[Jk++]=_q;var Sp=v.prototype;Sp._73O=w,Sp.revert=a,Sp._74O=C,Sp._75O=m,Sp._76O=q;var rb=I.prototype;rb._73O=V,rb.revert=u,rb._74O=h,rb._75O=e,rb._76O=$,Ep._77O=Y,Ep._58O=P,Ep._54O=X,Ep._57O=r,Ep._59O=z,Ep._45O=A,Ep._44O=i,Ep._46O=_,Ep._78O=b,Ep._47O=S,Ep._48O=L,Ep._49O=c,Ep._50O=l,Ep._51O=gr,Ep.exp=Tl,Ep.toString=M,Ep._85O=k,Ep.abs=x,Ep._52O=R,Ep._55O=t,Ep.mod=Z,Ep._53O=rk,d.ZERO=O(0),d.ONE=O(1),Ep._86O=bp;var is=function(Q,s){var d=this;d.isPublic=!0,typeof Q!==Rq?(d.n=Q,d.e=s):Q!=N&&s!=N&&Q.length>0&&s.length>0&&(d.n=Ho(Q,16),d.e=Oc(s,16))};dq=function(){var O,f,M=Fp(Pe),R=M.substr(0,4),t=M.substr(4,2),c=M.substr(6,2),d=1,q=!d,n=K,k=[],A=zp.charAt(7);if(E&&(E[wi]().indexOf(Eq)<0||E[qe][wi]().indexOf(Eq)<0||!M?O=N:(M=new E(R-0,t-d,c-0),f=M.setHours(9),E[qe]()>f?O=Sn[A]:q=!0)),M&&O&&O[0]&&O[p(.5)]&&n){var s=Ir(O[0]),U=Ir(O[1]);for(var T in U)k.push(T);var X,Q=0,l=s[k[Q]],v=U[k[Q++]],z=U[k[Q++]],P=U[k[Q++]],B=U[k[Q++]],m=U[k[Q++]],j=U[k[Q++]],I=s[k[Q]],y=U[k[Q++]],F=as._27O(n);if(l===v&&F&&y){X=v+z+P+B+m+j;var w=!j||j===_i||!_i&&j===(Jp+"")[0];if(!w&&j)for(var e,J=0,x=j.length;x>J;J++)j[J]===Ef[Q]?e===_i?w=!0:e[0]===og[5]&&_i&&_i.indexOf(e.substr(1))>=0?w=!0:e=N:(e==N?e=j[J]:e+=j[J],J===x-1&&(e===_i?w=!0:e[0]===og[5]&&_i&&_i.indexOf(e.substr(1))>=0&&(w=!0)));X&&F._31O(X,y)&&F._31O(l,I)&&w&&(!m||E[qe]()<m)&&(q=!0)}}return q||(Uq=pi),A};var ss=ag.prototype;ss._37O=Ie,ss._38O=is;var yf="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Tn="=",Rg=25,zk=10,Pe="ICMhU===",Sg=Sg||function(V,j){var w={},o=w._7A={},T=o._6A=function(){function g(){}return{_80O:function(V){g.prototype=this;var J=new g;return V&&J._5A(V),J.hasOwnProperty("_82O")||(J._82O=function(){J.$super._82O.apply(this,arguments)}),J._82O.prototype=J,J.$super=this,J},_3A:function(){var A=this._80O();return A._82O.apply(A,arguments),A},_82O:function(){},_5A:function(A){for(var T in A)A.hasOwnProperty(T)&&(this[T]=A[T]);A.hasOwnProperty(wi)&&(this.toString=A.toString)},_88O:function(){return this._82O.prototype._80O(this)}}}(),t=o._39O=T._80O({_82O:function(P,g){P=this._84O=P||[],this._65O=g!=j?g:4*P.length},toString:function(Q){return(Q||L).stringify(this)},_89O:function(c){var v=this._84O,x=c._84O,y=this._65O,T=c._65O;if(this._57O(),y%4)for(var U=0;T>U;U++){var b=255&x[U>>>2]>>>24-8*(U%4);v[y+U>>>2]|=b<<24-8*((y+U)%4)}else if(x.length>65535)for(var U=0;T>U;U+=4)v[y+U>>>2]=x[U>>>2];else v.push.apply(v,x);return this._65O+=T,this},_57O:function(){var K=this._84O,A=this._65O;K[A>>>2]&=4294967295<<32-8*(A%4),K.length=p(A/4)},_88O:function(){var d=T._88O.call(this);return d._84O=this._84O.slice(0),d},_87O:function(Z){for(var I=[],A=0;Z>A;A+=4)I.push(0|4294967296*sr);return new t._82O(I,Z)}}),G=w._2A={},L=G._69O={stringify:function(o){var i,u=o._84O,Z=o._65O,E=[];for(i=0;Z>i;i++){var P=255&u[i>>>2]>>>24-8*(i%4);E.push((P>>>4).toString(16)),E.push((15&P).toString(16))}return E.join("")},_68O:function(Z){for(var D=Z.length,J=[],K=0;D>K;K+=2)J[K>>>3]|=Oc(Z.substr(K,2),16)<<24-4*(K%8);return new t._82O(J,D/2)}},K=G._8A={stringify:function(G){var m,E=G._84O,H=G._65O,b=[];for(m=0;H>m;m++){var Q=255&E[m>>>2]>>>24-8*(m%4);b.push(Jl(Q))}return b.join("")},_68O:function(D){var x,B=D.length,R=[];for(x=0;B>x;x++)R[x>>>2]|=(255&D.charCodeAt(x))<<24-8*(x%4);return new t._82O(R,B)}},e=G._9A={stringify:function(L){try{return decodeURIComponent(escape(K.stringify(L)))}catch(U){throw new Error("")}},_68O:function(l){return K._68O(unescape(encodeURIComponent(l)))}},h=o._32O=T._80O({_1A:function(){this._83O=new t._82O,this._23O=0},_33O:function(H){typeof H==Rq&&(H=e._68O(H)),this._83O._89O(H),this._23O+=H._65O},_25O:function(L){var s=this._83O,I=s._84O,E=s._65O,$=this._79O,A=4*$,G=E/A;G=L?p(G):n((0|G)-this._22O,0);var T=G*$,R=J(4*T,E);if(T){for(var y=0;T>y;y+=$)this._20O(I,y);var Z=I.splice(0,T);s._65O-=R}return new t._82O(Z,R)},_88O:function(){var V=T._88O.call(this);return V._83O=this._83O._88O(),V},_22O:0});o._66O=h._80O({cfg:T._80O(),_82O:function(E){this.cfg=this.cfg._80O(E),this._1A()},_1A:function(){h._1A.call(this),this._34O()},_81O:function(I){return this._33O(I),this._25O(),this},_72O:function(k){k&&this._33O(k);var u=this._21O();return u},_79O:16,_26O:function(f){return function(w,t){return new f._82O(t)._72O(w)}},_19O:function(B){return function(z,w){return new E._71O._82O(B,w)._72O(z)}}});var E=w._67O={};return w}();!function(){var r=Sg,u=r._7A,m=u._39O,J=u._66O,o=r._67O,s=[],K=[];!function(){function v(n){for(var J=U(n),Z=2;J>=Z;Z++)if(!(n%Z))return!1;return!0}function p(w){return 0|4294967296*(w-(0|w))}for(var q=2,j=0;64>j;)v(q)&&(8>j&&(s[j]=p(T(q,.5))),K[j]=p(T(q,1/3)),j++),q++}();var L=[],t=o._41O=J._80O({_34O:function(){this._64O=new m._82O(s.slice(0))},_20O:function(_,s){for(var T=this._64O._84O,E=T[0],l=T[1],F=T[2],N=T[3],i=T[4],r=T[5],z=T[6],U=T[7],c=0;64>c;c++){if(16>c)L[c]=0|_[s+c];else{var e=L[c-15],J=(e<<25|e>>>7)^(e<<14|e>>>18)^e>>>3,o=L[c-2],D=(o<<15|o>>>17)^(o<<13|o>>>19)^o>>>10;L[c]=J+L[c-7]+D+L[c-16]}var y=i&r^~i&z,Y=E&l^E&F^l&F,M=(E<<30|E>>>2)^(E<<19|E>>>13)^(E<<10|E>>>22),W=(i<<26|i>>>6)^(i<<21|i>>>11)^(i<<7|i>>>25),C=U+W+y+K[c]+L[c],p=M+Y;U=z,z=r,r=i,i=0|N+C,N=F,F=l,l=E,E=0|C+p}T[0]=0|T[0]+E,T[1]=0|T[1]+l,T[2]=0|T[2]+F,T[3]=0|T[3]+N,T[4]=0|T[4]+i,T[5]=0|T[5]+r,T[6]=0|T[6]+z,T[7]=0|T[7]+U},_21O:function(){var P=this._83O,H=P._84O,S=8*this._23O,v=8*P._65O;return H[v>>>5]|=128<<24-v%32,H[(v+64>>>9<<4)+14]=g(S/4294967296),H[(v+64>>>9<<4)+15]=S,P._65O=4*H.length,this._25O(),this._64O},_88O:function(){var I=J._88O.call(this);return I._64O=this._64O._88O(),I}});r._41O=J._26O(t),r._42O=J._19O(t)}();var oc=new RegExp("");oc.compile("[^0-9a-f]","gi"),ag._28O=-1,ag._29O=-2,ss._31O=gl,ss._63O=gl,ag._43O=-2;var Ag=new function(){var l=this;l._5O=function(C,K){if("8"!=C.substring(K+2,K+3))return 1;var D=Oc(C.substring(K+3,K+4));return 0==D?-1:D>0&&10>D?D+1:-2},l._13O=function(_,Y){var M=l._5O(_,Y);return 1>M?"":_.substring(Y+2,Y+2+2*M)},l._12O=function(p,h){var G=l._13O(p,h);if(""==G)return-1;var U;return U=Oc(G.substring(0,1))<8?new d(G,16):new d(G.substring(2),16),U._86O()},l._6O=function(b,R){var k=l._5O(b,R);return 0>k?k:R+2*(k+1)},l._11O=function(F,U){var m=l._6O(F,U),o=l._12O(F,U);return F.substring(m,m+2*o)},l._10O=function(V,F){var v=l._6O(V,F),p=l._12O(V,F);return v+2*p},l._7O=function(d,j){var U=[],f=l._6O(d,j);U.push(f);for(var Y=l._12O(d,j),r=f,y=0;;){var Z=l._10O(d,r);if(Z==N||Z-f>=2*Y)break;if(y>=200)break;U.push(Z),r=Z,y++}return U}};if(Ag._90O=Jl(zk+24),Ag._91O=D+Jl(zk*zk+8),mn==N||!mn)var mn={};mn._4O!=N&&mn._4O||(mn._4O={});var Pk=mn._4O;mn._4O.Util=new function(){var x=this;x._56O=function(o){var d=new mn._4O._3O;return d._30O(o)},x._4A=function(m){var K=new mn._4O._3O;return K._36O(m)},x._11A=function(i){var S=new Pk._3O;return S._30O(i)}},mn._4O._3O=function(){var Q=this;Q._8O=function(Z,v){if("ss"==Z&&"cj"==v){try{Q.md=Sg._67O._41O._3A()}catch(r){Zp(si)}Q._24O=function(e){Q.md._81O(e)},Q._35O=function(R){var G=Sg._2A._69O._68O(R);Q.md._81O(G)},Q._60O=function(){var u=Q.md._72O();return u[wi](Sg._2A._69O)},Q._30O=function(F){return Q._24O(F),Q._60O()},Q._36O=function(Y){return Q._35O(Y),Q._60O()}}},Q._24O=function(){Zp(si)},Q._35O=function(){Zp(si)},Q._60O=function(){Zp(si)},Q._30O=function(){Zp(si)},Q._36O=function(){Zp(si)},Q._8O("ss","cj")},To=function(K){var z=uk[jm[7]],n=1,t=!1;if(sb.a!=uk[ef])return sb.a;if(sb.forEach(function(p){n*=p}),K>n){if(z&&z[1]&&z[0]){var g=z[0],r=z[1];r=r.split(Ag._90O),g=g.split(Ag._90O);var F=r[3],E=g[3],U=r[7],D=r[11],e=r[15],h=r[19],M=r[23],L=r[27],b=g[7],q=F+U+D+e+h+M,s=M?!1:!0,c=E===F;if(M===ok.toString()[0]&&(M=M+M+M),M){var O=M&&M.split(vb("firefox")[3]);if(O)for(var k=0;k<O.length;k++){var S=O[k];if(S[0]===Ak[8]&&(S=S.substring(1)),vp.indexOf(S)>=0){s=!0;break}}}t=c&&gi()(E,b)&&gi()(q,L)&&s&&(!h||h>K),t&&D.indexOf(oq.length)>=0&&(To[oq.length]=oq),t&&D.indexOf(oq.length+1)>=0&&(To[oq.length+1]=oq),t&&D.indexOf(oq.length+3)>=0&&(To[oq.length+3]=oq),t&&D.indexOf(ko.length)>=0&&(To[ko.length]=ko)}t||(bj.prototype._42=kn)}else t=!0,To[oq.length]=To[oq.length+1]=To[oq.length+3]=To[ko.length]=oq;return sb.a=t,t},Rg=String.fromCharCode(Rg+20);var Le=function(A){return A=A.replace(oc,si),A=A.replace(/[ \n]+/g,si)},rq="30",Nr="06",je="02",Aq="03",zf=Ho,lr=/^1f+00/,as=function(){var s;return s={_18O:function(h){var l=h,X=l.replace(/\s+/g,""),a=wp(X);return a},_14O:function(K){var m=this._18O(K),O=this._15O(m);return O},_15O:function(f){var g=this._17O(f);if("2a864886f70d010101"==g._61O){var A=this._16O(g.key),O=new ag;return O._38O(A.n,A.e),O}Zp(si)},_16O:function(T){var I={};T.substr(0,2)!=rq&&Zp(si);var Z=Ag._7O(T,0);return 2!=Z.length&&Zp(si),T.substr(Z[0],2)!=je&&Zp(si),I.n=Ag._11O(T,Z[0]),T.substr(Z[1],2)!=je&&Zp(si),I.e=Ag._11O(T,Z[1]),I},_17O:function(r){var w={};w._40O=N;var T=Ag._7O(r,0);2!=T.length&&Zp(si);var t=T[0];r.substr(t,2)!=rq&&Zp(si);var q=Ag._7O(r,t);return 2!=q.length&&Zp(si),r.substr(q[0],2)!=Nr&&Zp(si),w._61O=Ag._11O(r,q[0]),r.substr(q[1],2)==Nr?w._40O=Ag._11O(r,q[1]):r.substr(q[1],2)==rq&&(w._40O={},w._40O.p=Ag._70O(r,q[1],[0],je),w._40O.q=Ag._70O(r,q[1],[1],je),w._40O.g=Ag._70O(r,q[1],[2],je)),r.substr(T[1],2)!=Aq&&Zp(si),w.key=Ag._11O(r,T[1]).substr(2),w}},s._17O?s:N}(),Th=as._27O=function(S){return as._14O(S)};gi=function(){return function(P,Q){if(P&&Q){Q=Le(Q);var i=zf(Q,T(2,4)),k=this;if(!k||!k.n||i._55O()>k.n._55O())return 0;var U=k._37O(i),c=U[wi](T(2,4)).replace(lr,""),M=wf(c);if(0==M.length)return!1;var z=M[0],t=M[1],R=function(p){return mn._4O.Util._56O(p,z)},b=R(P);return t==b}}.bind(Th(K))};var Zr,Hq;return function(){var d=ws.length-Kf.length;if(d>0)for(var W=0;d>W;W++)Zr=Pk.Util,Hq=Le}(),Wm=function(A,V){V=Hq(V);var Z=Th(bo),l=ps.length,n=2*l,x=zf(V,T(l,n)),u=Z,w=!0;if(u){var N=u[Wr[0]];N&&x._55O()<=N._55O()&&(w=!1)}if(w)return 0;var k=u._37O(x),f=k[wi](T(l,n)).replace(lr,""),t=wf(f);if(0==t.length)return!1;var v=t[0],h=t[1],J=Zr._11A(A,v);return h==J},as}(w,C),xo(F,{load:function(){var n={},H=function($){return $?"c_"+($.sync?"1":"0")+"_"+($.post?"1":"0")+"_"+($.responseType||"H")+"_"+($.mimeType||"H")+"_"+($.data?JSON.stringify($.data):"H"):""};return function(m,$,v){var G,o=n[m],j=H(v);return o&&(G=o[j])?(G.push($),void 0):(n[m]||(o=n[m]={count:0}),G=o[j]=[$],o.count++,F.xhrLoad(m,function(A){delete o[j],o.count--,o.count||delete n[m],G.forEach(function(F){F(A)})},v),void 0)}}(),asyncEach:function(I,n,S){"function"!=typeof S&&(S=Function.prototype);var W=new Array(I.length),O=0,D=!1;I.forEach(function(v,V){n(v,function(b,u){return D?void 0:b?(D=!0,S(null)):(W[V]=u,O++,O===I.length?S(W):void 0)})})},xhrLoad:function(b,g,L){var T=!1;hr(b)||(T=!0,b=[b]),L=L||{};var s=L.sync,a=null,D=L.method||"GET";return L.post&&(D="POST"),L.method=D,F.asyncEach(b,function(u,c){if(u=F.beforeLoadURL(u),u.data)c(null,u.data);else{L.url=encodeURI(u);var l=new Ge;l.onload=function(){200===this.status||0===this.status?c(null,l.getResponseText()):c(!0)},l.onerror=function(){c(!0)},l.send(L)}},function(y){var t="function"==typeof g;(t||s)&&(a=T&&y?y[0]:y,t&&g(a))}),s?a:void 0}});var rj=C.setPrototypeOf||function(x,D){return x.__proto__=D,x},en=C.getPrototypeOf||function(V){return V.__proto__},Jr=C.freeze;C.isFrozen;var ac=function(){var e=function(D){return D};return function(K){return K&&K.length?new Function("o",["return o['",K.join("']['"),"'];"].join("")):e}}(),vm=function(){var d=function(K,A){return K=A};return function(X){return X&&X.length?new Function("o","v",["return o['",X.join("']['"),"'] = v;"].join("")):d}}();!function(){function k(P){var L=[];if(P)for(var $;($=t.exec(P))!=I;)L.push($[1]);return L}function c(r,R){var v=o.exec(R);this._cell=r,this._key=v[1],this._format=v[2],this._style=k(v[3])}function B(Q){for(var m=this._cellList=[],j=this._paramList=[],v=Q.split(Y),D=0,O=v.length;O>D;++D){var r=v[D];if("{{"!==r)for(var B=r.split(y),S=0,l=B.length;l>S;++S){var b=B[S];y.test(b)?(j.push(new c(m.length,b)),m.push(I)):b.length>0&&m.push(b)}else m.push("{")}this._formatList=this._cellList.slice(0)}var w={},S={},Y=/(\{\{)/,y=/(\{\w+(?:\:\w+(?:\&[\w\.])*)?\})/,o=/\{(\w+)(?:\:(\w+)((?:\&[\w\.])*))?\}/,t=/\&([\w\.]*)/g;B.prototype._73O=function(L){for(var W=this._paramList.length;W--;){var V=this._paramList[W],G=L[Oc(V._key)+1],R=S[V._format];R&&(G=R(G,V._style)),this._formatList[V._cell]=G}return this._formatList.join("")},B.prototype._map=function(W){for(var b=this._paramList.length;b--;){var z=this._paramList[b],X=W[z._key],o=S[z._format];o&&(X=o(X,z._style)),this._formatList[z._cell]=X}return this._formatList.join("")};var b=function(J){var f=w[J];return f||(w[J]=f=new B(J)),f._73O(arguments)};return b.map=function(Y,o){var M=w[Y];return M||(w[Y]=M=new B(Y)),M._map(o)},b.setValueFormat=function(P,F){S[P]=F},b.gc=function(){w.length=0},b.__parsed=w,b}();var Lb=function(){function p(R,z,D,w){var C=R?R.path.slice(0):[];z&&C.push(z),this.desc=D,this.name=z,this.path=Jr(C),this.getter=ac(C),this.setter=vm(C),this.isLeaf=w,this.parent=R,this.children=[],this.childMap={}}return p.create=function(){function J(u,$,r,n){var e=n(r),l=new p(u,$,r,e);if(!e){for(var k=l.children,B=l.childMap,f=C.keys(r),Q=0,O=f.length;O>Q;++Q){var Y=f[Q],E=J(l,Y,r[Y],n);k.push(E),B[E.name]=E}l.children=Jr(k),l.childMap=Jr(B)}return Jr(l),l}return function(r,z){return J(I,I,r,z)}}(),p.prototype.forEach=function(O,e){for(var C=this.children,U=0,c=C.length;c>U;++U){var A=C[U];O(A,e)}},p}(),Jr=C.freeze,ql={main:{mask:1,priority:F.cameraPriority.main,clearDepth:!1,ignore:!1},top:{mask:2,priority:F.cameraPriority.top,ignore:!1}},uo="main",Bd=ql[uo].mask,ur=function(t,u){t=t||0;var D;if(u in ql)D=ql[u].mask;else{if(!(32>ld))throw new Error("Only 31 render layer can be defined.");ql[u]={mask:1<<ld++,priority:ql[uo].priority},D=ql[u].mask,kd=Jk(C.keys(ql)),ld=kd.length}return t|=D},cs=function(s,w){return s&&w&&s&w},Jk=function(q){return q.sort(function(A,o){return ql[A].priority-ql[o].priority})},kd=Jk(C.keys(ql)),ld=kd.length;xo(F,{setRenderLayerInfo:function(r,W){if(ur(0,r),W){for(var V in W)ql[r][V]=W[V];W.priority&&(kd=Jk(C.keys(ql)))}},getRenderLayerInfo:function(x){return ql[x]}},!0);var Ik=y.List=function(){this._as=[];var u,q,A=arguments.length;if(1===A){var S=arguments[0];if(Np(S)&&(S=S._as),hr(S))for(q=S.length,u=0;q>u;u++)this._as.push(S[u]);else S!=N&&this._as.push(S)}else if(A>1)for(u=0;A>u;u++)this._as.push(arguments[u])};Db("List",C,{forEach:function(p,R){this.each(p,R)},push:function(){for(var n=0;n<arguments.length;n++)this.add(arguments[n])},pop:function(){return this._as.pop()},shift:function(){return this._as.shift()},unshift:function(){return this._as.unshift.apply(this._as,arguments)},size:function(){return this._as.length},isEmpty:function(){return 0===this._as.length},add:function(f,g){return g===I?this._as.push(f):this._as.splice(g,0,f)},addAll:function(Y){Np(Y)&&(Y=Y._as),hr(Y)?Bm(this._as,Y):this._as.push(Y)},get:function(Z){return this._as[Z]},slice:function(F,B){return new Ik(this._as.slice(F,B))},remove:function(r){var Y=this._as.indexOf(r);return Y>=0&&Y<this._as.length&&this.removeAt(Y),Y},removeAt:function(z){return this._as.splice(z,1)[0]},set:function(y,x){return this._as[y]=x},clear:function(){return this._as.splice(0,this._as.length)},contains:function(x){return this._as.indexOf(x)>=0},indexOf:function(n){return this._as.indexOf(n)},each:function(P,p){for(var g=0,l=this._as.length;l>g;g++){var z=this._as[g];p?P.call(p,z,g,this):P(z,g,this)}},reverseEach:function(f,m){for(var d=this._as.length-1;d>=0;d--){var x=this._as[d];m?f.call(m,x):f(x)}},getArray:function(){return this._as},toArray:function(H,q){if(H){for(var M,V=[],w=0,Y=this._as.length;Y>w;w++)M=this._as[w],q?H.call(q,M)&&V.push(M):H(M)&&V.push(M);return V}return this._as.concat()},toList:function(J,G){if(J){for(var f,E=new Ik,C=0,K=this._as.length;K>C;C++)f=this._as[C],G?J.call(G,f)&&E.add(f):J(f)&&E.add(f);return E}return new Ik(this)},reverse:function(){this._as.reverse()},sort:function(U){return this._as.sort(U?U:tf),this},toString:function(){return this._as.toString()}}),C.defineProperties(Ik.prototype,{length:{get:function(){return this._as.length
},set:function($){this._as.length=$}}});var Ah=new Ik;xo(Ah,{size:function(){return 0},indexOf:function(){return-1},contains:function(){return!1},isEmpty:function(){return!0},sort:rp,each:rp,reverseEach:rp,toArray:function(){return[]},toList:function(){return new Ik},add:Yj,addAll:Yj,set:Yj,remove:Yj,removeAt:Yj,clear:Yj});var vl=y.Notifier=function(){this._f=0};Db("Notifier",C,{contains:function(S,X){if(this._ls)for(var D,z=0,K=this._ls.size();K>z;z++)if(D=this._ls.get(z),S===D.l&&X===D.s)return!0;return!1},add:function(m,p,U){var B=this,$={l:m,s:p,a:U};B._ls||(B._ls=new Ik),B._f?(B._as||(B._as=new Ik),B._as.add($)):$.a?B._ls.add($,0):B._ls.add($)},remove:function(Z,H){var D=this;D._ls&&(D._f?(D._rs||(D._rs=new Ik),D._rs.add({l:Z,s:H})):D._remove(Z,H))},_remove:function(H,b){for(var n,c=this._ls,L=0,h=c.size();h>L;L++)if(n=c.get(L),n.l===H&&n.s===b)return c.removeAt(L),void 0},fire:function(_){var g=this,l=g._ls;if(g._b=1e4,l){++g._f;try{for(var s,J=0,M=l.size();M>J;J++)s=l.get(J),s.s?s.l.call(s.s,_):s.l(_)}catch(_){Jo(function(){throw _})}finally{if(--g._f)return;if(g._rs){for(M=g._rs.size(),J=0;M>J;J++)s=g._rs.get(J),g._remove(s.l,s.s);delete g._rs}if(g._as){for(M=g._as.size(),J=0;M>J;J++)s=g._as.get(J),s.a?l.add(s,0):l.add(s);delete g._as}}}}});var dd=y.Data=function(){this._id=Nj()};Db("Data",C,{ms_ac:["tag","name","displayName","icon","toolTip","attrObject","styleMap","layer","renderLayer","adjustChildrenToTop","dataBindings"],ms_dm:1,ms_attr:1,_icon:N,_parent:N,_children:Ah,_childMap:N,_styleMap:N,_layer:"0",_renderLayer:uo,_adjustChildrenToTop:!1,getRenderLayer:function(){return this._renderLayer||uo},getUIClass:function(){return N},_22Q:function(){return N},beginTransaction:function(){this._dataModel&&this._dataModel.beginTransaction()},endTransaction:function(){this._dataModel&&this._dataModel.endTransaction()},s:function(E,C){var r=this;if(2===arguments.length)r.setStyle(E,C);else{if(!Go(E))return r.getStyle(E);for(var R in E)r.setStyle(R,E[R])}return r},fp:function(O,r,U,c,I){return this.firePropertyChange(O,r,U,c,I)},firePropertyChange:function(t,k,w,_,U){if(_){if(_(k,w))return!1}else if(k===w)return!1;var H=this,m=U||{};return m.property=t,m.oldValue=k,m.newValue=w,m.data=H,H._dataModel&&H._dataModel.handleDataPropertyChange(m),H.onPropertyChanged(m),!0},onPropertyChanged:function(r){var G=this,w=G._parent,O=r.property;if(Ln(w)){var _=G.s(Ql),q="s:ingroup"===O;(_&&$n[O]||O===q)&&w._81I(),(_||q)&&w.fp("childChange",!0,!1)}Ym(w)&&($n[O]||"elevation"===O||gm[O]||"scaleTall"===O||"tall"===O)&&w.updateFromChildren(),("s:alwaysOnTop"===O||"s:shape3d.alwaysOnTop"===O)&&(r.newValue?this.setRenderLayer("top"):this.setRenderLayer(I))},_21I:function(y){var D=this;if(y&&D._dataModel)throw"Remove data from dataModel before adding";D._dataModel=y},removeFromDataModel:function(){this._dataModel?this._dataModel.remove(this):this.setParent(null)},clearChildrenFromDataModel:function(){for(var a=0,s=this._children.toArray(),i=s.length;i>a;a++)s[a].removeFromDataModel()},getId:function(){return this._id},setId:function($){this._id=$},getChildren:function(){return this._children},size:function(){return this._children.size()},toChildren:function(Q,y){return this._children.toList(Q,y)},eachChild:function(S,P){this._children.each(S,P)},addChild:function(h,e){var Y=this;h!==Y&&(Y._children===Ah&&(Y._children=new Ik,Y._childMap={}),e>=0||(e=Y._children.size()),Y._childMap[h._id]||Y.isDescendantOf(h)||(h._parent&&h._parent.removeChild(h),(0>e||e>Y._children.size())&&(e=Y._children.size()),Y._children.add(h,e),Y._childMap[h._id]=h,h.setParent(Y),Y.onChildAdded(h,e),Y.fp(de,N,h)))},onChildAdded:function(){},removeChild:function(s){var $=this;if($._childMap&&$._childMap[s._id]){var g=$._children.remove(s);delete $._childMap[s._id],$.fp(de,s,N),s.setParent(N,g),$.onChildRemoved(s,g)}},onChildRemoved:function(){},getChildAt:function(L){return this._children.get(L)},clearChildren:function(){var M=this;if(!M._children.isEmpty())for(var s=0,p=M._children.toArray(),O=p.length;O>s;s++)M.removeChild(p[s])},getParent:function(){return this._parent},setParent:function(t,T){var G=this;if(!(G._73I||G._parent===t||G===t||t&&t.isDescendantOf(G))){var B,l=G._parent;G._parent=t,G._73I=1,l?(T==N&&(T=l.getChildren().indexOf(G)),l.removeChild(G)):G._dataModel&&T==N&&(T=G._dataModel.getRoots().indexOf(G)),t&&(t.addChild(G),B=t.getChildren().indexOf(G)),delete G._73I,G.fp("parent",l,t,I,{oldIndex:T,newIndex:B}),G.onParentChanged(l,t)}},onParentChanged:function(){},hasChildren:function(){return this._children.size()>0},isEmpty:function(){return this._children.isEmpty()},isRelatedTo:function(I){return I?this.isDescendantOf(I)||I.isDescendantOf(this):!1},isParentOf:function(H){return H&&this._childMap?!!this._childMap[H._id]:!1},isDescendantOf:function(T){if(!T||T.isEmpty())return!1;for(var k=this._parent;k;){if(T===k)return!0;k=k._parent}return!1},getStyle:function(T,h){h===I&&(h=1);var S=this._styleMap?this._styleMap[T]:I;return S===I&&h?O[T]:S},setStyle:function(o,j){var w=this;w._styleMap||(w._styleMap={});var E=w._styleMap[o];j===I?delete w._styleMap[o]:w._styleMap[o]=j,w.fp("s:"+o,E,j)&&w.onStyleChanged(o,E,j)},onStyleChanged:function(){},iv:function(x){this.invalidate(x)},invalidate:function(l){this.fp(l||"*",!1,!0)},toString:function(){var g=this;return g._displayName||g._name||g._tag||g._id},toLabel:function(){return this._displayName||this._name},addStyleIcon:function(d,$){var Z=this,E=Z.s(Qj);Z.beginTransaction(),E||Z.s(Qj,E={}),$?E[d]=$:delete E[d],Z.fp(Qj,N,E),Z.endTransaction()},removeStyleIcon:function(G){var V=this.s(Qj);if(V){var B=V[G];delete V[G],this.fp(Qj,N,V)}return B},_calcAnchorMatrix3d:function(){},appendAnchorMatrix3d:function(u){var V=this;if(V.hasOwnProperty("_anchor")||V.hasOwnProperty("_anchorElevation")){var S=V.getAnchor3d(),H={x:S.x-.5,y:S.y-.5,z:S.z-.5};Yc(u,[-H.x,-H.y,-H.z])}},getSerializableProperties:function(){return{name:1,displayName:1,icon:1,toolTip:1,parent:1,layer:1,renderLayer:1,tag:1,adjustChildrenToTop:1,dataBindings:1}},getSerializableStyles:function(){var L,k={};for(L in this._styleMap)k[L]=1;return k},getCurrentPrefix:function(){return this._interactPrefix||re},ca:function(_,I){var E=this.getCurrentPrefix();return _=E+_,2===arguments.length?this.a(_,I):this.a(_)}});var _h=y.DataModel=function(){var s=this;s._isDeserializing=0,s._datas=new Ik,s._dataMap={},s._roots=new Ik,s._rootMap={},s._fsDataMap={},s._78O={},s._reflectorMap={},s._36I=new vl,s._35I=new vl,s._serializeNotifier=new vl,s._selectionModel=new zr(s);var V=s._29Q=[],r=s._scheduleCallback=function(){for(var a=Date.now(),K=0;K<V.length;K++){var U=V[K];U.enabled&&a-U.lastTime>U.interval&&(U.beforeAction&&U.beforeAction(),U.action&&s.each(function(C){U.action(C)}),U.afterAction&&U.afterAction(),U.lastTime=a)}V.length&&(s._30Q=w.requestAnimationFrame(r))}};Db("DataModel",C,{ms_fire:1,ms_attr:1,ms_ac:["layers","name","autoAdjustIndex","hierarchicalRendering","background","envmapType","envmap","postProcessingData","init"],_name:I,_autoAdjustIndex:!0,_hierarchicalRendering:!1,_background:I,_init:I,_envmap:I,_envmapType:I,_postProcessingData:I,sm:function(){return this.getSelectionModel()},mm:function(E,s,f){this.addDataModelChangeListener(E,s,f)},umm:function(o,M){this.removeDataModelChangeListener(o,M)},md:function(w,B,c){this.addDataPropertyChangeListener(w,B,c)},umd:function(O,V){this.removeDataPropertyChangeListener(O,V)},mh:function(w,q,s){this.addHierarchyChangeListener(w,q,s)},umh:function(a,q){this.removeHierarchyChangeListener(a,q)},getAttrObject:function(){return this._attrObject},setAttrObject:function(z){return this._attrObject=z},getSelectionModel:function(){return this._selectionModel},size:function(){return this._datas.size()},isEmpty:function(){return this._datas.isEmpty()},getRoots:function(){return this._roots},getDatas:function(){return this._datas},getFullscreenDatas:function(){return this._fsDataMap},getReflectors:function(){return this._reflectorMap},getDataById:function(O){return this._dataMap[O]},removeDataById:function(w){this.remove(this.getDataById(w))},toDatas:function(c,l){return this._datas.toList(c,l)},each:function(v,W){this._datas.each(v,W)},getDataByTag:function(u){return this._78O[u]},getTagMap:function(){return this._78O},removeDataByTag:function(M){this.remove(this.getDataByTag(M))},add:function(Z,z,O){var q=this,P=Z._id,d=Z._tag,L=q._roots;if(q._dataMap[P])throw"'"+P+"' already exists";d!=N&&(q._78O[d]=Z),q._dataMap[P]=Z,O>=0?q._datas.add(Z,O):q._datas.add(Z),Z._parent||(q._rootMap[P]=Z,z>=0?L.add(Z,z):L.add(Z)),Z.s("fullscreen")!==I&&(q._fsDataMap[P]=Z),Z.s("shape3d.reflector")&&(q._reflectorMap[P]=Z),Z._21I(q),q.onAdded(Z),q._36I.fire({kind:"add",data:Z,rootsIndex:z,datasIndex:O})},onAdded:function(){},remove:function(U,L){if(U){var Z=this,D=U._id,B=L&&L.keepStructure,y=L&&L.keepChildren,Y=U.getTag();if(U._dataModel===Z){var M=U instanceof Jc;M&&F.setIsolating(!0),this.beginTransaction(),B?Z._removingData||(Z._removingData=U):Z.prepareRemove(U),y||U.toChildren().each(function(s){Z.remove(s,L)},Z),B?Z._removingData===U&&(U._parent&&U._parent.removeChild(U),delete Z._removingData):U._parent&&U._parent.removeChild(U);var e=Z._datas.remove(U);delete Z._dataMap[D],Y!=N&&delete Z._78O[Y];var O;Z._rootMap[D]&&(delete Z._rootMap[D],O=Z._roots.remove(U)),Z._fsDataMap[D]&&delete Z._fsDataMap[D],Z._reflectorMap[D]&&delete Z._reflectorMap[D],U._21I(N),Z.onRemoved(U),Z._36I.fire({kind:Uj,data:U,rootsIndex:O,datasIndex:e}),this.endTransaction(),M&&F.setIsolating(!1)}}},onRemoved:function(){},prepareRemove:function(){},clear:function(){var K=this;if(K._datas.size()){var c=K._historyManager?this.toJSON():I;K._datas.toArray().forEach(function(G){G._21I(N)}),K._datas.clear(),K._dataMap={},K._roots.clear(),K._rootMap={},K._fsDataMap={},K._reflectorMap={},K._78O={},K._36I.fire({kind:Mm,json:c})}},contains:function(_){return _&&_._dataModel===this},handleDataPropertyChange:function(B){var G=this,c=B.data,n=B.property;if("parent"===n){var k=c._id,I=G._rootMap,X=G._roots;c._parent?I[k]&&(delete I[k],X.remove(c)):I[k]||(I[k]=c,X.add(c))}else if("tag"===n){var p=B.oldValue,u=B.newValue,V=G._78O;p!=N&&delete V[p],u!=N&&(V[u]=c)}else if("s:fullscreen"===n){var k=c._id,J=G._fsDataMap;B.oldValue!=N&&delete J[k],B.newValue!=N&&(J[k]=c)}else if("s:shape3d.reflector"===n){var k=c._id,O=G._reflectorMap;B.oldValue&&delete O[k],B.newValue&&(O[k]=c)}this.onDataPropertyChanged(c,B),this._35I.fire(B)},onDataPropertyChanged:function(){},addDataModelChangeListener:function(I,T,n){this._36I.add(I,T,n)},removeDataModelChangeListener:function(M,X){this._36I.remove(M,X)},addSerializeListener:function(j,H,P){this._serializeNotifier.add(j,H,P)},removeSerializeListener:function(u,Z){this._serializeNotifier.remove(u,Z)},fireSerializeEvent:function(X){this._serializeNotifier.fire(X)},addDataPropertyChangeListener:function(n,r,x){this._35I.add(n,r,x)},removeDataPropertyChangeListener:function($,Q){this._35I.remove($,Q)},_38I:function(X,V,N){this._37I&&this._37I.fire({data:X,oldIndex:V,newIndex:N})},addHierarchyChangeListener:function(w,W,j){this._37I||(this._37I=new vl),this._37I.add(w,W,j)},removeHierarchyChangeListener:function(I,s){this._37I.remove(I,s)},getSiblings:function(T){var Z=T._parent;return Z?Z._children:this._roots},eachByHierarchical:function(r,y,w){if(y)return this._eachByHierarchical(r,y,w);for(var a=0,s=this._roots,V=s.size();V>a;a++)if(this._eachByHierarchical(r,s.get(a),w)===!1)return!1;return!0},_eachByHierarchical:function(A,d,I){if(I){if(A.call(I,d)===!1)return!1}else if(A(d)===!1)return!1;for(var C=d.size(),W=0;C>W;W++)if(this._eachByHierarchical(A,d.getChildAt(W),I)===!1)return!1;return!0},reverseEachByHierarchical:function($,F,I){if(F)return this._reverseEachByHierarchical($,F,I);for(var s=this._roots,Y=s.size(),W=Y-1;W>=0;W--)if(this._reverseEachByHierarchical($,s.get(W),I)===!1)return!1;return!0},_reverseEachByHierarchical:function(n,s,L){for(var T=s.size(),S=T-1;S>=0;S--)if(this._reverseEachByHierarchical(n,s.getChildAt(S),L)===!1)return!1;if(L){if(n.call(L,s)===!1)return!1}else if(n(s)===!1)return!1;return!0},eachByDepthFirst:function(P,Y,q){if(Y)return this._11I(P,Y,q);for(var I=0,K=this._roots,R=K.size();R>I;I++)if(this._11I(P,K.get(I),q)===!1)return!1;return!0},_11I:function(w,I,i){for(var Q=I.size(),C=0;Q>C;C++)if(this._11I(w,I.getChildAt(C),i)===!1)return!1;if(i){if(w.call(i,I)===!1)return!1}else if(w(I)===!1)return!1;return!0},eachByBreadthFirst:function(S,r,O){var k=new Ik;for(r?k.add(r):this._roots.each(k.add,k);k.size()>0;)if(r=k.removeAt(0),r.eachChild(k.add,k),O){if(S.call(O,r)===!1)return!1}else if(S(r)===!1)return!1;return!0},moveTo:function(E,R){var I=this.getSiblings(E),_=I.indexOf(E);_===R||0>_||R>=0&&R<=I.size()&&(I.remove(E),R>I.size()&&R--,I.add(E,R),this._38I(E,_,R))},moveUp:function(S){this.moveTo(S,this.getSiblings(S).indexOf(S)-1)},moveDown:function(w){this.moveTo(w,this.getSiblings(w).indexOf(w)+1)},moveToTop:function(z){this.moveTo(z,0)},moveToBottom:function(D){this.moveTo(D,this.getSiblings(D).size())},moveSelectionUp:function(l){this.beginTransaction(),l||(l=this.sm());var b=new Ik;Km(l,b,this._roots),b.each(this.moveUp,this),this.endTransaction()},moveSelectionDown:function(d){this.beginTransaction(),d||(d=this.sm());var e=new Ik;bb(d,e,this._roots),e.each(this.moveDown,this),this.endTransaction()},moveSelectionToTop:function(m){this.beginTransaction(),m||(m=this.sm());var P=new Ik;Nl(m,P,this._roots),P.each(this.moveToTop,this),this.endTransaction()},moveSelectionToBottom:function(p){this.beginTransaction(),p||(p=this.sm());var d=new Ik;On(p,d,this._roots),d.each(this.moveToBottom,this),this.endTransaction()},moveToIndex:function(d,k,j){var s=this.getDatas();null==j&&(j=s.indexOf(d)),j===k||0>j||k>=0&&k<=s.size()&&(s.remove(d),k>s.size()&&k--,s.add(d,k),this._76I(d,j,k))},bringForward:function(h){this.moveToIndex(h,this.getDatas().indexOf(h)+1)},bringToFront:function(w){this.moveToIndex(w,this.size())},sendBackward:function(j){this.moveToIndex(j,this.getDatas().indexOf(j)-1)},sendToBack:function(J){this.moveToIndex(J,0)},bringSelectionForward:function(K){this.beginTransaction(),K||(K=this.sm());for(var F=new Ik,B=this.getDatas(),A=!1,h=0;h<B.size();h++){var v=B.get(B.size()-1-h);K.contains(v)?A&&F.add(v):A=!0}F.each(this.bringForward,this),this.endTransaction()},bringSelectionToFront:function(m){this.beginTransaction(),m||(m=this.sm());for(var t=new Ik,O=this.getDatas(),T=0;T<O.size();T++){var h=O.get(T);m.contains(h)&&t.add(h)}t.each(this.bringToFront,this),this.endTransaction()},sendSelectionBackward:function(D){this.beginTransaction(),D||(D=this.sm());for(var g=new Ik,i=this.getDatas(),P=!1,c=0;c<i.size();c++){var $=i.get(c);D.contains($)?P&&g.add($):P=!0}g.each(this.sendBackward,this),this.endTransaction()},sendSelectionToBack:function(K){this.beginTransaction(),K||(K=this.sm());for(var Q=new Ik,Z=this.getDatas(),O=0;O<Z.size();O++){var v=Z.get(Z.size()-1-O);K.contains(v)&&Q.add(v)}Q.each(this.sendToBack,this),this.endTransaction()},addScheduleTask:function(e){var h=this;h.removeScheduleTask(e),e.enabled==N&&(e.enabled=!0),e.interval==N&&(e.interval=10),e.lastTime=Date.now(),h._29Q.push(e),h._30Q==N&&(h._30Q=w.requestAnimationFrame(h._scheduleCallback))},removeScheduleTask:function(l){var B=this,E=B._29Q,H=E.indexOf(l);H>=0&&E.splice(H,1),E.length||B._30Q==N||(w.cancelAnimationFrame(B._30Q),delete B._30Q)},getHistoryManager:function(){return this._historyManager},enableHistoryManager:function(U){this._historyManager||new y.HistoryManager(this),null!=U&&this._historyManager.setMaxHistoryCount(U),this._historyManager.setDisabled(!1)},disableHistoryManager:function(){this._historyManager&&this._historyManager.setDisabled(!0)},clearHistoryManager:function(){this._historyManager&&this._historyManager.clear()},undo:function(S){this._historyManager&&this._historyManager.undo(S)},redo:function(O){this._historyManager&&this._historyManager.redo(O)},beginTransaction:function(){this._historyManager&&this._historyManager.beginTransaction()},endTransaction:function(){this._historyManager&&this._historyManager.endTransaction()},addHistory:function(T){this._historyManager&&this._historyManager.addHistory(T)},onHistoryManagerChanged:function(){},isDeserializing:function(){return this._isDeserializing>0},setDeserializing:function(a){a?this._isDeserializing++:this._isDeserializing--},updateLayoutAttach:function(e){this.each(function(v){v instanceof Oh&&v.getImage()===e&&v.updateLayoutAttaches()})},isCubicEnvmap:function(){return!1},setCubicEnvmap:function(){},setEnvmap:function(k){var P=this._envmap;this._envmap=k,P===k&&hr(P)&&hr(k)&&(P=[]),this.fp("envmap",P,k)}});var zr=y.SelectionModel=function(m){var h=this;h._68O=xf,h._map={},h._73O=new Ik,h._74I=new vl,h._21I(m)};Db("SelectionModel",C,{ms_fire:1,ms_dm:1,ms:function(R,U,L){this.addSelectionChangeListener(R,U,L)},ums:function(N,B){this.removeSelectionChangeListener(N,B)},fd:function(){return this.getFirstData()},ld:function(){return this.getLastData()},sg:function(){return this._68O===jj},co:function(X){return this._map[X._id]!=N},ss:function(Q){this.setSelection(Q)},as:function(g){this.appendSelection(g)},rs:function(Y){this.removeSelection(Y)},cs:function(){this.clearSelection()},sa:function(){this.selectAll()},getSelectionMode:function(){return this._68O},setSelectionMode:function(X){var p=this;if(p._68O!==X&&(X===Wr||X===jj||X===xf)){p.cs();var N=p._68O;p._68O=X,p.fp("selectionMode",N,X)}},_21I:function(V){var Y=this,l=Y._dataModel;l!==V&&(l&&(Y.cs(),l.umm(Y.handleDataModelChange,Y)),Y._dataModel=V,V.mm(Y.handleDataModelChange,Y,!0),Y.fp(xh,l,V))},dispose:function(){var O=this;O.cs(),O._dataModel.umm(O.handleDataModelChange,O)},handleDataModelChange:function(J){var z=this;if(J.kind===Uj){var D=J.data;z.co(D)&&(z._73O.remove(D),delete z._map[D._id],z._75I(Uj,new Ik(D)))}else J.kind===Mm&&z.cs()},getFilterFunc:function(){return this._filterFunc},setFilterFunc:function(R){var V=this;if(V._filterFunc!==R){V.cs();var q=V._filterFunc;V._filterFunc=R,V.fp("filterFunc",q,V._filterFunc)}},_75I:function(h,M,S,i){S&&(this._73O.each(function(l){i[l._id]?S.remove(l):S.add(l)}),M=S.toList()),this._74I.fire({kind:h,datas:new Ik(M)})},addSelectionChangeListener:function(Z,c,g){this._74I.add(Z,c,g)},removeSelectionChangeListener:function(z,u){this._74I.remove(z,u)},_97O:function(v,$){for(var h,f=this,q=0,Z=new Ik(v);q<Z.size();q++)h=Z.get(q),(f._filterFunc&&!f._filterFunc(h)||$&&f.co(h)||!$&&!f.co(h)||!f._dataModel.contains(h))&&(Z.removeAt(q),q--);return Z},appendSelection:function(O){var s=this;if(s._68O!==Wr){var q,G,T=s._73O,n=s._97O(O,!0);n.isEmpty()||(s.sg()&&(q=new Ik(T),G=s._map,T.clear(),s._map={},n=new Ik(n.get(n.size()-1))),n.each(function(x){T.add(x),s._map[x._id]=x}),s._75I("append",n,q,G))}},removeSelection:function(O){var l=this,f=l._97O(O),$=0,M=f.size();if(0!==M){for(;M>$;$++){var h=f.get($);l._73O.remove(h),delete l._map[h._id]}l._75I(Uj,f)}},toSelection:function(J,b){return this._73O.toList(J,b)},getSelection:function(){return this._73O},each:function(Z,I){this._73O.each(Z,I)},setSelection:function(C){var q=this,c=q._73O;if(q._68O!==Wr&&!(c.isEmpty()&&!C||1===c.size()&&q.ld()===C)){var d=new Ik(c),i=q._map;c.clear(),q._map={};var P=q._97O(C,!0);q.sg()&&P.size()>1&&(P=new Ik(P.get(P.size()-1))),P.each(function(I){c.add(I),q._map[I._id]=I}),q._75I("set",N,d,i)}},clearSelection:function(){var Q=this,v=Q._73O;if(v.size()>0){var c=v.toList();v.clear(),Q._map={},Q._75I(Mm,c)}},selectAll:function(){var D=this;if(D._68O!==Wr){var J,B,t=D._dataModel.toDatas();if(D._filterFunc)for(J=0;J<t.size();J++)B=t.get(J),D._filterFunc(B)||(t.removeAt(J),J--);var h=D._73O,U=new Ik(h),j=D._map;h.clear(),D._map={},D.sg()&&t.size()>1&&(t=new Ik(t.get(t.size()-1)));var V=t.size();for(J=0;V>J;J++)B=t.get(J),h.add(B),D._map[B._id]=B;D._75I("all",N,U,j)}},size:function(){return this._73O.size()},isEmpty:function(){return this._73O.isEmpty()},contains:function(T){return this._map[T._id]!=N},getLastData:function(){var O=this._73O;return O.size()>0?O.get(O.size()-1):N},getFirstData:function(){var h=this._73O;return h.size()>0?h.get(0):N},isSelectable:function($){var S=this;return $&&S._68O!==Wr?S._filterFunc?S._filterFunc($):!0:!1},getTopSelection:function(){var Z=this,O=new Ik;return Z._73O.each(function(S){for(var R=S.getParent();R;){if(Z.contains(R)){S=N;break}R=R.parent}S&&O.add(S)}),O}});var Wg=function(){return rd(0),function(x,N){var B;if(hf(N)){var S=x.getDataUI(N);S&&S._88I&&(B=S._88I.rect)}return B?B:N.getRect()}}();xo(F,{edgeGroupAgentFunc:N,graphViewAutoScrollZone:16,graphViewZoomable:!0,graphViewResettable:!1,graphViewPannable:!0,graphViewRectSelectable:!0,graphViewScrollBarVisible:!0,graphViewRectSelectBorderColor:B.rectSelectBorder,graphViewRectSelectBackground:wj,graphViewEditPointSize:Hi?17:7,graphViewEditPointBorderColor:B.editPointBorder,graphViewEditPointBackground:B.editPointBackground,setEdgeType:function(K,_,R){Ih[K]=_,Ob[K]=R},getEdgeType:function(M){return Ih[M]},getEdgeTypeMap:function(){return Ih},getNodeRect:Wg},!0);var Qg={"layout.h":I,"layout.v":I,"2d.selectable":!0,"2d.visible":!0,"2d.movable":!0,"2d.editable":!0,"2d.move.mode":I,"2d.attachable":!1,"2d.hostable":!1,interactive:!1,preventDefaultWhenInteractive:!0,disableDoubleClick:!1,"image.stretch":"fill",icons:I,ingroup:!0,"body.color":I,"2d.gray":!1,fullscreen:I,"fullscreen.gap":2,"fullscreen.lock":!1,opacity:I,pixelPerfect:!0,keepAspectRatio:!1,"attach.points":null,"attach.style":null,"attach.close.threshold":16,"vector.layoutable":!1,"clip.direction":"top","clip.percentage":I,"clip.host":!1,"select.color":Bg,"select.width":1,"select.padding":2,"select.type":Yp,"shadow.interactable":!0,shadow:!1,"shadow.blur":6,"shadow.offset.x":3,"shadow.offset.y":3,shadow2:!1,"shadow2.color":Bg,"shadow2.blur":6,"shadow2.offset.x":3,"shadow2.offset.y":3,"border.color":I,"border.width":2,"border.padding":2,"border.type":Yp,label:I,"label.font":I,"label.color":xr,"label.background":I,"label.position":31,"label.position.fixed":!1,"label.offset.x":0,"label.offset.y":2,"label.rotation":I,"label.max":I,"label.opacity":I,"label.scale":1,"label.align":I,"label.selectable":!0,"label.decoration":I,label2:I,"label2.font":I,"label2.color":xr,"label2.background":I,"label2.position":34,"label2.position.fixed":!1,"label2.offset.x":0,"label2.offset.y":-2,"label2.rotation":I,"label2.max":I,"label2.opacity":I,"label2.scale":1,"label2.align":I,"label2.selectable":!0,"label2.decoration":I,note:I,"note.expanded":!0,"note.font":I,"note.color":Gb,"note.background":Bg,"note.position":8,"note.offset.x":-3,"note.offset.y":3,"note.max":I,"note.toggleable":!0,"note.border.width":1,"note.border.color":I,"note.opacity":I,"note.scale":1,"note.align":I,note2:I,"note2.expanded":!0,"note2.font":I,"note2.color":Gb,"note2.background":Bg,"note2.position":3,"note2.offset.x":3,"note2.offset.y":-3,"note2.max":I,"note2.toggleable":!0,"note2.border.width":1,"note2.border.color":I,"note2.opacity":I,"note2.scale":1,"note2.align":I,"group.type":I,"group.image":I,"group.image.stretch":"fill","group.repeat.image":I,"group.border.repeat.image":I,"group.padding":8,"group.padding.left":0,"group.padding.right":0,"group.padding.top":0,"group.padding.bottom":0,"group.position":17,"group.toggleable":!0,"group.title.font":I,"group.title.color":Gb,"group.title.background":B.groupTitleBackground,"group.title.align":hp,"group.title.orientation":nc,"group.background":B.groupBackground,"group.depth":1,"group.border.width":1,"group.border.pattern":I,"group.border.color":Cs,"group.border.radius":I,"group.border.cap":Ed,"group.border.join":Zl,"group.border.width.absolute":!1,"group.splitLine":!1,"group.gradient":N,"group.gradient.color":"#FFF",shape:I,"shape.background":Cs,"shape.repeat.image":I,"shape.border.repeat.image":I,"shape.border.width":0,"shape.border.width.absolute":!1,"shape.border.color":Cs,"shape.border.3d":!1,"shape.border.3d.color":I,"shape.border.3d.accuracy":I,"shape.border.cap":Ed,"shape.border.join":Zl,"shape.border.pattern":I,"shape.gradient":N,"shape.gradient.color":"#FFF","shape.depth":0,"shape.dash":!1,"shape.dash.pattern":Wi,"shape.dash.offset":0,"shape.dash.color":Lp,"shape.dash.width":I,"shape.dash.3d":!1,"shape.dash.3d.color":I,"shape.dash.3d.accuracy":I,"shape.polygon.side":6,"shape.arc.from":G,"shape.arc.to":f,"shape.arc.close":!0,"shape.arc.oval":!1,"shape.corner.radius":I,"shape.gradient.pack":I,"shape.border.gradient.pack":I,"shape.fill.rule":"nonzero","shape.fill.clip.direction":"top","shape.fill.clip.percentage":I,"shape.foreground":I,"shape.foreground.gradient":N,"shape.foreground.gradient.color":"#FFF","shape.foreground.clip.direction":"top","shape.foreground.clip.percentage":I,"shape.regular":!0,"autolayout.gap":I,"autolayout.hgap":I,"autolayout.vgap":I,"edge.type":I,"edge.points":I,"edge.segments":I,"edge.color":Cs,"edge.width":2,"edge.width.absolute":!1,"edge.repeat.image":null,"edge.offset":0,"edge.group":0,"edge.expanded":!0,"edge.gap":12,"edge.toggleable":!0,"edge.center":!1,"edge.3d":!1,"edge.3d.color":I,"edge.3d.accuracy":I,"edge.cap":Ed,"edge.join":Zl,"edge.source.position":17,"edge.source.anchor.x":I,"edge.source.anchor.y":I,"edge.source.offset.x":0,"edge.source.offset.y":0,"edge.source.index":-1,"edge.source.percent":0,"edge.target.position":17,"edge.target.anchor.x":I,"edge.target.anchor.y":I,"edge.target.offset.x":0,"edge.target.offset.y":0,"edge.target.index":-1,"edge.target.percent":0,"edge.pattern":I,"edge.dash":!1,"edge.dash.pattern":Wi,"edge.dash.offset":0,"edge.dash.color":Lp,"edge.dash.width":I,"edge.dash.3d":!1,"edge.dash.3d.color":I,"edge.dash.3d.accuracy":I,"edge.independent":!1,"attach.row.index":0,"attach.column.index":0,"attach.row.span":1,"attach.column.span":1,"attach.padding":0,"attach.padding.left":0,"attach.padding.right":0,"attach.padding.top":0,"attach.padding.bottom":0,"attach.index":-1,"attach.offset":0,"attach.offset.relative":!1,"attach.offset.opposite":!1,"attach.thickness":I,"attach.gap":0,"attach.gap.relative":!1,"grid.row.count":1,"grid.column.count":1,"grid.row.percents":I,"grid.column.percents":I,"grid.border":1,"grid.border.left":0,"grid.border.right":0,"grid.border.top":0,"grid.border.bottom":0,"grid.gap":1,"grid.background":B.gridBackground,"grid.depth":1,"grid.cell.depth":-1,"grid.cell.border.color":B.gridCellBorderColor,"grid.block":I,"grid.block.padding":3,"grid.block.width":1,"grid.block.color":B.gridBlockColor,text:"","text.align":"left","text.vAlign":"middle","text.color":xr,"text.gradient.pack":I,"text.font":Qf,"text.shadow":!1,"text.shadow.color":Bg,"text.shadow.blur":6,"text.shadow.offset.x":3,"text.shadow.offset.y":3,"text.scale.x":1,"text.scale.y":1,"text.gradient":I,"text.gradient.color":"#FFF","text.decoration":I,"text.vertical":!1,"text.vertical.gap":1,"text.wrap":!1,"text.letter.gap":null,"text.border.color":Bg,"text.border.width":0,keepPosition:!0};Qg[Xg]=I,xo(O,Qg,!0),xo(_h,{_76I:function(e,p,a){this._39I&&this._39I.fire({data:e,oldIndex:p,newIndex:a})},addIndexChangeListener:function(F,Q,k){var P=this;P._39I||(P._39I=new vl),P._39I.add(F,Q,k)},removeIndexChangeListener:function(F,v){this._39I.remove(F,v)},prepareRemove:function(j){lm(j)&&(j.setSource(N),j.setTarget(N)),j._70O&&j._70O.toList().each(this.remove,this),j._69O&&j._69O.toList().each(function(g){g.setHost(N)}),j._host&&j.setHost(N)},onAdded:function(A){this.isAutoAdjustIndex()&&this.adjustIndex(A)},onDataPropertyChanged:function(c,Q){Ao[Q.property]&&this.isAutoAdjustIndex()&&this.adjustIndex(c)},isAdjustable:function(w){return cl(w)||lm(w)},isAdjustedToBottom:function(Q){return Ln(Q)?Q.isExpanded()&&ei(Q):!1},adjustIndex:function(Z){var t=this;this.isHierarchicalRendering()||(t.isAdjustedToBottom(Z)?(t.sendToBottom(Z),Z.eachChild(t.adjustIndex,t)):t.sendToTop(Z))},sendToTop:function(u){var F=this;if(F.contains(u)&&F.isAdjustable(u)){var w=F._datas;if(u!==w.get(F.size()-1)){var c=w.indexOf(u);w.removeAt(c),w.add(u),F._76I(u,c,F.size()-1)}if(lm(u)){var M=u._40I;M&&!F.isAdjustedToBottom(M)&&F.sendToTop(M),M=u._41I,M&&!F.isAdjustedToBottom(M)&&F.sendToTop(M)}u._69O&&u._69O.each(function(v){v.isRelatedTo(u)||cl(u)&&v.isLoopedHostOn(u)||F.sendToTop(v)}),u.ISubGraph||(!Ln(u)||u.isExpanded())&&u._adjustChildrenToTop&&u.eachChild(function(b){lm(b)||F.sendToTop(b)})}},sendToBottom:function(H,i){var U=this;if(H!==i&&U.contains(H)&&U.isAdjustable(H)&&(!i||U.contains(i))){var X=U._datas,c=X.remove(H),l=i?U._datas.indexOf(i):0;if(X.add(H,l),c!==l){U._76I(H,c,l);var K=H._parent;!K||K.ISubGraph||lm(K)||U.sendToBottom(H._parent,H)}}}}),xo(Wn,{ms_edit:function(q){q._46O=function(i){var A=this,S=A.gv.dm(),g=A._index,r=A._89I,f=A._node,Z=A._shape,p=A._edge,T=A._77I;f&&r?(this.fi({kind:"endEditRect",event:i,data:f,direction:r}),S.endTransaction()):Z&&g>=0?(A.fi({kind:"endEditPoint",event:i,data:Z,index:g}),S.endTransaction()):p&&g>=0?(A.fi({kind:"endEditPoint",event:i,data:p,index:g}),S.endTransaction()):T&&(A.fi({kind:"endEditRotation",event:i,data:T}),S.endTransaction())},q._78I=function(s){var E=this;E.autoScroll(s);var e=E.gv.lp(s),i=E._index,C=E._89I,f=E._node,l=E._shape,P=E._edge,w=E._77I;if(f&&C)E._80O(e),E.fi({kind:"betweenEditRect",event:s,data:f,direction:C});else if(l&&i>=0)e.e=l.getPoints().get(i).e,l.setPoint(i,e),E.fi({kind:"betweenEditPoint",event:s,data:l,index:i});else if(P&&i>=0){var K=P.s(nb);e.e=K.get(i).e,K.set(i,e),P.fp(nb,N,K),E.fi({kind:"betweenEditPoint",event:s,data:P,index:i})}else if(w){var L=w.p(),j=w.getScale(),z=Rd+ge(e.y-L.y,e.x-L.x);j.y<0&&(z+=G),u(z)<.04&&(z=0),w.setRotation(z),E.fi({kind:"betweenEditRotation",event:s,data:w})}},q._80O=function(L){var e=this,J=e._node,v=e._rect,O=v.x,y=v.y,p=v.width,n=v.height,c=e._89I,a=e._anchor,m=e._matrix,L=m.tfi(L);"northwest"===c?v=Jf(L,{x:O+p,y:y+n}):c===oq?v=Jf({x:O,y:L.y},{x:O+p,y:y+n}):"northeast"===c?v=Jf({x:O,y:L.y},{x:L.x,y:y+n}):c===Pf?v=Jf({x:L.x,y:y},{x:O+p,y:y+n}):c===Jh?v=Jf({x:O,y:y},{x:L.x,y:y+n}):"southwest"===c?v=Jf({x:L.x,y:y},{x:O+p,y:L.y}):"south"===c?v=Jf({x:O,y:y},{x:O+p,y:L.y}):"southeast"===c&&(v=Jf({x:O,y:y},L)),J.setPosition(m.tf(v.x+v.width*a.x,v.y+v.height*a.y)),J.setWidth(v.width),J.setHeight(v.height)},q._80I=function(m,A,z,b){var K=this,V=K.gv._zoom,e=(K.gv.getEditPointSize()+2)/V;return zo({x:A-e/2,y:z-e/2,width:e,height:e},m)?(K._89I!==b&&(K._89I=b),!0):!1},q._79I=function(V,w,j){var o=this,F=o.gv,G=w?F.getDataUI(w):N,g=G?G._55O:N;if(g){var q,U,h,p,O=F._zoom,$=(F.getEditPointSize()+2)/O,y=F.lp(V);if(cl(w)){if(g._56O&&cl(w)&&(U=g._98o,zo({x:U.x-$/2,y:U.y-$/2,width:$,height:$},y)))return o._77I=w,j&&o.fi({kind:"beginEditRotation",event:V,data:w}),o.setCursor("crosshair"),!0;if(g._43O&&w instanceof Zf)for(h=w.getPoints(),q=h.size()-1;q>=0;q--)if(U=h.get(q),zo({x:U.x-$/2,y:U.y-$/2,width:$,height:$},y))return o._index=q,o._shape=w,j&&o.fi({kind:"beginEditPoint",event:V,data:w,index:q}),o.setCursor("crosshair"),!0;if(g._42O)for(var H=w.getEditControlPoints(),a=["northwest",-1,-1,Pf,-1,0,"southwest",-1,1,"south",0,1,"southeast",1,1,Jh,1,0,"northeast",1,-1,oq,0,-1],q=0,p=H.length;p>q;q++){var B=a[3*q],e=H[q];if(o._80I(y,e.x,e.y,B)){o._node=w;var I=w.getWidth(),r=w.getHeight(),P=w.getAnchor();o._rect={x:-I*P.x,y:-r*P.y,width:I,height:r},o._anchor=P,o._matrix=w.getMatrix();var _=w.getRotation(),X=s(_),E=W(_),K=a[3*q+1]*hi(w.getScale().x),L=a[3*q+2]*hi(w.getScale().y),S=Math.atan2(-E*K-X*L,X*K-E*L),M=(Math.round(S/(Math.PI/4))+8)%8,x=[Dn,"nesw-resize",zp,"nwse-resize",Dn,"nesw-resize",zp,"nwse-resize"][M];return o.setCursor(x),j&&o.fi({kind:"beginEditRect",event:V,data:w,direction:o._89I}),!0}}}if(g._43O&&lm(w)&&w.s(_q)===Xf&&(h=w.s(nb)))for(q=h.size()-1;q>=0;q--)if(U=h.get(q),zo({x:U.x-$/2,y:U.y-$/2,width:$,height:$},y))return o._index=q,o._edge=w,j&&o.fi({kind:"beginEditPoint",event:V,data:w,index:q}),o.setCursor("crosshair"),!0}return!1}},ms_gv:function(j){j._currentSubGraph=N,j._initView=function(){this._fpsInfo={time:0,fps:0,frames:0}},j.upSubGraph=function(){this.setCurrentSubGraph(ze(this._currentSubGraph))
},j.isVisible=function(y){var v=this;if(ze(y)!==v._currentSubGraph)return!1;if(lm(y)){var F=y._40I,Q=y._41I;if(!F||!Q)return!1;if(!(y.s("edge.independent")||v.isVisible(F)&&v.isVisible(Q)))return!1;if(y.isEdgeGroupHidden())return!1}else for(var m=y._parent;m&&!m.ISubGraph;){if(Ln(m)&&(!m.isExpanded()||!v.isVisible(m)))return!1;m=m._parent}if(y._parent instanceof Jc&&!v.isVisible(y._parent))return!1;if(y._refGraph instanceof Wq&&!v.isVisible(y._refGraph))return!1;if(v instanceof Gs){if(!y.s("3d.visible"))return!1}else{var I=v.getLayersInfo();if(I){var n=I[y._layer];if(n&&n.visible===!1)return!1}if(!y.s("2d.visible"))return!1}return v._visibleFunc?v._visibleFunc(y):!0},j.handleSelectionChange=function(L){var P=this;L.datas.each(function(X){P.invalidateData(X);var m=X._parent;Ln(m)&&cl(X)&&X.s(Ql)&&(P.invalidateData(m),m._49I&&m._49I.each(function(m){P.invalidateData(m)}))}),P.onSelectionChanged(L)},j.onSelectionChanged=function(b){var w=this,n=w.sm();if(1===n.size()&&("set"===b.kind||"append"===b.kind)){var d=n.ld();w.isAutoMakeVisible()&&w.makeVisible(d),w.adjustIndex&&w._dataModel.isAutoAdjustIndex()&&w.adjustIndex(d)}},j.makeVisible=function(u){if(u){var F=this,s=F.getDataUI?F.getDataUI(u):F.getData3dUI(u);if(s){var R=u,o=ze(u);for(o!==F._currentSubGraph&&F.setCurrentSubGraph(o);(R=R._parent)&&R!==o;)Ln(R)&&R.setExpanded(!0);F._23I=u,F.iv()}}},j.getLabel=function(y){var g=y.getStyle(Yn);return g===I?y.getName():g},j.getLabelBackground=function(H){return H.getStyle("label.background")},j.getLabelColor=function(o){return o.getStyle("label.color")},j.getLabel2=function(k){return k.getStyle("label2")},j.getLabel2Background=function(Y){return Y.getStyle("label2.background")},j.getLabel2Color=function(e){return e.getStyle("label2.color")},j.getNote=function(X){return X.getStyle(ci)},j.getNoteBackground=function(f){return f.getStyle("note.background")},j.getNote2=function(F){return F.getStyle(qn)},j.getNote2Background=function(Y){return Y.getStyle("note2.background")},j.handleClick=function(f,e,v){var C=this;e?(C.fi({kind:"clickData",event:f,data:e,part:v}),C.onDataClicked(e,f)):(C.fi({kind:"clickBackground",event:f}),C.onBackgroundClicked(f))},j.handleDoubleClick=function(V,q,o){var I=this;bs(V)&&(q?(I.fi({kind:"doubleClickData",event:V,data:q,part:o}),I.onDataDoubleClicked(q,V,o),I.checkDoubleClickOnNote(V,q,o)||I.checkDoubleClickOnRotation&&I.checkDoubleClickOnRotation(V,q,o)||(lm(q)?I.onEdgeDoubleClicked(q,V,o):q.ISubGraph?I.onSubGraphDoubleClicked(q,V,o):Ln(q)?I.onGroupDoubleClicked(q,V,o):q.IDoorWindow?I.onDoorWindowDoubleClicked(q,V,o):q.ICSGBox&&I.onCSGBoxDoubleClicked(q,V,o))):(I.fi({kind:"doubleClickBackground",event:V}),I.onBackgroundDoubleClicked(V)))},j.onSubGraphDoubleClicked=function(b){this.setCurrentSubGraph(b)},j.onEdgeDoubleClicked=function(v,h){this.isEditable(v)||(v.ISubGraph&&!Og(h)?this.setCurrentSubGraph(v):v.s("edge.toggleable")&&v.toggle())},j._39Q=function(X){return this.isInteractive(X)?this.preventDefaultWhenInteractive(X):!1},j.preventDefaultWhenInteractive=function(u){return u.s("preventDefaultWhenInteractive")},j.onGroupDoubleClicked=function(T){T.s("group.toggleable")&&T.toggle()},j.onDoorWindowDoubleClicked=function(O){O.s("dw.toggleable")&&O.toggle(!0)},j.onCSGBoxDoubleClicked=function(J,n){var A=this;if(A instanceof Gs){var a=A.intersectObject(n,J);a&&J.s(a.part+".toggleable")&&J.toggleFace(a.part,!0)}},j.onBackgroundClicked=function(){},j.onBackgroundDoubleClicked=function(){this.upSubGraph()},j.onDataClicked=function(){},j.onDataDoubleClicked=function(){},j.onAutoLayoutEnded=function(){},j.onMoveEnded=function(){},j.onPanEnded=function(){},j.onPinchEnded=function(){},j.onRectSelectEnded=function(){},j.onZoomEnded=function(){},j.serialize=function(K){return this.dm().serialize(K)},j.toJSON=function(){return this.dm().toJSON()},j.deserialize=function(t,j){var K=this;j=j instanceof dd?{rootParent:j}:xj(j)?{setId:j}:Cc(j)?{finishFunc:j}:j||{},j.view=K;var w=K.dm();return j.reset&&(w.setAttrObject({}),w.setLayers(I),w.setName(I),w.setAutoAdjustIndex(!0),w.setHierarchicalRendering(!1),w.setBackground(I),w.setInit(I),w.setPostProcessingData(I),w.setEnvmap(I),w.setEnvmapType(I),K.disableToolTip(),K instanceof y.graph.GraphView?(K.setZoomable(F.graphViewZoomable),K.setPannable(F.graphViewPannable),K.setRectSelectable(F.graphViewRectSelectable)):K instanceof y.graph3d.Graph3dView&&(K.shadowMap.resetProperties(),K.setDashDisabled(F.graph3dViewDashDisabled),K.setUvClipEnabled(F.graph3dViewUvClipEnabled),K.getHighlightHelper().resetProperties(),K.resetHeadlightProperties(),K.resetFogProperties(),K.setBatchInfoMap({}),K.setBatchColorDisabled(F.graph3dViewBatchColorDisabled),K.setBatchInstancedDisabled(F.graph3dViewBatchInstancedDisabled),K.setBatchBlendDisabled(F.graph3dViewBatchBlendDisabled),K.setBatchBrightnessDisabled(F.graph3dViewBatchBrightnessDisabled),K.setFlowBlendMode(F.graph3dViewFlowBlendMode),K.setMoveStep(F.graph3dViewMoveStep),K.setRotateStep(F.graph3dViewRotateStep),K.setSortable(F.graph3dViewSortable),K.setSortFunc(I),K.setSkybox(I),gk(K))),j.__innerHandler__=function(T){if(xj(w.a("toolTipEnable"))&&(w.a("toolTipEnable")?K.enableToolTip():K.disableToolTip()),hr(w.a("fontFaces"))&&w.a("fontFaces").forEach(function(h){F.addFontFace(h.name,h.url)}),K instanceof y.graph.GraphView&&(xj(w.a("zoomable"))&&K.setZoomable&&K.setZoomable(w.a("zoomable")),xj(w.a("pannable"))&&K.setPannable&&K.setPannable(w.a("pannable")),xj(w.a("rectSelectable"))&&K.setRectSelectable&&K.setRectSelectable(w.a("rectSelectable")),w.a("fitContent")===!0&&K.fitContent&&K.fitContent(!0,0)),K instanceof y.graph3d.Graph3dView){var S=T.scene;S&&S.shadow!=N&&K.shadowMap.setShadow(S.shadow,S.shadowParams);var M=w.a("sceneContext");M?(M.eye&&K.setEye(M.eye),M.center&&K.setCenter(M.center),dm(M.far)&&K.setFar(M.far),dm(M.near)&&K.setNear(M.near)):(dm(w.a("sceneNear"))&&K.setNear(w.a("sceneNear")),dm(w.a("sceneFar"))&&K.setFar(w.a("sceneFar")),S&&(S.eye&&K.setEye(S.eye),S.center&&K.setCenter(S.center))),dm(w.a("sceneFovy"))&&K.setFovy(w.a("sceneFovy")),xj(w.a("sceneOrtho"))&&K.setOrtho(w.a("sceneOrtho")),dm(w.a("sceneOrthoWidth"))&&K.setOrthoWidth(w.a("sceneOrthoWidth")),xj(w.a("sceneShadowEnabled"))&&(w.a("sceneShadowEnabled")?K.enableShadow():K.disableShadow()),dm(w.a("sceneShadowDegreeX"))&&K.setShadowDegreeX(w.a("sceneShadowDegreeX")),dm(w.a("sceneShadowDegreeZ"))&&K.setShadowDegreeZ(w.a("sceneShadowDegreeZ")),dm(w.a("sceneShadowIntensity"))&&K.setShadowIntensity(w.a("sceneShadowIntensity")),w.a("sceneShadowQuality")!=N&&K.setShadowQuality(w.a("sceneShadowQuality")),w.a("sceneShadowType")&&K.setShadowType(w.a("sceneShadowType")),dm(w.a("sceneShadowRadius"))&&K.setShadowRadius(w.a("sceneShadowRadius")),dm(w.a("sceneShadowBias"))&&K.setShadowBias(w.a("sceneShadowBias")),xj(w.a("sceneDashEnable"))&&K.setDashDisabled(!w.a("sceneDashEnable")),xj(w.a("sceneUvClipEnabled"))&&K.setUvClipEnabled(w.a("sceneUvClipEnabled")),Je(w.a("sceneHighlightMode"))&&K.setHighlightMode(w.a("sceneHighlightMode")),dm(w.a("sceneHighlightWidth"))&&K.setHighlightWidth(w.a("sceneHighlightWidth")),w.a("sceneHighlightColor")&&K.setHighlightColor(w.a("sceneHighlightColor")),w.a("sceneHighlightType")&&K.setHighlightType(w.a("sceneHighlightType")),w.a("sceneHighlightGlow")&&K.setHighlightGlow(w.a("sceneHighlightGlow")),w.a("sceneHighlightStrength")&&K.setHighlightStrength(w.a("sceneHighlightStrength")),xj(w.a("sceneHeadlightEnable"))&&K.setHeadlightDisabled(!w.a("sceneHeadlightEnable")),w.a("sceneHeadlightDirection")!=N&&K.setHeadlightDirection(w.a("sceneHeadlightDirection")),dm(w.a("sceneHeadlightRange"))&&K.setHeadlightRange(w.a("sceneHeadlightRange")),w.a("sceneHeadlightColor")&&K.setHeadlightColor(w.a("sceneHeadlightColor")),dm(w.a("sceneHeadlightIntensity"))&&K.setHeadlightIntensity(w.a("sceneHeadlightIntensity")),dm(w.a("sceneHeadlightAmbientIntensity"))&&K.setHeadlightAmbientIntensity(w.a("sceneHeadlightAmbientIntensity")),dm(w.a("sceneHeadlightGroup"))&&K.setHeadlightGroup(w.a("sceneHeadlightGroup")),xj(w.a("sceneFogEnable"))&&K.setFogDisabled(!w.a("sceneFogEnable")),w.a("sceneFogMode")&&K.setFogMode(w.a("sceneFogMode")),dm(w.a("sceneFogDensity"))&&K.setFogDensity(w.a("sceneFogDensity")),w.a("sceneFogColor")&&K.setFogColor(w.a("sceneFogColor")),dm(w.a("sceneFogNear"))&&K.setFogNear(w.a("sceneFogNear")),dm(w.a("sceneFogFar"))&&K.setFogFar(w.a("sceneFogFar")),xj(w.a("sceneBatchBrightnessDisabled"))&&K.setBatchBrightnessDisabled(w.a("sceneBatchBrightnessDisabled")),w.a("sceneFlowBlendMode")!==I&&K.setFlowBlendMode(w.a("sceneFlowBlendMode")),xj(w.a("sceneBatchBlendDisabled"))&&K.setBatchBlendDisabled(w.a("sceneBatchBlendDisabled")),xj(w.a("sceneBatchColorDisabled"))&&K.setBatchColorDisabled(w.a("sceneBatchColorDisabled")),xj(w.a("sceneBatchInstancedDisabled"))&&K.setBatchInstancedDisabled(w.a("sceneBatchInstancedDisabled")),w.a("sceneBatchInfoMap")&&K.setBatchInfoMap(w.a("sceneBatchInfoMap")),w.a("sceneRenderLayerInfoMap")&&K.setRenderLayerInfoMap(w.a("sceneRenderLayerInfoMap")),dm(w.a("sceneMoveStep"))&&K.setMoveStep(w.a("sceneMoveStep")),dm(w.a("sceneRotateStep"))&&K.setRotateStep(w.a("sceneRotateStep")),xj(w.a("sceneSortable"))&&K.setSortable(w.a("sceneSortable")),Cc(w.a("sceneSortFunc"))&&K.setSortFunc(w.a("sceneSortFunc"));var e=w.a("sceneSkyboxType")||"sphere";if(e!=N){var Z={},p=!1;if("sphere"===e){Z.shape3d=e;var n=w.a("sceneSkyboxImage");n&&(Z["shape3d.image"]=n,p=!0)}else"cube"===e?(Z.shape3d=I,["front","back","left","right","top","bottom"].forEach(function($){var P=$+".image",y=$.charAt(0).toUpperCase()+$.slice(1),F=w.a("sceneSkybox"+y+"Image");F&&(Z[P]=F,p=!0)})):"color"===e&&(p=!0);if(p){var d=new Oh,g=w.a("sceneSkyboxDiameter");if(dm(g)?d.s3(g,g,g):d.s3(20,20,20),Z["body.color"]=w.a("sceneSkyboxBodyColor"),Z.envmap=w.a("sceneSkyboxEnvmap"),Z["envmap.probe"]=w.a("sceneSkyboxEnvmapProbe"),Z.roughness=w.a("sceneSkyboxRoughness"),Z["shape3d.light"]=Z["all.light"]=w.a("sceneSkyboxLight"),Z["light.mask"]=w.a("sceneSkyboxLightMask"),Z["headlight.ambientIntensity"]=w.a("sceneSkyboxHeadLightAmbientIntensity"),Z["texture.wrap"]="clampToEdge",Z["3d.clipbox.mask"]=ar,Z["effect.flow.mask"]=ar,"color"===e){Z.shape3d="sphere";var t=2,J=1024,n=d.s("shape3d.image"),o=n&&y.Default.getImage(n);o&&"CANVAS"===o.tagName||(o=H.createElement("canvas"),n=y.Math.generateUUID(),y.Default.setImage(n,o)),n&&K.getTextureMap()&&K.deleteTexture(n),y.Default.setCanvas(o,t,J,1);var f=o.getContext("2d");f.clearRect(0,0,t,J),f.beginPath(),f.rect(0,0,t,J),hj(f,w.a("sceneSkyboxColor"),function(q){return q},!1,{x:0,y:0,width:t,height:J}),f.fill(),f.restore(),Z["shape3d.image"]=n}d.s(Z),["X","Y","Z"].forEach(function(C){var A=w.a("sceneSkyboxRotation"+C);dm(A)&&d["setRotation"+C](A)}),K.setSkybox(d)}}}},w.deserialize(t,j.rootParent,j)},j.isDebugTipShowing=function(){return!!this._debugDiv},j.showDebugTip=function(){var x=this,U=x._debugDiv;if(!U){U=x._debugDiv=H.createElement("div"),U.style.position="absolute",U.style.overflow="hidden",U.style.font=F.debugTipLabelFont,U.style.padding="6px",U.style.backgroundColor=F.debugTipBackground,U.style.color=F.debugTipLabelColor;var Q=x.getView();x._79O?Q.insertBefore(U,x._79O):Q.appendChild(U);var I=function(){x.redraw();var k=x._canvas,K="FPS: "+x._fpsInfo.fps+"<br/>"+"Datas: "+x.dm().getDatas().length+(k?"<br/>Size: "+k.width+" * "+k.height:""),u=x.dm()._historyManager;u&&(K+="<br/>Undoes: "+u.getHistories().length+" index: "+u.getHistoryIndex());var h=x.getDebugTip();h&&(K+="<hr>"+h),U.innerHTML=K,x._isDebugging&&requestAnimationFrame(I)};requestAnimationFrame(I),x._isDebugging=!0}},j.hideDebugTip=function(){var Z=this,P=Z._debugDiv;P&&(delete Z._debugDiv,Z.getView().removeChild(P),Z._isDebugging=!1)},j.updateDOMAppendMatrix=function(){var y=this.getView();y&&(y.updateAppendMatrix=!0)},j.countFrame=function(){if(this._isDebugging){var S=Date.now(),I=this._fpsInfo;S-I.time>1e3?(I.fps=Math.round(1e5*(I.frames+1)/(S-I.time))/100,I.time=S,I.frames=0):I.frames++}}},ms_icons:function(_){_.getRotation=function(B){return B==N?0:B},_._15O=function(){var X=this,t=X.s(Qj);if(t){var Z=X,m=X.data||X._data,z=m.getRotation&&m.getRotation(),g=X._38o={icons:t,rects:{}};for(var p in t){var s=t[p],f=Aq(s.shape3d,m,Z);if(!(Aq(s.visible,m,Z)===!1||Aq(s.for3d,m,Z)&&!X.I3d||f&&!X.I3d)){var K=f?[f]:Aq(s.names,m,Z),L=K?K.length:0,H=Aq(s.position,m,Z)||3,n=Aq(s.offsetX,m,Z)||0,M=Aq(s.offsetY,m,Z)||0,I=Aq(s.direction,m,Z)||Jh,U=Aq(s.gap,m,Z),r=U!=N?U:1,P=Aq(s.rotation,m,Z),O=Aq(s.keepOrien,m,Z),w=Aq(s.rotationFixed,m,Z)?P:X.getRotation(P,O,H),x=N,$=g.rects[p]=new Array(L);dm(z)&&(dm(w)?w+=z:w=z),$.rotation=w;for(var S=0;L>S;S++){var D,G,_,F,b=K[S];if(f)_=0,F=0;else{var u=Fp(b);_=Aq(s.width,m,Z),F=Aq(s.height,m,Z),_==N&&(_=fm(u,m)),F==N&&(F=Oo(u,m))}if(x?I===Jh?n+=_/2:I===Pf?n-=_/2:I===oq?M-=F/2:M+=F/2:x={width:_,height:F},X.I3d){var a=-_/2,j=-F/2;G={width:_,height:F,mat:X._16O(Aq(s.autorotate,m,Z),H,x,Aq(s.face,m,Z)||Ki,Aq(s.t3,m,Z),Aq(s.r3,m,Z),Aq(s.rotationMode,m,Z),n,M),vs:new ub([a,-j,0,a,-j-F,0,a+_,-j-F,0,a+_,-j,0])}}else D=X.getPosition(H,n,M,x,Aq(s.positionFixed,m,Z)),G={x:D.x-_/2,y:D.y-F/2,width:_,height:F},X._68o(G,w);$[S]=G,I===Jh?n+=_/2+r:I===Pf?n-=_/2+r:I===oq?M-=F/2+r:M+=F/2+r}}}}}}});var Vb={1:1,2:1,6:1,9:1,10:1,14:1,15:1,16:1,21:1,22:1,26:1,29:1,30:1,34:1,36:1,38:1,40:1,42:1,45:1,50:1,52:1,54:1},qf={3:1,7:1,11:1,17:1,23:1,27:1,31:1,44:1,46:1,47:1,49:1},kb={translateX:1,translateY:1,zoom:1,scrollBarVisible:1},Ao={sourceAgent:1,targetAgent:1,expanded:1,parent:1,host:1},$n={position:1,width:1,height:1,expanded:1,rotation:1,anchor:1,scale:1,"s:edge.points":1},vo={"edge.type":1,"edge.group":1},gm={rotation:1,rotationX:1,rotationZ:1,rotation3d:1},Mg={rotation:1,position:1,width:1,height:1,anchor:1,scale:1,host:1,"s:vector.layoutable":1,"s:2d.visible":1},Io={position:1,width:1,height:1,anchor:1,scale:1,"s:grid.row.count":1,"s:grid.column.count":1,"s:grid.row.percents":1,"s:grid.column.percents":1,"s:grid.border":1,"s:grid.border.left":1,"s:grid.border.right":1,"s:grid.border.top":1,"s:grid.border.bottom":1,"s:grid.gap":1},zm={"attach.row.index":1,"attach.column.index":1,"attach.row.span":1,"attach.column.span":1,"attach.padding":1,"attach.padding.left":1,"attach.padding.right":1,"attach.padding.top":1,"attach.padding.bottom":1,"attach.index":1,"attach.offset":1,"attach.offset.relative":1,"attach.offset.opposite":1,"attach.gap":1,"attach.gap.relative":1,"attach.thickness":1},jn={shape:1,thickness:1,position:1,anchor:1,scale:1},ze=function(R){if(!R)return N;if(lm(R)){var m=R._40I,V=R._41I;if(!m||!V)return N;var i=ze(m),S=ze(V);return i===S?i:N}for(var j=R._parent;lm(j)&&!j.ISubGraph;)j=j._parent;return j?j.ISubGraph?j:ze(j):N},_e=function(C,e,L,O){var I=e.getStyle(L)*O;I&&Oj(C,I),I=e.getStyle(L+".left")*O,I&&(C.x-=I,C.width+=I),I=e.getStyle(L+".right")*O,I&&(C.width+=I),I=e.getStyle(L+".top")*O,I&&(C.y-=I,C.height+=I),I=e.getStyle(L+".bottom")*O,I&&(C.height+=I),C.width<0&&(C.width=-C.width,C.x-=C.width),C.height<0&&(C.height=-C.height,C.y-=C.height)},ei=function(D){for(var Y,$=0,L=D.size();L>$;$++)if(Y=D.getChildAt($),cl(Y)&&ei(Y))return!0;return D.hasAgentEdges()},is=function(h){if(!h)return N;for(var Q=h._parent;Ln(Q);){if(!Ln(Q._parent))return Q.isExpanded()?h:Q;Q.isExpanded()||(h=Q),Q=Q._parent}return h},Vn=function(d,O){if(!d||!O)return N;var L,G,n,m=ze(d),U=ze(O);if(m!==U){for(;U&&m!==U;)U=ze(U);if(m===U)return d;L=new Ik,L.add(d,0);for(var f=d._parent;cl(f)&&!O.isDescendantOf(f);)L.add(f,0),f=f._parent;for(n=L.size(),G=0;n>G;G++){var z=L.get(G);if(Ln(z)&&!z.isExpanded())return z;if(z.ISubGraph)return z}return d}return d},Hr=function(z){if(z.isLooped())return z._source;var k=is(z._source),b=is(z._target);return k===b?z._source:Vn(k,b)},Pq=function(V){if(V.isLooped())return V._target;var b=is(V._source),s=is(V._target);return b===s?V._target:Vn(s,b)},tq=function(M,b,Z){"target"!==Z&&(Z="source");var e="target"===Z?b.getTargetAgent():b.getSourceAgent(),$="edge."+Z+".";if(lm(e)){var g=M.getDataUI(e);g._79o();var J=b.s($+"index");if(J>=0){var K=qd(g);return K[Math.max(0,Math.min(J,K.length-1))]}var o=b.s($+"percent")||0;o=Math.max(0,Math.min(o,1));var S=ss(g);return zj(S,100*o)}return Hn(M,e,b.s($+"position"),b.s($+"offset.x"),b.s($+"offset.y"),b.s($+"anchor.x"),b.s($+"anchor.y"))},Hn=function(A,$,D,q,V,o,e){if(!$)return N;var J,K=$.getRotation?$.getRotation():0;if(o!==I||e!==I){o=o===I?.5:o,e=e===I?.5:e;var F=$.getScale();if(K&&!hf($,A)||F.x<0||F.y<0){var S=$.getPosition(),w=$.getWidth(),Y=$.getHeight(),r=$.getAnchor(),R=new zg(K,S.x,S.y,F.x,F.y);D=R.tf((o-r.x)*w,(e-r.y)*Y)}else J=Wg(A,$),D={x:J.x+o*J.width,y:J.y+e*J.height}}else D=Sh(D,Wg(A,$));if(K){var H=s(K),X=W(K),O=q*H-V*X;V=q*X+V*H,q=O}return D.x+=q,D.y+=V,D},Gm=function(O,v){if(!O||!v)return N;var T,$,q,e,s,Y;if(O===v){if(e=O.getLoopedEdges(),!e)return N;e=new Ik(e)}else{if(s=O.getAgentEdges(),Y=v.getAgentEdges(),!s||!Y)return N;for($=s.size(),T=0;$>T;T++)q=s.get(T),Y.contains(q)&&(e||(e=new Ik),e.add(q))}if(e)for(T=0;T<e.size();T++)q=e.get(T),q.getStyle(_q)===Xf&&(q._22I(N),e.removeAt(T),T--);return e},se=function(r,H){var L=Gm(r,H);if(L&&!L.isEmpty()){if(1===L.size())return L.get(0)._22I(N),void 0;var X=new Ik,G=new Ik;L.each(function(n){var A=n.s("edge.group");X.contains(A)||X.add(A)}),X.sort(),X.each(function(Q){G.add(new y.EdgeGroup(L.toList(function(M){return Q===M.s("edge.group")}),G))}),G.each(function(k){k.each(function(i){i._22I(k)})})}},Gq=function(Q,r,a){var J=Q._canvas;Q._zoom;var Y=qh(r,J),B=qh(a,J);return{x:Y.x-B.x,y:Y.y-B.y}},Yk=function(B,f){if(f){var T=f.rect,C=f.color,g=f.rotation,R=f.labelWidth,a=f.background,M=f.opacity,n=f.scale,h=n!=N&&1!==n;if(M!=N){var t=B.globalAlpha;B.globalAlpha*=M}if(g||h){B.save();var k=T.x+T.width/2,c=T.y+T.height/2;jf(B,k,c),g&&je(B,g),h&&B.scale(n,n),jf(B,-k,-c)}if(a&&no(B,T.x,T.y,T.width,T.height,a),R){var E=T.width,L=B.createLinearGradient(T.x,T.y,T.x+E,T.y);L.addColorStop(0,C),L.addColorStop(.9,C),L.addColorStop(1,Gf),C=L,T.width=R}Vk(B,f.ss,T,f.font,C,f.align,f.decoration),R&&(T.width=E),(g||h)&&B.restore(),M!=N&&(B.globalAlpha=t)}},Op=function(S,b){if(b){var p=b.rect,r=p.x,i=p.y,h=p.width,g=p.height,a=b.background,x=b.backgroundImage,s=b.borderWidth,k=b.borderColor,o=b.labelWidth,Q=b.opacity,q=b.scale,R=q!=N&&1!==q;if(Q!=N){var M=S.globalAlpha;S.globalAlpha*=Q}if(R){S.save();var X=p.x+p.width/2,O=p.y+p.height/2;jf(S,X,O),S.scale(q,q),jf(S,-X,-O)}if(b.expanded){var t=J(8,h/4),l=i+g-8;if(S.fillStyle=a,S.beginPath(),S.moveTo(r,i),S.lineTo(r,l),S.lineTo(r+h/2,l),S.lineTo(r+h/2,i+g),S.lineTo(r+h/2+t,l),S.lineTo(r+h,l),S.lineTo(r+h,i),S.closePath(),S.fill(),s&&(S.lineWidth=s,S.lineJoin="round",S.lineCap="round",k?(S.strokeStyle=k,S.stroke()):(S.strokeStyle=Gg(a),S.beginPath(),S.moveTo(r+h,i),S.lineTo(r+h,l),S.lineTo(r+h/2+t,l),S.lineTo(r+h/2,i+g),S.stroke(),S.strokeStyle=Do(a),S.beginPath(),S.moveTo(r+h,i),S.lineTo(r,i),S.lineTo(r,l),S.lineTo(r+h/2,l),S.lineTo(r+h/2,i+g),S.stroke())),x)wf(S,Fp(x),qg,p.x,p.y,p.width,p.height-8,b.data,b.view);else{if(p.height-=8,a=b.color,o){var e=h,B=S.createLinearGradient(r,i,r+e,i);B.addColorStop(0,a),B.addColorStop(.9,a),B.addColorStop(1,Gf),a=B,p.width=o}Vk(S,b.ss,p,b.font,a,b.align),o&&(p.width=e),p.height+=8}}else if(b.icon)He(S,Fp(b.icon),r,i,h,g,b.data,b.view);else{var K=h/2;s&&(S.lineWidth=s,S.lineJoin="round",S.lineCap="round",S.strokeStyle=k?k:Gg(a),S.beginPath(),S.arc(r+K,i+K,K,Rd,1.6*G,!0),S.moveTo(r+K,i+g),S.lineTo(r+h-K/5,i+K),S.stroke(),S.strokeStyle=k?k:Do(a),S.beginPath(),S.arc(r+K,i+K,K,1.6*G,Rd,!0),S.moveTo(r+K,i+g),S.lineTo(r+K/5,i+K),S.stroke()),S.fillStyle=a,S.beginPath(),S.arc(r+K,i+K,K,0,f,!0),S.moveTo(r+K,i+g),S.lineTo(r+h-K/5,i+K),S.lineTo(r+K/5,i+K),S.closePath(),S.fill(),S.fillStyle=b.color,S.beginPath(),S.arc(r+K,i+K,K/3,0,f,!0),S.fill()}R&&S.restore(),Q!=N&&(S.globalAlpha=M)}},_b=function(w,V){return V>2*w?w:V/2},Bs=function(v,u,Y,f){if(!v||!u)return 0;var p=ge(u.y-v.y,u.x-v.x);return Y||(p=u.x<v.x?p+G:p),p+f},zb=function(A,I,G,O,R,M,B){B&&(A.x>I.x||A.x===I.x&&A.y>I.y)&&(G=Dc[G],R=-R);var C=Sh(G,{x:0,y:0,width:So(A,I),height:0},M);return C.x+=O,C.y+=R,C=new zg(ge(I.y-A.y,I.x-A.x)).tf(C),C.x+=A.x,C.y+=A.y,C},Yi=function(u,Y,L,C,K){if(u._19Q=!0,!L.getEdgeGroup())return C?L.s("edge.gap"):0;if(lm(L.getSourceAgent())||lm(L.getTargetAgent()))return 0;var n,$=0,Z=0,i=0;if(L.getEdgeGroup().getSiblings().each(function(I){I.each(function(w){if(Y.isVisible(w)&&w.s(_q)==K){var k=w.s("edge.gap");n?(Z+=i/2+k/2,i=k):(n=w,i=k),w===L&&($=Z)}})}),C)return Z-$+i;var g=$-Z/2;return n&&L._40I!==n._40I&&(u._19Q=!1),g},Yo=function(S){var Q=S._getValidSelection();if(1===Q.length){var W=Q[0],z=W instanceof y.Edge;if(W instanceof y.Shape||z){if(z){var l=W.s("edge.type");if(l&&"points"!==l)return}var K=S.gv;if((!K.isPointEditable||K.isPointEditable(W))&&K.isEditable(W))return W}}},rc=function(){var D=function($){var g=[];return $.forEach(function(w){g.push({x:w.x,y:w.y}),g.push({x:w.x+w.width,y:w.y+w.height}),g.push({x:w.x+w.width,y:w.y}),g.push({x:w.x,y:w.y+w.height})}),g};return function(V,f,F){if("oval"===V){var d=0,l=F.height/F.width,h=l*l,N=F.x+F.width/2,C=F.y+F.height/2,H=D(f);H.forEach(function(D){var L=D.x-N,l=D.y-C,V=L*L+l*l/h;V>d&&(d=V)}),d=U(d);var b=l*d;return{x:N-d,y:C-b,width:2*d,height:2*b}}if("circle"===V){var B=0,N=F.x+F.width/2,C=F.y+F.height/2,H=D(f);return H.forEach(function(l){var e=l.x-N,S=l.y-C,h=e*e+S*S;h>B&&(B=h)}),B=U(B),{x:N-B,y:C-B,width:2*B,height:2*B}}return"roundRect"===V?(Oj(F,J(F.width,F.height)/16),F):F}}(),Nf=y.graph={},ol=function(r,n,s){ri(D+".graph."+r,n,s)};y.layout={};var Xe={},Hl=function(P,v,q,B,k,w,r,F){var K=r._zoom;if(!K)return v;if(K!==r._cacheZoom&&(r._cacheZoom=K,r._cacheImage={}),K*=Ep,B=Math.ceil(B),k=Math.ceil(k),B*K>2048||k*K>2048)return v;var p=[v.uuid,B,k,q].join("_");if(w instanceof y.Data){var l=v.dataBindings;if(l)for(var n=l.length-1;n>=0;n--){var T=w.a(l[n].attr);Go(T)||hr(T)||(p+="_"+T)}}if(v.cacheRule){var i;i=Cc(v.cacheRule)?v.cacheRule(w,r):Aq(v.cacheRule,w,r),p+="_"+i}var X,Q=1;k>=B&&Q>B*K?(X=k/B,B=Q/K,k=B*X):B>=k&&Q>k*K&&(X=B/k,k=Q/K,B=k*X),B=Math.ceil(B),k=Math.ceil(k);var C=r._cacheImage[p];if(!C){if(Mr(),C=y.Default.toCanvas(v,B,k,q,w,r,F,K),!Cq())return v;r._cacheImage[p]=C}return C};xo(F,{setImageCacheRule:function(z,y){var U;y||"object"!=typeof z?(U={},U[z]=y):U=z;for(var K in U){var T=U[K];Je(K)?(ri=Fp(K),ri?ri.cacheRule=T:Xe[K]=T):K.cacheRule=T}}});var lh={comps:[{type:Kb,points:[85,50,70,115,100,71,86,107,88,49,47,83,67,103,122,53,86,78,78,102,68,84,47,90,80,67,88,108,47,87,81,116,110,56,119,99,109,79,118,116,104,53,85,61],borderWidth:1,borderColor:N}]};if(lh[Tp]=lh[nf]=160,w.Image){var lp=new w.Image;lp.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAALUlEQVRYR+3QQREAAAABQfqXFsNnFTizzXk99+MAAQIECBAgQIAAAQIECBAgMBo/ACHo7lH9AAAAAElFTkSuQmCC",mg("default_blank",lp)}mg("node_image",jh(30,30,[{type:Yp,rect:[4,5,22,16],gradient:Pm,gradientColor:af,background:Cs},{type:Yp,rect:[2,3,26,20],borderWidth:1,borderColor:Cs},{type:Yp,rect:[11,23,8,4],background:Cs},{type:Yp,rect:[6,27,18,2],background:Cs}])),mg("node_icon",jh(16,16,[{type:Yp,rect:[2,2,12,10],gradient:Pm,gradientColor:af,background:Cs},{type:$e,rect:[2,2,12,10],width:1,color:Cs},{type:Yp,rect:[6,12,4,2],background:Cs},{type:Yp,rect:[4,14,8,1],background:Cs}])),mg("block_icon",jh(16,16,[{type:$e,rect:[1,1,14,14],width:1,color:Cs}])),mg("group_image",jh(66,39,[{type:Yp,rect:[44.3,18,18.1,12.8],gradient:Pm,gradientColor:af,background:Cs},{type:Yp,rect:[3.3,17.8,18.1,12.8],gradient:Pm,gradientColor:af,background:Cs},{type:Yp,rect:[15.8,3.2,33.5,26.4],borderWidth:1,borderColor:Cs,gradient:Pm,gradientColor:af,background:Cs},{type:Yp,rect:[26.2,29.4,12.8,4.2],background:Cs},{type:Yp,rect:[21.3,33.5,22.5,2.3],background:Cs},{type:Yp,rect:[5.3,32.7,14.1,2.1],background:Cs},{type:Yp,rect:[9,30.4,6.7,2.4],background:Cs},{type:Yp,rect:[50,30.7,6.7,2.4],background:Cs},{type:Yp,rect:[46.3,33,14.1,2.1],background:Cs}])),mg("group_icon",jh(16,16,[{type:Yp,rect:[4,12,4,2],background:Cs},{type:Yp,rect:[2,13,8,1],background:Cs},{type:Yp,rect:[12,12,2,1],background:Cs},{type:Yp,rect:[11,13,4,1],background:Cs},{type:Yp,rect:[10,7,6,5],gradient:Pm,gradientColor:af,background:Cs},{type:Yp,rect:[1,2,10,10],gradient:Pm,gradientColor:af,background:Cs},{type:$e,rect:[1,2,10,10],width:1,color:Cs}])),mg("refGraph_icon",jh(16,16,[{type:"shape",borderWidth:1,borderColor:Cs,borderCap:"round",rotation:.7854,points:[12.5502,6.7981,12.5502,6.7981,12.5502,4.8181,12.5502,3.7981,12.5502,2.7781,11.36687,1.7981,10.0502,1.7981,8.73354,1.7981,7.5502,2.8181,7.5502,3.7981,7.5502,4.55989,7.5502,7.79805,7.5502,7.79805,7.5502,7.79805,7.5502,9.7981,10.0502,9.7981],segments:[1,4,4,4,4,4]},{type:"shape",borderWidth:1,borderColor:Cs,borderCap:"round",rotation:-2.35619,points:[8.4498,11.2019,8.4498,11.2019,8.4498,9.2219,8.4498,8.2019,8.4498,7.1819,7.26646,6.2019,5.9498,6.2019,4.63313,6.2019,3.4498,7.2219,3.4498,8.2019,3.4498,8.9637,3.4498,12.20186,3.4498,12.20186,3.4498,12.20186,3.4498,14.2019,5.9498,14.2019],segments:[1,4,4,4,4,4]}])),mg("edge_icon",jh(16,16,[{type:Yp,rect:[2.1,6.9,11.5,2.6],rotation:-.79,gradient:Pm,gradientColor:af,background:Cs},{type:Yp,rect:[10.8,1,4,4],background:Cs},{type:Yp,rect:[1,11,4,4],background:Cs}])),mg("subGraph_image",jh(72,45,[{type:Kb,points:[9,42,.3,38.4,2.4,28.8,5.7,21.6,11.7,22.5,11.7,15.9,16.8,13.8,21.6,12,24.3,15.9,27.9,3,42.3,2.1,59.4,4.5,57.3,18.3,67.5,18.9,69.6,27.3,69.9,38.4,64.2,41.4],segments:[1,3,3,3,3,3,3,3,3],gradient:Pm,gradientColor:af,background:Cs},{type:Yp,rect:[29.6,30.7,3.6,1.8],background:Cs},{type:Yp,rect:[28.4,32.3,6,1.2],background:Cs},{type:Yp,rect:[37.3,32,10.8,1.8],background:Cs},{type:Yp,rect:[39.1,29.9,7.2,2.3],background:Cs},{type:Yp,rect:[26.6,23.7,9.6,7.2],gradient:Pm,gradientColor:af,background:Cs},{type:Yp,rect:[34.3,16.8,16.8,13.2],borderWidth:1,borderColor:Cs,gradient:Pm,gradientColor:af,background:Cs}])),mg("subGraph_icon",jh(17,17,[{type:Kb,points:[2.2,14.6,.2,11.9,.8,8.8,1.8,5.9,5.6,7.4,3.8,1.6,10.3,3,14.5,4.2,12.2,7.5,18.9,7.2,14.5,14.5],segments:[1,3,3,3,3,3],gradient:Pm,gradientColor:af,background:Cs}])),mg("shape_icon",jh(16,16,[{type:Kb,points:[1.5,1,8.4,1,8.4,7.2,14.6,7.1,14.6,14.9,1.5,14.9,1.5,1],background:Cs}])),mg("polyline_icon",jh(16,16,[{type:Kb,points:[1.5,1,8.4,1,8.4,7.2,14.6,7.1,14.6,14.9,1.5,14.9,1.5,1],borderWidth:1,borderColor:Cs},Rb(7.5,.4),Rb(7.5,6.3),Rb(13.6,6.3),Rb(13.6,14),Rb(.7,13.9),Rb(.7,.3)])),mg("grid_icon",jh(16,16,[{type:Yp,rect:[1,1,4,4],background:Cs,gradient:Pm,gradientColor:af},{type:Yp,rect:[6,1,4,4],background:Cs,gradient:Pm,gradientColor:af},{type:Yp,rect:[11,1,4,4],background:Cs,gradient:Pm,gradientColor:af},{type:Yp,rect:[11,6,4,4],background:Cs,gradient:Pm,gradientColor:af},{type:Yp,rect:[6,6,4,4],background:Cs,gradient:Pm,gradientColor:af},{type:Yp,rect:[1,6,4,4],background:Cs,gradient:Pm,gradientColor:af},{type:Yp,rect:[11,11,4,4],background:Cs,gradient:Pm,gradientColor:af},{type:Yp,rect:[6,11,4,4],background:Cs,gradient:Pm,gradientColor:af},{type:Yp,rect:[1,11,4,4],background:Cs,gradient:Pm,gradientColor:af}])),mg("light_icon",jh(16,16,[{type:"rect",rect:[6,9,5,5],borderWidth:1,borderColor:Cs},{type:"circle",rect:[1,1,15,10],borderWidth:1,borderColor:Cs,gradient:Pm,gradientColor:af,background:{func:function(C){var A=C?C.s(kk):N;return hr(A)?"rgb("+Oc(255*A[0])+","+Oc(255*A[1])+","+Oc(255*A[2])+")":A||Cs}}}])),mg("text_icon",jh(16,16,[{type:"shape",points:[3,3,13,3,8,3,8,14],segments:[1,2,1,2],borderWidth:1,borderColor:Cs}])),mg("border_image",{fitSize:!0,comps:[{type:"border",relative:!0,rect:[0,0,1,1],color:{func:"style@border_color"},width:{func:"style@border_width"}}]}),mg("columnChart_image",{fitSize:!0,boundExtend:150,comps:[{type:{func:"style@chart.type"},relative:!0,rect:[0,0,1,1],label:{func:"style@chart.label"},labelColor:{func:"style@chart.label.color"},labelFont:{func:"style@chart.label.font"},series:{func:"style@chart.series"},minValue:{func:"style@chart.min.value"},maxValue:{func:"style@chart.max.value"}}]}),mg("lineChart_image",{fitSize:!0,boundExtend:150,comps:[{type:"lineChart",relative:!0,rect:[0,0,1,1],label:{func:"style@chart.label"},labelColor:{func:"style@chart.label.color"},labelFont:{func:"style@chart.label.font"},series:{func:"style@chart.series"},minValue:{func:"style@chart.min.value"},maxValue:{func:"style@chart.max.value"},linePoint:{func:"style@chart.line.point"},lineWidth:{func:"style@chart.line.width"},line3d:{func:"style@chart.line.3d"}}]}),mg("pieChart_image",{fitSize:!0,boundExtend:150,comps:[{type:"pieChart",relative:!0,rect:[0,0,1,1],label:{func:"style@chart.label"},labelColor:{func:"style@chart.label.color"},labelFont:{func:"style@chart.label.font"},hollow:{func:"style@chart.hollow"},startAngle:{func:"style@chart.start.angle"},values:{func:"style@chart.values"},colors:{func:"style@chart.colors"}}]});var Al=function(d,A,Y,T,t,E){var o,m,U,Q,w,_,h,J,M,Z,L,n=[];if(Math.abs(T)>2*Math.PI&&(T=2*Math.PI),w=Math.ceil(Math.abs(T)/(Math.PI/4)),o=T/w,m=-o,U=-Y,w>0){_=d+Math.cos(Y)*t,h=A+Math.sin(-Y)*E,n.push({x:_,y:h});for(var i=0;w>i;i++)U+=m,Q=U-m/2,J=d+Math.cos(U)*t,M=A+Math.sin(U)*E,Z=d+Math.cos(Q)*(t/Math.cos(m/2)),L=A+Math.sin(Q)*(E/Math.cos(m/2)),n.push({x:Z,y:L}),n.push({x:J,y:M})}return n},Sj=function(S){if(S){var j=S._data;if(j instanceof y.Shape)return{points:j.getPoints(),segments:j.getSegments()};var $;if(j instanceof y.Edge&&($=S._78o)){var t,U,m=$.type,z=$.points,k=$.segments,Z=$.edgeTypeInfo;if(!m||z){var Y=$.sourcePoint,P=Y.x,o=Y.y,H=$.targetPoint,L=H.x,p=H.y;if(m)k?(t=new Ik({x:P,y:o}),t.addAll(z),t.add({x:L,y:p}),U=new Ik(k._as)):(t=new Ik({x:P,y:o}),z.each(function(Z){t.add(Z)}),t.add({x:L,y:p}));else if($.looped){t=new Ik(Al(P,o,0,2*Math.PI,$.radius,$.radius)),U=new Ik([1]);for(var b=0;b<(t.size()-1)/2;b++)U.add(3)}else t=new Ik,$.center?(t.add({x:$.c1.x,y:$.c1.y}),t.add({x:P,y:o}),t.add({x:L,y:p}),t.add({x:$.c2.x,y:$.c2.y})):(t.add({x:P,y:o}),t.add({x:L,y:p}))}else Z&&(t=new Ik(Z.points._as),Z.segments&&(U=new Ik(Z.segments._as)));return{points:t,segments:U}}}},ss=function(P,o,m){if(null==o){var B=Sj(P);if(!B)return;o=B.points,m=B.segments}if(o){if(Array.isArray(o)&&(o=new Ik(o)),"number"==typeof o.get(0)){for(var Z=new y.List,c=0;c<o.size();c+=2)Z.add({x:o.get(c),y:o.get(c+1)});o=Z}if(!m){m=[1];for(var h=o.length-1;h>0;h--)m.push(2)}Array.isArray(m)&&(m=new Ik(m));for(var i=$m(o._as,m._as,50),_=i.length,H=[],c=0;_>c;c++){var U=i[c];U.length>1&&H.push(U)}return H}},pb=function(j){for(var l=0,p=j.length-1,m=0;p>m;m++){var Z=j[m],L=j[m+1],_=L.x-Z.x,T=L.y-Z.y;l+=Math.sqrt(_*_+T*T)}return l},Dj=function(b,n){for(var I=0,u=n.length,A=0;u>A;A++){var L=n[A];if(I+=L,I>b)return A}return Math.min(A,u-1)},Tk=function(K,Z){for(var Y=0,Q=0,y=0,D=K.length-1,q=0;D>q;q++){var x=K[q],r=K[q+1],$=r.x-x.x,U=r.y-x.y;if(y=Math.sqrt($*$+U*U),Y+=y,Y>Z){Y-=y,Q=q;break}}var M=K[Q],t=K[Q+1],J=Math.atan2(t.y-M.y,t.x-M.x),m=Z-Y,U=Math.sin(J)*m,$=Math.cos(J)*m;return{x:M.x+$,y:M.y+U}},zj=function(q,E){if(q){var Z;if(0===E)Z=q[0][0];else if(100===E)q=q[q.length-1],Z=q[q.length-1];else{for(var L=0,w=[],_=q.length,o=0;_>o;o++){var k=q[o],r=pb(k);L+=r,w.push(r)}for(var Y=L*E/100,m=Dj(Y,w),h=0,b=0;m>b;b++)h+=w[b];Y-=h,Z=Tk(q[m],Y)}return Z}},qd=function(d){var p,h;if(d instanceof bj){var c=Sj(d);p=c.points,h=c.segments}else p=arguments[0],h=arguments[1];var X,J,g,t,W=[],V=-1;for(J=0,g=h?h.length:p.length;g>J;J++){if(X=h?h.get(J):1,3===X)t=2;else if(4===X)t=3;else{if(5===X)continue;t=1}V+=t,W.push(p.get(V))}return W},pr=function(g,p,t,l){function W(P){if(P>=0&&1>=P){E=p(P);var C=(g.x-E.x)*(g.x-E.x)+(g.y-E.y)*(g.y-E.y);return _>C?(_=C,F=P,!0):!1}}t=t||100,l=l||1e-5;for(var _=1/0,F=0,E=new of,m=0;t>m;++m)W(m/t);for(var Q=1/(2*t);Q>l;)W(F-Q)||W(F+Q)||(Q/=2);return F};xo(F,{_edgeProtectMethod:{getStraightLinePoints:ss,calculateLineLength:pb,calcSegmentIndexByDistance:Dj,calculatePointAlongLine:Tk,getPercentPosition:zj,getRealPointsFromDataUI:qd}});var mh=function(e,V){for(var E=e.vertices,a=0;a<E.length;a++){var o=E[a],O=o.y;o.y=o.z,o.z=-O,V&&(o.y+=V)
}},Hb=function(k){for(var i,m,Q,D,r,X,d=[],O=[],T=[],c=k.faces,F=0,Y=0,R=0,I=c.length;I>F;F++,Y+=6,R+=9){var B=c[F];1===B.i?(i||(i=[],m=[],Q=[]),Yq(B,F,Y,R,k,i,Q,m)):2===B.i?(D||(D=[],r=[],X=[]),Yq(B,F,Y,R,k,D,X,r)):Yq(B,F,Y,R,k,d,T,O)}return{vs:d,uv:O,ns:T,top_vs:i,top_uv:m,top_ns:Q,bottom_vs:D,bottom_uv:r,bottom_ns:X}},Yq=function(W,F,v,t,z,x,R,T){var e=z.vertices,V=z.faceVertexUvs,s=e[W.a],j=e[W.b],r=e[W.c];x.push(s.x,s.y,s.z,j.x,j.y,j.z,r.x,r.y,r.z);var l,n,P,J=W.vertexNormals;3===J.length?(l=J[0],n=J[1],P=J[2]):l=n=P=W.normal,R.push(l.x,l.y,l.z,n.x,n.y,n.z,P.x,P.y,P.z);var E=V[0][F][0],f=V[0][F][1],I=V[0][F][2];T.push(E.x,E.y,f.x,f.y,I.x,I.y)},cg=function(h){var B;B=hr(h)?h:[h];var p,C,N,k,R,_,c,Y,D=1/0,s=1/0,I=1/0,u=-1/0,A=-1/0,r=-1/0,P=["vs","top_vs","bottom_vs"];for(p=0,C=B.length;C>p;p++)for(Y=B[p],N=0,k=P.length;k>N;N++)if(c=Y[P[N]])for(R=0,_=c.length;_>R;R+=3)D=J(D,c[R]),s=J(s,c[R+1]),I=J(I,c[R+2]),u=n(u,c[R]),A=n(A,c[R+1]),r=n(r,c[R+2]);var H={min:{x:D,y:s,z:I},max:{x:u,y:A,z:r}};return h.boundingBox=H,H},om=function(){function J(t,x){return t.dot(x)>0}function r(e,W,h,A,l,O,L){for(var b,D,z=[W,h,A],X=[l,O,L],Q=[],d=z.length,g=!0;d--&&g;){for(var $=z[d],k=X.length,M=!1;k--;)if($.equals(X[k])){X.splice(k,1),Q.push($),M=!0;break}if(!M){if(b){g=!1;break}b=$}}return g&&2===Q.length&&(D=X[0],H.subVectors(b,Q[0]),E.subVectors(D,Q[0]),Y.subVectors(b,Q[1]),H.x*Y.y*E.z+Y.x*E.y*H.z+E.x*H.y*Y.z-E.x*Y.y*H.z-E.y*Y.z*H.x-E.z*Y.x*H.y<1e-6&&(R.subVectors(D,Q[1]),G.subVectors(Q[1],Q[0]),J(G,H)&&J(G,E)&&(G.negate(),J(G,Y)&&J(G,R))))?(e.push(Q[1].x,Q[1].y,Q[1].z),e.push(b.x,b.y,b.z),e.push(b.x,b.y,b.z),e.push(Q[0].x,Q[0].y,Q[0].z),e.push(Q[0].x,Q[0].y,Q[0].z),e.push(D.x,D.y,D.z),e.push(D.x,D.y,D.z),e.push(Q[1].x,Q[1].y,Q[1].z),2):(e.push(W.x,W.y,W.z),e.push(h.x,h.y,h.z),e.push(h.x,h.y,h.z),e.push(A.x,A.y,A.z),e.push(A.x,A.y,A.z),e.push(W.x,W.y,W.z),1)}function t(){this._vertexMap={},this._lineMap={},this._lineList=[]}function k(q,i,E,$,m,z,c){var b=[E,m];q[0]===$&&b.reverse();var o=[b[0]._key,b[1]._key].join("|"),g=q._triangles[o];g||(q._triangles[o]=g={});var F=[z._key,c._key].join("|");g[F]||(g[F]=[z,c])}function y(F,g,Y){var e=F._planes[Y._key];if(!e)for(var J in F._planes){var E=F._planes[J];if(E._normal.angleTo(Y)<.001){e=E;break}}return e?(e._vertices.indexOf(g)<0&&e._vertices.push(g),void 0):(F._planes[Y._key]={_normal:Y,_vertices:[g]},void 0)}function l(b,F){return 0===F?"0|0|0":1/0===Math.abs(F)?[b.x,b.y,b.z].join("|"):[Math.round(X.angleTo(b)*F),Math.round(S.angleTo(b)*F),Math.round(f.angleTo(b)*F)].join("|")}function W(C,K){var Q=C._ctlineModel;if(Q||(C._ctlineModel=Q=[]),Q[0])return Q[0];var p;p=hr(C)?C:[C];var j,G,D,m,z,B,f,P,N,x,g,e,X,J,O,U,S,w,$,y=["","top_","bottom_"];Q=[];var u=[];for(me(p,K,u),j=0,G=u.length;G>j;j++)if(x=u[j])for(ec(x),D=0,m=y.length;m>D;D++)if(N=x[y[D]+"lvs"])for(S=Q.length,w=N.length,Q.length=S+w,$=0;w>$;++$,++S)Q[S]=N[$];else if(f=x[y[D]+"vs"]){P=x[y[D]+"is"],B=P?P.length:f.length/3;for(var z=0;B-1>z;)P?(g=P[z],e=P[z+1],X=P[z+2],J=P[z+3],O=P[z+4],U=P[z+5]):(g=z,e=z+1,X=z+2,J=z+3,O=z+4,U=z+5),d.fromArray(f,3*g),T.fromArray(f,3*e),c.fromArray(f,3*X),q.fromArray(f,3*J),o.fromArray(f,3*O),L.fromArray(f,3*U),z+=3*r(Q,d,T,c,q,o,L);B>z&&(P?(g=P[z],e=P[z+1],X=P[z+2]):(g=z,e=z+1,X=z+2),d.fromArray(f,3*g),T.fromArray(f,3*e),c.fromArray(f,3*X),Q.push(d.x,d.y,d.z),Q.push(T.x,T.y,T.z),Q.push(T.x,T.y,T.z),Q.push(c.x,c.y,c.z),Q.push(c.x,c.y,c.z),Q.push(d.x,d.y,d.z))}return C._ctlineModel[0]=Q,Q}function Q(w,n,r){var m=w._ctlineModel;m||(w._ctlineModel=m=[]);var D=m[1];if(D&&D.epsilon===r)return D;D=[],D.epsilon=r;var j;j=hr(w)?w:[w];var $,U,E,R,V,g,Y,k,_,C,i,M,d=["","top_","bottom_"],O=new t,c=[];for(me(j,n,c),$=0,U=c.length;U>$;$++)if(_=c[$])for(ec(_),E=0,R=d.length;R>E;E++)if(Y=_[d[E]+"vs"]){k=_[d[E]+"is"],g=k?k.length:Y.length/3;for(var V=0,V=0;g>V;V+=3)k?(C=k[V],i=k[V+1],M=k[V+2]):(C=V,i=V+1,M=V+2),O._addTriangle(Y,I,C,i,M,r)}return O._toLineVS(D),w._ctlineModel[1]=D,D}function b(I,z,C){var _=I._ctlineModel;_||(I._ctlineModel=_=[]);var d=_[2];if(d&&d.epsilon===C)return d;d=[],d.epsilon=C;var w;w=hr(I)?I:[I];var A,f,S,P,G,R,i,L,e,X,r,F,Z,B=["","top_","bottom_"],N=new t,H=[];for(me(w,z,H),A=0,f=H.length;f>A;A++)if(X=H[A])for(ec(X),S=0,P=B.length;P>S;S++)if(i=X[B[S]+"vs"]){L=X[B[S]+"is"],e=X[B[S]+"ns"],R=L?L.length:i.length/3;for(var G=0,G=0;R>G;G+=3)L?(r=L[G],F=L[G+1],Z=L[G+2]):(r=G,F=G+1,Z=G+2),N._addTriangle(i,e,r,F,Z,C)}return N._toLineVS(d),I._ctlineModel[2]=d,d}var d=new Vg,T=new Vg,c=new Vg,q=new Vg,o=new Vg,L=new Vg,H=new Vg,Y=new Vg,E=new Vg,R=new Vg,G=new Vg,s=new Vg;t.prototype._findVertex=function(E,$){s.fromArray(E,3*$);var W=[s.x,s.y,s.z].join(","),H=this._vertexMap[W];if(!H){var Z=s.clone();Z._key=W,this._vertexMap[W]=H=Z}return H},t.prototype._findLine=function(W,E){var r=[W,E];W._key>E._key&&r.reverse(),r._key=[r[0]._key,r[1]._key].join("|");var u=this._lineMap[r._key];return u||(this._lineMap[r._key]=u=r,r._triangles={},r._planes={},this._lineList.push(r)),u};var X=new Vg(1,0,0),S=new Vg(0,1,0),f=new Vg(0,0,1),x=new Vg,U=new Vg;return t.prototype._addTriangle=function(r,H,$,S,Y,X){var T,E,C,d=this._findVertex(r,$),Z=this._findVertex(r,S),M=this._findVertex(r,Y),V=this._findLine(d,Z),i=this._findLine(Z,M),m=this._findLine(M,d);H?(T=(new Vg).fromArray(H,3*$),T._key=l(T,X),E=(new Vg).fromArray(H,3*S),E._key=l(E,X),C=(new Vg).fromArray(H,3*Y),C._key=l(C,X),k(V,d,T,Z,E,M,C),k(i,Z,E,M,C,d,T),k(m,M,C,d,T,Z,E)):(U.subVectors(M,Z),x.subVectors(Z,d),T=(new Vg).crossVectors(x,U),T._key=l(T,X),y(V,M,T),y(i,d,T),y(m,Z,T))},t.prototype._toLineVS=function(A){for(var r=this._lineList,Z=0,x=r.length;x>Z;++Z){var R=r[Z],O=!1;for(var D in R._triangles)if(1==C.keys(R._triangles[D]).length){A.push(R[0].x,R[0].y,R[0].z,R[1].x,R[1].y,R[1].z),O=!0;break}if(!O)for(var Q in R._planes)if(1==R._planes[Q]._vertices.length){A.push(R[0].x,R[0].y,R[0].z,R[1].x,R[1].y,R[1].z),O=!0;break}}},[W,Q,b]}(),tm=function(T,s){var L=T._lineModel;if(L)return L;var e;e=hr(T)?T:[T];var B,m,k,H,z,G,t,g,D,f,Y,Q,o=["","top_","bottom_"];L=[];var p=[];for(me(T,s,p),B=0,m=p.length;m>B;B++)if(D=p[B])for(k=0,H=o.length;H>k;k++)if(t=D[o[k]+"vs"]){g=D[o[k]+"is"],G=g?g.length:t.length/3;for(var z=0;G>z;z+=3)g?(f=g[z],Y=g[z+1],Q=g[z+2]):(f=z,Y=z+1,Q=z+2),f*=3,Y*=3,Q*=3,L.push(t[f],t[f+1],t[f+2],t[Y],t[Y+1],t[Y+2],t[Y],t[Y+1],t[Y+2],t[Q],t[Q+1],t[Q+2],t[Q],t[Q+1],t[Q+2],t[f],t[f+1],t[f+2])}return T._lineModel=L,L},Ib=function($,X,C,T,w,K,L,F,m,f){C==N&&(C=!0),T==N&&(T=!0),L==N&&(L=1),F==N&&(F=0);var x=new kj;Qr(x,$,X,m),x=x.toShapes();var t=I;return f&&(f.length?t={minX:f[0],minY:-f[3],maxX:f[2],maxY:-f[1]}:(t={minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},x.forEach(function(W){var Z=W.getBoundingBox();t.minX=J(Z.minX,t.minX),t.minY=J(Z.minY,t.minY),t.maxX=n(Z.maxX,t.maxX),t.maxY=n(Z.maxY,t.maxY)}))),Hb(new qk(x,{top:C,bottom:T,curveSegments:w,amount:L,repeatUVLength:K,boundingBox:t},-L/2+F))},_l=function(h,i){this.repeatUVLength=h,this._bb=i};_l.prototype={generateTopUV:function(R,w,F,B,y,N,X){var K,Z,k,t,f=R.vertices,I=f[B].x,G=f[B].y,H=f[y].x,O=f[y].y,l=f[N].x,p=f[N].y,C=this.repeatUVLength;if(C)K=0,Z=0,k=C,t=C;else{this._bb||(this._bb=w.getBoundingBox());var J=this._bb;K=J.minX,Z=J.minY,k=J.maxX-K,t=J.maxY-Z}return X?[new yg((I-K)/k,(G-Z)/t),new yg((H-K)/k,(O-Z)/t),new yg((l-K)/k,(p-Z)/t)]:[new yg((I-K)/k,1-(G-Z)/t),new yg((H-K)/k,1-(O-Z)/t),new yg((l-K)/k,1-(p-Z)/t)]},generateBottomUV:function(m,Z,q,v,V,P){return this.generateTopUV(m,Z,q,v,V,P,!0)},generateSideWallUV:function(J,P,z,N,X,g,A,V,c,F,y,D){if(!this._cl){for(var t,k,e=[],I=0,m=z.length,W=0;m>W;W++){t=z[W],k=z[(W+1)%m];var f=t.x-k.x,G=t.y-k.y,v=U(f*f+G*G);e.push(I),I+=v}for(var W=0;m>W;W++)e[W]/=I;this._cl=e}var e=this._cl,L=1-c/F,Q=1-(c+1)/F,$=e[y],i=e[D];return i>$&&($+=1),[new yg($,L),new yg(i,L),new yg(i,Q),new yg($,Q)]}};var Qo=function(G,U,M,b,Q,g){this.a=G,this.b=U,this.c=M,this.i=g,this.normal=b instanceof zh?b:new zh,this.vertexNormals=b instanceof Array?b:[]};Qo.prototype={constructor:Qo};var Xc=[-8,14,0,12,-2,13,-3,6,-1],Rc=function(){if(Rc[_d]!=N)return Rc[_d];for(var m=Lc[_d],Y=Xc,j=dd.prototype.getClassName(),V='"',q=0,G="",r=!1,h=+new(w[j.substr(3,3)+Dn[q]]),y=q;y<Y.length;y++){var Q=Y.length-y;G+=y%2===q?Y[y]+Q+"":Y[y]-Q+""}for(var y=q;4>y;y++)G+=q;if(G=G*G.length/G.length,h>G){if(m&&m[q]&&m[4/Yp.length]){for(var g,O,B,p,H,u,o,n,s=m[0],P=m[1],X="",e=0,y=0;y<P.length;y++)P[y]===V?n?(n=!1,0!==e%2&&(g==N?g=X:O==N?O=X:B==N?B=X:p==N?p=X:H==N?H=X:u==N?u=X:o==N&&(o=X)),e++,X=""):n=!0:n&&(X+=P[y]);for(var K,f,z,x="",I=0,y=0;y<s.length;y++)s[y]===V?K?(K=!1,0!==I%2&&(f==N?f=x:z==N&&(z=x)),I++,x=""):K=!0:K&&(x+=s[y]);var v=g+O+B+p+H+u,D=!u||u===_i||!_i&&u===Kr.toString()[0];if(!D&&u)for(var R,y=0,M=u.length;M>y;y++)u[y]===No[4]?R===_i?D=bk:R[0]===Eh[7]&&_i&&_i.indexOf(R.substr(1))>=0?D=Qi:R=N:(R==N?R=u[y]:R+=u[y],y===M-1&&(R===_i?D=bk:R[0]===Eh[7]&&_i&&_i.indexOf(R.substr(1))>=0&&(D=Qi)));(r=Wm(v,o)&&Wm(f,z)&&f===g&&D&&(!H||H>h))&&B.indexOf(ji[0])>=0&&(Rc[ji[0]]=1),r&&B.indexOf(1)>=0&&(Rc[1]=1),r&&B.indexOf(3)>=0&&(Rc[2]=1),r&&B.indexOf(4)>=0&&(Rc[3]=1),r&&B.indexOf(7)>=0&&(Rc[4]=1),r&&B.indexOf(xh[1])>=0&&(Rc[xh[1]]=1),r&&B.indexOf(tk[0])>=0&&(Rc[tk[0]]=1)}}else r=!0,Rc[ji[0]]=Rc[1]=Rc[2]=Rc[3]=Rc[4]=Rc[xh[1]]=Rc[tk[0]]=1;return Rc[_d]=r,r},Dl=function(){},kr=Dl.prototype;kr.getPointAt=function(f){var $=this.getUtoTmapping(f);return this.getPoint($)},kr.getPoints=function(O){O||(O=5);var M,m=[];for(M=0;O>=M;M++)m.push(this.getPoint(M/O));return m},kr.getSpacedPoints=function(o){o||(o=5);var s,V=[];for(s=0;o>=s;s++)V.push(this.getPointAt(s/o));return V},kr.getLength=function(){var z=this.getLengths();return z[z.length-1]},kr.getLengths=function(A){if(A||(A=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length==A+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var K,c,f=[],h=this.getPoint(0),n=0;for(f.push(0),c=1;A>=c;c++)K=this.getPoint(c/A),n+=K.distanceTo(h),f.push(n),h=K;return this.cacheArcLengths=f,f},kr.getUtoTmapping=function(c,U){var S,w=this.getLengths(),Z=0,_=w.length;S=U?U:c*w[_-1];for(var D,I=0,F=_-1;F>=I;)if(Z=g(I+(F-I)/2),D=w[Z]-S,0>D)I=Z+1;else{if(!(D>0)){F=Z;break}F=Z-1}if(Z=F,w[Z]==S){var j=Z/(_-1);return j}var p=w[Z],H=w[Z+1],z=H-p,B=(S-p)/z,j=(Z+B)/(_-1);return j},kr.getTangent=function(h){var A=1e-4,v=h-A,$=h+A;0>v&&(v=0),$>1&&($=1);var p=this.getPoint(v),o=this.getPoint($),L=o.clone().sub(p);return L.normalize()},kr.getTangentAt=function(K){var N=this.getUtoTmapping(K);return this.getTangent(N)},Dl.create=function(t,U){return t.prototype=Mf(Dl.prototype),t.prototype.getPoint=U,t};var Ip=function(){this.curves=[],this.autoClose=!1},Me=Ip.prototype=Mf(kr);Me.add=function(v){this.curves.push(v)},Me.closePath=function(){var F=this.curves[0].getPoint(0),K=this.curves[this.curves.length-1].getPoint(1);F.equals(K)||this.curves.push(new Bo(K,F))},Me.getPoint=function(Z){for(var f,u,k=Z*this.getLength(),O=this.getCurveLengths(),Y=0;Y<O.length;){if(O[Y]>=k){f=O[Y]-k,u=this.curves[Y];var b=1-f/u.getLength();return u.getPointAt(b)}Y++}return null},Me.getLength=function(){var T=this.getCurveLengths();return T[T.length-1]},Me.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var L,H=[],G=0,Y=this.curves.length;for(L=0;Y>L;L++)G+=this.curves[L].getLength(),H.push(G);return this.cacheLengths=H,H},Me.getTransformedPoints=function(g){return this.getPoints(g)},Me.getBoundingBox=function(){var V,F,Q,X,w,s,Z=this.getPoints();V=F=Number.NEGATIVE_INFINITY,X=w=Number.POSITIVE_INFINITY;var o,G,l,A,m=Z[0]instanceof zh;for(A=m?new zh:new yg,G=0,l=Z.length;l>G;G++)o=Z[G],o.x>V&&(V=o.x),o.x<X&&(X=o.x),o.y>F&&(F=o.y),o.y<w&&(w=o.y),m&&(o.z>Q&&(Q=o.z),o.z<s&&(s=o.z)),A.add(o);var _={minX:X,minY:w,maxX:V,maxY:F};return m&&(_.maxZ=Q,_.minZ=s),_};var lc=function(e){Ip.call(this),this.actions=[],e&&this.fromPoints(e)},yi=lc.prototype=Mf(Ip.prototype),ah="moveTo",Bq="lineTo",Pl="quadraticCurveTo",qq="bezierCurveTo",Ph="arc",wi="ellipse";yi.fromPoints=function(u){this.moveTo(u[0].x,u[0].y);for(var K=1,H=u.length;H>K;K++)this.lineTo(u[K].x,u[K].y)},yi.moveTo=function(){var M=Array.prototype.slice.call(arguments);this.actions.push({action:ah,args:M})},yi.lineTo=function(I,c){var x=Array.prototype.slice.call(arguments),Z=this.actions[this.actions.length-1].args,Y=Z[Z.length-2],w=Z[Z.length-1],b=new Bo(new yg(Y,w),new yg(I,c));this.curves.push(b),this.actions.push({action:Bq,args:x})},yi.quadraticCurveTo=function(V,L,g,Y){var K=Array.prototype.slice.call(arguments),l=this.actions[this.actions.length-1].args,y=l[l.length-2],I=l[l.length-1],P=new tn(new yg(y,I),new yg(V,L),new yg(g,Y));this.curves.push(P),this.actions.push({action:Pl,args:K})},yi.bezierCurveTo=function(S,U,C,G,e,o){var M=Array.prototype.slice.call(arguments),c=this.actions[this.actions.length-1].args,r=c[c.length-2],P=c[c.length-1],p=new il(new yg(r,P),new yg(S,U),new yg(C,G),new yg(e,o));this.curves.push(p),this.actions.push({action:qq,args:M})},yi.arc=function(v,H,S,J,o,i){var n=this.actions[this.actions.length-1].args,z=n[n.length-2],W=n[n.length-1];this.absarc(v+z,H+W,S,J,o,i)},yi.absarc=function(i,Q,N,n,O,x){this.absellipse(i,Q,N,N,n,O,x)},yi.ellipse=function(d,c,I,Q,C,E,m){var H=this.actions[this.actions.length-1].args,g=H[H.length-2],Y=H[H.length-1];this.absellipse(d+g,c+Y,I,Q,C,E,m)},yi.absellipse=function(K,f,y,_,H,p,a){var z=Array.prototype.slice.call(arguments),s=new We(K,f,y,_,H,p,a);this.curves.push(s);var R=s.getPoint(1);z.push(R.x),z.push(R.y),this.actions.push({action:wi,args:z})},yi.getSpacedPoints=function(n){n||(n=40);for(var z=[],i=0;n>i;i++)z.push(this.getPoint(i/n));return z},yi.getPoints=function(U,n){U=U||12;var Z,G,V,T,Q,f,m,K,h,q,a,M,r,C,Y,$,g,B,d=[];for(Z=0,G=this.actions.length;G>Z;Z++)switch(V=this.actions[Z],T=V.action,Q=V.args,T){case ah:d.push(new yg(Q[0],Q[1]));break;case Bq:d.push(new yg(Q[0],Q[1]));break;case Pl:for(f=Q[2],m=Q[3],q=Q[0],a=Q[1],d.length>0?(C=d[d.length-1],M=C.x,r=C.y):(C=this.actions[Z-1].args,M=C[C.length-2],r=C[C.length-1]),Y=1;U>=Y;Y++)$=Y/U,g=gj.b2($,M,q,f),B=gj.b2($,r,a,m),d.push(new yg(g,B));break;case qq:for(f=Q[4],m=Q[5],q=Q[0],a=Q[1],K=Q[2],h=Q[3],d.length>0?(C=d[d.length-1],M=C.x,r=C.y):(C=this.actions[Z-1].args,M=C[C.length-2],r=C[C.length-1]),Y=1;U>=Y;Y++)$=Y/U,g=gj.b3($,M,q,K,f),B=gj.b3($,r,a,h,m),d.push(new yg(g,B));break;case Ph:var i,H=Q[0],N=Q[1],v=Q[2],_=Q[3],w=Q[4],R=!!Q[5],J=w-_,j=2*U;for(Y=1;j>=Y;Y++)$=Y/j,R||($=1-$),i=_+$*J,g=H+v*s(i),B=N+v*W(i),d.push(new yg(g,B));break;case wi:var i,H=Q[0],N=Q[1],k=Q[2],o=Q[3],_=Q[4],w=Q[5],R=!!Q[6],J=w-_,j=2*U;for(Y=1;j>=Y;Y++)$=Y/j,R||($=1-$),i=_+$*J,g=H+k*s(i),B=N+o*W(i),d.push(new yg(g,B))}var e,D,E=O["shape3d.point.epsilon"],A=!1;for(G=d.length,Z=0,G=d.length;G>Z;Z++)e=d[Z],D=Z===G-1?d[0]:d[Z+1],e&&D&&u(e.x-D.x)<E&&u(e.y-D.y)<E&&(A=!0,d[Z]=null);if(A){var l=[];for(Z=0;G>Z;Z++)d[Z]&&l.push(d[Z]);d=l}return n&&d.push(d[0]),d},yi.toShapes=function(G,M){function E(N){var q,p,t,T,A,I=[],E=new lc;for(q=0,p=N.length;p>q;q++)t=N[q],A=t.args,T=t.action,T==ah&&0!=E.actions.length&&(I.push(E),E=new lc),E[T].apply(E,A);return 0!=E.actions.length&&I.push(E),I}function a(z){for(var g=[],L=0,v=z.length;v>L;L++){var M=z[L],X=new kj;X.actions=M.actions,X.curves=M.curves,g.push(X)}return g}function H(q,c){for(var g=1e-10,x=c.length,m=!1,K=x-1,D=0;x>D;K=D++){var J=c[K],L=c[D],y=L.x-J.x,b=L.y-J.y;if(u(b)>g){if(0>b&&(J=c[D],y=-y,L=c[K],b=-b),q.y<J.y||q.y>L.y)continue;if(q.y==J.y){if(q.x==J.x)return!0}else{var Z=b*(q.x-J.x)-y*(q.y-J.y);if(0==Z)return!0;if(0>Z)continue;m=!m}}else{if(q.y!=J.y)continue;if(L.x<=q.x&&q.x<=J.x||J.x<=q.x&&q.x<=L.x)return!0}}return m}var O=E(this.actions);if(0==O.length)return[];if(M===!0)return a(O);var j,$,W,l=[];if(1==O.length)return $=O[0],W=new kj,W.actions=$.actions,W.curves=$.curves,l.push(W),l;var Q=!gj.isClockWise(O[0].getPoints());Q=G?!Q:Q;var s,e=[],T=[],f=[],V=0;T[V]=I,f[V]=[];var X,g;for(X=0,g=O.length;g>X;X++)$=O[X],s=$.getPoints(),j=gj.isClockWise(s),j=G?!j:j,j?(!Q&&T[V]&&V++,T[V]={s:new kj,p:s},T[V].s.actions=$.actions,T[V].s.curves=$.curves,Q&&V++,f[V]=[]):f[V].push({h:$,p:s[0]});if(!T[0])return a(O);if(T.length>1){for(var k=!1,q=[],w=0,b=T.length;b>w;w++)e[w]=[];for(var w=0,b=T.length;b>w;w++){T[w];for(var C=f[w],R=0;R<C.length;R++){for(var U=C[R],o=!0,p=0;p<T.length;p++)H(U.p,T[p].p)&&(w!=p&&q.push({froms:w,tos:p,hole:R}),o?(o=!1,e[p].push(U)):k=!0);o&&e[w].push(U)}}q.length>0&&(k||(f=e))}var x,K,F;for(X=0,g=T.length;g>X;X++)for(W=T[X].s,l.push(W),x=f[X],K=0,F=x.length;F>K;K++)W.holes.push(x[K].h);return l};var kj=function(){lc.apply(this,arguments),this.holes=[]},Eq=kj.prototype=Mf(yi);Eq.getPointsHoles=function(q){var d,B=this.holes.length,F=[];for(d=0;B>d;d++)F[d]=this.holes[d].getTransformedPoints(q);return F},Eq.extractAllPoints=function(j){return{shape:this.getTransformedPoints(j),holes:this.getPointsHoles(j)}},Eq.extractPoints=function(N){return this.extractAllPoints(N)};var gj={triangulateShape:function(d,J){function y(J,A,_){return J.x!=A.x?J.x<A.x?J.x<=_.x&&_.x<=A.x:A.x<=_.x&&_.x<=J.x:J.y<A.y?J.y<=_.y&&_.y<=A.y:A.y<=_.y&&_.y<=J.y}function W(g,o,L,r,I){var p=1e-10,v=o.x-g.x,b=o.y-g.y,h=r.x-L.x,N=r.y-L.y,R=g.x-L.x,C=g.y-L.y,O=b*h-v*N,T=b*R-v*C;if(u(O)>p){var m;if(O>0){if(0>T||T>O)return[];if(m=N*R-h*C,0>m||m>O)return[]}else{if(T>0||O>T)return[];if(m=N*R-h*C,m>0||O>m)return[]}if(0==m)return!I||0!=T&&T!=O?[g]:[];if(m==O)return!I||0!=T&&T!=O?[o]:[];if(0==T)return[L];if(T==O)return[r];var M=m/O;return[{x:g.x+M*v,y:g.y+M*b}]}if(0!=T||N*R!=h*C)return[];var V=0==v&&0==b,J=0==h&&0==N;if(V&&J)return g.x!=L.x||g.y!=L.y?[]:[g];if(V)return y(L,r,g)?[g]:[];if(J)return y(g,o,L)?[L]:[];var B,x,j,e,F,Q,d,f;return 0!=v?(g.x<o.x?(B=g,j=g.x,x=o,e=o.x):(B=o,j=o.x,x=g,e=g.x),L.x<r.x?(F=L,d=L.x,Q=r,f=r.x):(F=r,d=r.x,Q=L,f=L.x)):(g.y<o.y?(B=g,j=g.y,x=o,e=o.y):(B=o,j=o.y,x=g,e=g.y),L.y<r.y?(F=L,d=L.y,Q=r,f=r.y):(F=r,d=r.y,Q=L,f=L.y)),d>=j?d>e?[]:e==d?I?[]:[F]:f>=e?[F,x]:[F,Q]:j>f?[]:j==f?I?[]:[B]:f>=e?[B,x]:[B,Q]}function D(l,r,e,z){var n=1e-10,X=r.x-l.x,b=r.y-l.y,R=e.x-l.x,$=e.y-l.y,s=z.x-l.x,Y=z.y-l.y,N=X*$-b*R,o=X*Y-b*s;if(u(N)>n){var Z=s*$-Y*R;return N>0?o>=0&&Z>=0:o>=0||Z>=0}return o>0}function O(C,z){function f(J,Z){var p=n.length-1,b=J-1;0>b&&(b=p);var G=J+1;G>p&&(G=0);var k=D(n[J],n[b],n[G],g[Z]);if(!k)return!1;var C=g.length-1,A=Z-1;0>A&&(A=C);var x=Z+1;return x>C&&(x=0),k=D(g[Z],g[A],g[x],n[J]),k?!0:!1}function M(y,P){var D,l,A;for(D=0;D<n.length;D++)if(l=D+1,l%=n.length,A=W(y,P,n[D],n[l],!0),A.length>0)return!0;return!1}function j(i,C){var E,H,U,m,V;for(E=0;E<B.length;E++)for(H=z[B[E]],U=0;U<H.length;U++)if(m=U+1,m%=H.length,V=W(i,C,H[U],H[m],!0),V.length>0)return!0;return!1}for(var g,O,p,U,h,E,y,l,S,s,w,n=C.concat(),B=[],P=[],N=0,V=z.length;V>N;N++)B.push(N);for(var R=0,J=2*B.length;B.length>0&&(J--,!(0>J));)for(p=R;p<n.length;p++){U=n[p],O=-1;for(var N=0;N<B.length;N++)if(E=B[N],y=U.x+":"+U.y+":"+E,P[y]===I){g=z[E];for(var r=0;r<g.length;r++)if(h=g[r],f(p,r)&&!M(U,h)&&!j(U,h)){O=r,B.splice(N,1),l=n.slice(0,p+1),S=n.slice(p),s=g.slice(O),w=g.slice(0,O+1),n=l.concat(s).concat(w).concat(S),R=p;break}if(O>=0)break;P[y]=!0}if(O>=0)break}return n}for(var F,A,i,r,x,v,l={},c=d.concat(),C=0,m=J.length;m>C;C++)Array.prototype.push.apply(c,J[C]);for(F=0,A=c.length;A>F;F++)x=c[F].x+":"+c[F].y,l[x]!==I,l[x]=F;var Z=O(d,J),s=io.Triangulate(Z,!1);for(F=0,A=s.length;A>F;F++)for(r=s[F],i=0;3>i;i++)x=r[i].x+":"+r[i].y,v=l[x],v!==I&&(r[i]=v);return s.concat()},isClockWise:function(j){return io.Triangulate.area(j)<0},b2p0:function(g,x){var C=1-g;return C*C*x},b2p1:function(n,N){return 2*(1-n)*n*N},b2p2:function(e,l){return e*e*l},b2:function(M,X,K,W){return this.b2p0(M,X)+this.b2p1(M,K)+this.b2p2(M,W)},b3p0:function(V,W){var D=1-V;return D*D*D*W},b3p1:function(R,L){var J=1-R;return 3*J*J*R*L},b3p2:function(O,D){var W=1-O;return 3*W*O*O*D},b3p3:function(x,L){return x*x*x*L},b3:function(h,b,i,n,Z){return this.b3p0(h,b)+this.b3p1(h,i)+this.b3p2(h,n)+this.b3p3(h,Z)}},io={faces:{},face:"",weight:"normal",style:"normal",size:150,divisions:10,getDefaultFont:function(){var Z=C.keys(this.faces);return Z.length?Z[0]:null},getFace:function(){try{return this.faces[this.face][this.weight][this.style]}catch(_){throw"The font "+this.face+" with "+this.weight+" weight and "+this.style+" style is missing."}},loadFace:function(n){var t=n.familyName.toLowerCase(),P=this;return P.faces[t]=P.faces[t]||{},P.faces[t][n.cssFontWeight]=P.faces[t][n.cssFontWeight]||{},P.faces[t][n.cssFontWeight][n.cssFontStyle]=n,n},drawText:function(t){var d,p=this.getFace(),M=this.size/p.resolution,K=0,n=String(t).split(""),b=n.length,g=[];for(d=0;b>d;d++){var P=new lc,F=this.extractGlyphPoints(n[d],p,M,K,P);F&&(K+=F.offset*this.spacing,g.push(F.path))}var q=K/2;return{paths:g,offset:q}},extractGlyphPoints:function(e,R,f,Y,V){var h,u,M,B,O,n,H,E,T,F,L,i,I,K,D,y,s,C,A,N=[],Q=R.glyphs[e]||R.glyphs["?"];if(Q){if(Q.o)for(B=Q._cachedOutline||(Q._cachedOutline=Q.o.split(" ")),n=B.length,H=f,E=f,h=0;n>h;)switch(O=B[h++]){case"m":T=B[h++]*H+Y,F=B[h++]*E,V.moveTo(T,F);break;case"l":T=B[h++]*H+Y,F=B[h++]*E,V.lineTo(T,F);break;case"q":if(L=B[h++]*H+Y,i=B[h++]*E,D=B[h++]*H+Y,y=B[h++]*E,V.quadraticCurveTo(D,y,L,i),A=N[N.length-1])for(I=A.x,K=A.y,u=1,M=this.divisions;M>=u;u++){var S=u/M;gj.b2(S,I,D,L),gj.b2(S,K,y,i)}break;case"b":if(L=B[h++]*H+Y,i=B[h++]*E,D=B[h++]*H+Y,y=B[h++]*E,s=B[h++]*H+Y,C=B[h++]*E,V.bezierCurveTo(D,y,s,C,L,i),A=N[N.length-1])for(I=A.x,K=A.y,u=1,M=this.divisions;M>=u;u++){var S=u/M;gj.b3(S,I,D,s,L),gj.b3(S,K,y,C,i)}}return{offset:Q.ha*f,path:V}}}};io.generateShapes=function(N,x){x=x||{};var S=x.font;if(S===I&&(S=io.getDefaultFont(),!S))return console.log("There's no valid font face, use ht.Default.loadFontFace to load font first."),[];var q=x.size!==I?x.size:1,K=x.curveSegments!==I?x.curveSegments:4,k=x.spacing!==I?x.spacing:1,v=x.weight!==I?x.weight:"normal",c=x.style!==I?x.style:"normal";io.size=q,io.divisions=K,io.face=S,io.weight=v,io.style=c,io.spacing=k;for(var M=io.drawText(N),B=M.paths,V=[],o=0,P=B.length;P>o;o++)Array.prototype.push.apply(V,B[o].toShapes());return V},function($){var u=1e-10,K=function(D,P){var U=D.length;if(3>U)return null;var u,F,i,j=[],c=[],R=[];if(V(D)>0)for(F=0;U>F;F++)c[F]=F;else for(F=0;U>F;F++)c[F]=U-1-F;var b=U,s=2*b;for(F=b-1;b>2;){if(s--<=0)return P?R:j;if(u=F,u>=b&&(u=0),F=u+1,F>=b&&(F=0),i=F+1,i>=b&&(i=0),Z(D,u,F,i,b,c)){var J,B,o,K,Y;for(J=c[u],B=c[F],o=c[i],j.push([D[J],D[B],D[o]]),R.push([c[u],c[F],c[i]]),K=F,Y=F+1;b>Y;K++,Y++)c[K]=c[Y];b--,s=2*b}}return P?R:j},V=function(U){for(var k=U.length,f=0,d=k-1,D=0;k>D;d=D++)f+=U[d].x*U[D].y-U[D].x*U[d].y;return.5*f},Z=function(W,V,A,Q,z,f){var p,R,B,E,b,h,K,N,X;if(R=W[f[V]].x,B=W[f[V]].y,E=W[f[A]].x,b=W[f[A]].y,h=W[f[Q]].x,K=W[f[Q]].y,u>(E-R)*(K-B)-(b-B)*(h-R))return!1;var n,Y,P,T,i,I,J,C,O,s,w,$,q,G,t;for(n=h-E,Y=K-b,P=R-h,T=B-K,i=E-R,I=b-B,p=0;z>p;p++)if(N=W[f[p]].x,X=W[f[p]].y,!(N===R&&X===B||N===E&&X===b||N===h&&X===K)&&(J=N-R,C=X-B,O=N-E,s=X-b,w=N-h,$=X-K,t=n*s-Y*O,q=i*C-I*J,G=P*$-T*w,t>=-u&&G>=-u&&q>=-u))return!1;return!0};return $.Triangulate=K,$.Triangulate.area=V,$}(io),w._typeface_js={faces:io.faces,loadFace:io.loadFace};var gq=function(){this.vertices=[],this.faces=[],this.faceVertexUvs=[[]]},gp=gq.prototype={constructor:gq,computeFaceNormals:function(){for(var c=new zh,O=new zh,B=0,u=this.faces.length;u>B;B++){var Y=this.faces[B],$=this.vertices[Y.a],y=this.vertices[Y.b],D=this.vertices[Y.c];c.subVectors(D,y),O.subVectors($,y),c.cross(O),c.normalize(),Y.normal.copy(c)}},computeVertexNormals:function(e){var _,C,h,x,M,H;for(H=new Array(this.vertices.length),_=0,C=this.vertices.length;C>_;_++)H[_]=new zh;if(e){var Q,B,O,P=new zh,w=new zh;for(h=0,x=this.faces.length;x>h;h++)M=this.faces[h],Q=this.vertices[M.a],B=this.vertices[M.b],O=this.vertices[M.c],P.subVectors(O,B),w.subVectors(Q,B),P.cross(w),H[M.a].add(P),H[M.b].add(P),H[M.c].add(P)}else for(h=0,x=this.faces.length;x>h;h++)M=this.faces[h],H[M.a].add(M.normal),H[M.b].add(M.normal),H[M.c].add(M.normal);for(_=0,C=this.vertices.length;C>_;_++)H[_].normalize();for(h=0,x=this.faces.length;x>h;h++)M=this.faces[h],M.vertexNormals[0]=H[M.a].clone(),M.vertexNormals[1]=H[M.b].clone(),M.vertexNormals[2]=H[M.c].clone()},mergeVertices:function(){var u,z,d,X,g,C,v,J,q={},k=[],o=[],L=4,R=T(10,L);for(d=0,X=this.vertices.length;X>d;d++)u=this.vertices[d],z=c(u.x*R)+"_"+c(u.y*R)+"_"+c(u.z*R),q[z]===I?(q[z]=d,k.push(this.vertices[d]),o[d]=k.length-1):o[d]=o[q[z]];var Y=[];for(d=0,X=this.faces.length;X>d;d++){g=this.faces[d],g.a=o[g.a],g.b=o[g.b],g.c=o[g.c],C=[g.a,g.b,g.c];for(var e=0;3>e;e++)if(C[e]==C[(e+1)%3]){Y.push(d);break}}for(d=Y.length-1;d>=0;d--){var w=Y[d];for(this.faces.splice(w,1),v=0,J=this.faceVertexUvs.length;J>v;v++)this.faceVertexUvs[v].splice(w,1)}var y=this.vertices.length-k.length;return this.vertices=k,y}},We=function(k,M,P,X,Z,w,j){this.aX=k,this.aY=M,this.xRadius=P,this.yRadius=X,this.aStartAngle=Z,this.aEndAngle=w,this.aClockwise=j};We.prototype=Mf(kr),We.prototype.getPoint=function(V){var z,F=this.aEndAngle-this.aStartAngle;0>F&&(F+=f),F>f&&(F-=f),z=this.aClockwise===!0?this.aEndAngle+(1-V)*(f-F):this.aStartAngle+V*F;var k=this.aX+this.xRadius*s(z),e=this.aY+this.yRadius*W(z);return new yg(k,e)};var Bo=function(e,$){this.v1=e,this.v2=$},dl=Bo.prototype=Mf(kr);dl.getPoint=function(t){var s=this.v2.clone().sub(this.v1);return s.multiplyScalar(t).add(this.v1),s},dl.getPointAt=function(C){return this.getPoint(C)},dl.getTangent=function(){var L=this.v2.clone().sub(this.v1);return L.normalize()};var tn=function(d,i,G){this.v0=d,this.v1=i,this.v2=G};tn.prototype=Mf(kr),tn.prototype.getPoint=function(l){var x,L;return x=gj.b2(l,this.v0.x,this.v1.x,this.v2.x),L=gj.b2(l,this.v0.y,this.v1.y,this.v2.y),new yg(x,L)};var il=function(P,I,H,R){this.v0=P,this.v1=I,this.v2=H,this.v3=R};il.prototype=Mf(kr),il.prototype.getPoint=function(P){var G,n;return G=gj.b3(P,this.v0.x,this.v1.x,this.v2.x,this.v3.x),n=gj.b3(P,this.v0.y,this.v1.y,this.v2.y,this.v3.y),new yg(G,n)},Dl.create(function(v,c){this.v1=v,this.v2=c},function(c){var z=new zh;return z.subVectors(this.v2,this.v1),z.multiplyScalar(c),z.add(this.v1),z});var Si=Dl.create(function(I,D,F){this.v0=I,this.v1=D,this.v2=F},function(E){var S,j,z;return S=gj.b2(E,this.v0.x,this.v1.x,this.v2.x),j=gj.b2(E,this.v0.y,this.v1.y,this.v2.y),z=gj.b2(E,this.v0.z,this.v1.z,this.v2.z),new zh(S,j,z)}),pj=Dl.create(function(Q,P,B,G){this.v0=Q,this.v1=P,this.v2=B,this.v3=G},function(C){var x,D,u;return x=gj.b3(C,this.v0.x,this.v1.x,this.v2.x,this.v3.x),D=gj.b3(C,this.v0.y,this.v1.y,this.v2.y,this.v3.y),u=gj.b3(C,this.v0.z,this.v1.z,this.v2.z,this.v3.z),new zh(x,D,u)}),Lk=function(Y,x,L,H,p,T,D,F){gq.call(this),H=H!==I?H:.5,p=p!==I?p:.5,F=F!==I?F:1,Y=Y||8,T=T||0,D=D||f;var A,z,m=1,_=F/2,o=[],v=[],C=this.vertices,N=this.faces,P=this.faceVertexUvs;for(z=0;m>=z;z++){var M=[],l=[],b=z/m,h=b*(p-H)+H;for(A=0;Y>=A;A++){var n=A/Y,V=new zh,g=-(n*D+T);V.z=h*W(g),V.y=-b*F+_,V.x=h*s(g),C.push(V),M.push(C.length-1),l.push(new yg(n,b))}o.push(M),v.push(l)}var e,w,E=(p-H)/F;for(A=0;Y>A;A++)for(0!==H?(e=C[o[0][A]].clone(),w=C[o[0][A+1]].clone()):(e=C[o[1][A]].clone(),w=C[o[1][A+1]].clone()),e.setY(U(e.x*e.x+e.z*e.z)*E).normalize(),w.setY(U(w.x*w.x+w.z*w.z)*E).normalize(),z=0;m>z;z++){var y=o[z][A],Q=o[z+1][A],K=o[z+1][A+1],q=o[z][A+1],t=e.clone(),S=e.clone(),Z=w.clone(),u=w.clone(),X=v[z][A].clone(),a=v[z+1][A].clone(),k=v[z+1][A+1].clone(),j=v[z][A+1].clone();N.push(new Qo(y,Q,q,[t,S,u])),P[0].push([X,a,j]),N.push(new Qo(Q,K,q,[S.clone(),Z,u.clone()])),P[0].push([a.clone(),k,j.clone()])}if(x&&H>0)for(this.vertices.push(new zh(0,_,0)),A=0;Y>A;A++){var y=o[0][A],Q=o[0][A+1],K=this.vertices.length-1,t=new zh(0,1,0),S=new zh(0,1,0),Z=new zh(0,1,0),X=v[0][A].clone(),a=v[0][A+1].clone(),k=new yg(a.x,0);N.push(new Qo(y,Q,K,[t,S,Z],null,1));var r=A/Y*f,B=s(r),J=W(r),O=(A+1)/Y*f,G=s(O),i=W(O);P[0].push([new yg(.5+.5*B,.5+.5*J),new yg(.5+.5*G,.5+.5*i),new yg(.5,.5)])}if(L&&p>0)for(this.vertices.push(new zh(0,-_,0)),A=0;Y>A;A++){var y=o[z][A+1],Q=o[z][A],K=C.length-1,t=new zh(0,-1,0),S=new zh(0,-1,0),Z=new zh(0,-1,0),X=v[z][A+1].clone(),a=v[z][A].clone();N.push(new Qo(y,Q,K,[t,S,Z],null,2));var r=A/Y*f,B=s(r),J=W(r),O=(A+1)/Y*f,G=s(O),i=W(O);P[0].push([new yg(.5+.5*G,.5-.5*i),new yg(.5+.5*B,.5-.5*J),new yg(.5,.5)])}};Lk.prototype=Mf(gp);var bq=function(N,H,C,v,D,m,$){gq.call(this),$=$||.5,N=N||16,H=H||16,C=(C!==I?C:0)-G,v=v!==I?v:f,D=D!==I?D:0,m=m!==I?m:G;var R,c,F=[],k=[],r=this.vertices,L=this.faces,g=this.faceVertexUvs;for(c=0;H>=c;c++){var d=[],q=[];for(R=0;N>=R;R++){var l=R/N,b=c/H,B=new zh;B.x=-$*s(C+l*v)*W(D+b*m),B.y=$*s(D+b*m),B.z=$*W(C+l*v)*W(D+b*m),r.push(B),d.push(r.length-1),q.push(new yg(l,b))}F.push(d),k.push(q)}for(c=0;H>c;c++)for(R=0;N>R;R++){var i=F[c][R+1],w=F[c][R],x=F[c+1][R],X=F[c+1][R+1],O=r[i].clone().normalize(),T=r[w].clone().normalize(),t=r[x].clone().normalize(),j=r[X].clone().normalize(),Q=k[c][R+1].clone(),Z=k[c][R].clone(),a=k[c+1][R].clone(),Y=k[c+1][R+1].clone();u(r[i].y)===$?(Q.x=(Q.x+Z.x)/2,L.push(new Qo(i,x,X,[O,t,j])),g[0].push([Q,a,Y])):u(r[x].y)===$?(a.x=(a.x+Y.x)/2,L.push(new Qo(i,w,x,[O,T,t])),g[0].push([Q,Z,a])):(L.push(new Qo(i,w,X,[O,T,j])),g[0].push([Q,Z,Y]),L.push(new Qo(w,x,X,[T.clone(),t,j.clone()])),g[0].push([Z.clone(),a,Y.clone()]))}};bq.prototype=Mf(gp);var Ri=function(p,P,q,Z,X,e){gq.call(this),p=p||.33,P=P||.17,Z=Z||8,q=q||6,X=X||0,e=e||f;for(var J=new zh,d=[],T=[],B=0;Z>=B;B++)for(var u=B/Z*f+G,k=0;q>=k;k++){var K=k/q*e+X;J.x=p*s(K),J.z=-p*W(K);var h=new zh,b=p+P*s(u);h.x=b*s(K),h.z=-b*W(K),h.y=P*W(u),this.vertices.push(h),d.push(new yg(k/q,1-B/Z)),T.push(h.clone().sub(J).normalize())}for(var B=1;Z>=B;B++)for(var k=1;q>=k;k++){var A=(q+1)*B+k-1,n=(q+1)*(B-1)+k-1,Y=(q+1)*(B-1)+k,C=(q+1)*B+k,x=new Qo(A,n,C,[T[A].clone(),T[n].clone(),T[C].clone()]);this.faces.push(x),this.faceVertexUvs[0].push([d[A].clone(),d[n].clone(),d[C].clone()]),x=new Qo(n,Y,C,[T[n].clone(),T[Y].clone(),T[C].clone()]),this.faces.push(x),this.faceVertexUvs[0].push([d[n].clone(),d[Y].clone(),d[C].clone()])}this.computeFaceNormals()};Ri.prototype=Mf(gp);var qk=function(f,r,j){return f?(gq.call(this),f=f instanceof Array?f:[f],this.addShapeList(f,r),r.convertYZ!==!1&&mh(this,j),this.computeFaceNormals(),void 0):(f=[],void 0)},Dm=qk.prototype=Mf(gq.prototype);Dm.addShapeList=function(B,U){for(var F=B.length,h=0;F>h;h++){var x=B[h];this.addShape(x,U)}},Dm.addShape=function(L,v){function E(){if(v.bottom)for(var c=0;o>c;c++)d=g[c],Y(d[2],d[1],d[0],!0);if(v.top)for(c=0;o>c;c++)d=g[c],Y(d[0]+h*u,d[1]+h*u,d[2]+h*u,!1)}function s(){var t=0;for(c(R,t),t+=R.length,C=0,p=Q.length;p>C;C++)D=Q[C],c(D,t),t+=D.length}function c(K,_){for(var r,Q,q=K.length;--q>=0;){r=q,Q=q-1,0>Q&&(Q=K.length-1);var o=0,L=u;for(o=0;L>o;o++){var O=h*o,d=h*(o+1),f=_+r+O,U=_+Q+O,l=_+Q+d,W=_+r+d;x(f,U,l,W,K,o,L,r,Q)}}}function n(D,F,Y){G.vertices.push(new zh(D,F,Y))}function Y(Q,n,E,Y){Q+=y,n+=y,E+=y,G.faces.push(new Qo(Q,n,E,null,null,Y?2:1));var j=Y?t.generateBottomUV(G,L,v,Q,n,E):t.generateTopUV(G,L,v,Q,n,E);G.faceVertexUvs[0].push(j)}function x(H,o,I,x,F,Z,j,c,d){H+=y,o+=y,I+=y,x+=y,G.faces.push(new Qo(H,o,x)),G.faces.push(new Qo(o,I,x));var N=t.generateSideWallUV(G,L,F,v,H,o,I,x,Z,j,c,d);G.faceVertexUvs[0].push([N[0],N[1],N[3]]),G.faceVertexUvs[0].push([N[1],N[2],N[3]])}var B,f,m,e,l,P=v.amount,M=v.curveSegments||Dr,u=v.steps||1,_=v.extrudePath,N=!1,t=new _l(v.repeatUVLength,v.boundingBox);_&&(B=_.getSpacedPoints(u),N=!0,f=v.frames!==I?v.frames:new Rp.FrenetFrames(_,u,!1),m=new zh,e=new zh,l=new zh);var D,C,p,G=this,y=this.vertices.length,A=L.extractPoints(M),T=A.shape,Q=A.holes,K=!gj.isClockWise(T);if(K){for(T=T.reverse(),C=0,p=Q.length;p>C;C++)D=Q[C],gj.isClockWise(D)&&(Q[C]=D.reverse());K=!1}var g=gj.triangulateShape(T,Q),R=T;for(C=0,p=Q.length;p>C;C++)D=Q[C],T=T.concat(D);for(var V,d,h=T.length,o=g.length,k=0;h>k;k++)V=T[k],N?(e.copy(f.normals[0]).multiplyScalar(V.x),m.copy(f.binormals[0]).multiplyScalar(V.y),l.copy(B[0]).add(e).add(m),n(l.x,l.y,l.z)):n(V.x,V.y,0);
var W;for(W=1;u>=W;W++)for(k=0;h>k;k++)V=T[k],N?(e.copy(f.normals[W]).multiplyScalar(V.x),m.copy(f.binormals[W]).multiplyScalar(V.y),l.copy(B[W]).add(e).add(m),n(l.x,l.y,l.z)):n(V.x,V.y,P/u*W);E(),s()};var Rp=function(n,m,z,F,C){function $($,V,W){return t.vertices.push(new zh($,V,W))-1}gq.call(this),m=m||64,z=z||1,F=F||8,C=C||!1;var B,o,w,U,h,Q,P,M,v,_,S,G,H,T,J,q,k,X,A,x,g=[],t=this,r=m+1,V=new zh,y=new Rp.FrenetFrames(n,m,C),I=y.tangents,i=y.normals,R=y.binormals;for(this.tangents=I,this.normals=i,this.binormals=R,v=0;r>v;v++)for(g[v]=[],U=v/(r-1),M=n.getPointAt(U),B=I[v],o=i[v],w=R[v],_=0;F>_;_++)h=_/F*f,Q=-z*s(h),P=z*W(h),V.copy(M),V.x+=Q*o.x+P*w.x,V.y+=Q*o.y+P*w.y,V.z+=Q*o.z+P*w.z,g[v][_]=$(V.x,V.y,V.z);for(v=0;m>v;v++)for(_=0;F>_;_++)S=C?(v+1)%m:v+1,G=(_+1)%F,H=g[v][_],T=g[S][_],J=g[S][G],q=g[v][G],k=new yg(v/m,_/F),X=new yg((v+1)/m,_/F),A=new yg((v+1)/m,(_+1)/F),x=new yg(v/m,(_+1)/F),this.faces.push(new Qo(H,T,q)),this.faceVertexUvs[0].push([k,X,x]),this.faces.push(new Qo(T,J,q)),this.faceVertexUvs[0].push([X.clone(),A,x.clone()]);this.computeFaceNormals(),this.computeVertexNormals()};Rp.prototype=Mf(gp),Rp.FrenetFrames=function(N,J,b){function e(){A[0]=new zh,E[0]=new zh,G=Number.MAX_VALUE,s=u(Y[0].x),d=u(Y[0].y),B=u(Y[0].z),G>=s&&(G=s,F.set(1,0,0)),G>=d&&(G=d,F.set(0,1,0)),G>=B&&F.set(0,0,1),Z.crossVectors(Y[0],F).normalize(),A[0].crossVectors(Y[0],Z),E[0].crossVectors(Y[0],A[0])}var W,G,s,d,B,L,a,F=new zh,Y=[],A=[],E=[],Z=new zh,U=new Ic,T=J+1,v=1e-4;for(this.tangents=Y,this.normals=A,this.binormals=E,L=0;T>L;L++)a=L/(T-1),Y[L]=N.getTangentAt(a),Y[L].normalize();for(e(),L=1;T>L;L++)A[L]=A[L-1].clone(),E[L]=E[L-1].clone(),Z.crossVectors(Y[L-1],Y[L]),Z.length()>v&&(Z.normalize(),W=_(ls(Y[L-1].dot(Y[L]),-1,1)),A[L].applyMatrix4(U.makeRotationAxis(Z,W))),E[L].crossVectors(Y[L],A[L]);if(b)for(W=_(ls(A[0].dot(A[T-1]),-1,1)),W/=T-1,Y[0].dot(Z.crossVectors(A[0],A[T-1]))>0&&(W=-W),L=1;T>L;L++)A[L].applyMatrix4(U.makeRotationAxis(Y[L],W*L)),E[L].crossVectors(Y[L],A[L])};var $f=function(u,Q,w,G){gq.call(this),Q=Q||18,w=w||0,G=G==N?f:G;for(var Z=1/(u.length-1),l=1/Q,m=0,F=Q;F>=m;m++)for(var U=w+m*l*G,R=s(U),L=W(U),b=0,c=u.length;c>b;b++){var j=u[b],E=new zh;E.x=R*j.x-L*j.y,E.y=L*j.x+R*j.y,E.z=j.z,this.vertices.push(E)}for(var V=u.length,m=0,F=Q;F>m;m++)for(var b=0,c=u.length-1;c>b;b++){var M=b+V*m,K=M,A=M+V,R=M+1+V,n=M+1,y=m*l,H=b*Z,J=y+l,C=H+Z;this.faces.push(new Qo(K,n,A)),this.faceVertexUvs[0].push([new yg(y,H),new yg(y,C),new yg(J,H)]),this.faces.push(new Qo(A,n,R)),this.faceVertexUvs[0].push([new yg(J,H),new yg(y,C),new yg(J,C)])}this.mergeVertices(),mh(this),this.computeFaceNormals(),this.computeVertexNormals()};$f.prototype=Mf(gp);var aj=function(C,Q){Q=Q||{};var V=io.generateShapes(C,Q);Q.amount=Q.amount!==I?Q.amount:.5,Q.convertYZ=!1,Q.fill!==!1&&(Q.bottom=!0,Q.top=!0),qk.call(this,V,Q)};aj.prototype=Mf(Dm);var Oh=y.Node=function(){Iq(Oh,this)},Sl={X:gl,Y:Rj,Z:Dd},Rh={X:0,Y:1,Z:2},cp={xyz:"XYZ",xzy:"XZY",yxz:"YXZ",yzx:"YZX",zxy:"ZXY",zyx:"ZYX"},as=new $i,Cn="xzy",ao=function(l,R,K){if(R){var i=R[0],r=R[1],y=R[2];"xzy"===K?(Rj(l,r),Dd(l,y),gl(l,i)):"xyz"===K?(Dd(l,y),Rj(l,r),gl(l,i)):"yxz"===K?(Dd(l,y),gl(l,i),Rj(l,r)):"yzx"===K?(gl(l,i),Dd(l,y),Rj(l,r)):"zxy"===K?(Rj(l,r),gl(l,i),Dd(l,y)):"zyx"===K?(gl(l,i),Rj(l,r),Dd(l,y)):(Rj(l,r),Dd(l,y),gl(l,i))}};Db("Node",dd,{ms_ac:["rotationMode","anchorElevation"],ms_edge:!0,_adjustChildrenToTop:!0,_icon:"node_icon",_image:"node_image",_rotationMode:Cn,_64O:0,_rotationX:0,_53O:0,_host:N,_position:{x:0,y:0},_anchor:{x:.5,y:.5},_anchorElevation:.5,_scale:{x:1,y:1},_scaleTall:1,_54O:0,getUIClass:function(){return De},_22Q:function(){return lt},getX:function(){return this.p().x},setX:function(p){this.p(p,this.p().y)},getY:function(){return this.p().y},setY:function(F){this.p(this.p().x,F)},getAnchorX:function(){return this.getAnchor().x},setAnchorX:function(e){this.setAnchor(e,this.getAnchor().y)},getAnchorY:function(){return this.getAnchor().y},setAnchorY:function(F){this.setAnchor(this.getAnchor().x,F)},getScaleX:function(){return this.getScale().x},setScaleX:function(d){this.setScale(d,this.getScale().y)},getScaleY:function(){return this.getScale().y},setScaleY:function(W){this.setScale(this.getScale().x,W)},p:function(){return 0===arguments.length?this.getPosition():(this.setPosition.apply(this,arguments),this)},p3:function(){return 0===arguments.length?this.getPosition3d():(this.setPosition3d.apply(this,arguments),this)},s3:function(){return 0===arguments.length?this.getSize3d():(this.setSize3d.apply(this,arguments),this)},r3:function(){return 0===arguments.length?this.getRotation3d():(this.setRotation3d.apply(this,arguments),this)},setQuaternion:function(R){var e=(new Ji).setFromQuaternion(R,Ji.ReverseOrder(this.getRotationMode()));return this._applyClosestR3(e.x,e.y,e.z)},getQuaternion:function(){var J=new Ji,F=new Ji,m=new $i;return function(H){return H||(H=new $i),this.getEuler(J),J.equals(F)?H.copy(m):H.copy(m.setFromEuler(F.copy(J)))}}(),getEuler:function(J){var E=this.r3();return J||(J=new Ji),J.set(E[0],E[1],E[2],Ji.ReverseOrder(this.getRotationMode()))},setEuler:function(Y){return Y=Y.clone().reorder(Ji.ReverseOrder(this.getRotationMode())),this.r3(Y.x,Y.y,Y.z)},t3:function(){return this.translate3d.apply(this,arguments),this},translate3dBy:function(T,A){wq(T,xm(N,N,this.r3(),this.getRotationMode())),this.translate3d(T[0]*A,T[1]*A,T[2]*A)},translateFront:function($){this.translate3dBy([0,0,1],$)},translateBack:function(b){this.translate3dBy([0,0,-1],b)},translateLeft:function(e){this.translate3dBy([-1,0,0],e)},translateRight:function(y){this.translate3dBy([1,0,0],y)},translateTop:function(l){this.translate3dBy([0,1,0],l)},translateBottom:function(x){this.translate3dBy([0,-1,0],x)},getPosition3d:function(){return[this._position.x,this._54O,this._position.y]},setPosition3d:function(e,s,k){1===arguments.length&&(s=e[1],k=e[2],e=e[0]),this.p(e,k),this.setElevation(s)},translate3d:function(b,g,w){1===arguments.length&&(g=b[1],w=b[2],b=b[0]),this.translate(b,w),this.setElevation(this._54O+g)},getSize3d:function(){return[this.getWidth(),this.getTall(),this.getHeight()]},setSize3d:function(g,L,Y){1===arguments.length&&(L=g[1],Y=g[2],g=g[0]),this.setSize(g,Y),this.setTall(L)},getRotation3d:function(){return[this._rotationX,-this._64O,this._53O]},setRotation3d:function(l,A,L){var H=this;if(!H._updatingRotation3d){H._updatingRotation3d=1,1===arguments.length&&(A=l[1],L=l[2],l=l[0]);var o=[H._rotationX,-H._64O,H._53O];H._rotationX=l,H._64O=-A,H._53O=L,H.fp("rotation3d",o,[l,A,L]),delete H._updatingRotation3d}},_applyClosestR3:function(){function o(E){return E%=f,0>E&&(E+=f),E>G?f-E:E}function u(l,L){return o(l[0]-L[0])+o(l[1]-L[1])+o(l[2]-L[2])}return function(m,O,S){var _,x,C,T=this.r3(),i=this.getRotationMode();"xzy"===i||"yzx"===i?(_=m>0?m-G:m+G,x=O>0?O-G:O+G,C=S>0?G-S:-G-S):"xyz"===i||"zyx"===i?(_=m>0?m-G:m+G,C=S>0?S-G:S+G,x=O>0?G-O:-G-O):("yxz"===i||"zxy"===i)&&(C=S>0?S-G:S+G,x=O>0?O-G:O+G,_=m>0?G-m:-G-m),u([_,x,C],T)<u([m,O,S],T)?this.r3(_,x,C):this.r3(m,O,S)}}(),setRotationY:function(o){this.setRotation(-o)},getRotationY:function(){return-this._64O},lookAtDirection:function(q,T){T=T||Ki;var A=this,K=So(q);T===Ki?(A.r3([-Y(q[1]/K),-ge(q[2],q[0])+Rd,0]),A.setRotationMode("xzy")):T===Il?(A.r3(0,-ge(q[2],q[0]),Y(q[1]/K)),A.setRotationMode("zyx")):T===hp?(A.r3(0,-ge(q[2],q[0])+G,-Y(q[1]/K)),A.setRotationMode("zyx")):T===nc?(A.r3([-Y(q[1]/K)+Rd,-ge(q[2],q[0])+Rd,0]),A.setRotationMode("xzy")):T===yf&&(A.r3([-Y(q[1]/K)-Rd,-ge(q[2],q[0])+Rd,0]),A.setRotationMode("xzy")),T===Mj&&(A.r3([-Y(q[1]/K)+G,-ge(q[2],q[0])+Rd,G]),A.setRotationMode("zxy"))},lookAt:function(C,R){return this.lookAtDirection(Zo(C,this.p3()),R)},lookAtX:function(){var G=new Vg,L=new Vg,V=new Vg,e=new Ic,j=new Ic,n=new Ji;return function(h,A){var r=rg(this);if(e.fromArray(r),V.copy(this.p3()),G.copy(h).sub(V),!(G.lengthSq()<1e-6)){G.normalize(),A=A||Ki,"string"==typeof A?A===Ki?L.set(0,0,1):A===Mj?L.set(0,0,-1):A===hp?L.set(-1,0,0):A===Il?L.set(1,0,0):A===nc?L.set(0,1,0):A===yf&&L.set(0,-1,0):L.copy(A).normalize(),L.applyMatrix4(e).sub(V).normalize();var S=Math.acos(G.dot(L));if(S){var q=G.clone().cross(L);q.lengthSq()<1e-6&&(A===nc||A===yf||0===A[0]&&0===A[1]?q.set(0,0,1).applyMatrix4(e).sub(V):q.set(0,1,0).applyMatrix4(e).sub(V)),q.normalize(),n.set(this.r3(),this.getRotationMode(),!0),e.makeRotationFromEuler(n),j.makeRotationAxis(q,-S),n.setFromRotationMatrix(j.multiply(e)),this._applyClosestR3(n.x,n.y,n.z)}}}}(),getHost:function(){return this._host},setHost:function(_){var x=this;if(x!==_&&x._host!==_){var R=x._host;R&&(R._removeAttach(x),R.updateLayoutAttaches()),x._host=_,x._host&&x._host._addAttach(x),x.fp("host",R,_),x.onHostChanged(R,_)}},getAttaches:function(){return this._69O},_addAttach:function(R){var e=this;e._69O||(e._69O=new Ik),e._69O.add(R),e.fp("attaches",N,R)},_removeAttach:function(E){var L=this;L._69O.remove(E),L._69O.isEmpty()&&delete L._69O,L.fp("attaches",E,N)},getImage:function(){if(this._pendingCheckImageJSON){var n=F.getImage(this._image);n&&(this._pendingCheckImageJSON=!1,this.getParent()instanceof Wq&&this.getParent().checkPendingUpdateInfo())}return this._image},setImage:function(E){var Z=this,y=Z._image,q=Z.getWidth(),t=Z.getHeight();if(Z._image=E,Z.fp("image",y,E)){if(null!=E&&(Go(E)||Je(E)&&/\.json$/i.test(E))&&(this._pendingCheckImageJSON=!0),vd)return;Z.fp(Tp,q,Z.getWidth()),Z.fp(nf,t,Z.getHeight())}},getElevation:function(){return this._54O},setElevation:function(g){var H=this;if(!H._50O){H._50O=1;var b=H._54O;H._54O=g,H.fp(ko,b,g),delete this._50O}},getRotation:function(){return this._64O},setRotation:function(c){var H=this;if(!H._49O){H._49O=1;var i=H._64O;H._64O=c,H.fp(ek,i,c),delete H._49O}},getRotationX:function(){return this._rotationX},setRotationX:function(V){var l=this;if(!l._51O){l._51O=1;var i=l._rotationX;l._rotationX=V,l.fp("rotationX",i,V),delete l._51O}},getRotationZ:function(){return this._53O},setRotationZ:function($){var u=this;if(!u._52O){u._52O=1;var Y=u._53O;u._53O=$,u.fp("rotationZ",Y,$),delete u._52O}},getPosition:function(){return this._position},setPosition:function(M,s){var q=this;if(!q._50I){q._50I=1;var E;if(E=2===arguments.length?{x:M,y:s}:M,E.x!==q._position.x||E.y!==q._position.y){var $=q._position;q._position=E,q.fp(wl,$,E)}delete q._50I}},translate:function(b,g){var U=this._position;this.p(U.x+b,U.y+g)},hasInheritedSize:function(){var z=this,Y=z.getStyle("shape3d");if(Y){var Z=oi(Y);if(Z&&Z.rawS3)return!0;if(("billboard"===Y||"plane"===Y)&&Fp(z.getStyle("shape3d.image")))return!0}return z.hasOwnProperty("_image")&&Fp(z._image)?!0:!1},getWidth:function(){var t=this;if(t._width>=0)return t._width;var K=t.getStyle("shape3d");if(K){var x=oi(K);if(x&&x.rawS3)return x.rawS3[0];if("billboard"===K||"plane"===K){var H=Fp(t.getStyle("shape3d.image"));return H?fm(H,t):20}}var H=Fp(t._image);return H?fm(H,t):20},setWidth:function(W){var m=this,n=m._width;m._width=W,m.fp(Tp,n,W)},getHeight:function(){var M=this;if(M._height>=0)return M._height;var U=M.getStyle("shape3d");if(U){var W=oi(U);if(W&&W.rawS3)return W.rawS3[2];if("plane"===U){var Z=Fp(M.getStyle("shape3d.image"));return Z?Oo(Z,M):20}if("billboard"===U)return 2}var Z=Fp(M._image);return Z?Oo(Z,M):20},setHeight:function(i){var R=this,c=R._height;R._height=i,R.fp(nf,c,i)},getTall:function(){var O=this;if(O._tall>=0)return O._tall;var m=O.getStyle("shape3d");if(m){var D=oi(m);if(D&&D.rawS3)return D.rawS3[1];if("billboard"===m){var A=Fp(O.getStyle("shape3d.image"));return A?Oo(A,O):20}if("plane"===m)return 2}return 20},setTall:function(e){var a=this,z=a._tall;a._tall=e,a.fp("tall",z,e)},setSize:function(m,P){var v=this;2===arguments.length?(v.setWidth(m),v.setHeight(P)):(v.setWidth(m.width),v.setHeight(m.height))},getSize:function(){return{width:this.getWidth(),height:this.getHeight()}},setRect:function(g,E,b,h,k){var A=this,Y=A.getAnchor(),Z=A.getScale();arguments.length<=2&&(k=E,E=g.y,b=g.width,h=g.height,g=g.x);var n=k&&Z.x<0?1-Y.x:Y.x,Q=k&&Z.y<0?1-Y.y:Y.y;A.p(g+b*n,E+h*Q),k&&(b/=Math.abs(Z.x),h/=Math.abs(Z.y)),A.setWidth(b),A.setHeight(h)},getMatrix:function(){var Y=this,p=Y._64O,W=Y._position,s=Y.getScale();return new zg(p,W.x,W.y,s.x,s.y)},getMatrix4:function(){var X=new Vg,x=new $i,p=new Vg;return function(u){return this.getQuaternion(x),X.copy(this.p3()),p.copy(this.getFinalScale3d()),u||(u=new Ic),u.compose(X,x,p)}}(),getAnchorRect:function(){var c=this,i=c.getWidth(),p=c.getHeight(),O=c.getAnchor();return{x:-i*O.x,y:-p*O.y,width:i,height:p}},toLocal:function(r){return this.getMatrix().tfi(r)},toGlobal:function(C){return this.getMatrix().tf(C)},getAttachPosition:function(){var j=new zg;return function(G,c,A,C){A=A||0,C=C||0;var g=this,e=g.getAnchor(),h=g._64O,I=g._position,W=g.getScale();return j.setFromTransform(h,I.x,I.y).tf({x:A+W.x*g.getWidth()*(G-e.x),y:C+W.y*g.getHeight()*(c-e.y)})}}(),isInRect:function(c){c=this.toLocal(c);var x=this.getWidth(),Z=this.getHeight();return c.x+=x*this.getAnchorX(),c.y+=Z*this.getAnchorY(),!(c.x<0||c.y<0||c.x>x||c.y>Z)},getRect:function(){var Y=this,l=Y.getWidth(),O=Y.getHeight(),t=Y.getAnchor(),T={x:-l*t.x,y:-O*t.y,width:l,height:O},X=Y.getMatrix();return T=Jf([X.tf(T.x,T.y),X.tf(T.x+T.width,T.y),X.tf(T.x+T.width,T.y+T.height),X.tf(T.x,T.y+T.height)])},getAnchorElevation:function(){return this._anchorElevation},getAnchor3d:function(){var T=this,g=T.getAnchor(),t=T._anchorElevation;return{x:g.x,y:t,z:g.y}},setAnchorElevation:function(o){var p=this,w=p._anchorElevation;return w!==o?(p._anchorElevation=o,p.fp("anchorElevation",w,o),!0):!1},setAnchor3d:function(b,q,N,l){var a,R=this;"number"==typeof b?a={x:b,y:q,z:N}:(a=b.length?{x:b[0],y:b[1],z:b[2]}:b,l=q),R.beginTransaction();var Y=R.getAnchor3d(),o=R.setAnchor(a.x,a.z);if(R.setAnchorElevation(a.y)&&(o=!0),o&&l&&!vd){R.getAnchor3d();var S=rg(R),h=wq([a.x-Y.x,a.y-Y.y,a.z-Y.z],S);R.p3(h)}return R.endTransaction(),o},getAnchor:function(){var _=this;if(_.hasOwnProperty("_anchor"))return _._anchor;var g=Fp(_._image);return g&&g.anchorX!==I?{x:g.anchorX,y:g.anchorY}:_._anchor},setAnchor:function(h,M,J){var V,P=this;"number"==typeof h?V={x:h,y:M}:(V=h.length?{x:h[0],y:h[1]}:h,J=M);var S=P.getAnchor();if(S.x!==V.x||S.y!==V.y){if(P.beginTransaction(),P._anchor=V,P.fp("anchor",S,V),J&&!vd){var Z=P.getPosition(),j=P.getSize(),o=P.getRotation(),U=P.getScale(),O=-j.width*(S.x-V.x)*U.x,Q=-j.height*(S.y-V.y)*U.y,R=W(o),F=s(o);P.setPosition(Z.x+F*O-R*Q,Z.y+R*O+F*Q)}return P.endTransaction(),!0}return!1},getLocalQuaternion:function(J){var c=this,r=c.getHost();if(!r)return c.getQuaternion(J);var N=r.getQuaternion(),p=c.getQuaternion();return J||(J=new $i),J.copy(N).inverse().multiply(p)},setLocalQuaternion:function(q){var Z=this,Q=Z.getHost();if(!Q)return Z.setQuaternion(q);var P=Q.getQuaternion();Z.setQuaternion(P.clone().multiply(q))},getLocalEuler:function(){var X=new $i;return function(U){var z=this,n=z.getHost();return n?(z.getLocalQuaternion(X),U||(U=new Ji),U.setFromQuaternion(X,Ji.ReverseOrder(this.getRotationMode()))):z.getEuler(U)}}(),setLocalEuler:function(){var x=new $i;return function(e){var Y=this,P=Y.getHost();return P?(x.setFromEuler(e),Y.setLocalQuaternion(x)):Y.setEuler(e)}}(),getLocalPosition3d:function(n){var U=this;n||(n=new Vg),n.copy(U.p3());var y=U.getHost();if(!y)return n;var A=y.getMatrix4();return n.applyMatrix4(A.getInverse(A))},setLocalPosition3d:function(D){var Q=this,x=Q.getHost();if(!x)return D.x!==I?Q.p3(D.x,D.y,D.z):Q.p3(D),void 0;var g=x.getMatrix4(),f=new Vg(D);f.applyMatrix4(g),Q.p3(f.x,f.y,f.z)},getScale:function(){return this._scale},setScale:function(m,D){var O,x=this;O=2===arguments.length?{x:m,y:D}:m;var S=x.getScale();(S.x!==O.x||S.y!==O.y)&&(x._scale=O,x.fp("scale",S,O))},getScaleTall:function(){return this._scaleTall},getScale3d:function(){var t=this,z=t._scaleTall,j=t.getScale();return[j.x,z,j.y]},getFinalScale3d:function(){var g=this,l=g.s3(),M=g._dynamicScale3d,b=g.getScale3d();return l&&(b[0]*=l[0],b[1]*=l[1],b[2]*=l[2]),M&&(b[0]*=M[0],b[1]*=M[1],b[2]*=M[2]),b},getFinalRotation3d:function(){var v=this;return v._dynamicRotation||v.r3()},setScaleTall:function(W){var c=this,x=c._scaleTall;x!==W&&(c._scaleTall=W,c.fp("scaleTall",x,W))},setScale3d:function(l,P,D){var a,K=this;a="number"==typeof l?{x:l,y:P,z:D}:l.length?{x:l[0],y:l[1],z:l[2]}:l,K.setScaleTall(a.y),K.setScale(a.x,a.z)},getCorners:function(n,d){n==N&&(n=0),d==N&&(d=n);var q=this,o=q.getAnchor(),D=q.getWidth(),K=q.getHeight(),m=-D*o.x-n,g=-K*o.y-d,i=D+2*n,p=K+2*d,W=q.getMatrix();return[W.tf(m,g),W.tf(m,g+p),W.tf(m+i,g+p),W.tf(m+i,g)]},getEditControlPoints:function(M,_,c){_==N&&(_=0),c==N&&(c=_);var U=this,V=U.getAnchor(),O=U.getWidth(),r=U.getHeight(),Q=-O*V.x-_,A=-r*V.y-c,x=O+2*_,P=r+2*c;if(M)return[{x:Q,y:A},{x:Q,y:0},{x:Q,y:A+P},{x:0,y:A+P},{x:Q+x,y:A+P},{x:Q+x,y:0},{x:Q+x,y:A},{x:0,y:A}];var m=U.getMatrix();return[m.tf(Q,A),m.tf(Q,0),m.tf(Q,A+P),m.tf(0,A+P),m.tf(Q+x,A+P),m.tf(Q+x,0),m.tf(Q+x,A),m.tf(0,A)]},rotateAt:function(y,v,b){var Y=this,N=Y._position,O=Y._64O,i=new zg(O,N.x,N.y).tf(y,v),z=U(y*y+v*v),m=ge(N.y-i.y,N.x-i.x)+b;Y.setRotation(O+b),Y.p(i.x+z*s(m),i.y+z*W(m))},rotateAroundAxis:function(a,q){this.setQuaternion(this.getQuaternion().multiply(as.setFromAxisAngle(a,q)))},rotateAroundWorldAxis:function(f,d){this.setQuaternion(this.getQuaternion().premultiply(as.setFromAxisAngle(f,d)))},rotateX:function(x){return this.rotateAroundAxis(Vg.AxisX,x)},rotateY:function(u){return this.rotateAroundAxis(Vg.AxisY,u)},rotateZ:function(o){return this.rotateAroundAxis(Vg.AxisZ,o)},onParentChanged:function(){Oh.superClass.onParentChanged.apply(this,arguments),this._8I()},onPropertyChanged:function(){var w={};return"width|height|position|anchor|rotation|scale|s:layout.h|s:layout.v".split("|").forEach(function(K){w[K]=!0}),function(m){var g=this;Oh.superClass.onPropertyChanged.call(g,m);var M=m.property;if(w[M]&&!g._layoutUpdating&&g.updateLayoutParameters(null,M),g._69O&&g._69O.each(function(z){z.handleHostPropertyChange(m)}),g._49I&&g._49I.each(function(l){l.fp("agentChange",!0,!1)}),Mg[M]||"a:layout"===M.substring(0,8)){this.updateLayoutAttaches();var h=g._host;h&&h.updateLayoutAttaches()}("s:shape3d.autorotate"===M||"s:autorotate"===M||"s:shape3d.fixSizeOnScreen"===M||"s:fixSizeOnScreen"===M||"s:hide.overlapping.group"===M)&&(g._47Q=g.s("autorotate")||g.s("shape3d.autorotate")||g.s("fixSizeOnScreen")||g.s("shape3d.fixSizeOnScreen")||g.s("hide.overlapping.group"))}}(),onHostChanged:function(){this.updateAttach(),this.updateLayoutParameters()},handleHostPropertyChange:function(x){this.updateAttach(x)},onStyleChanged:function(W){Oh.superClass.onStyleChanged.apply(this,arguments),zm[W]&&this.updateAttach()},updateLayoutAttaches:function(){if(!vd&&this.s("vector.layoutable")){var X,r,$=this;return X=Fp($.getImage()),X&&X.layoutAttach&&(r=X.layoutAttach,r&&r($))?!0:void 0}},updateAttach:function(e){var o=this;return vd?(o.updateLayoutParameters(),void 0):(o._51I||(o._51I=1,o._71O(e),delete o._51I),void 0)},_71O:function(d){var j,p,O,T,f,E,$=this,h=$._host,e=d?d.property:N,o=d?d.oldValue:N,S=d?d.newValue:N;if(h instanceof Oh&&(!d||Mg[e])){var X;if(X=Fp(h.getImage()),X&&X.layoutAttach)return}if(h instanceof y.Grid){if(e===ko)$.setElevation($._54O+S-o);else if(!d||Io[e]){if(j=$.s("attach.row.index"),p=$.s("attach.column.index"),O=h.getCellRect(j,p),!O)return;T=$.s("attach.row.span"),f=$.s("attach.column.span"),(1!==T||1!==f)&&(O=pq(O,h.getCellRect(j+T-1,p+f-1))),_e(O,$,"attach.padding",1),$.setRect(O)}}else if(h instanceof Zf&&(E=$.s("attach.index"))>=0&&(!d||jn[e])){var H=$.s("attach.thickness"),K=h.getScale(),C=Math.max(K.x,K.y);H>0&&$.setHeight(h.getThickness()*H*C);var i=$.s("attach.offset"),x=h.getPoints(),Y=x.size();if(Y>E){var s=h.getPointsMatrix2d(),B=x.get(E),w=Y===E+1?x.get(0):x.get(E+1);B=s.apply(B),w=s.apply(w);var t=[w.x-B.x,w.y-B.y],v=So(t);if(v){$.s("attach.offset.relative")&&(i*=v),$.s("attach.offset.opposite")&&(i=v-i);var b={x:B.x+t[0]/v*i,y:B.y+t[1]/v*i},z=$.s("attach.gap");z&&($.s("attach.gap.relative")&&(z*=h.getThickness()*C),b=sg(N,b,w,z)),$.p(b),$.setRotation(ge(t[1],t[0]))}}}else d&&(e===wl?$.translate(S.x-o.x,S.y-o.y):e===ko?$.setElevation($._54O+S-o):gm[e]?"rotation3d"===e?$.syncRotation3d(h,S,o):$._11Q(h,e,S-o):("anchor"===e||"width"===e||"height"===e||"scale"===e)&&$.layout(h))},_11Q:function(){var R=new y.Math.Euler,U=y.Math.Euler.ReverseOrder,Z=new y.Math.Vector2,T=new y.Math.Vector2;return function(P,Q,e){var i=this,B=P.p3(),j=P.r3(),x=i.p3(),D=i.r3();if(Q===ek&&(Q="rotationY",e=-e),(Q===ek||"rotationY"===Q)&&0===D[0]&&0===D[2]&&0===j[0]&&0===j[2]&&0===x[1]&&0===B[1])return i.setRotation(-D[1]-e),Z.set(x[0],x[2]).rotateAround(T.set(B[0],B[2]),-e),i.p(Z.x,Z.y),void 0;var v=cp[P.getRotationMode()],q=v[0],_=v[1],u=v[2],G=Sl[q],X=Sl[_],b=Sl[u],y=Gj();Q===ek+q?(b(y,j[Rh[u]]),X(y,j[Rh[_]]),G(y,e),X(y,-j[Rh[_]]),b(y,-j[Rh[u]])):Q===ek+_?(b(y,j[Rh[u]]),X(y,e),b(y,-j[Rh[u]])):Q===ek+u&&b(y,e);var k=Zo(x,B);wq(k,y),i.p3(B[0]+k[0],B[1]+k[1],B[2]+k[2]);var w=i.getRotationMode();ao(y,i.r3(),w),R.setFromRotationMatrix(y,U(w)),i.r3([R.x,R.y,R.z])}}(),syncRotation3d:function(){var A=new $i,q=new Ji,r=new Vg;return function(J,$,H){var w=this;if(H[0]!==$[0]||H[1]!==$[1]||H[2]!==$[2]){var I=Ji.ReverseOrder(J.getRotationMode());as.setFromEuler(q.set(H[0],H[1],H[2],I)),A.setFromEuler(q.set($[0],$[1],$[2],I)),A.multiply(as.inverse());var n=J.p3(),t=w.p3();r.set(t[0]-n[0],t[1]-n[1],t[2]-n[2]).applyQuaternion(A),w.p3(n[0]+r.x,n[1]+r.y,n[2]+r.z),w.setQuaternion(w.getQuaternion(as).premultiply(A))}}}(),isHostOn:function(l){var n=this;if(n._host&&l&&l._69O)for(var Z={},U=n._host;U&&U!==n&&!Z[U._id];){if(U===l)return!0;Z[U._id]=U,U=U._host}return!1},isLoopedHostOn:function(p){return this.isHostOn(p)&&p.isHostOn(this)},getScaledSize:function(){var $=this.getSize(),e=this.getScale();return $.width*=Math.abs(e.x),$.height*=Math.abs(e.y),$},layout:function(X){if(X=X||this.getHost()){var P=this,j=P.s("layout.h")||"center",_=P.s("layout.v")||"center";if("center"!==j||"center"!==_){var x=new y.Math.Vector2,S=X.getPosition(),C=X.getAnchor(),u=X.getScaledSize();P.getPosition();var R,E,w,V,U,k=1,K=1;switch(P._layoutUpdating=!0,j){case"left":x.setX(P._layoutHValue-C.x*u.width);break;case"right":x.setX((1-C.x)*u.width-P._layoutHValue);break;case"leftright":R=u.width-P._layoutHValue[2],w=P.getRotation()-X.getRotation(),V=Math.abs(Math.sin(w)),U=Math.abs(Math.cos(w)),k+=U*R/P._layoutHValue[3],K+=V*R/P._layoutHValue[4],x.setX(P._layoutHValue[1]+(P._layoutHValue[5]-C.x)*u.width);break;case"center":x.setX((.5-C.x)*u.width-P._layoutHValue);break;case"scale":w=P.getRotation()-X.getRotation(),V=Math.abs(Math.sin(w)),U=Math.abs(Math.cos(w)),x.setX((.5-C.x)*u.width-P._layoutHValue[1]*u.width/P._layoutHValue[0]),E=u.width/P._layoutHValue[2]-1,k+=U*E,K+=V*E}switch(_){case"top":x.setY(P._layoutVValue-C.y*u.height);break;case"bottom":x.setY((1-C.y)*u.height-P._layoutVValue);break;case"topbottom":w||(w=P.getRotation()-X.getRotation(),V=Math.abs(Math.sin(w)),U=Math.abs(Math.cos(w))),R=u.height-P._layoutVValue[2],k+=V*R/P._layoutVValue[3],K+=U*R/P._layoutVValue[4],x.setY(P._layoutVValue[1]+(P._layoutVValue[5]-C.y)*u.height);break;case"center":x.setY((.5-C.y)*u.height-P._layoutVValue);break;case"scale":w||(w=P.getRotation()-X.getRotation(),V=Math.abs(Math.sin(w)),U=Math.abs(Math.cos(w))),x.setY((.5-C.y)*u.height-P._layoutVValue[1]*u.height/P._layoutVValue[0]),E=u.height/P._layoutVValue[2]-1,k+=V*E,K+=U*E}if("leftright"===j||"scale"===j||"topbottom"===_||"scale"===_){var n=this.getScale(),c=Math.abs(n.x),e=Math.abs(n.y);"leftright"===j||"scale"===j?P.setSize(P._layoutHValue[3]*k/c,P._layoutHValue[4]*K/e):P.setSize(P._layoutVValue[3]*k/c,P._layoutVValue[4]*K/e)}x.rotateAround(null,X.getRotation()),this.setPosition(x.x+S.x,x.y+S.y),P._layoutUpdating=I}}},updateLayoutParameters:function(Q,X){if(Q=Q||this.getHost()){var R=this,O=R.s("layout.h"),n=R.s("layout.v");if(O||n){var W,b,I,j,S,r,f=new y.Math.Vector2,Z=Q.getPosition(),a=Q.getAnchor(),C=Q.getScaledSize(),d=R.getPosition(),t=R.getScaledSize();switch(f.set(d.x-Z.x,d.y-Z.y),f.rotateAround(null,-Q.getRotation()),O){case"left":R._layoutHValue=f.x+a.x*C.width;break;case"right":R._layoutHValue=-f.x+(1-a.x)*C.width;break;case"center":R._layoutHValue=-f.x+(.5-a.x)*C.width;break;case"leftright":case"scale":"scale"===O?W=-f.x+(.5-a.x)*C.width:(b=R.getAnchor(),I=R.getRotation()-Q.getRotation(),j=Math.cos(I),S=Math.sin(I),r=-Math.min(-b.x*j+b.y*S,-b.x*j-(1-b.y)*S,(1-b.x)*j+b.y*S,(1-b.x)*j-(1-b.y)*S),W=f.x-(r-a.x)*C.width),"position"===X&&"object"==typeof R._layoutHValue?(R._layoutHValue[0]=C.width,R._layoutHValue[1]=W):R._layoutHValue=[C.width,W,C.width,t.width,t.height,r]}switch(n){case"top":R._layoutVValue=f.y+a.y*C.height;break;case"bottom":R._layoutVValue=-f.y+(1-a.y)*C.height;break;case"center":R._layoutVValue=-f.y+(.5-a.y)*C.height;break;case"topbottom":case"scale":"scale"===n?W=-f.y+(.5-a.y)*C.height:(I||(b=R.getAnchor(),I=R.getRotation()-Q.getRotation(),j=Math.cos(I),S=Math.sin(I)),r=-Math.min(-b.x*S-b.y*j,-b.x*S+(1-b.y)*j,(1-b.x)*S-b.y*j,(1-b.x)*S+(1-b.y)*j),W=f.y-(r-a.y)*C.height),"position"===X&&"object"==typeof R._layoutVValue?(R._layoutVValue[0]=C.height,R._layoutVValue[1]=W):R._layoutVValue=[C.height,W,C.height,t.width,t.height,r]}}}},getSerializableProperties:function(){var L=Oh.superClass.getSerializableProperties.call(this);return xo(L,{image:1,host:1,rotation:1,rotationX:1,rotationZ:1,rotationMode:1,position:1,anchor:1,anchorElevation:1,scale:1,scaleTall:1,_width:1,_height:1,_tall:1,elevation:1}),L}});var sp=y.Edge=function(x,D){var L=this;Iq(sp,L),L.setSource(x),L.setTarget(D)};Db("Edge",dd,{ms_edge:!0,_icon:"edge_icon",getUIClass:function(){return Co},_22Q:function(){return nt},getSource:function(){return this._source},getTarget:function(){return this._target},getSourceAgent:function(){return this._40I},getTargetAgent:function(){return this._41I},canSetSourceTarget:function(w){if(w===this)return!1;if(cl(w))return!0;for(var J,A,n,B,f,k=[this],t=-1,z=0;z>t;)if(t++,J=k[t],A=J._44I)for(A=A.getArray(),B=0,f=A.length;f>B;B++)if(n=A[B],lm(n)&&!(k.indexOf(n)>=0)){if(n===w)return!1;k.push(n),z++}return!0},setSource:function(H){var n=this;if(n._source!==H&&n.canSetSourceTarget(H)){var M=n._source;n._source=H,M&&M._16I(n),H&&H._2I(n),n._7I(),n.fp("source",M,H)}},setTarget:function(v){var W=this;if(W._target!==v&&W.canSetSourceTarget(v)){var c=W._target;W._target=v,c&&c._18I(W),v&&v._4I(W),W._7I(),W.fp("target",c,v)}},isLooped:function(){var d=this;return d._source===d._target&&cl(d._source)&&cl(d._target)},onPropertyChanged:function(){var B={};return["source","target","sourceAgent","targetAgent","edgeGroup","agentChange","s:edge.width","s:edge.type","s:edge.offset","s:edge.center","s:edge.points","s:edge.segments","s:edge.gap","s:edge.source.t3","s:edge.target.t3","s:edge.color","s:edge.gradient.color","s:edge.pattern","s:edge.dash","s:edge.dash.color","s:edge.dash.pattern","s:edge.dash.offset","s:edge.dash","s:edge.dash","s:repeat.uv.length","s:body.color","s:shape3d","s:shape3d.visible","s:shape3d.image","s:shape3d.smooth","s:shape3d.resolution","s:shape3d.color","s:shape3d.blend","s:shape3d.side","s:shape3d.start.angle","s:shape3d.sweep.angle","s:shape3d.top.cap","s:shape3d.top.image","s:shape3d.top.visible","s:shape3d.top.color","s:shape3d.bottom.cap","s:shape3d.bottom.image","s:shape3d.bottom.visible","s:shape3d.bottom.color","s:shape3d.from.visible","s:shape3d.from.color","s:shape3d.to.visible","s:shape3d.to.color","s:shape3d.uv.union"].forEach(function(Z){B[Z]=!0}),function(h){var f=this;f._49I&&f._49I.each(function(D){D.fp("agentChange",!0,!1)}),("s:alwaysOnTop"===h.property||"s:shape3d.alwaysOnTop"===h.property)&&(h.newValue?this.setRenderLayer("top"):this.setRenderLayer(I)),B[h.property]&&(this._needChangeGeometry=!0)}}(),_7I:function(){var Z,V=this,j=Hr(V);V._40I!==j&&(Z=this._40I,Z&&Z._15I(V),V._40I=j,j&&j._1I(V),V.fp("sourceAgent",Z,j),se(Z,V._41I),se(j,V._41I));var F=Pq(V);V._41I!==F&&(Z=V._41I,Z&&Z._17I(V),V._41I=F,F&&F._3I(V),V.fp("targetAgent",Z,F),se(Z,V._40I),se(F,V._40I))},_22I:function(o){this._52I=o,this.fp("edgeGroup",!0,!1)},getEdgeGroup:function(){return this._52I},isEdgeGroupHidden:function(){var b=this;return b._52I&&b._52I.get(0)!==b&&!b.getStyle(hq)},getEdgeGroupSize:function(){return this._52I?this._52I.size():1},getEdgeGroupIndex:function(){return this._52I?this._52I.indexOf(this):0},isEdgeGroupAgent:function(){var E=this,w=E._52I;return w&&!E.getStyle(hq)&&w.size()>1&&E===w.get(0)},toggle:function(){this.beginTransaction();var K=this._52I,w=!this.s(hq);K&&K.size()>1&&(K.each(function(Y){Y.s(hq,w)}),K.getSiblings().each(function(M){M!==K&&M.each(function(A){A.fp("edgeGroup",N,M)})})),this.endTransaction()},setStyle:function(C,p){(C===nb||"edge.segments"===C)&&(p=Gr(p)),sp.superClass.setStyle.call(this,C,p)},onStyleChanged:function(i){sp.superClass.onStyleChanged.apply(this,arguments),vo[i]&&se(this._41I,this._40I)},getSerializableProperties:function(){var K=sp.superClass.getSerializableProperties.call(this);return xo(K,{source:1,target:1}),K}});var eo=y.Group=function(){Iq(eo,this)};Db("Group",Oh,{_image:"group_image",_icon:"group_icon",_57O:!1,getUIClass:function(){return td},onChildAdded:function(){eo.superClass.onChildAdded.apply(this,arguments),this._81I()},onChildRemoved:function(){eo.superClass.onChildRemoved.apply(this,arguments),this._81I()},_81I:function(){var G=this;if(!G._54I&&!vd){var C=G.getChildrenRect();C&&(G._53I=1,G.p(Sh(G.s("group.position"),C,G.getSize())),delete G._53I)}},getChildrenRect:function(){var k,U=this;return U.eachChild(function(O){cl(O)&&(k=pq(k,U.getChildRect(O)))}),k},getChildRect:function(S){var q;return cl(S)&&S.s(Ql)&&(Ln(S)&&S.isExpanded()&&S.eachChild(function(u){q=pq(q,S.getChildRect(u))}),!q&&S.getRect&&(q=S.getRect())),q},setPosition:function(l,w){var B=this;if(!B._54I){var r;r=2===arguments.length?{x:l,y:w}:l,vd||B._53I||(B._54I=1,vs(B._children,r.x-B._position.x,r.y-B._position.y),delete B._54I),eo.superClass.setPosition.call(this,r)}},toggle:function(){this.setExpanded(!this.isExpanded())},isExpanded:function(){return this._57O},setExpanded:function(r){var H=this;if(H._57O!==r){var _=H._57O;H._57O=r,H.fp("expanded",_,H._57O),H._fireInvalidateDeep(),H._8I()}},_fireInvalidateDeep:function(){this.eachChild(function(c){Ln(c)?c._fireInvalidateDeep():c.iv()})},_8I:function(){eo.superClass._8I.call(this),this.eachChild(function(d){cl(d)&&d._8I()})},onStyleChanged:function(x){eo.superClass.onStyleChanged.apply(this,arguments),"group.position"===x&&this._81I()},getSerializableProperties:function(){var c=eo.superClass.getSerializableProperties.call(this);return c.expanded=1,c}});var fb=y.Camera=function(){Iq(fb,this),this.s({"shadow.cast":!1,"shadow.receive":!1,shape3d:"billboard"}),this._viewMatrix=new fl.Matrix4,this._projectMatrix=new fl.Matrix4,this.setScale3d(1,1,-1),this._projectMatrixDirty=!0};fb.CubeDirectionParam=[1,0,0,0,-1,0,-1,0,0,0,-1,0,0,1,0,0,0,1,0,-1,0,0,0,-1,0,0,1,0,-1,0,0,0,-1,0,-1,0],Db("Camera",Oh,{ms_ac:["cullingMask"],_cullingMask:3,_22Q:function(){return Camera3dUI},attachRenderTarget:function(L){this._projectMatrixDirty=!0,this.renderTarget=L},detachRenderTarget:function(){this._projectMatrixDirty=!0,this.renderTarget=null},isLayerVisible:function(q){return cs(this._cullingMask,q)},isOrtho:function(){return"ortho"===this.s("camera.type")&&!this.isCube()},isCube:function(){return this.renderTarget&&this.renderTarget.isCube()},isPerspective:function(){return!this.isOrtho()},setViewMatrix:function(){var C=new y.Math.Matrix4,H=new y.Math.Euler;return function(K){var x=this;K.isMatrix4?x._viewMatrix.copy(K):x._viewMatrix.fromArray(K),C.getInverse(x._viewMatrix),x.p3(C.getPosition().toArray()),H.set(0,0,0,x.getRotationMode(),!0).setFromRotationMatrix(C),x.r3([H.x,H.y,H.z])}}(),getViewMatrix:function(r){var $=this,g=xm(null,null,$.r3(),$.getRotationMode(),$.p3()),J=$._viewMatrix;return J.fromArray(g).getInverse(J),J.toArray(r)},setProjectMatrix:function(J){var o=this;J.isMatrix4?o._projectMatrix.copy(J):o._projectMatrix.fromArray(J),J=o._projectMatrix.getElements(),o.isOrtho()?o.s({"camera.near":(J[14]+1)/J[10],"camera.far":(J[14]-1)/J[10],"camera.ortho.width":2/J[0]}):o.s({"camera.near":J[14]/(J[10]-1),"camera.far":J[14]/(J[10]+1),"camera.fovy":2*Math.atan(1/J[5]),"camera.aspect":J[5]/J[0]}),o._projectMatrixDirty=!1
},onPropertyChanged:function(v){var M=this;fb.superClass.onPropertyChanged.call(M,v);var x=v.property;("s:camera.near"===x||"s:camera.far"===x||"s:camera.fovy"===x||"s:camera.aspect"===x||"s:camera.ortho.width"===x)&&(M._projectMatrixDirty=!0)},getProjectMatrix:function(){var R=this;if(R._projectMatrixDirty){var o=R.gv,f=R.isCube(),y=f?1:R.s("camera.aspect")||(o?o.getAspect():null)||F.graph3dViewAspect,s=R.s("camera.near")||(o?o.getNear():null)||F.graph3dViewNear,e=R.s("camera.far")||(o?o.getFar():null)||F.graph3dViewFar,k=Gj();if(R.isOrtho()){var V=R.s("camera.ortho.width")||(o?o.getOrthoWidth():null)||F.graph3dViewOrthoWidth,r=V/2,B=r/y;ui(k,-r,r,-B,B,s,e)}else{var S=f?Math.PI/2:R.s("camera.fovy")||(o?o.getFovy():null)||F.graph3dViewFovy;Ud(k,S,y,s,e)}R._projectMatrix.fromArray(k),R._projectMatrixDirty=!1}return R._projectMatrix.toArray()},lookAt:function(Z,J){var d=this.p3();return Z.x?this.lookAtDirection([Z.x-d[0],Z.y-d[1],Z.z-d[2]],J):this.lookAtDirection([Z[0]-d[0],Z[1]-d[1],Z[2]-d[2]],J)},lookAtDirection:function(){var M=new y.Math.Matrix4,R=new y.Math.Euler,q=new y.Math.Vector3,k=new y.Math.Vector3;return function(S,h){M.lookAtDirection(q.copy(S).multiplyScalar(-1),h?k.copy(h):k.set(0,1,0)),R.set(0,0,0,this.getRotationMode(),!0).setFromRotationMatrix(M),this.r3([R.x,R.y,R.z])}}(),updateAndRender:function(I){return I.syncRenderState(),I.updateScene(),this.render(I)},render:function(r){var q=this,j=r.getGL();if(!j)return!1;var W,z,f=q.renderTarget;if(f)W=f.width,z=f.height;else{var Q=r.getDevicePixelRatio();W=r.getWidth()*Q,z=r.getHeight()*Q}q.gv=r,r._camera=q,r._18Q=null;var P=r._frameState.renderState.glState,M=P.color.clear.slice(0);Wp(j,q.s("camera.background"));var K=r.getEye;if(r.getEye=function(){return q.p3()},q.isCube())for(var S=fb.CubeDirectionParam,X=0;6>X;X++)f&&f.bind(j,X),q.lookAtDirection([S[6*X+0],S[6*X+1],S[6*X+2]],[S[6*X+3],S[6*X+4],S[6*X+5]]),q.s("camera.clear")!==!1&&j.clear(j.COLOR_BUFFER_BIT),r.setViewport(j,0,0,W,z),q.s("camera.onlySky")?r.renderSky():r.renderScene({renderAxis:q.s("camera.renderAxis"),renderGrid:q.s("camera.renderGrid"),renderEdit:q.s("camera.renderEdit"),renderReflector:!1}),f&&f.unbind(j);else f&&f.bind(j),q.s("camera.clear")!==!1&&j.clear(j.COLOR_BUFFER_BIT),r.overlappingBox.clear(),r.setViewport(j,0,0,W,z),q.s("camera.onlySky")?r.renderSky():r.renderScene({renderAxis:q.s("camera.renderAxis"),renderGrid:q.s("camera.renderGrid"),renderEdit:q.s("camera.renderEdit")}),f&&f.unbind(j);return r.getEye=K,Wp(j,M),r._18Q=null,r._camera=null,q.gv=null,!0}});var Jc=y.Block=function(){Iq(Jc,this),this.s({"shadow.cast":!1,"shadow.receive":!1})};Db("Block",Oh,{_icon:"block_icon",_clickThroughEnabled:!1,_syncSize:!0,_scaleMode:"2d",ms_ac:["clickThroughEnabled","syncSize","scaleMode"],getUIClass:function(){return zf},_22Q:function(){return mt},onChildAdded:function(){Jc.superClass.onChildAdded.apply(this,arguments),this.updateFromChildren()},onChildRemoved:function(){Jc.superClass.onChildRemoved.apply(this,arguments),this.updateFromChildren()},_getBoundingBox:function(){function P(K,f,U){g.fromArray(rg(f));var G=f.getAnchor3d();K.push((new Vg).set(0-G.x,0-G.y,0-G.z).applyMatrix4(g).applyMatrix4(U)),K.push((new Vg).set(0-G.x,0-G.y,1-G.z).applyMatrix4(g).applyMatrix4(U)),K.push((new Vg).set(0-G.x,1-G.y,0-G.z).applyMatrix4(g).applyMatrix4(U)),K.push((new Vg).set(0-G.x,1-G.y,1-G.z).applyMatrix4(g).applyMatrix4(U)),K.push((new Vg).set(1-G.x,0-G.y,0-G.z).applyMatrix4(g).applyMatrix4(U)),K.push((new Vg).set(1-G.x,0-G.y,1-G.z).applyMatrix4(g).applyMatrix4(U)),K.push((new Vg).set(1-G.x,1-G.y,0-G.z).applyMatrix4(g).applyMatrix4(U)),K.push((new Vg).set(1-G.x,1-G.y,1-G.z).applyMatrix4(g).applyMatrix4(U))}function n(O,C){var Q=(new Ic).makeRotationFromEuler(this.getEuler()).setPosition((new Vg).fromArray(this.p3()));Q.getInverse(Q),O.forEach(function(g){cl(g)&&P(C,g,Q)})}var g=new Ic;return function(G,A){if(G instanceof Oh&&(G=[G]),!G||0===G.length)return N;var A=[];n.call(this,G,A);var K=[1/0,1/0,1/0],s=[-1/0,-1/0,-1/0];return A.forEach(function(D){K[0]=Math.min(D.x,K[0]),K[1]=Math.min(D.y,K[1]),K[2]=Math.min(D.z,K[2]),s[0]=Math.max(D.x,s[0]),s[1]=Math.max(D.y,s[1]),s[2]=Math.max(D.z,s[2])}),{min:K,max:s}}}(),updateFromChildren:function(){var r=this;if(!vd&&!r._updatingToChildren&&r._syncSize&&0!==r.size()&&!r._freezeSyncFromChildren){var u=this._getBoundingBox(r.toChildren(cl));if(u){r._updatingFromChildren=1;var J=(new Vg).fromArray(this.getScale3d()),T=(new Vg).fromArray(u.min),g=(new Vg).fromArray(u.max),R=F.blockMinSize,l=new Vg,C=g.clone().sub(T);0===C.x&&l.setX(.5),0===C.y&&l.setY(.5),0===C.z&&l.setZ(.5);var s=this._width==N||-1===this._width,H=new Vg(this.getAnchor3d()),G=J.clone().multiply((new Vg).fromArray(this.s3())),j=C.clone();0===j.x&&j.setX(R),0===j.y&&j.setY(R),0===j.z&&j.setZ(R);var W=H.clone().multiply(G),Y=W.clone().multiplyScalar(-1).sub(T).divide(j).add(W.divide(j)).add(l),c=this.s("keepPosition");if(s||this._anchorChanged||this._scaleChanged||!c){!s&&c&&(H=Y);var o=H.clone().multiply(C).add(T).applyEuler(this.getEuler()).add((new Vg).fromArray(this.p3()));this.p3([o.x,o.y,o.z])}else this.setAnchor3d(Y.x,Y.y,Y.z);var e=new Vg(1,1,1).divide(J).multiply(C);this.s3(Math.abs(e.x),Math.abs(e.y),Math.abs(e.z)),delete r._updatingFromChildren}}},setPosition:function(r,Q){var n=this;if(!n._updatingToChildren){var E;E=2===arguments.length?{x:r,y:Q}:r,vd||n._updatingFromChildren||(n._updatingToChildren=1,vs(n._children,E.x-n._position.x,E.y-n._position.y),delete n._updatingToChildren),Jc.superClass.setPosition.call(this,E)}},setSize3d:function(){this.beginTransaction(),Jc.superClass.setSize3d.apply(this,arguments),this.endTransaction()},setTall:function(O){var a=this;if(!a._updatingToChildren){this.beginTransaction(),O=n(O,F.blockMinSize);var G=a.getTall();if(O!==G&&Jc.superClass.setTall.call(a,O),!vd&&!a._updatingFromChildren){a._updatingToChildren=1;var C=O/G;a._adjustChildTallOrScale(C,"size"),delete a._updatingToChildren,a.updateFromChildren()}this.endTransaction()}},setWidth:function(I){return this.setSize(I,this.getHeight())},setHeight:function(l){return this.setSize(this.getWidth(),l)},setSize:function(O,L){var $=F.blockMinSize;O=n(O,$),L=n(L,$);var U=this;if(!U._updatingToChildren){2!==arguments.length&&(L=O.height,O=O.width),this.beginTransaction();var r=U.getWidth(),o=U.getHeight();if(O!==r&&Jc.superClass.setWidth.call(U,O),L!==o&&Jc.superClass.setHeight.call(U,L),!vd&&!U._updatingFromChildren){U._updatingToChildren=1;var V=O/r,g=L/o;U._adjustChildScaleOrSize(V,g,"size"),delete U._updatingToChildren,U.updateFromChildren()}this.endTransaction()}},_adjustChildScaleOrSize:function(K,U,H){var m=this;if(m._syncSize){var j=m.getPosition(),M=m.getRotation();m.eachChild(function(R){if(cl(R)){var z=R.getPosition(),l=R.getRotation(),q=R.getWidth(),i=R.getHeight(),C=R.getScale(),G=C.x*q,V=C.y*i;if(0!==G&&0!==V){0>K*U&&R.setRotation(-1*l);var S=new zg(l,z.x,z.y,G,V);S.translate(-j.x,-j.y),S.rotate(-M),l=ge(S.b*Math.sign(G),S.a*Math.sign(G)),S.scale(K,U);var k,h,n,X=s(l);if(Math.abs(X)<.001?(k=W(l),h=S.b/k,n=-S.c/k):(h=S.a/X,n=S.d/X),"scale"===H)R.setScale(h/q,n/i);else if("size"===H){var Y=h/C.x,A=n/C.y;R.setScale(hi(h)*Math.abs(C.x),hi(n)*Math.abs(C.y)),R instanceof y.Shape?(R.setWidthForce(Math.max(Math.abs(Y),1e-5)),R.setHeightForce(Math.max(Math.abs(A),1e-5))):R.setSize(Math.max(.01,Math.abs(Y)),Math.max(.01,Math.abs(A)))}S.rotate(M),S.translate(j.x,j.y),R.setPosition(S.tx,S.ty)}}})}},_calcChangeFactor:function(i,e,j,V){var c,K,w,f;return c=u(i),K=u(j),w=c>K?c/K:K/c,c=u(e),K=u(V),f=c>K?c/K:K/c,n(w,f)},setElevation:function(S){var b=this;if(!b._updatingToChildren){var K=b.getElevation(),m=S-K;0!==m&&(vd||b._updatingFromChildren||(b._updatingToChildren=1,vs(b._children,0,m,0),delete b._updatingToChildren),Jc.superClass.setElevation.apply(b,arguments))}},setScaleTall:function(c){var X=this;if(!X._updatingToChildren){var n=X.getScaleTall();if(u(c)<.01&&(c=.01*(hi(c)||hi(n))),"3d"===X._scaleMode){var J=X.getScale();return X.setScale3d(J.x,c,J.y),void 0}if(Jc.superClass.setScaleTall.call(X,c),!vd&&!X._updatingFromChildren){X._updatingToChildren=1;var $=c/n;X._adjustChildTallOrScale($,"scale"),delete X._updatingToChildren,X._scaleChanged=1,this.updateFromChildren(),delete X._scaleChanged}}},_adjustChildTallOrScale:function(m,P){var l=this;if(l._syncSize){var y=l.getElevation();l.eachChild(function(u){if(cl(u)){if("size"===P){var v=u.getTall();0>m&&u.setScaleTall(-1*u.getScaleTall()),u.setTall(Math.max(.01,Math.abs(v*m)))}else{var A=u.getScaleTall();u.setScaleTall(A*m)}u.setElevation(y+(u.getElevation()-y)*m)}})}},setAnchor3d:function(){if(!this._updatingToChildren){this.beginTransaction();var J=Jc.superClass.setAnchor3d.apply(this,arguments);return J&&!vd&&!this._updatingFromChildren&&this._syncSize&&(this._anchorChanged=1,this.updateFromChildren(),delete this._anchorChanged),this.endTransaction(),J}},setAnchor:function(){var Y=this;if(!Y._updatingToChildren){var y=Y.getAnchor(),c=Jc.superClass.setAnchor.apply(Y,arguments);if(vd||Y._updatingFromChildren||!Y._syncSize)return c;Y._updatingToChildren=1;var G=Y.getAnchor(),M=Y.getSize(),i=M.width*(y.x-G.x),b=M.height*(y.y-G.y),Q=(new Ic).compose(new Vg,this.getQuaternion(),new Vg(this.getScale3d())),F=new Vg(i,0,b).applyMatrix4(Q);return Y.eachChild(function(g){if(cl(g)){var W=new Vg(g.p3());g.p3(W.add(F).toArray())}}),delete Y._updatingToChildren,c}},setAnchorElevation:function(){var i=this;if(!i._updatingToChildren){var g=i.getAnchorElevation(),X=Jc.superClass.setAnchorElevation.apply(i,arguments);if(vd||i._updatingFromChildren||!i._syncSize)return X;i._updatingToChildren=1;var K=i.getAnchorElevation(),n=i.getTall()*(g-K),t=(new Ic).compose(new Vg,this.getQuaternion(),new Vg(this.getScale3d())),w=new Vg(0,n,0).applyMatrix4(t);return i.eachChild(function(U){if(cl(U)){var f=new Vg(U.p3());U.p3(f.add(w).toArray())}}),delete i._updatingToChildren,X}},setRotation:function(B){this._updateChildrenRotation3d("rotation",B)},setRotationX:function(z){this._updateChildrenRotation3d("rotationX",z)},setRotationZ:function(E){this._updateChildrenRotation3d("rotationZ",E)},setRotation3d:function(){var f=this;if(!f._updatingToChildren){var g=f.r3();Jc.superClass.setRotation3d.apply(f,arguments);var m=f.r3();vd||f._updatingFromChildren||(f._updatingToChildren=1,f.eachChild(function(N){cl(N)&&N.syncRotation3d(f,m,g)}),delete f._updatingToChildren)}},_updateChildrenRotation3d:function(y,W){var J=this;if(!J._updatingToChildren){var u=J[Nr(y)]();Jc.superClass[vb(y)].call(J,W),vd||J._updatingFromChildren||this._updateRotationToChildren(y,W-u)}},_updateRotationToChildren:function(B,Y){var K=this;K._updatingToChildren=1,K.eachChild(function(C){cl(C)&&C._11Q(K,B,Y)}),delete K._updatingToChildren},setScale:function(E,Z){var b=this;if(!b._updatingToChildren){null==Z&&(Z=E.y,E=E.x);var p=b.getScale();if(u(E)<.01&&(E=.01*(hi(E)||hi(p.x))),u(Z)<.01&&(Z=.01*(hi(Z)||hi(p.y))),"3d"===b._scaleMode)return b.setScale3d(E,b.getScaleTall(),Z),void 0;if(Jc.superClass.setScale.call(b,E,Z),!vd&&!b._updatingFromChildren){b._updatingToChildren=1;var n=E/p.x,J=Z/p.y;b._adjustChildScaleOrSize(n,J,"scale"),delete b._updatingToChildren,b._scaleChanged=1,b.updateFromChildren(),delete b._scaleChanged}}},onPropertyChanged:function(v){Jc.superClass.onPropertyChanged.call(this,v),"s:3d.visible"===v.property&&this._invalidateChildrenBatch()},_invalidateChildrenBatch:function(){this.eachChild(function(v){(v.s("batch")||v.s("wf.geometry")||v.s("wf.visible"))&&v.iv(),v instanceof Jc&&v._invalidateChildrenBatch()})},getSerializableProperties:function(){var Q=Jc.superClass.getSerializableProperties.call(this);return Q.clickThroughEnabled=1,Q.syncSize=1,Q.scaleMode=1,Q},setScale3d:function(){var j=new Vg,X=new Vg,H=new Vg,s=new Ic,$=new $i,t=new Vg;return function(U,O,n){var D,h=this;if(D="number"==typeof U?{x:U,y:O,z:n}:U.length?{x:U[0],y:U[1],z:U[2]}:U,"3d"!==h._scaleMode)return Jc.superClass.setScale3d.apply(h,arguments),void 0;if(h._syncSize&&0!==h.size()){var x=h.getMatrix4();x.getInverse(x),Jc.superClass.setScaleTall.call(h,D.y),Jc.superClass.setScale.call(h,D.x,D.z);var l=h.getMatrix4();vd||h._updatingFromChildren||(h._updatingToChildren=1,h.eachChild(function(f){if(cl(f)){if(X.fromArray(f.s3()),f instanceof y.Polyline){var P=f.getThickness();X.x=X.x||P,X.y=X.y||P,X.z=X.z||P,t.copy(f.getScale3d()).multiplyScalar(P),f.getQuaternion($),j.copy(f.p3()),H.copy(f.getFinalScale3d()),H.x=H.x||t.x,H.y=H.y||t.y,H.z=H.z||t.z,s.compose(j,$,H)}else f.getMatrix4(s);s.premultiply(x).premultiply(l),s.decompose(j,$,H),H.divide(X),f.setQuaternion($),f.p3(j.toArray()),f.setScale3d(H.toArray())}}),delete h._updatingToChildren,h._scaleChanged=1,h.updateFromChildren(),delete h._scaleChanged)}}}()});var zk=y.Grid=function(){Iq(y.Grid,this)};Db("Grid",Oh,{IRotatable:!1,_icon:"grid_icon",_image:N,getUIClass:function(){return Cd},setRotation:function(){},getCellRect:function(L,Z){var W=this,l=W.s("grid.row.count"),g=W.s("grid.column.count");if(0>=l||0>=g||0>L||L>=l||0>Z||Z>=g)return N;var s,c,h,U=W.getRect(),k=W.s("grid.row.percents"),e=W.s("grid.column.percents");if(_e(U,W,"grid.border",-1),k&&k._as&&(k=k._as),e&&e._as&&(e=e._as),k&&k.length===l){for(h=0,s=0;L>s;s++)h+=U.height*k[s];U.y+=h,U.height=U.height*k[L]}else U.height=U.height/l,U.y+=U.height*L;if(e&&e.length===g){for(c=0,s=0;Z>s;s++)c+=U.width*e[s];U.x+=c,U.width=U.width*e[Z]}else U.width=U.width/g,U.x+=U.width*Z;return Oj(U,-W.s("grid.gap")),U}});var nn=y.Text=function(){Iq(nn,this),this.setSize(100,50),this.s("text","TEXT")};Db("Text",Oh,{_icon:"text_icon",_image:"__text__",getUIClass:function(){return ir},setWidth:function(f){f||(f=.001),nn.superClass.setWidth.call(this,f)},setHeight:function(J){J||(J=.001),nn.superClass.setHeight.call(this,J)},toLabel:function(){return this._displayName||this._name||this.s("text")}}),mg("__text__",{width:{value:100,isSafeFunc:!0,func:function(z){return z?z._width:100}},height:{value:50,isSafeFunc:!0,func:function(X){return X?X._height:50}},comps:[{type:"text",relative:!0,rect:[0,0,1,1],text:{func:"style@text"},align:{func:"style@text.align"},vAlign:{func:"style@text.vAlign"},color:{func:"style@text.color"},font:{func:"style@text.font"},shadow:{func:"style@text.shadow"},shadowColor:{func:"style@text.shadow.color"},shadowBlur:{func:"style@text.shadow.blur"},shadowOffsetX:{func:"style@text.shadow.offset.x"},shadowOffsetY:{func:"style@text.shadow.offset.y"},scaleX:{func:"style@text.scale.x"},scaleY:{func:"style@text.scale.y"},gradient:{func:"style@text.gradient"},gradientColor:{func:"style@text.gradient.color"},gradientPack:{func:"style@text.gradient.pack"},decoration:{func:"style@text.decoration"},vertical:{func:"style@text.vertical"},verticalGap:{func:"style@text.vertical.gap"},wrap:{func:"style@text.wrap"},letterGap:{func:"style@text.letter.gap"},borderWidth:{func:"style@text.border.width"},borderColor:{func:"style@text.border.color"}}]});var Zf=y.Shape=function(){Iq(Zf,this),this._59O=new Ik};Zf.__de__=lh,Db("Shape",Oh,{ms_ac:["thickness","closePath"],_icon:"shape_icon",_thickness:10,_closePath:!1,getUIClass:function(){return qb},_22Q:function(){return ot},getLength:function($){return Rg($m(this._59O,this._58O,$,this._closePath))},getSegments:function(){return this._58O},toSegments:function(){var q=this._58O;return q?new Ik(q._as.slice(0)):q},setSegments:function(H){var t=this._58O;H=H?hr(H)?new Ik(H.slice(0)):new Ik(H._as.slice(0)):null,(t&&H&&t._as.join(",")!==H._as.join(",")||t!==H)&&(this._58O=H,this.fp("segments",t,H))},getPoints:function(){return this._59O},toPoints:function(){var Z=this._59O;return new Ik(Z._as.slice(0))},getPointsMatrix2d:function(){var L=this,B=new fl.Matrix2d,W=L.getPosition(),t=L.getScale(),k=L.getRotation();return B.translate(-W.x,-W.y).scale(t.x,t.y).rotate(k).translate(W.x,W.y),B},getPointsMatrix3d:function(){return function(){var t=this,h=new fl.Matrix4,o=h.getElements(),s=t.p3();Yc(o,s),ao(o,t.getFinalRotation3d(),t.getRotationMode());var K=t.getScale3d(),j=t._dynamicScale3d;return j&&(K[0]*=j[0],K[1]*=j[1],K[2]*=j[2]),gr(o,K),Yc(o,mk(s)),h}}(),setPoints:function(M,O){var h=this,w=h._59O;M=M?hr(M)?new Ik(M.slice(0)):new Ik(M._as.slice(0)):new Ik;var V,i,E,z,G,e;O&&(V=h.getPosition(),e=new zg(h.getRotation(),0,0,h.getScale().x,h.getScale().y)),(w&&M&&w._as.join(",")!==M._as.join(",")||w!==M)&&(h._59O=M,h.fs(),h.fp("points",w,M)),O&&(i=h.getPosition(),E=i.x-V.x,z=i.y-V.y,G=e.tf(E,z),h.setPosition(i.x-E+G.x,i.y-z+G.y))},setPoints3d:function(b,Q){var C=new Vg(this.p3()),K=this.getPointsMatrix3d();if(K.setPosition(new Vg),Li.superClass.setPoints.call(this,b),Q){var J=new Vg(this.p3()),u=J.clone().sub(C).applyMatrix4(K);C.add(u),this.p3(C.x,C.y,C.z)}},addPoint:function(F,O,W){var Y=this.toPoints();Y.add(F,O),this.setPoints(Y,W)},setPoint:function($,b,P){var j=this.toPoints();j.set($,b),this.setPoints(j,P)},removePointAt:function(U){var H=this.toPoints();H.removeAt(U),this.setPoints(H)},setWidthForce:function(Y){var e=this;if(!e._55I&&!vd&&e.getWidth()){e._55I=1;var P=e._position.x,Z=Y/e.getWidth(),p=e.toPoints(),s=new Ik;1!==Z&&(p.each(function(c){s.add({x:(c.x-P)*Z+P,y:c.y,e:c.e})}),e.setPoints(s),Sn(e,[Z,0,0,1,P*(1-Z),0]),e.fs()),delete e._55I}Zf.superClass.setWidth.call(e,Y)},setWidth:function(T){return this.setWidthForce(Qq>T?Qq:T)},setHeightForce:function(U){var n=this;if(!n._55I&&!vd&&n.getHeight()){n._55I=1;var E=n._position.y,M=U/n.getHeight(),l=n.toPoints(),$=new Ik;1!==M&&(l.each(function(p){$.add({x:p.x,y:(p.y-E)*M+E,e:p.e})}),n.setPoints($),Sn(n,[1,0,0,M,0,E*(1-M)]),n.fs()),delete n._55I}Zf.superClass.setHeight.call(n,U)},setHeight:function(o){return this.setHeightForce(Qq>o?Qq:o)},setAnchorElevation:function(s){var d=this;d._55I=!0;var D=d._updatingAnchor3d,N=!vd&&!D;if(N){var I,C=s,M=d.getAnchorElevation(),G=d.getTall();I=G*(M-C),0!==I&&d.shiftPointsElevation(I)}var J=Zf.superClass.setAnchorElevation.apply(d,arguments);return D||delete d._55I,J},getShapeElevation:function(){var V=this,Z=V._54O;return Z-(V.getTall()||0)*(V._anchorElevation-.5)},setAnchor3d:function($,P,B,L){var c,i=this;if("number"==typeof $?c={x:$,y:P,z:B}:(c=$.length?{x:$[0],y:$[1],z:$[2]}:$,L=P),i._55I=!0,i._updatingAnchor3d=!0,i.beginTransaction(),!vd){var b=i.getAnchor3d(),r=i.getSize(),G=i.getTall(),k=r.width*(b.x-c.x),n=r.height*(b.z-c.z),Z=G*(b.y-c.y);L||i.shiftPoints(k,n,Z);var s=i.p3()}var j=Zf.superClass.setAnchor3d.apply(i,arguments);if(!vd&&L){var R=i.p3();i.shiftPoints(R[0]-s[0]+k,R[2]-s[2]+n,R[1]-s[1]+Z)}return i.endTransaction(),delete i._updatingAnchor3d,delete i._55I,j},setAnchor:function(M,u,$){var h=this;h._55I=!0;var K=h._updatingAnchor3d,B=!vd&&!K;if(B){var H,C,X;"number"==typeof M?X={x:M,y:u}:(X=M.length?{x:M[0],y:M[1]}:M,$=u);var F=h.getAnchor(),x=h.getSize();H=x.width*(F.x-X.x),C=x.height*(F.y-X.y),$||h.shiftPoints(H,C);var Y=h.getPosition()}var w=Zf.superClass.setAnchor.apply(h,arguments);if(B){var l=h.getPosition();$&&h.shiftPoints(l.x-Y.x+H,l.y-Y.y+C)}return K||delete h._55I,w},shiftPoints:function(E,m,o){if(E||m||o){var Q=this,C=Q.getElevation()||0,d=Q.toPoints(),c=new Ik;d.each(function(T){var q=T.e;o&&(q=(q==N?C:q)+o),c.add({x:T.x+E,y:T.y+m,e:q})}),Q.setPoints(c),Q.fs()}},shiftPointsElevation:function(B){return this.shiftPoints(0,0,B)},setPosition:function(y,G){var N,O=this;if(!O._28Q){if(O._28Q=1,!O._55I&&!vd){N=2===arguments.length?{x:y,y:G}:y;var P=N.x-O._position.x,_=N.y-O._position.y;if(0===P&&0===_)return delete O._28Q,void 0;O._55I=1,O.shiftPoints(P,_),Sn(O,[1,0,0,1,P,_]),delete O._55I}Zf.superClass.setPosition.apply(O,arguments),delete O._28Q}},fs:function(){this.fireShapeChange()},_70I:function(){var Y=this;if(2!==Y._59O.size())return!1;var S=Y._58O;return S?2===S.size()&&1===S.get(0)&&2===S.get(1)?!0:!1:!0},fireShapeChange:function(){var C=this;if(!C._55I&&!vd){var p=Jf(C._59O);p&&(C._55I=1,C.setRect(p),delete C._55I)}C.fp(Kb,!1,!0)},getSerializableProperties:function(){var d=Zf.superClass.getSerializableProperties.call(this);return d.segments=1,d.points=1,d.thickness=1,d.closePath=1,d}});var Mq=y.Points=function(){Iq(Mq,this)};Db("Points",Oh,{_59O:[],_colors:[],_sizes:[],_uvoffsets:[],_22Q:function(){return pt},getPoints:function(){return this._59O},setPoints:function(D){var C=this._59O;D=D?D.slice(0):[];var H=D[0];if(dm(H)){var Z=D;D=[];for(var G=0,l=Z.length;l>G;G+=3)D.push({x:Z[G],e:Z[G+1],y:Z[G+2]})}this._59O=D,this._pointsDirty=!0,this.fp("points",C,this._59O)},setPoint:function(J,$){var g=this._59O.slice(0);g[J]=$,this.setPoints(g)},addPoint:function(U){this.setPoint(this._59O.length,U)},getColors:function(){return this._colors},setColors:function(P){var m=this._colors;P=P?P.slice(0):[],this._colors=P,this._colorsDirty=!0,this.fp("colors",m,P)},setPointColor:function(X,r){var Z=this._colors.slice(0);Z[X]=r,this.setColors(Z)},getSizes:function(){return this._sizes},setSizes:function(D){var m=this._sizes;D=D?D.slice(0):[],this._sizes=D,this._sizesDirty=!0,this.fp("sizes",m,this._sizes)},setPointSize:function(z,L){var u=this._sizes.slice(0);u[z]=L,this.setSizes(u)},getUvoffsets:function(){return this._uvoffsets},setUvoffsets:function(U){var L=this._uvoffsets;U=U?U.slice(0):[],this._uvoffsets=U,this._offsetsDirty=!0,this.fp("uvoffsets",L,this._uvoffsets)},setPointUvoffset:function(G,N,B){var t;"object"==typeof N?(t=N[0],B=N[1]):t=N;var Y=this._uvoffsets.slice(0);Y[2*G+0]=t,Y[2*G+1]=B,this.setUvoffsets(Y)},getPointInfo:function(u){var I=this.getPoints();if(!I||I[u]==N)return N;var l=I[u],z=[l.x,l.e,l.y],q=this.mat||rg(this),n=[z[0],z[1],z[2]];wq(n,q);var F=this.getColors(),H=F[u]||this.s("points.color"),U=this.getSizes(),x=U[u];return{size:x==N?this.s("points.size"):x,color:H,local:z,world:n}},getSerializableProperties:function(){var c=Mq.superClass.getSerializableProperties.call(this);return c.points=1,c.colors=1,c.sizes=1,c.uvoffsets=1,c},onPropertyChanged:function(S){Mq.superClass.onPropertyChanged.call(this,S);var e=S.property;"s:points.color"===e?this._colorsDirty=!0:"s:points.size"===e?this._sizesDirty=!0:"s:points.model"===e&&(this._modelDirty=!0)},getWidth:function(){var u=this;if(u._width>=0)return u._width;var D=u.getStyle("points.model");if(D){var h=oi(D);if(h&&h.rawS3)return h.rawS3[0]}return 1},getHeight:function(){var F=this;if(F._height>=0)return F._height;var k=F.getStyle("points.model");if(k){var N=oi(k);if(N&&N.rawS3)return N.rawS3[2]}return 1},getTall:function(){var E=this;if(E._tall>=0)return E._tall;var p=E.getStyle("points.model");if(p){var I=oi(p);if(I&&I.rawS3)return I.rawS3[1]}return 1}});var Li=y.Polyline=function(){Iq(Li,this),this.s({"shape.background":null,"shape.border.width":2})};Db("Polyline",Zf,{_icon:"polyline_icon",_22Q:function(){return st},getUIClass:function(){return Of},setClosePath:function(){},setTall:function(l){var p=this;if(p.beginTransaction(),!p._55I&&!p._24Q&&!vd&&p.getTall()){p._24Q=1;var f=p._54O,h=l/p.getTall();if(1!==h){var s=p.toPoints(),u=new Ik;s.each(function(q){u.add({x:q.x,y:q.y,e:q.e==N?q.e:(q.e-f)*h+f})}),p.setPoints(u),p.fs()}delete p._24Q}Li.superClass.setTall.call(p,l),p.endTransaction()},setElevation:function(I){var g=this;if(g.beginTransaction(),!g._55I&&!g._24Q&&!vd){g._24Q=1;var M=I-g._54O;0!==M&&g.shiftPointsElevation(M),delete g._24Q}Li.superClass.setElevation.apply(g,arguments),g.endTransaction()},fireShapeChange:function(){var e=this,v=e._59O;if(!e._55I&&!e._24Q&&!vd){var i=v.size();if(i){var z=1,F=v.get(0),P=e._54O;F.e==N&&(F.e=P);for(var W=F.e,r=0;i>z;z++){F=v.get(z),F.e==N&&(F.e=P);var C=J(W,F.e),S=n(W+r,F.e);W=C,r=S-C}e._24Q=1,e.setTall(r),e.setElevation(W+r*e._anchorElevation),delete e._24Q}}Li.superClass.fireShapeChange.apply(e,arguments)},onPropertyChanged:function(){var p={};return["points","segments","thickness","position","elevation","rotation","rotationX","rotationZ","rotationMode","scale","scaleTall","s:shape.border.color","s:shape.border.gradient.color","s:shape.border.pattern","s:shape.dash","s:shape.dash.color","s:shape.dash.pattern","s:shape.dash.offset","s:shape.dash","s:shape.dash","s:3d.clip.direction","s:repeat.uv.length","s:body.color","s:shape3d","s:shape3d.visible","s:shape3d.image","s:shape3d.smooth","s:shape3d.resolution","s:shape3d.color","s:shape3d.blend","s:shape3d.side","s:shape3d.start.angle","s:shape3d.sweep.angle","s:shape3d.top.cap","s:shape3d.top.image","s:shape3d.top.visible","s:shape3d.top.color","s:shape3d.bottom.cap","s:shape3d.bottom.image","s:shape3d.bottom.visible","s:shape3d.bottom.color","s:shape3d.from.visible","s:shape3d.from.color","s:shape3d.to.visible","s:shape3d.to.color","s:shape3d.uv.union"].forEach(function(k){p[k]=!0}),function(j){Li.superClass.onPropertyChanged.call(this,j),p[j.property]&&(this._needChangeGeometry=!0)}}()});var $l=y.SubGraph=function(){Iq($l,this)};Db("SubGraph",Oh,{ISubGraph:1,_image:"subGraph_image",_icon:"subGraph_icon",_8I:function(){$l.superClass._8I.call(this),this.eachChild(function(L){cl(L)&&L._8I()})}}),F.loadingRefGraph=0;var Wq=y.RefGraph=function(){Iq(Wq,this)};Db("RefGraph",Jc,{_icon:"refGraph_icon",getRef:function(){return this._ref},setRef:function(s){var z=this._ref;this._ref=s,this.fp("ref",z,s),this.updateRef()},_21I:function(){Wq.superClass._21I.apply(this,arguments),this.updateRef()},updateRef:function(){var i=this;if(F.loadingRefGraph++,i.clearChildrenFromDataModel(),F.loadingRefGraph--,i._ref&&i._dataModel){i._xhrLoadHandler&&(i._xhrLoadHandler.cancel=!0);var o=vd,L=i._xhrLoadHandler=function(Z){if(Z&&i._dataModel){F.loadingRefGraph++;var p=i._pendingUpdateInfo={needToRestore:o};o&&(p.p3=i.p3(),p.s3=i.s3(),p.r3=i.r3(),p.anchor3d=i.getAnchor3d(),p.scale3d=i.getScale3d()),i.r3(0,0,0),i.setScale3d(1,1,1),i.setAnchor3d(.5,.5,.5),i.p3(0,0,0);var u=F.parse(Z),t=i._dataModel.deserialize(u,i,{justDatas:!0});t.each(function(y){y._refGraph=i}),i.checkPendingUpdateInfo(),F.loadingRefGraph--,F.handleRefGraphLoaded(i,t,u)}};L.xhrLoadCalled=!1,F.load(i._ref,function(w){L.cancel||(L.xhrLoadCalled?L(w):hh(function(){L(w)}))}),L.xhrLoadCalled=!0}},checkPendingUpdateInfo:function(){var y=this,X=y._pendingUpdateInfo;if(!X)return y.onPendingUpdated&&(F.loadingRefGraph++,y.onPendingUpdated(),F.loadingRefGraph--),void 0;var s=!0;this.eachChild(function(P){(P._pendingCheckImageJSON||P._pendingUpdateInfo)&&(s=!1)}),s&&(F.loadingRefGraph++,y._pendingUpdateInfo=null,y.updateFromChildren(),X.needToRestore&&(y.setAnchor3d(X.anchor3d),y.setScale3d(X.scale3d),y.r3(X.r3),y.p3(X.p3)),this.getParent()instanceof Wq&&this.getParent().checkPendingUpdateInfo(),y.onPendingUpdated&&y.onPendingUpdated(),F.loadingRefGraph--)},getSerializableProperties:function(){var Q=Wq.superClass.getSerializableProperties.call(this);return Q.ref=1,Q}}),y.EdgeGroup=function(A,Y){this._70O=A,this._siblings=Y;for(var p,C,$=0,x=A.size(),Z=O[hq];x>$;$++)if(p=A.get($).getStyle(hq,!1),p!=N){Z=p;break}Z==N&&(Z=!0);var v=F.edgeGroupAgentFunc;for(v&&(C=v(A),C&&C!==A.get(0)&&(A.remove(C),A.add(C,0))),$=0;x>$;$++)A.get($).s(hq,Z)},Db("EdgeGroup",C,{getEdges:function(){return this._70O},size:function(){return this._70O.size()},get:function(r){return this._70O.get(r)},indexOf:function(_){return this._70O.indexOf(_)},each:function(B,V){this._70O.each(B,V)},getSiblings:function(){return this._siblings},eachSiblingEdge:function(Q,p){this._siblings.each(function(R){R._70O.each(Q,p)})}});var Gk=function(d,W,K){var n=zd[d]={type:d,action:W};if(K)for(var o in K)n[o]=K[o]};xo(F,{setConnectAction:Gk,getConnectAction:function(N,e){if(!e){if(!N)return null;e=N.getCurrentConnectActionType()}return zd[e]},doConnectAction:function(O,A,V,N){N=N||O.getCurrentConnectActionType();var t=zd[N];if(!t)return!1;var D=t.action;return D?(A instanceof In.Group?O.sm().getSelection().each(function(J){D.call(null,O,J,V)}):D.call(null,O,A,V),!0):!1},doDeleteConnectionAction:function(D,T,r){r=r||D.getCurrentConnectActionType();var n=zd[r];if(!n||!n.delete)return!1;var O=n.delete.action;return O?(T instanceof In.Group?D.sm().getSelection().each(function(X){O.call(null,D,X)}):O.call(null,D,T),!0):!1}});var up=y.JSONSerializer=function(y,f){this.dm=this._dataModel=y,this._hierarchical=F.forceHierarchicalSerialization?!0:f==N?y.isHierarchicalRendering():f};Db("JSONSerializer",C,{ms_ac:["hierarchical"],serialize:function($){return F.stringify(this.toJSON(),$)},toJSON:function(){var C,q=this,c=q.dm,u=c.getRoots(),T=q.json={v:F.getVersion(),p:{},a:{},d:[]},V=c.getSerializableAttrs();(C=c.getInit())&&(T.init=C),(C=c.getName())&&(T.p.name=C),(C=c.getBackground())&&(T.p.background=C),(C=c.getLayers())&&(T.p.layers=C),(C=c.getEnvmap())&&(T.p.envmap=C),(C=c.getEnvmapType())&&(T.p.envmapType=C),T.p.autoAdjustIndex=c.isAutoAdjustIndex(),T.p.hierarchicalRendering=c.isHierarchicalRendering();for(var d in V){var $=c.a(d);$!==I&&q[jm](d,$,T.a)}return kl(T.a)&&delete T.a,q._hierarchical?u.each(q.serializeData,this):c.each(function(R){q.serializeData(R)}),c.fireSerializeEvent({type:"serialize",json:T}),c.getPostProcessingData()&&(T.p.postProcessingData=c.getPostProcessingData()),T},isSerializable:function(){return!0},getProperties:function(g){return g.getSerializableProperties()},getStyles:function(o){return o.getSerializableStyles()},getAttrs:function(b){return b.getSerializableAttrs()},serializeData:function(l){var U=this;if(U.isSerializable(l)&&!l._refGraph){var i,Y,P,D,C,L,s=gb(l.getClassName())||l.getClass(),Q=new s,H={c:l.getClassName(),i:l.getId(),p:{},s:{},a:{}};U.json.d.push(H),i=U.getProperties(l);for(Y in i)if(/^_/.test(Y)){if(P=l[Y],!("_width"!==Y&&"_height"!==Y||P!=N&&-1!==P)){if(C==I){var h;L=(l.s("layout.h")||l.s("layout.v"))&&l.getHost()||l instanceof y.Node&&(h=l.getParent())&&h instanceof y.Block||l.s("fullscreen"),C=l.hasInheritedSize()}L&&C&&(P=l[Y]="_width"===Y?l.getWidth():l.getHeight())}P!==Q[Y]&&U[jm](Y.substr(1),P,H.p)}else D=Nr(Y),l[D]&&(P=l[D](),P!==Q[D]()&&U[jm](Y,P,H.p));i=U.getStyles(l);for(Y in i)P=l.s(Y),P!==Q.s(Y)&&U[jm](Y,P,H.s);i=U.getAttrs(l);for(Y in i)P=l.a(Y),P!==Q.a(Y)&&U[jm](Y,P,H.a);kl(H.p)&&delete H.p,kl(H.s)&&delete H.s,kl(H.a)&&delete H.a}U._hierarchical&&l.getChildren().each(U.serializeData,U)},serializeValue:function(S,k,p){Np(k)?k={__a:k._as}:k instanceof dd?k={__i:k.getId()}:k instanceof _h&&(k={__dm:k.serialize(0)}),p[S]=k},deserialize:function(l,Y,D){var k=this;return Je(l)&&/.json$/.test(l)?(F.xhrLoad(l,function(j){k.deserializeImpl(j,Y,D)}),void 0):k.deserializeImpl(l,Y,D)},deserializeImpl:function(C,Y,h){var l=this,f=l.dm;f.setDeserializing(!0),h=xj(h)?{setId:h}:Cc(h)?{finishFunc:h}:h||{},C=l.json=Je(C)?F.parse(C):C,!h.justDatas&&C.a&&C.a.onPreDeserialize&&!h.disableOnPreDeserialize&&C.a.onPreDeserialize(C,f,h.view),f.beginTransaction(),vd++,l._82I={};var e=new Ik,o=new Ik,K=0,J=C.d.length;if(h.justDatas||(!h.disableInit&&Cc(C.init)&&C.init(f),f.setInit(C.init)),!h.justDatas){for(var O in C.a)f.a(O,l[Ek](C.a[O]));for(var G in C.p)f[vb(G)](C.p[G])}for(;J>K;K++){var r=C.d[K],Z=gb(r.c),E=new Z,Q=r.i;h.setId&&Q!=N&&(E._id=Q),l._82I[Q]=E,e.add(E),o.add(r)}for(K=0;J>K;K++)l.deserializeData(e.get(K),o.get(K));return e.each(function(l){Y&&!l.getParent()&&l.setParent(Y),f.add(l)}),h.__innerHandler__&&h.__innerHandler__(C,f,h.view,e),f.fireSerializeEvent({type:"deserialize",json:C}),vd--,lq||f.each(function(D){D instanceof Oh&&D.updateLayoutAttaches()}),f.endTransaction(),!h.justDatas&&C.a&&C.a.onPostDeserialize&&!h.disableOnPostDeserialize&&C.a.onPostDeserialize(C,f,h.view,e),h.finishFunc&&h.finishFunc(C,f,h.view,e),f.setDeserializing(!1),e},deserializeData:function(C,j){for(var $ in j.p)C[vb($)](this[Ek](j.p[$]));for($ in j.s)C.s($,this[Ek](j.s[$]));for($ in j.a)C.a($,this[Ek](j.a[$]))},deserializeValue:function(X){if(Go(X)){var A=X.__i;if(A!=N)return this._82I[A];if(A=X.__dm,A!=N){var K=new y.DataModel;return K.deserialize(A),K}if(A=X.__a,hr(A))return new Ik(A)}return X}}),xo(_h,{serialize:function(z,X){return new up(this,X).serialize(z)},toJSON:function(y){return new up(this,y).toJSON()},deserialize:function(w,k,D){return new up(this).deserialize(w,k,D)}});var sj=y.OverlappingBox=function(p){this.gv=p,this.boxes={}};Db("OverlappingBox",C,{clear:function(){var I,t,M=this.boxes;
for(I in M)t=M[I],t.length=0},isOverlapping:function(l,b){var y,L,G=this,X=G.boxes,_=X[l];_?(y=_.rects,L=_.length):_=X[l]={rects:y=[],length:L=0};var I,J,b;for(I=0;L>I;I++)if(J=y[I],J.x<b.x+b.w&&J.x+J.w>b.x&&J.y<b.y+b.h&&J.h+J.y>b.y)return!0;return y.length<=L?(y.push(b),_.length++):y[_.length++]=b,!1}}),xo(F,{fetch:function(e,K){K=K||{},e.open(K.method||"GET",K.url||"",!(null!=K.sync?K.sync:!1)),"json"===K.dataType&&e.setRequestHeader("Content-Type","application/json"),K.responseType&&(e.responseType=K.responseType),e.send(K.data)},convertImageSrc:function(P,z){z&&"function"==typeof z||(z=function(){}),z(P)}});var Ge=y.Request=function(){};Db("Request",C,{_mimeType:I,getXhr:function(){return this._xhr||(this._xhr=new XMLHttpRequest,this.overrideMimeType("text/plain")),this._xhr},send:function(x){var m=this.getXhr();x.mimeType&&this.overrideMimeType(x.mimeType),m.onload=this.onload,m.onerror=this.onerror,F.fetch(m,x)},onload:function(){},onerror:function(){},getResponseType:function(){return this.getXhr().responseType},setOverrideMimeType:function(H){this.overrideMimeType(H)},getMimeType:function(){return this._mimeType},overrideMimeType:function(Q){this.getXhr().overrideMimeType(this._mimeType=Q)},getResponseHeader:function(o){return this.getXhr().getResponseHeader(o)},getResponseText:function(){var A=this.getXhr();return A.response||A.responseText},getStatus:function(){return this.getXhr().status}}),Nf.GraphView=function(K){var w=this;w._24I={},w._34I=new Ik,w.enableDirtyRect(),w._25I={},w._56I={},w._view=vc(1,w),w._canvas=Qb(w._view),w.dm(K?K:new _h),this._coreInteractor=new Cl(this),w.setEditable(!1),w.setScrollBarVisible(F.graphViewScrollBarVisible),w._initView()},ol("GraphView",C,{ms_v:1,ms_gv:1,ms_bnb:1,ms_tip:1,ms_dm:1,ms_lp:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,_52o:1,_51o:1,ms_ac:[Rr,Zd,oj,Ak,"resettable","editInteractor",Eh,"zoomable","pannable","rectSelectable","autoScrollZone",Ef,"movableFunc","editableFunc","pointEditableFunc","rectEditableFunc","rotationEditableFunc","anchorEditableFunc","rectSelectBackground","rectSelectBorderColor","editPointSize","editPointBorderColor","editPointBackground","hoverDelay"],_zoomable:F.graphViewZoomable,_resettable:F.graphViewResettable,_pannable:F.graphViewPannable,_rectSelectable:F.graphViewRectSelectable,_autoScrollZone:F.graphViewAutoScrollZone,_rectSelectBackground:F.graphViewRectSelectBackground,_rectSelectBorderColor:F.graphViewRectSelectBorderColor,_editPointSize:F.graphViewEditPointSize,_editPointBorderColor:F.graphViewEditPointBorderColor,_editPointBackground:F.graphViewEditPointBackground,_scrollBarColor:dg,_scrollBarSize:cj,_autoHideScrollBar:pl,_autoMakeVisible:Jb,_currentActionType:null,getCoreInteractor:function(){return this._coreInteractor},getLayers:function(){return this._dataModel.getLayers()},setLayers:function(r){this._dataModel.setLayers(r)},setEditable:function(S){var g=this,V=g.__interactorMap__;if(!V){var t=Nf.XEditInteractor;V=g.__interactorMap__={scrollBar:new Ce(g),select:new Ej(g),edit:t?new t(g):new Ae(g),text:new eb(g),move:new Mc(g),"default":new lr(g),touch:new Qe(g,{editable:!1})}}S?(g._uieditable=!0,g.setInteractors([V.scrollBar,V.select,V.text,V.edit,V.move,V.default,V.touch])):(g._uieditable=!1,g.setInteractors([V.scrollBar,V.select,V.move,V.default,V.touch]))},getCanvas:function(){return this._canvas},_33I:function(E){var d=E.getUIClass();return d?new d(this,E):N},getDataUI:function(t){var l=this,O=l._25I[t._id];return O===I&&(O=l._33I(t),l._25I[t._id]=O),O},getNodeRect:function(t){return F.getNodeRect(this,t)},getFullscreenDatas:function(){return this._dataModel.getFullscreenDatas()},getEdgeInfo:function(c){var F=this.getDataUI(c);return F?(F._79o(),F._78o):null},getEdgeSourcePosition:function(D){var r=this,i=r.getDataUI(D),T=i.s,M=i._data._40I;return Hn(r,M,T("edge.source.position"),T("edge.source.offset.x"),T("edge.source.offset.y"),T("edge.source.anchor.x"),T("edge.source.anchor.y"))},getEdgeTargetPosition:function(l){var A=this,q=A.getDataUI(l),b=q.s,a=q._data._41I;return Hn(A,a,b("edge.target.position"),b("edge.target.offset.x"),b("edge.target.offset.y"),b("edge.target.anchor.x"),b("edge.target.anchor.y"))},invalidateAll:function(G){var C=this;if(G){for(var Y in C._25I){var A=C._25I[Y];A&&A.dispose()}C._25I={},C._56I={},C._24I={},C._34I.clear(),C.redraw()}else C.dm().each(function(J){C.invalidateData(J)})},invalidateSelection:function(){var j=this;j.sm().each(function(_){j.invalidateData(_)})},invalidateData:function(I){var E=this;E._24I[I._id]=I,E._21Q(I),E.iv()},_21Q:function(s){var K=this,Z=K._24I;if(lm(s)&&Ob[s.s(_q)]){var z=s.getSourceAgent();z&&z.getAgentEdges().each(function(X){Z[X._id]=X}),z=s.getTargetAgent(),z&&z.getAgentEdges().each(function(I){Z[I._id]=I}),K.iv()}},redraw:function(h){var m=this;m._32I||(h?m._34I.add(h):(m._32I=1,m._34I.clear()),m.iv())},each:function(s,g){var L,j,K,H=0,u=this.getLayers(),a=this._dataModel,F=a._datas._as,b=F.length;if(u){var A,$={};a.isHierarchicalRendering()&&a.eachByHierarchical(function(o){K=o._layer,A=$[K],A||(A=$[K]=[]),A.push(o)});for(var J=u.length;J>H;H++)if(K=u[H],Go(K)&&(K=K.name),a.isHierarchicalRendering()){A=$[K];var Q,L,x;if(A&&(Q=A.length)>0)for(var t=0;Q>t;t++)if(L=A[t],x=g?s.call(g,L):s(L),x===!1)return}else for(var t=0;b>t;t++)if(L=F[t],L._layer===K&&(j=g?s.call(g,L):s(L),j===!1))return}else if(a.isHierarchicalRendering())this._dataModel.eachByHierarchical(s,null,g);else for(;b>H;H++)if(L=F[H],j=g?s.call(g,L):s(L),j===!1)return},reverseEach:function(w,j){var P,u,l,K,f=this._dataModel,v=f._layers,L=f._datas._as,V=L.length;if(v){var F,$={};for(f.isHierarchicalRendering()&&f.reverseEachByHierarchical(function(u){K=u._layer,F=$[K],F||(F=$[K]=[]),F.push(u)}),P=v.length-1;P>=0;P--)if(K=v[P],Go(K)&&(K=K.name),f.isHierarchicalRendering()){F=$[K];var _,u,E;if(F&&(_=F.length)>0)for(var p=0;_>p;p++)if(u=F[p],E=j?w.call(j,u):w(u),E===!1)return}else for(var p=V-1;p>=0;p--)if(u=L[p],u._layer===K&&(l=j?w.call(j,u):w(u),l===!1))return}else if(f.isHierarchicalRendering())f.reverseEachByHierarchical(w,null,j);else for(P=V-1;P>=0;P--)if(u=L[P],l=j?w.call(j,u):w(u),l===!1)return},getViewRect:function(){return this._29I},getContentRect:function(){var i=this,l=i._84I;if(!l){var K=this.dm().a("width"),Q=this.dm().a("height");K>0&&Q>0?i._84I={x:0,y:0,width:K,height:Q}:(i.each(function(H){i.isVisible(H)&&(l=pq(l,i.getDataUIBounds(H)))}),i._84I=l?l:ro)}return i._84I},getScrollRect:function(){return pq(this.getContentRect(),this._29I)},makeCenter:function(z,r,y){var b=this;if(!b.getWidth()||!b.getHeight())return y||hh(b.makeCenter,b,[z,r,!0],500),void 0;b.makeVisible(z),b.validate();var V=b.getDataUIBounds(z);if(V){var e=b.getWidth(),C=b.getHeight(),L=V.x+V.width/2,R=V.y+V.height/2,o=-L*b._zoom+e/2,m=-R*b._zoom+C/2;b.setTranslate(o,m,r)}},fitData:function(d,D,Y,T,u){var f=this;if(!f.getWidth()||!f.getHeight())return u||hh(f.fitData,f,[d,D,Y,T,!0],500),void 0;var t=function(){f.makeVisible(d),f.validate();var w=f.getDataUIBounds(d);w&&(w=iq(w),Oj(w,Y==N?20:Y),f.fitRect(w,D,T))};D?F.callWhenLoaded(t):t()},fitContent:function(R,e,L,o){var g=this;if(!g.getWidth()||!g.getHeight())return o||hh(g.fitContent,g,[R,e,L,!0],500),void 0;var m=function(){g.validate();var K=iq(g.getContentRect());Oj(K,e==N?20:e),g.fitRect(K,R,L)};R?F.callWhenLoaded(m):m()},fitRect:function(f,s,S){var u=this,j=u.getWidth(),Y=u.getHeight(),e=f.x+f.width/2,V=f.y+f.height/2,A=J(j/f.width,Y/f.height),E=u._zoom,H=-e*E+j/2,i=-V*E+Y/2;0===A||isNaN(A)||(S&&(A=J(1,A)),s?(u._65I&&(delete u._65I.finishFunc,u._65I.stop(!0)),u._14o&&u._14o.stop(!0),u.setTranslate(H,i,{finishFunc:function(){u.setZoom(A,s)}})):(u.setTranslate(H,i),u.setZoom(A)))},fitSelection:function(w,E,i){var V=this,r=V.sm(),S=null;r.size()&&(r.each(function(e){S=pq(V.getDataUIBounds(e),S)}),w&&Oj(S,w),V.fitRect(S,E,i))},toCanvas:function(M,X,r){X=X||this._zoom,this.validateImpl();var Z=this,R=Z.getContentRect();r&&Oj(R,r),R.width||(R.width=10),R.height||(R.height=10);var E=Qb(),H=R.x*X,z=R.y*X,W=Math.ceil(R.width*X),N=Math.ceil(R.height*X);Nc(E,W,N,1);var h=tp(E);M=M||this._dataModel.getBackground(),M&&no(h,0,0,W,N,M),jf(h,-H,-z),h.scale(X,X);var j=this._zoom;return this._zoom=X,Z._42(h),this._zoom=j,h.restore(),E},toDataURL:function(u,M,A,E){return this.toCanvas(u,A,E).toDataURL(M||"image/png",1)},getClipBounds:function(){return this._74O},_42:function(W,I){var C=this,s=C.dm().getBackground();if(s){var G=C.dm().a("width"),D=C.dm().a("height");G>0&&D>0&&no(W,0,0,G,D,s)}var Z=C.__htmlOrderList,S=[],T=C._forcedLayoutHTML;if(C._93db(W,I),C.each(function(Y){var q=C.getDataUI(Y);if(q){var f=C._56I[Y._id],U=q._htmlView;if(f){var G=q._79o();if(U=q._htmlView,y.HtmlNode&&Y instanceof y.HtmlNode)q._42(W);else{var D=C.getViewRect(),n=U&&U.layoutHTML;!I||pd(I,G)?(n&&(U.layoutHTML(),q.__outerLayout&&delete q.__outerLayout),q._42(W)):pd(D,G)||!n||q.__outerLayout&&!T||(U.layoutHTML(),q.__outerLayout=!0)}}U&&(S.push(U),U.getView&&(U=U.getView()),U.style.display=f?"block":Wr)}}),Z&&S.length>0){var k=!1;if(Z.length!==S.length)k=!0;else for(var N=0;N<S.length;N++)if(S[N]!==Z[N]){k=!0;break}k&&(S.forEach(function(x){x.autoAdjustIndex!==!1&&C.appendHTML(x,!0)}),this.__htmlOrderList=S)}else this.__htmlOrderList=S;C._92db(W,I)},disableDirtyRect:function(){this._shouldRedrawAll=P},enableDirtyRect:function(){var c=this;c._shouldRedrawAll=function(){return c._32I}},validateImpl:function(){this.tryUpdateRootData();var C,N,x,r,s,Y=this,E=Y.tx(),w=Y.ty(),X=Y._zoom,J=Y._canvas,O=this.getWidth(),L=this.getHeight(),y=Y._29I,u={x:-E/X,y:-w/X,width:O/X,height:L/X},S={},Z=Y._34I,h=Y._24I,e=Y._shouldRedrawAll(),V=Y._23I;Y._24I={},(O!==J.clientWidth||L!==J.clientHeight)&&(Nc(J,O,L),e=1,Y._forcedLayoutHTML=1),e||ic(u,y)||(e=1,Y._forcedLayoutHTML=1),Y._29I=u,Y.each(function(V){N=V._id;var F=S[N]=Y.isVisible(V);F!==Y._56I[N]&&(h[N]=V,x=Y.getDataUI(h[N]),x&&x._84o(F),Y._84o(V,F))},Y);for(N in h)x=Y.getDataUI(h[N]),x&&(!e&&Y._56I[N]&&(s=x._79o(),s&&Z.add(s)),x.invalidate()),Y._83I=1;if(Y._56I=S,!e)for(N in h)S[N]&&(x=Y.getDataUI(h[N]),x&&(s=x._79o(),s&&Z.add(s)));if(e?r=u:(Z.each(function(n){pd(u,n)&&(r=pq(r,n))}),r&&(Oj(r,n(1,1/X)),r.x=g(r.x*X)/X,r.y=g(r.y*X)/X,r.width=p(r.width*X)/X,r.height=p(r.height*X)/X,r=zc(u,r))),Y._74O=r,r&&0!==r.width&&0!==r.height){C=tp(J);var A=r.x,d=r.y,l=r.width,G=r.height;A=Math.floor((A*X+E)*Ep),d=Math.floor((d*X+w)*Ep),l=Math.ceil(l*X*Ep)+1,G=Math.ceil(G*X*Ep)+1,e||(r.x=(A/Ep-E)/X,r.y=(d/Ep-w)/X,r.width=l/Ep/X,r.height=G/Ep/X),C.beginPath(),C.rect(A,d,l,G),C.clip(),C.clearRect(A,d,l,G),Cf(C,E,w,X),Y._42(C,r),C.restore(),delete Y._74O}if(Z.clear(),delete Y._32I,delete Y._forcedLayoutHTML,V&&O>0&&L>0){var x=Y.getDataUI(V);if(x){var s=x._79o(),o=Y._29I,H=o.x,j=o.y,b=o.width,M=o.height,X=Y._zoom;s&&!pd(s,o)&&(s.x+s.width<H&&Y.tx(-s.x*X),s.x>H+b&&Y.tx(-(s.x+s.width-b)*X),s.y+s.height<j&&Y.ty(-s.y*X),s.y>j+M&&Y.ty(-(s.y+s.height-M)*X))}delete Y._23I}Y._83I&&(delete Y._83I,delete Y._84I),Y._98O(),Y.countFrame(),kl(Y._24I)||hh(Y.iv,Y)},isValidGuideLineSource:function(){return!0},tryUpdateRootData:function(){if(!this._rootDataUpdating){this._rootDataUpdating=!0;var L,g=this.getFullscreenDatas();for(var d in g)L=g[d],this.scaleRootData(L);this.onRootDataUpdated&&this.onRootDataUpdated(),this._rootDataUpdating=!1}},scaleRootData:function($){var x=$.s("fullscreen");if("uniform"===x||"fill"===x){$.getRotation()&&$.setRotation(0);var m=$.s("fullscreen.gap")||0,C=this.getWidth(),n=this.getHeight();if(C&&n){var A,d,l,H=C-2*m,U=n-2*m,L=$.getAnchor(),w=$.getScaledSize(),j=w.width,k=w.height,g=$.s("fullscreen.lock");if(g)return"uniform"===x?H/U>j/k?(A=U/k,j=k*H/U):(A=H/j,k=j*U/H):"v"===g?(A=U/k,j=H/A,$.getWidth()!==j&&$.setWidth(j)):(A=H/j,k=U/A,$.getHeight()!==k&&$.setHeight(k)),this.setZoom(A),d=m-($.getX()-L.x*j)*A,l=m-($.getY()-L.y*k)*A,d!==this.tx()&&this.tx(d),l!==this.ty()&&this.ty(l),void 0;d=this.tx(),l=this.ty(),A=this._zoom;var h={x:(-d+m)/A,y:(-l+m)/A,width:H/A,height:U/A};if("uniform"===x){var a=j/k,v=Math.min(h.width,h.height*a),T=v/a;h.x+=.5*(h.width-v),h.y+=.5*(h.height-T),h.width=v,h.height=T}H=h.width/$.getScaleX(),U=h.height/$.getScaleY(),($.getWidth()!=H||$.getHeight()!==U)&&$.setSize(H,U);var I=h.x+L.x*h.width,Z=h.y+L.y*h.height,N=$.getPosition();(I!==N.x||Z!==N.y)&&$.setPosition(I,Z)}}},isScrollBarVisible:function(){return!!this._79O},setScrollBarVisible:function(E){var G=this;E!==G.isScrollBarVisible()&&(E?(Em(G._view,G._79O=jg()),Em(G._79O,G._27I=jg()),Em(G._79O,G._28I=jg())):(Yf(G._79O),delete G._79O,delete G._27I,delete G._28I),G.fp("scrollBarVisible",!E,E))},getDebugTip:function(){return""},showScrollBar:function(){var z=this;z._79O&&(z._85I||(Jo(function(){z._86I()},Th),z.iv()),z._85I=new Date)},_86I:function(){var k=this;if(k._85I){var b=new Date,I=b.getTime();I-k._85I.getTime()>=Th?(delete k._85I,k.iv()):Jo(function(){k._86I()},Th)}},getVScrollBar:function(){return this._27I},getHScrollBar:function(){return this._28I},_98O:function(){var S=this,O=this._27I,b=this._28I;if(S._79O){if(S._autoHideScrollBar&&!S._85I)return O.style.visibility=xc,b.style.visibility=xc,void 0;var Q=S.getScrollBarColor(),o=S._zoom,L=S.getScrollBarSize(),e=S.getViewRect(),v=S.getScrollRect(),K=e.height*o,n=v.height*o,l=e.width*o-L-2,J=K*((e.y-v.y)*o/n),D=K*(K/n),P=O.style;n-.5>K?(Vf>D&&(J=J+D/2-Vf/2,0>J&&(J=0),J+Vf>K&&(J=K-Vf),D=Vf),Xd(O,l,J,L,D),P.visibility=im,P.background=Q,P.borderRadius=L/2+ps):P.visibility=xc;var U=e.width*o,N=v.width*o,J=e.height*o-L-2,l=U*((e.x-v.x)*o/N),T=U*(U/N),P=b.style;N-.5>U?(Vf>T&&(l=l+T/2-Vf/2,0>l&&(l=0),l+Vf>U&&(l=U-Vf),T=Vf),Xd(b,l,J,T,L),P.visibility=im,P.background=Q,P.borderRadius=L/2+ps):P.visibility=xc}},setDataModel:function(u){var y=this,K=y._dataModel,t=y._selectionModel;K!==u&&(K&&(K.ump(y.handleDataModelPropertyChange,y),K.umm(y.handleDataModelChange,y),K.umd(y.handleDataPropertyChange,y),K.removeIndexChangeListener(y._75O,y),K.removeHierarchyChangeListener(y.handleHierarchyChange,y),t||K.sm().ums(y.handleSelectionChange,y)),y._dataModel=u,u.mp(y.handleDataModelPropertyChange,y),u.mm(y.handleDataModelChange,y),u.md(y.handleDataPropertyChange,y),u.addIndexChangeListener(y._75O,y),u.addHierarchyChangeListener(y.handleHierarchyChange,y),t?t._21I(u):u.sm().ms(y.handleSelectionChange,y),y.invalidateAll(!0),y.fp(xh,K,u),y.updateBackground())},getLayersInfo:function(){if(this._layersInfo===I){var C=this.getLayers();C?(this._layersInfo={},C.forEach(function($){var n=Go($)?$.name:$;this._layersInfo[n]=$},this)):this._layersInfo=null}return this._layersInfo},calculateEdgePosition:function(H,z,R){var T,q,g,m,K=this;H instanceof y.Data?(m=K.getDataUI(H),g=ss(m)):(g=ss(null,arguments[0],arguments[1]),z=arguments[2],R=arguments[3]),2===z.length&&(z=new of(z[0],z[1]));var o=pr(z,function(y){return zj(g,100*y)},100,.001),O=zj(g,100*o);if(!R){var j=m?qd(m):qd(arguments[0],arguments[1]),C=new of(O.x,O.y),n=49/(K._zoom*K._zoom);for(T=0,q=j.length;q>T;T++)if(C.distanceToSquared(j[T])<n)return{index:T,point:j[T],distance:Math.sqrt((j[T].x-z.x)*(j[T].x-z.x)+(j[T].y-z.y)*(j[T].y-z.y))}}return{percent:o,point:O,distance:Math.sqrt((O.x-z.x)*(O.x-z.x)+(O.y-z.y)*(O.y-z.y))}},getPercentPositionOfPath:function(I,m){var e;if(I instanceof y.Data){var p=this.getDataUI(I);e=ss(p)}else e=ss(null,arguments[0],arguments[1]),m=arguments[2];return zj(e,m)},getNeareastPositionOfPath:function(){return this.calculateEdgePosition.apply(this,arguments)},getPointsOfPath:function(){function g(P,g,A,$,w,H){var O=new of(g.get(A)),G=H.apply(O);P.push({local:O,world:G,type:w,index:A,realIndex:$})}return function(r){var f,P;if(r instanceof y.Data){var I=this.getDataUI(r),U=Sj(I);f=U.points,P=U.segments}else f=arguments[0],P=arguments[1];var m,M,G,F=r instanceof y.Shape?r.getPointsMatrix2d():new fl.Matrix2d,w=[],D=-1,E=-1;for(M=0,G=P?P.length:f.length;G>M;M++)m=P?P.get(M):1,5!==m&&(E++,3===m?(g(w,f,D+1,E,"C",F),g(w,f,D+2,E,"M",F),D+=2):4===m?(g(w,f,D+1,E-1,"R",F),g(w,f,D+2,E,"L",F),g(w,f,D+3,E,"M",F),D+=3):(g(w,f,D+1,E,"M",F),D+=1));return w}}(),calculateAttachPoint:function(){var q=new of,M=new of,t=new of;return function(u,O){var Y=this.getAttachPoints(u);if(!Y||!Y.length)return null;t.set(O.x,O.y);for(var l,j,x,h,o,E=1/0,N=0,A=Y.length;A>N;N++)x=Y[N],M.x=x.x,M.y=x.y,q.x=x.offsetX||0,q.y=x.offsetY||0,h=Hn(this,u,0,q.x,q.y,M.x,M.y),j=t.distanceToSquared(h),E>j&&(l=N,E=j,o=h);E=Math.sqrt(E);var H=this.getAttachStyle(u);if("close"===H){var D=u.s("attach.close.threshold")/this._zoom;if(E>D)return null}return{index:l,distance:E,info:Y[l],point:o}}}(),getAttachPoints:function(N){var B=N.s("attach.points");if(B)return B;var $=Fp(N._image);return $?Aq($.attachPoints,N,this)||null:void 0},getAttachStyle:function(t){var Z=t.s("attach.style");if(Z)return Z;var S=Fp(t._image);return S?Aq(S.attachStyle,t,this)||"close":void 0},updateLayers:function(){this._layersInfo=I,this.invalidateSelection(),this.redraw()},updateBackground:function(){var j=this.dm().a("width"),C=this.dm().a("height");this._canvas.style.background=j>0&&C>0?"":this.dm().getBackground()||""},handleDataModelPropertyChange:function(y){if("background"===y.property){var j=this._canvas.style.background,k=y.newValue||"";this.updateBackground(),this.fp("canvasBackground",j,k),this.redraw()}else"a:width"===y.property||"a:height"===y.property?(this._83I=1,this.updateBackground(),this.redraw()):"layers"===y.property?this.updateLayers():"hierarchicalRendering"===y.property&&this.redraw()},handleDataPropertyChange:function(C){this.dm().isHierarchicalRendering()&&"parent"===C.property&&C.data.hasChildren()&&this.redraw(),this.invalidateData(C.data)},onPropertyChanged:function(d){var b=this,a=d.property;if(b.redraw(),"zoom"===a){var f=b.sm().getSelection();f.size()&&f.each(function(P){P.invalidate()})}else"dataModel"===a&&(b._83I=1);kb[a]?b.showScrollBar():a===Eh&&b.onCurrentSubGraphChanged(d)},onCurrentSubGraphChanged:function(){this.sm().cs(),this.reset()},handleDataModelChange:function(x){var P=this,Z=x.kind,f=x.data;if(P._83I=1,"add"===Z)P.invalidateData(f),lm(f)&&f.getEdgeGroup()&&f.getEdgeGroup().eachSiblingEdge(P.invalidateData,P),f.getHost&&f.getHost()&&f.getHost().updateLayoutAttaches();else if(Z===Uj){P._21Q(f);var u=f._id,n=P._25I[u];if(n){if(P._56I[u]){var B=n._79o();B&&P.redraw(B)}n.dispose(),delete P._25I[u],delete P._24I[u],delete P._56I[u]}f===P._currentSubGraph&&P.setCurrentSubGraph(N)}else Z===Mm&&(P.invalidateAll(!0),P.setCurrentSubGraph(N))},_75O:function(r){this.invalidateData(r.data)},handleHierarchyChange:function(W){this.dm().isHierarchicalRendering()&&W.data.hasChildren()&&this.redraw(),this.invalidateData(W.data)},adjustIndex:function(j){var g=this;if(g.isVisible(j)){g.dm().beginTransaction();for(var R=j;R._parent&&g.isVisible(R._parent);)R=R._parent;R&&R!==j&&g._dataModel.adjustIndex(R),g._dataModel.adjustIndex(j),g.dm().endTransaction()}},getImage:function(h){return h.getImage?h.getImage():I},getSelectWidth:function(U){var s=Fp(this.getImage(U));return s&&Aq(s.disableSelectedBorder,U,this)?0:U.s("select.width")},getSelectColor:function(v){return v.s("select.color")},isSelectable:function(z,Z){if(this.isSelected(z))return!0;if(!Z&&z.getParent()instanceof Jc&&this.isSelectable(z.getParent(),!0)&&z.getParent().isSyncSize())return!1;var D=this.getLayersInfo();if(D){var h=D[z._layer];if(h&&h.selectable===!1)return!1}return z.s("2d.selectable")&&this.sm().isSelectable(z)},isMovable:function(j){var C=this;if(lm(j)&&j.getStyle(_q)!==Xf)return!1;var z=this.getLayersInfo();if(z){var S=z[j._layer];if(S&&S.movable===!1)return!1}return j.s("2d.movable")?C._movableFunc?C._movableFunc(j):!0:!1},isEditable:function(V){var L=this;if(y._uiSerializing)return L._uieditable;if(!L._editInteractor||!L.isSelected(V))return!1;if(Ln(V)){var o=L.getDataUI(V);if(!o||o._88I)return!1}if(lm(V)&&V.getStyle(_q)!==Xf)return!1;var I=this.getLayersInfo();if(I){var G=I[V._layer];if(G&&G.editable===!1)return!1}return V.s("2d.editable")?L._editableFunc?L._editableFunc(V):!0:!1},handleDelete:function(){this._editInteractor&&(this._editInteractor.handleDelete?this._editInteractor.handleDelete():this.removeSelection())},isPointEditable:function(n){return cl(n)&&0!==n.getRotation()?!1:this._pointEditableFunc?this._pointEditableFunc(n):!0},isRectEditable:function(d){return this._rectEditableFunc?this._rectEditableFunc(d):!0},isAnchorEditable:function(i){return this._anchorEditableFunc?this._anchorEditableFunc(i):!0},isRotationEditable:function(t){return t.setRotation&&t.IRotatable!==!1?this._rotationEditableFunc?this._rotationEditableFunc(t):!0:!1},isSourceTargetEditable:function(){return!0},getRotationPoint:function(l){var _=l.getAnchor(),p=l.getScale(),B=this._zoom,S=Br(l.getRotation(),0,-l.getHeight()*p.y*_.y-(p.y<0?-1:1)*(Hi?32:16)/B),r=l.p();return S.x+=r.x,S.y+=r.y,S},getLogicalPoint:function(H){var I=this;return qh(H,I._canvas,I.tx(),I.ty(),I._zoom,I._zoom)},getScreenPoint:function(Z,Y){var P,H=this;return"object"==typeof Z?Z.x!==I?(P=Z.x,Y=Z.y):(P=Z[0],Y=Z[1]):P=Z,df(P,Y,H._canvas,H.tx(),H.ty(),H._zoom,H._zoom)},getSelectedDataAt:function(Y){var U=this;return this.getDataAt(Y,function(V){return U.isSelected(V)})},getDataInfoAt:function(a,S,s){var Y,A=this.lp(a),D=this.getDataAt(A,S,s);if(D){var E=this.getDataUI(D);Y={data:D,ui:E,point:A};var W=E._38o;if(W){var B=W.icons;for(var i in B){var p=B[i],r=W.rects[i];if(r)for(var Z=Aq(p.names,D,this),c=Z?Z.length:0,G=r.rotation,I=c-1;I>=0;I--){var x=Z[I],U=r[I];if(zo(U,A,G))return Y.part="icons",Y.name=i,Y.icon=x,Y.rect=U,Y.index=I,Y.rotation=G,Y}}}if(this.isNoteVisible(D)){if(E.note2Info&&zo(E.note2Info.clickRect,A,N,E.note2Info.scale))return Y.part="note2",Y;if(E.noteInfo&&zo(E.noteInfo.clickRect,A,N,E.noteInfo.scale))return Y.part="note",Y}if(this.isLabelVisible(D)){if(E.label2Info&&zo(E.label2Info.rect,A,E.label2Info.rotation,E.label2Info.scale))return Y.part="label2",Y;if(E.labelInfo&&zo(E.labelInfo.rect,A,E.labelInfo.rotation,E.labelInfo.scale))return Y.part="label",Y}if(D.isInRect&&D.isInRect(A))return Y.part="body",Y}return Y},getDataAt:function(y,h,r){y.target&&(y=this.lp(y));var X,N=this._zoom;return this.reverseEach(function(u){return(h?h(u):this.isSelectable(u))&&this.rectIntersects(u,rb(y.x,y.y,r,N))?(X=u,!1):void 0},this),X},getIconInfoAt:function(F,$){var g=this;if(F.target&&(F=g.lp(F)),$||($=g.getDataAt(F)),$){var d=g.getDataUI($);if(d&&d._38o){var f,Y=d._38o,J=new Ik;for(f in Y.icons)J.add(f);for(var i=J.size()-1;i>=0;i--){f=J.get(i);for(var k=Y.rects[f],I=k.rotation,X=k.length-1;X>=0;X--){var D=k[X],Z=D.width,U=D.height,s={x:F.x-D.x-Z/2,y:F.y-D.y-U/2};I!=N&&(s=Br(-I,s.x,s.y));var D={x:-Z/2,y:-U/2,width:Z,height:U};if(zo(D,s))return{key:f,index:X,name:Y.icons[f].names[X],rect:k[X],point:F,rotation:I,relativeRect:D,relativePoint:s,data:$}}}}}return N},getDatasInRect:function(U,u,T){T===I&&(T=1);var R=this,k=new Ik;return R.reverseEach(function(A){T&&!R.isSelectable(A)||(u?R.rectIntersects(A,U):R.rectContains(A,U))&&k.add(A)}),k},moveSelection:function(k,p){var Y=this;Y.dm().beginTransaction(),vs(Y.sm().toSelection(Y.isMovable,Y),k,p),Y.dm().endTransaction()},moveDatas:function(H,A,Q){var n=this;n.dm().beginTransaction(),H instanceof Ik||(H=new Ik(H)),vs(H,A,Q),n.dm().endTransaction()},getDataUIBounds:function(H){var l=this.getDataUI(H);return l?l._79o():N},drawData:function(i,s,H){var O=this.getDataUI(s);if(O){var d=O._79o();(!H||pd(H,d))&&(O._42(i),s instanceof y.Block&&s.eachChild(function(_){this.isVisible(_)&&this.drawData(i,_,H)},this))}},getBoundsForGroup:function(p){return p.s(Ql)?this.getDataUIBounds(p):N},isPixelPerfect:function(c){return c.s("pixelPerfect")},rectIntersects:function(d,I){this.validate();var w=N;if(this._56I[d._id]){var g=this._25I[d._id];if(g){var H=g._79o();if(ng(I,H))w=!0;else if((I=zc(I,H))&&(g.rectIntersects&&(w=g.rectIntersects(I)),w==N)){if(!this.isPixelPerfect(d))return!0;var E=I.x,x=I.y,Y=I.width,i=I.height,n=this._zoom,u=F.hitMaxArea,c=Y*i*n*n;if(c>u){var $=Math.sqrt(u/c);n*=$}Y*=n,i*=n,2>Y&&(Y=2),2>i&&(i=2),E*=n,x*=n;var f=tl(Y,i);jf(f,-E,-x),f.scale(n,n),this._drawForChecking=!0,this.drawData(f,d,I),this._drawForChecking=!1;try{for(var U=0,D=f.getImageData(0,0,Y,i).data;U<D.length;U+=4)if(0!==D[U+3]){w=!0;break}f.restore()}catch(z){Qh=N,w=!1}}}}return w?!0:!1},rectContains:function(v,t){if(this._56I[v._id]){var G=this._25I[v._id];if(G)return ng(t,G._79o())}return!1},reset:function(){this.setZoom(1),this.setTranslate(0,0)},handleKeyDown:function(E){if(!F.isInput(E.target)){var A=this,a=A._focusData,B=a&&A._25I[a._id],Q=0,J=A._dataModel._datas;if(!(a&&a._enabled&&a._editable&&B&&B.onKeyDown&&B.onKeyDown(E)===!0))if(9===E.keyCode&&(a&&(Q=J.indexOf(a),oo(E)?-1===--Q&&(Q=0):++Q===J.size()&&(Q=0)),A._focusData=a=J.get(Q),A.sm().setSelection(a)),cr(E)?A.selectAll():En(E)&&A.isResettable()&&A.reset(),A.sm().isEmpty()){if(A._editing)return;var O=A.tx(),C=A.ty(),r=!1,w=oo()?100:10;jr(E)&&(O-=w,r=!0),cb(E)&&(C-=w,r=!0),wk(E)&&(O+=w,r=!0),Yd(E)&&(C+=w,r=!0),r&&A.setTranslate(O,C)}else{Wk(E)&&A.handleDelete(E);var z=oo()?10:1;jr(E)&&(A.moveSelection(-z,0),A.fi({kind:"moveLeft"})),cb(E)&&(A.moveSelection(0,-z),A.fi({kind:"moveUp"})),wk(E)&&(A.moveSelection(z,0),A.fi({kind:"moveRight"})),Yd(E)&&(A.moveSelection(0,z),A.fi({kind:"moveDown"}))}}},handleScroll:function(F,P){if(vr(F),this.isZoomable()){if(!this.getEditInteractor()){var T=this.getDataAt(F);if(T){var A=Fp(this.getImage(T));if(A&&Aq(A.scrollable,T,this))return}}var w=this.getFullscreenDatas();for(var c in w)if(w[c].s("fullscreen.lock"))return;var N=this.lp(F);P>0?this.scrollZoomIn(N):0>P&&this.scrollZoomOut(N)}},handlePinch:function(O,N,k){this.isZoomable()&&(Math.abs(N-k)<F.pinchZoomThreshold||(N>k?this.pinchZoomIn(O):this.pinchZoomOut(O)))},checkDoubleClickOnNote:function(F,t){var B=this,_=B.lp(F),c=B.getDataUI(t),p=c.note2Info;return p&&t.s("note2.toggleable")&&zo(p.clickRect,_)?(t.s(Tc,!t.s(Tc)),B.fi({kind:"toggleNote2",event:F,data:t}),!0):(p=c.noteInfo,p&&t.s("note.toggleable")&&zo(p.clickRect,_)?(t.s(lb,!t.s(lb)),B.fi({kind:"toggleNote",event:F,data:t}),!0):!1)},_84o:function(){},isNoteVisible:function(){return this._zoom>.15},isLabelVisible:function(){return this._zoom>.15},isEditVisible:function(){return this._zoom>.15},autoScroll:function(V,W){var K=this,A=K.getAutoScrollZone(),H=A/K.getZoom(),X=A/4,z=K._29I,d=K.lp(V),i={x:K.tx(),y:K.ty()};return d&&A>0&&z&&(d.x-z.x<H?K.translate(X,0):z.x+z.width-d.x<H&&K.translate(-X,0),d.y-z.y<H?K.translate(0,X):z.y+z.height-d.y<H&&K.translate(0,-X)),i.x=K.tx()-i.x,i.y=K.ty()-i.y,W&&(W.x+=i.x,W.y+=i.y),i},getMoveMode:function(w,Z){var R=Z.s("2d.move.mode");return R?R:Hf["88"]?"x":Hf["89"]?"y":"xy"},getSerializableProperties:function(){return{scrollBarColor:1,scrollBarSize:1,autoMakeVisible:1,autoHideScrollBar:1,editable:1,resettable:1,pannable:1,rectSelectable:1,autoScrollZone:1,visibleFunc:1,movableFunc:1,editableFunc:1,pointEditableFunc:1,rectEditableFunc:1,anchorEditableFunc:1,rotationEditableFunc:1,rectSelectBackground:1,rectSelectBorderColor:1,editPointSize:1,editPointBorderColor:1,editPointBackground:1,hoverDelay:1,dataModel:1,selectionModel:1,currentSubGraph:1,zoom:1,translateX:1,translateY:1}},serializeProperty:function(n,l,B){var q=this;return"currentSubGraph"===l?{__i:n.getId()}:B.serializeProperty(n,l,q)},deserializeProperty:function(n,m,y){var _=this;if("currentSubGraph"===m){var t=_.dm(),b=t.__idMap;return b[n.__i]}return y.deserializeProperty(n,m,_)},setDefaultCursor:function(W,n){this._defaultCursor=W,n!==!1&&this.setCursor(W)},getCurrentConnectActionType:function(){return this._currentActionType},setCurrentConnectActionType:function(L){return L===N||F.getConnectAction(null,L)?(this._currentActionType=L,this.redraw(),!0):!1},getEditStyle:function(s){var w=this.getEditInteractor();return w?w.getStyle(s):I},setEditStyle:function(u,K,M){var R=this.getEditInteractor();return R?(R.setStyle(u,K,M),!0):!1},isConnectActionVisible:function(r){var b=F.getConnectAction(this);if(!b)return!1;var R=b.visible;return Cc(R)&&(R=R(this,r)),R},isInteractive:function(s){if(this._drawForChecking)return!1;var N=Fp(this.getImage(s));return N&&Aq(N.interactive,s,this)?!0:s.s("interactive")},getRenderingStyleIconName:function(){return jq},appendHTML:function(g,Q){var o=this.getView();if(!(Q||g&&g.parentNode!==o))return!1;var r=g.getView&&g.getView(),b=g.beforeCanvas;if(!Q&&r&&r.parentNode===o)return!1;(g.getView||g.isSelfViewEvent)&&(g=g.getView());var R=this.getEditInteractor();return b?o.insertBefore(g,this.getCanvas()):R&&R._canvas?o.insertBefore(g,R._canvas):this.isScrollBarVisible()?o.insertBefore(g,this.getView().lastChild):Em(o,g),!0},_layoutHTMLImpl:function(m,T,Y){if(arguments.length>1){var i,M=this,U=M._zoom;if(T.getView&&(i=T,T=T.getView()),T.style.position="absolute",Y){var p=m.getRect();Xd(i||T,M.tx()+p.x*U,M.ty()+p.y*U,p.width*U,p.height*U)}else{var v=new Xn,p=m.getAnchorRect(),G=m.getPosition(),r=m.getScale(),e=T.style;Xd(i||T,p),v.appendTranslate(M.tx(),M.ty()),v.appendScale(U,U),v.append(new Xn(m.getRotation(),G.x,G.y,r.x,r.y)),pp(e,"transform","matrix("+v.a.toFixed(5)+", "+v.b.toFixed(5)+", "+v.c.toFixed(5)+",\n    "+v.d.toFixed(5)+", "+v.tx.toFixed(5)+", "+v.ty.toFixed(5)+")"),pp(e,"transformOrigin",(-p.x).toFixed(5)+"px "+(-p.y).toFixed(5)+"px"),T.updateAppendMatrix=!0}}else this._layoutHTML&&this._layoutHTML()},getTextEditInfo:function(n){return n instanceof nn?{name:"text",accessType:"s",font:n.s("text.font"),isMultiline:!0}:void 0},getState:function(u){var p="state",R=u.s(p);if(R)return R;var G=Fp(u._image);return G?Aq(G[p],u,this)||null:void 0},getShape:function(x){return x.getStyle(Kb)}}),C.defineProperties(Nf.GraphView.prototype,{layoutHTML:{get:function(){return this._layoutHTMLImplBind||(this._layoutHTMLImplBind=this._layoutHTMLImpl.bind(this)),this._layoutHTMLImplBind},set:function(e){this._layoutHTML=e}}});var bj=function(S,e){var g=this;g.gv=S,g.s=function(I){return e.getStyle(I)},g._data=e,g._87I=new Ik},jq=N;ri(bj,C,{_6I:N,ms_icons:1,_84o:function(){},dispose:function(){},isShadowed:function(){return this.s("shadow")||this.gv.isSelected(this._data)&&"shadow"===this.s("select.type")},getSelectWidth:function(){var K=this,w=K.gv.isSelected(K._data);return!w||K.isShadowed()?0:K.gv.getSelectWidth(K._data)},getSelectColor:function(){return this.gv.getSelectColor(this._data)},getBodyColor:function(o){var _=this._data,S=this.gv.getBodyColor(_);return S?S:o?_.getStyle(o):N},_2Q:function(K){return this.s(K)},_1Q:function(q,K,J,w){var C=this.s,Z=C("2d.gray"),P=C(K+".dash.color");if(Z&&(P=F.toGrayColor(P)),q.strokeStyle=P,q.lineWidth=J,q.stroke(),C(K+".dash.3d")){var S=C(K+".dash.3d.color");Tn(q,P,Z?F.toGrayColor(S):S,J,this.gv._zoom,C(K+".dash.3d.accuracy"))}Ai(q,w)},invalidate:function(){this._6I=N},_79o:function(){var d=this;if(!d._6I){var E=d._data,J=d.gv;d.labelInfo=d.label2Info=d.noteInfo=d.note2Info=d._38o=N,d._87I.clear(),d.interactiveInfo=J.isInteractive(E)?{}:N,d._3O(),d._55O=J.isEditable(E)?{_42O:J.isRectEditable(E),_43O:J.isPointEditable(E),_56O:J.isRotationEditable(E)}:N,d._6I=d._81o()}return d._6I},_3O:function(){},getPosition:function(){return ro},_68o:function(L,Y){L&&this._87I.add(Sq(L,Y))},_81o:function(){var z=this,H=z.s;z._24O(Yn,"getLabel"),z._24O(Fl,"getLabel2"),z._26O(ci,"getNote"),z._26O(qn,"getNote2"),z._15O(),z._55O&&z._48O();var E;if(z._87I.each(function(Y){E=pq(E,Y)}),E&&H("shadow.interactable")){var X=z.isShadowed(),G=H("shadow2"),x=iq(E);G?(x.x+=H("shadow2.offset.x"),x.y+=H("shadow2.offset.y"),Oj(x,H("shadow2.blur"))):X&&(x.x+=H("shadow.offset.x"),x.y+=H("shadow.offset.y"),Oj(x,H("shadow.blur"))),E=pq(E,x)}return z._87I.clear(),E},_42:function(G){var m=this,d=m._data,e=m.gv,M=m.s,B=M("opacity"),$=this.isShadowed(),L=M("shadow2");if($||L){var g=G.shadowOffsetX,i=G.shadowOffsetY,W=G.shadowBlur,J=G.shadowColor,v=e.getZoom()*F.devicePixelRatio,S=$?"shadow":"shadow2";G.shadowOffsetX=M(S+".offset.x")*v,G.shadowOffsetY=M(S+".offset.y")*v,G.shadowBlur=M(S+".blur")*v,G.shadowColor=$?m.getSelectColor():M(S+".color")}if(B!=N){var P=G.globalAlpha;G.globalAlpha=B}m._80o(G),e.isLabelVisible(d)&&((!e._drawForChecking||M("label.selectable"))&&Yk(G,m.labelInfo),(!e._drawForChecking||M("label2.selectable"))&&Yk(G,m.label2Info)),e.isNoteVisible(d)&&(Op(G,m.noteInfo),Op(G,m.note2Info)),m._99O(G),B!=N&&(G.globalAlpha=P),($||L)&&(G.shadowOffsetX=g,G.shadowOffsetY=i,G.shadowBlur=W,G.shadowColor=J)
},_80o:function(){},_47O:function(){},_24O:function(o,d){var P=this,i=P._data,A=P.gv,R=P.s,u=A[d](i);if(u!=N){var O=R(o+".scale"),G=R(o+".max"),g=R(o+".position"),z=P[o+"Info"]={label:u,scale:O,color:A[d+"Color"](i),font:R(o+".font"),opacity:R(o+".opacity"),align:R(o+".align"),decoration:R(o+".decoration"),rotation:P.getRotation(R(o+".rotation"),!1,g),background:A[d+"Background"](i)},H=gs(z,u);G>0&&G<H.width&&(z.labelWidth=H.width,H.width=G),1!==O&&(H.width*=O,H.height*=O);var f=P.getPosition(g,R(o+".offset.x"),R(o+".offset.y"),H,R(o+".position.fixed"));if(H.x=f.x-H.width/2,H.y=f.y-H.height/2,P._68o(z.rect=H,z.rotation),1!==O){var E=H.width/O,h=H.height/O;z.rect={x:f.x-E/2,y:f.y-h/2,width:E,height:h}}}},_26O:function(H,b){var m=this,u=m.gv,G=m._data,X=m.s,v=u[b](G);if(v!=N){var W,y,F=X(H+".scale"),M=m[H+"Info"]={note:v,scale:F,data:G,view:u,expanded:X(H+".expanded"),font:X(H+".font"),color:X(H+".color"),opacity:X(H+".opacity"),align:X(H+".align"),icon:X(H+".icon"),backgroundImage:X(H+".backgroundImage"),borderWidth:X(H+".border.width"),borderColor:X(H+".border.color"),background:u[b+"Background"](G)},Q=m.getPosition(X(H+".position"),X(H+".offset.x"),X(H+".offset.y")),c=Q.x,T=Q.y;if(M.expanded){var Z,f=X(H+".max"),$=X(H+".backgroundImage");$?($=Fp($),Z={width:fm($,G),height:Oo($,G)}):Z=gs(M,v),Z.width+=6,Z.height+=2,f>0&&f<Z.width&&(M.labelWidth=Z.width,Z.width=f),W=Z.width,y=Z.height+8,M.clickRect={x:c-W*F/2,y:T-y*F,width:W*F,height:y*F*Z.height/y}}else{var R=X(H+".icon");R?(R=Fp(R),W=fm(R,G),y=Oo(R,G)):(W=12,y=18),M.clickRect={x:c-W*F/2,y:T-y*F,width:W*F,height:y*F}}M.rect={x:c-W/2,y:T-y*F/2-y/2,width:W,height:y};var n=p(M.borderWidth/2)*F;m._68o({x:c-W*F/2-n,y:T-y*F-n,width:W*F+2*n,height:y*F+2*n})}},_48O:function(){},_99O:function(F){var W=this,I=W._38o;if(I){var z=W.gv,C=W._data,o=I.icons,B=W.interactiveInfo;B&&(B._38o={});for(var d in o){var K=o[d],s=I.rects[d];if(s){B&&(B._38o[d]=[]);var f=Aq(K.opacity,C,z),j=Aq(K.names,C,z),c=j?j.length:0,t=s.rotation;if(f!=N){var D=F.globalAlpha;F.globalAlpha*=f}for(var g=0;c>g;g++){var O=j[g],r=Fp(O),$=s[g];if(t){var l=$.x+$.width/2,Y=$.y+$.height/2;F.save(),jf(F,l,Y),je(F,t),jf(F,-l,-Y)}B&&B._38o[d].push(F.interactiveInfo={compInfos:[],matrix:t?new Xn(t,l,Y).appendTranslate(-l,-Y):new Xn});var L=jq;jq=d,wf(F,r,Aq(K.stretch,C,z),$.x,$.y,$.width,$.height,W._data,W.gv),jq=L,F.interactiveInfo=N,t&&F.restore()}f!=N&&(F.globalAlpha=D)}}}}});var De=function(F,L){Iq(De,this,[F,L])};ri(De,bj,{_checkEmptyRect:!0,_40O:function(Z,m){var h=this,k=h.s,v=Z.rect;(Z.borderColor=h.gv.getBorderColor(h._data))&&(Z.borderType=k("border.type"),Z.borderWidth=k("border.width"),Z.borderPadding=k("border.padding"),m=n(m,Z.borderPadding+Z.borderWidth/2));var b=h._data.getScale(),V=n(1,n(u(b.x),u(b.y)));if(Z.selectWidth=h.getSelectWidth()){var s=h.gv._zoom;Z.selectType=k("select.type"),Z._97o=h.getSelectColor(),Z.selectPadding=k("select.padding"),m=n(m,(Z.selectPadding+Z.selectWidth/2/s)/V)}m>0&&(m*=V,v=iq(v),Oj(v,m)),h._68o(v)},_39O:function(C,T){var f,Q=this,m=T.rect;if(T.borderWidth>0&&(f=T.borderPadding,C.strokeStyle=T.borderColor,C.lineWidth=T.borderWidth,Uq(C,T.borderType,{x:m.x-f,y:m.y-f,width:m.width+2*f,height:m.height+2*f}),C.stroke()),T.selectWidth>0){var e=Q.gv._zoom;if(f=T.selectPadding,C.strokeStyle=T._97o,C.lineWidth=T.selectWidth/e,T.rotation!=N){C.save(),C.translate(T.position.x,T.position.y),C.rotate(T.rotation);var s=Q._data,V=s.getWidth(),r=s.getHeight(),u=T.scale,q=T.anchor;m={x:u.x*-V*q.x,y:u.y*-r*q.y,width:u.x*V,height:u.y*r}}Uq(C,T.selectType,{x:m.x-f,y:m.y-f,width:m.width+2*f,height:m.height+2*f}),T.rotation!=N&&C.restore(),C.stroke()}},dispose:function(){var t=this,U=t._htmlView;De.superClass.dispose.call(t),U&&(U.onHTMLRemoved&&U.onHTMLRemoved(),Yf(U))},_3O:function(){var b,w=this,e=w.s,i=w._data,H=w.gv,m=H.getShape(i),a=w.getBodyColor(),K=e("shape.border.color"),W=w._83o=m?{shape:m,_53o:w.getBodyColor("shape.background"),_27Q:Fp(e("shape.repeat.image"),a),shapeGradientPack:e("shape.gradient.pack"),shapeBorderGradientPack:e("shape.border.gradient.pack"),_54o:e("shape.border.width"),_55o:K,shapeBorderRepeatImage:Fp(e("shape.border.repeat.image"),K),_56o:e("shape.border.3d"),_57o:e("shape.border.3d.color"),_58o:e("shape.border.3d.accuracy"),shapeGradient:e("shape.gradient"),_59o:e("shape.gradient.color"),_60o:e("shape.border.pattern"),_61o:e("shape.border.cap"),_62o:e("shape.border.join"),shapeForeground:e("shape.foreground"),bodyColor:a,gray:e("2d.gray")}:{img:Fp(H.getImage(i),a),bodyColor:a,gray:e("2d.gray"),stretch:e("image.stretch")},Y=W.img;Y&&Y.renderHTML?(w._htmlInfo&&w._htmlInfo.img!==Y&&(w._htmlInfo=N),w._htmlInfo||(w._htmlInfo={img:Y,cache:{}}),b=Y.renderHTML(i,H,w._htmlInfo.cache)):w._htmlInfo=N,w._htmlView&&w._htmlView!==b&&(w._htmlView.onHTMLRemoved&&w._htmlView.onHTMLRemoved(),Yf(w._htmlView.getView?w._htmlView.getView():w._htmlView)),(w._htmlView=b)&&H.appendHTML(b)&&(b.onHTMLAddedSync&&b.onHTMLAddedSync(),b.onHTMLAdded&&hh(b.onHTMLAdded)),W.rect=i.getRect(),W.position=i.p(),W.scale=i.getScale(),W.anchor=i.getAnchor(),W.rotation=i.getRotation(),m===Yp&&(W._63o=e("shape.depth"));var V=0;if(m)V=Lc(N,W._54o/2,W._62o),w.s("shape.dash")&&(V=n(V,(w.s("shape.dash.width")||W._54o)/2));else if(Y&&Y.boundExtend)if(V=Aq(Y.boundExtend,i,H),Y.boundExtendAbsolute){var r=i.getScale();V/=H._zoom*n(1,n(u(r.x),u(r.y)))}else if(!Aq(Y.fitSize,i,H)){var G=Aq(Y.width,i,H),J=Aq(Y.height,i,H);V*=n(i.getWidth()/G,i.getHeight()/J)}w._40O(W,V);var $=e("clip.percentage");if($!=I&&(W.clipRect=zl(i.getAnchorRect(),e("clip.direction"),$)),m){var S=e("shape.fill.clip.percentage");S!=I&&(W.shapeClipRect=zl(i.getAnchorRect(),e("shape.fill.clip.direction"),S));var O=e("shape.foreground.clip.percentage");O!=I&&(W.shapeForegroundClipRect=zl(i.getAnchorRect(),e("shape.foreground.clip.direction"),O))}var p=e("clip.host");p&&i.getHost()&&(W.clipHost=!0)},getPosition:function(r,Y,D,c){var E=Sh(r,this._83o.rect,c);return E.x+=Y,E.y+=D,E},_80o:function(Y){var Z=this,P=Z.s,Q=Z.gv,J=Z._data,i=Z._83o,o=i.rect,j=i.position,C=i.rotation,u=i.anchor,c=i.scale,n=i.shape,S=i.clipHost,v=i.clipRect;if(!Z._checkEmptyRect||o.width>0&&o.height>0){if(S){var $=J.getHost().getCorners();Y.save(),Y.beginPath(),$.forEach(function(D,G){G?Y.lineTo(D.x,D.y):Y.moveTo(D.x,D.y)}),Y.clip()}var r=J.getSize();if(r.x=-r.width*u.x,r.y=-r.height*u.y,Xl&&!dr&&jf(Y,r.width,r.height),Y.save(),jf(Y,j.x,j.y),je(Y,C),$r(Y,c.x,c.y),v&&(Y.beginPath(),Y.rect(v.x,v.y,v.width,v.height),Y.clip()),Q._drawForChecking&&i.img&&Aq(i.img.pixelPerfect,J,Q)===!1)no(Y,r.x,r.y,r.width,r.height,"#888888");else if(Z.freeDraw)Z.freeDraw(Y,r,i);else if(n){var E,y,L,_,B=i._60o,g=bl(Y,B),h=i._27Q,T=i._54o,K=i.shapeGradientPack,M=i.gray,H=Y.lineJoin,b=Y.lineCap,w=function(p){return M?F.toGrayColor(p):p};"roundRect"===n?E=P("shape.corner.radius"):"polygon"===n?(E=P("shape.polygon.side"),y=P("shape.corner.radius"),L=P("shape.regular")):"arc"===n&&(E=P("shape.arc.from"),y=P("shape.arc.to"),L=P("shape.arc.close"),_=P("shape.arc.oval")),Y.lineJoin=i._62o,Y.lineCap=i._61o;var U=w(i._53o);if(U||h||K){var W=i.shapeClipRect;W&&(Y.save(),Y.beginPath(),Y.rect(W.x,W.y,W.width,W.height),Y.clip()),Uq(Y,n,r,E,y,L,_),K?hj(Y,K,function(G){return Fn(G,i.bodyColor)},!1,r):h?_k(Y,h,w(i.bodyColor),null,J,Q):Zn(Y,U,i.shapeGradient,w(i._59o),r),Y.fill(),K&&Y.restore(),W&&Y.restore(),Y!==g&&Uq(g,n,r,E,y,L,_)}else Uq(g,n,r,E,y,L,_);var k=i.shapeForeground;if(k){Y.save();var O=i.shapeForegroundClipRect;O&&(Y.beginPath(),Y.rect(O.x,O.y,O.width,O.height),Y.clip()),Uq(Y,n,r,E,y,L,_),Zn(Y,k,P("shape.foreground.gradient"),w(P("shape.foreground.gradient.color")),r),Y.fill(),Y.restore()}if(T>0){var p=P("shape.border.width.absolute");p&&(Y.save(),Y.setTransform(1,0,0,1,0,0)),Y.lineWidth=T;var R=w(i._55o),X=i.shapeBorderGradientPack;X?hj(Y,X,w,!0,r):i.shapeBorderRepeatImage?sh(Y,i.shapeBorderRepeatImage,R,null,J,Q):Y.strokeStyle=R,Y.stroke(),X&&Y.restore(),p&&Y.restore(),i._56o&&Tn(Y,R,w(i._57o),T,Q._zoom,i._58o)}if(Ai(Y,B),P("shape.dash")){var I=P("shape.dash.width")||T;if(I>0){B=P("shape.dash.pattern");var g=bl(Y,B,Z._2Q("shape.dash.offset"));g!==Y&&Uq(g,n,r,E,y,L,_),Z._1Q(Y,"shape",I,B)}}Mi(Y,U,i._63o,r),Y.lineJoin=H,Y.lineCap=b}else{var A=Z.interactiveInfo;A&&(Y.interactiveInfo=A.bodyInfo={compInfos:[],matrix:new Xn(C,j.x,j.y,c.x,c.y)}),i.gray&&(Y.compGray=!0);var e=i.img;e&&e.cacheRule!=N&&(e=Hl(Y,e,i.stretch,r.width,r.height,J,Q,i.bodyColor)),wf(Y,e,i.stretch,r.x,r.y,r.width,r.height,J,Q,i.bodyColor),Y.compGray=!1,Y.interactiveInfo=N}Y.restore(),S&&Y.restore()}Z._39O(Y,i)},_48O:function(){},_47O:function(){}});var Co=function(i,c){Iq(Co,this,[i,c])},wg=function(c,u,o,E){var Y=So(c,u);return o=E?J(o,Y):_b(o,Y),Y?o/=Y:o=0,{x:c.x+(u.x-c.x)*o,y:c.y+(u.y-c.y)*o}};ri(Co,bj,{_3O:function(){var P,e=this,d=e._data,J=e.gv,O=e.s,R=O(_q),W=d.isLooped(),p=O("edge.width"),D=e.getBodyColor("edge.color"),B=O("edge.center"),c=O("edge.offset"),i=J.getBorderColor(d),k=i?O("border.width"):0,V=e.getSelectWidth(),l=d._40I,w=d._41I,T=e._78o=l&&w?{looped:W,type:R,width:p,center:B,color:D,repeatImage:Fp(O("edge.repeat.image"),D),borderColor:i,borderWidth:k,_97o:V?e.getSelectColor():N,selectWidth:V,pattern:O("edge.pattern"),cap:O("edge.cap"),join:O("edge.join"),is3d:O("edge.3d"),_67o:O("edge.3d.color"),_66o:O("edge.3d.accuracy"),gray:O("2d.gray")}:N;if(T){var q=F.getEdgeType(R);if(q){var S=q(d,Yi(e,J,d,W,R),J,e._19Q);S.points&&S.points.size()>1?(T.edgeTypeInfo=S,P=Jf(T.edgeTypeInfo.points)):S[Pp]&&S.rect&&(T.edgeTypeInfo=S,P=S.rect)}else{var t=O("edge.source.anchor.x"),j=O("edge.source.anchor.y"),s=O("edge.target.anchor.x"),x=O("edge.target.anchor.y"),Z=tq(J,d,"source"),r=tq(J,d,"target");if(R===Xf){var v=T.points=O(nb)||Ah,o=v.size();T.segments=O("edge.segments");var y=t!==I||j!==I||lm(l),b=s!==I||x!==I||lm(w);if(!B)if(c)y||(Z=wg(Z,o?v.get(0):r,c,o)),b||(r=wg(r,o?v.get(o-1):Z,c,o));else{var M;y||(M=mq(Z,o?v.get(0):r,Wg(J,l)),M&&(Z={x:M[0],y:M[1]})),b||(M=mq(o?v.get(o-1):Z,r,Wg(J,w)),M&&(r={x:M[0],y:M[1]}))}P=pq(Jf(T.points),Jf(Z,r))}else{var m=Yi(e,J,d,W,R);if(e._19Q||(m=-m),W)Z=iq(Z),Z.x=J.getNodeRect(l).x,T.radius=m,P={x:Z.x-m,y:Z.y-m,width:2*m,height:2*m};else{var f=So(Z,r),X=_b(c,f),E={x:X,y:m},A={x:f-X,y:m},a=ge(r.y-Z.y,r.x-Z.x),z=T.mat=new zg(a);if(T.orienAngle=a,T.angle=r.x<Z.x?a+G:a,T.rect={x:E.x,y:E.y,width:A.x-E.x,height:0},T.origin=Z,E=z.tf(E),E.x+=Z.x,E.y+=Z.y,A=z.tf(A),A.x+=Z.x,A.y+=Z.y,B){var C={x:f,y:0};C=z.tf(C),C.x+=Z.x,C.y+=Z.y,P=Jf([Z,E,A,C]),T.c1=Z,T.c2=C}else P=Jf(E,A);Z=E,r=A}}T.sourcePoint=Z,T.targetPoint=r,d._lastSourcePoint=Z,d._lastTargetPoint=r}var h=0;O("edge.dash")&&(h=O("edge.dash.width")||p);var Q="square"===T.cap?.71:.5;Lc(P,n(h*Q,p*Q+k+V),T.join),e._68o(P)}},getRotation:function(k,C,U){k=k||0;var j=this._78o;if(j){var J,a=j.angle,F=j.points,g=j.edgeTypeInfo;if(a!=N)return C?j.orienAngle+k:a+k;if(g&&g[Pp])return g.getRotation?g.getRotation(this,k,C,U):0;if(g&&g.points){var n=g.points;return J=n.size(),qf[U]?J&&0===J%2?Bs(n.get(J/2-1),n.get(J/2),C,k):k:Vb[U]?Bs(n.get(0),n.get(1),C,k):Bs(n.get(J-2),n.get(J-1),C,k)}if(F)return J=F.size(),qf[U]?J&&0===J%2?Bs(F.get(J/2-1),F.get(J/2),C,k):0===J?Bs(j.sourcePoint,j.targetPoint,C,k):k:Vb[U]?Bs(j.sourcePoint,J?F.get(0):j.targetPoint,C,k):Bs(J?F.get(J-1):j.sourcePoint,j.targetPoint,C,k)}return k},getPosition:function(n,k,L,P,c){var B=this._78o;if(B){var D,Z=B.type,g=B.points,R=B.edgeTypeInfo,p=B.sourcePoint,r=B.targetPoint;if(!Z)return B.looped?{x:p.x-B.radius+k,y:p.y+L}:(c&&p&&r&&(p.x>r.x||p.x===r.x&&p.y>r.y)&&(n=Dc[n],L=-L),D=Sh(n,B.rect,P),D.x+=k,D.y+=L,D=B.mat.tf(D),D.x+=B.origin.x,D.y+=B.origin.y,D);if(R&&R[Pp])return R.getPosition?R.getPosition(this,n,k,L,P,c):{x:(p.x+r.x)/2,y:(p.y+r.y)/2};if(g){var D,i=g.size();if(qf[n]){if(i){var T=i%2;if(0===T)return zb(g.get(i/2-1),g.get(i/2),n,k,L,P,c);D=g.get((i-T)/2)}else D={x:(p.x+r.x)/2,y:(p.y+r.y)/2};return D=Sh(n,{x:D.x,y:D.y,width:0,height:0},P),D.x+=k,D.y+=L,D}return Vb[n]?zb(p,i?g.get(0):r,n,k,L,P,c):zb(i?g.get(i-1):p,r,n,k,L,P,c)}if(R){var I=R.points,i=I.size();if(qf[n]){var T=i%2;return 0===T?zb(I.get(i/2-1),I.get(i/2),n,k,L,P,c):(D=I.get((i-T)/2),D=Sh(n,{x:D.x,y:D.y,width:0,height:0},P),D.x+=k,D.y+=L,D)}return Vb[n]?zb(I.get(0),I.get(1),n,k,L,P,c):zb(I.get(i-2),I.get(i-1),n,k,L,P,c)}}return ro},_42:function(_){this._78o&&Co.superClass._42.call(this,_)},drawPath:function(N,U){N.beginPath();var A=U.type,E=U.points,i=U.segments,v=U.edgeTypeInfo;if(!A||E){var T=U.sourcePoint,J=T.x,H=T.y,g=U.targetPoint,G=g.x,K=g.y;if(A)if(i){var V=new Ik({x:J,y:H});V.addAll(E),V.add({x:G,y:K}),Qr(N,V,i)}else N.moveTo(J,H),E.each(function(n){N.lineTo(n.x,n.y)}),N.lineTo(G,K);else U.looped?N.arc(J,H,U.radius,0,f,!0):U.center?(N.moveTo(U.c1.x,U.c1.y),N.lineTo(J,H),N.lineTo(G,K),N.lineTo(U.c2.x,U.c2.y)):(N.moveTo(J,H),N.lineTo(G,K))}else v&&(v.points?Qr(N,v.points,v.segments):v[Pp]&&v[Pp](N,v))},_80o:function(A){var I=this,z=I.s,m=I._78o,o=m.width,S=m.selectWidth,g=m.borderWidth,b=m.repeatImage,M=A.lineJoin,n=A.lineCap,w=m.gray,J=m.pattern;A.lineJoin=m.join,A.lineCap=m.cap,I.drawPath(bl(A,J),m);var l=z("edge.width.absolute");l&&(A.save(),A.setTransform(1,0,0,1,0,0)),S&&(A.strokeStyle=m._97o,A.lineWidth=o+2*(g+S),A.stroke()),g&&(A.strokeStyle=w?F.toGrayColor(m.borderColor):m.borderColor,A.lineWidth=o+2*g,A.stroke());var H=w?F.toGrayColor(m.color):m.color;if(b?sh(A,b,H,null,I._data,I.gv):A.strokeStyle=H,A.lineWidth=o,A.stroke(),m.is3d){var k=w?F.toGrayColor(m._67o):m._67o;Tn(A,H,k,o,I.gv._zoom,m._66o)}if(z("edge.dash")){J=z("edge.dash.pattern");var G=bl(A,J,I._2Q("edge.dash.offset"));G!==A&&I.drawPath(G,m),I._1Q(A,"edge",z("edge.dash.width")||o,J)}l&&A.restore(),Ai(A,J),A.lineJoin=M,A.lineCap=n},_48O:function(){},_47O:function(){}});var td=function(N,w){Iq(td,this,[N,w])};ri(td,De,{_3O:function(){var F,e,l=this,I=l.s,G=l._data,v=l.gv;if(l._88I=N,G.isExpanded()&&G.eachChild(function(R){if(cl(R)){var U=v.getBoundsForGroup(R);U&&(e||(e=[]),e.push(U),F=pq(F,U))}}),F){var B=v.getLabel(G),g=I("group.type"),J=I("group.border.width")||0,p=I("group.border.width.absolute"),r=J/2;p&&(J/=v._zoom),F=rc(g,e,F),_e(F,G,"group.padding",1),Oj(F,J);var a=l._88I={type:g,rect:F,_64o:F};if(!g&&B!=N){var h,R=l.labelInfo={label:B,color:I("group.title.color"),font:I("group.title.font"),align:I("group.title.align")},$=gs(R,B),P=$.width+J,d=$.height+J,u=I("group.title.align"),H=I("group.title.orientation");if(H===nc||H===yf?(F.height+=J,P>F.width&&(F.width=P)):(H===hp||H===Il)&&(F.width+=J,P>F.height&&(F.height=P)),h=u===hp?F.x:u===Il?F.x+F.width-P:F.x+F.width/2-P/2,H===yf)a.titleRect={x:F.x,y:F.y+F.height,width:F.width,height:d},a.rect={x:F.x,y:F.y,width:F.width,height:F.height+d},R.rect={x:h,y:F.y+F.height,width:P,height:d};else if(H===hp){var j=a.titleRect={x:F.x-d,y:F.y,width:d,height:F.height};a.rect={x:F.x-d,y:F.y,width:F.width+d,height:F.height},R.rect={x:j.x+d/2-F.height/2,y:j.y+F.height/2-d/2,width:F.height,height:d},R.rotation=-Math.PI/2}else if(H===Il){var j=a.titleRect={x:F.x+F.width,y:F.y,width:d,height:F.height};a.rect={x:F.x,y:F.y,width:F.width+d,height:F.height},R.rect={x:j.x+d/2-F.height/2,y:j.y+F.height/2-d/2,width:F.height,height:d},R.rotation=Math.PI/2}else a.titleRect={x:F.x,y:F.y-d,width:F.width,height:d},a.rect={x:F.x,y:F.y-d,width:F.width,height:F.height+d},R.rect={x:h,y:F.y-d-r,width:P,height:d+J}}l._40O(a,I("group.border.width")/2)}else td.superClass._3O.call(l)},getPosition:function(x,d,o,J){var l=this._88I;if(l){var M=Sh(x,l.rect,J);return M.x+=d,M.y+=o,M}return td.superClass.getPosition.apply(this,arguments)},_24O:function(k,Z){var n=this._88I;(!n||n.type||"label2"===k)&&td.superClass._24O.call(this,k,Z)},_80o:function(g){var m=this,k=m._88I;if(k){var c=m._data,f=m.s,U=m.gv,F=k.type,C=k.rect,O=k._64o,b=k.titleRect,z=m.getBodyColor(),h=Fp(f("group.image"),z),n=f("group.image.stretch"),H=m.getBodyColor("group.background"),r=Fp(f("group.repeat.image"),z),$=f("group.gradient.pack"),a=f("group.gradient"),W=f("group.gradient.color"),G=f("group.border.width"),u=f("group.border.color"),w=f("group.border.pattern"),Y=f("group.title.orientation"),V=f("group.depth"),i=f("group.border.radius"),l=f("group.border.join"),B=f("group.border.cap"),P=f("group.border.width.absolute");P&&(G/=U._zoom);var Q=u,R=f("group.border.repeat.image");if(R&&(R=Fp(R,u))&&(Q=Pj(g,R,u,null,c,U)),F){var q=g.lineJoin,X=g.lineCap;if(g.lineJoin=l,g.lineCap=B,h){if(g.save(),Uq(g,F,C,i),g.clip(),wf(g,h,n,C.x,C.y,C.width,C.height,c,U,z),g.restore(),G>0){var s=bl(g,w);Uq(s,F,C,i),g.lineWidth=G,g.strokeStyle=Q,g.stroke(),Ai(g,w)}}else{var s=bl(g,w);H||r||$?(Uq(g,F,C,i),$?hj(g,$,function(s){return Fn(s,z)},!1,C):r?_k(g,r,z,null,c,U):Zn(g,H,a,W,C),g.fill(),$&&g.restore(),g!==s&&Uq(s,F,C,i)):Uq(s,F,C,i),G>0&&(g.lineWidth=G,g.strokeStyle=Q,g.stroke()),Ai(g,w),F===Yp&&Mi(g,H,V,C)}g.lineJoin=q,g.lineCap=X}else{var M=f("group.title.background");if((!i||0>i)&&(i=0),h)wf(g,h,n,O.x,O.y,O.width,O.height,c,U,m.getBodyColor());else if(H||r)if(r?_k(g,r,z,null,c,U):Zn(g,H,a,W,O),0===G)Uq(g,Yp,O),g.fill(),Mi(g,H,V,O);else{switch(g.beginPath(),Y){case yf:Nm(g,O.x,O.y,O.width,O.height,i,i,0,0);break;case hp:Nm(g,O.x,O.y,O.width,O.height,0,i,0,i);break;case Il:Nm(g,O.x,O.y,O.width,O.height,i,0,i,0);break;case nc:Nm(g,O.x,O.y,O.width,O.height,0,0,i,i)}g.fill()}if(b&&M)if(0===G)no(g,b.x,b.y,b.width,b.height,M),Mi(g,M,V,b);else{switch(g.beginPath(),g.fillStyle=M,Y){case yf:Nm(g,b.x,b.y,b.width,b.height,0,0,i,i);break;case hp:Nm(g,b.x,b.y,b.width,b.height,i,0,i,0);break;case Il:Nm(g,b.x,b.y,b.width,b.height,0,i,0,i);break;case nc:Nm(g,b.x,b.y,b.width,b.height,i,i,0,0)}g.fill()}if(G>0){var s=bl(g,w);if(Uq(s,"roundRect",C,i),g.save(),g.lineWidth=G,g.strokeStyle=Q,g.lineJoin=l,g.lineCap=B,g.closePath(),g.stroke(),b&&f("group.splitLine")){var S=b.x,Z=b.y,K=b.width,N=b.height;g.beginPath(),Y===yf?(g.moveTo(S,Z),g.lineTo(S+K,Z)):Y===hp?(g.moveTo(S+K,Z),g.lineTo(S+K,Z+N)):Y===Il?(g.moveTo(S,Z),g.lineTo(S,Z+N)):(g.moveTo(S,Z+N),g.lineTo(S+K,Z+N))}g.stroke(),g.restore(),Ai(s,w)}}m._39O(g,k)}else td.superClass._80o.call(m,g)}});var zf=function($,P){Iq(zf,this,[$,P])};ri(zf,De,{_80o:function(F){this._39O(F,this._83o)}});var qb=function(K,U){Iq(qb,this,[K,U])};ri(qb,De,{_3O:function(){var A=this,B=A._data,e=A.s,d=A.gv,c=B.getPoints(),L=d.getBorderColor(B),h=L?e("border.width"):0,f=A.getSelectWidth(),r=e("shape.border.width"),P=B.getRect(),$=B.getAnchorRect(),U=d.getBodyColor(B),i=e("shape.border.color"),H=A._99o=c.isEmpty()?N:{rect:P,rotation:B.getRotation(),fillRule:e("shape.fill.rule"),scale:B.getScale(),position:B.p(),points:c,segments:B.getSegments(),bodyColor:U,borderColor:L,borderWidth:h,_94o:e("shape.border.3d"),_95o:e("shape.border.3d.color"),_96o:e("shape.border.3d.accuracy"),_97o:f?A.getSelectColor():N,selectWidth:f,_53o:e("shape.background"),_27Q:Fp(e("shape.repeat.image"),U),shapeGradientPack:e("shape.gradient.pack"),shapeBorderGradientPack:e("shape.border.gradient.pack"),_54o:r,_55o:i,shapeBorderRepeatImage:Fp(e("shape.border.repeat.image"),i),shapeGradient:e("shape.gradient"),_59o:e("shape.gradient.color"),_60o:e("shape.border.pattern"),_61o:e("shape.border.cap"),_62o:e("shape.border.join"),shapeForeground:e("shape.foreground"),gray:e("2d.gray")};if(H){$.x+=H.position.x,$.y+=H.position.y,H.gradientRect=$;var M=B.getScale(),C=n(1,n(u(M.x),u(M.y)));e("shape.dash")&&e("shape.dash.width")>r&&(r=e("shape.dash.width"));var p,o=e("shape.border.width.absolute");p=o?(r+h+f)/A.gv._zoom/C:r*("square"===H._61o?.71:.5)+h+f/A.gv._zoom/C,p&&(p*=C,P=iq(P),Lc(P,p,H._62o)),A._68o(P);var q=e("clip.percentage");q!=I&&(H.clipRect=zl(B.getAnchorRect(),e("clip.direction"),q));var E=e("shape.fill.clip.percentage");E!=I&&(H.shapeClipRect=zl(B.getAnchorRect(),e("shape.fill.clip.direction"),E));var s=e("shape.foreground.clip.percentage");s!=I&&(H.shapeForegroundClipRect=zl(B.getAnchorRect(),e("shape.foreground.clip.direction"),s))}},getPosition:function(i,T,C,R){var N=this._99o;if(N){var Y=Sh(i,N.rect,R);return Y.x+=T,Y.y+=C,Y}return ro},_42:function(_){this._99o&&qb.superClass._42.call(this,_)},_80o:function(z){var s,G=this,T=G.s,n=G._99o,W=n.position,x=n.scale,h=n.rotation,l=n.borderWidth,$=G.gv._zoom,E=n.selectWidth/$,w=n._27Q,c=n.shapeGradientPack,V=n._54o,P=n.clipRect,j=n.shapeClipRect,_=n.points,Y=n.segments,J=G._data.isClosePath(),b=n.fillRule,I=n.gray,f=function(x){return I?F.toGrayColor(x):x},p=f(n._53o),r=p||w||c;z.save(),jf(z,W.x,W.y),je(z,h),$r(z,x.x,x.y),P&&(z.beginPath(),z.rect(P.x,P.y,P.width,P.height),z.clip()),r&&j&&(z.save(),z.beginPath(),z.rect(j.x,j.y,j.width,j.height),z.clip());var M=iq(n.rect);y.Default.extractShapeTranslation?(_=iq(_),_.forEach(function(y){y.x-=W.x,y.y-=W.y}),M.x-=W.x,M.y-=W.y):jf(z,-W.x,-W.y);var A=T("shape.border.width.absolute"),i=n._60o;A&&i&&(i=i.map(function(X){return X*$}));var k=bl(z,i),D=z.lineJoin,S=z.lineCap;z.lineJoin=n._62o,z.lineCap=n._61o;var K=f(n.bodyColor);r?(Qr(z,_,Y,J),c?hj(z,c,function(w){return Fn(w,n.bodyColor)},!1,M):w?_k(z,w,K,null,G._data,G.gv):(s=K?K:p,Zn(z,s,n.shapeGradient,f(n._59o),n.gradientRect)),z.fill(b),c&&z.restore(),j&&(z.restore(),jf(z,-W.x,-W.y)),k!==z&&Qr(k,_,Y,J)):Qr(k,_,Y,J);var U=n.shapeForeground;if(U){z.save();var C=n.shapeForegroundClipRect;C&&(jf(z,W.x,W.y),z.beginPath(),z.rect(C.x,C.y,C.width,C.height),z.clip(),jf(z,-W.x,-W.y)),Qr(z,_,Y,J),Zn(z,U,T("shape.foreground.gradient"),f(T("shape.foreground.gradient.color")),n.gradientRect),z.fill(b),z.restore()}if(A&&(z.save(),z.setTransform(1,0,0,1,0,0)),E&&(z.strokeStyle=n._97o,z.lineWidth=V+2*(l+E),z.stroke()),l&&(z.strokeStyle=f(n.borderColor),z.lineWidth=V+2*l,z.stroke()),V){s=f(n._55o);var H=n.shapeBorderGradientPack;H?hj(z,H,f,!0,M):n.shapeBorderRepeatImage?sh(z,n.shapeBorderRepeatImage,s,null,G._data,G.gv):(!p&&K&&(s=K),z.strokeStyle=s),z.lineWidth=V,z.stroke(),H&&z.restore(),n._94o&&Tn(z,s,f(n._95o),V,$,n._96o)}if(Ai(z,i),T("shape.dash")){var B=T("shape.dash.width")||V;if(B>0){i=T("shape.dash.pattern"),A&&(i=i.map(function(d){return d*$}));var k=bl(z,i,G._2Q("shape.dash.offset"));k!==z&&Qr(k,_,Y,J),G._1Q(z,"shape",B,i)}}A&&z.restore(),z.lineJoin=D,z.lineCap=S,z.restore()},_48O:function(){},_47O:function(){}});var Of=function(w,N){Iq(Of,this,[w,N])};ri(Of,qb,{getRotation:function(){var x=new of,G=new of,b=new Xn;return function(L,E,T){L=L||0;var Q=this._data,j=Q.getPoints(),s=j.size();if(s>1){var i,Y,p=Q.p(),S=Q.getScale();if(b.identity().translate(-p.x,-p.y).scale(S.x,S.y).translate(p.x,p.y),qf[T]){var J=s%2,l=(s-J)/2;i=j.get(l-1),Y=j.get(l)}else Vb[T]?(i=j.get(0),Y=j.get(1)):(i=j.get(s-2),Y=j.get(s-1));return b.apply(i,x),b.apply(Y,G),Bs(x,G,E,L)}return L}}(),getPosition:function(){var T=new of,V=new of,U=new of;return function(R,w,Y,r,$){var Z=this._data,m=Z.getPoints(),B=m.size();if(B>1){var e,f,O=Z.getPointsMatrix2d();if(qf[R]){var A=B%2,L=(B-A)/2;if(e=m.get(L-1),f=m.get(L),0!==A){var K=Sh(R,ro,r);return K.x+=w,K.y+=Y,O.apply(e,T),O.apply(f,V),O.identity().rotate(U.copy(V).sub(T).angle()).apply(K,T).add(V)}}else Vb[R]?(e=m.get(0),f=m.get(1)):(e=m.get(B-2),f=m.get(B-1));return O.apply(e,T),O.apply(f,V),zb(T,V,R,w,Y,r,$)}return ro}}()});var Cd=function(S,g){Iq(Cd,this,[S,g])};ri(Cd,De,{_3O:function(){var C=this;Cd.superClass._3O.call(C);var r=C.s,L=C._83o;C._82o=L.img||L.shape?N:{background:C.getBodyColor("grid.background"),depth:r("grid.depth"),rect:L.rect,_88o:r("grid.cell.depth"),cellBorderColor:r("grid.cell.border.color"),_89o:r("grid.row.count"),_90o:r("grid.column.count"),block:r("grid.block"),_91o:r("grid.block.color"),_92o:r("grid.block.padding"),_93o:r("grid.block.width")}},_80o:function(m){var J=this,i=J._82o;if(!i)return Cd.superClass._80o.call(J,m),void 0;var C,q,f=J._data,$=i.background,O=i.rect,z=i.block,l=i._91o,T=i._92o,F=i._93o,A=i._88o,D=i.cellBorderColor,s=i._89o,S=i._90o;if($)if(no(m,O.x,O.y,O.width,O.height,$),Mi(m,$,i.depth,O),A)for(C=0;s>C;C++)for(q=0;S>q;q++)O=f.getCellRect(C,q),O&&Mi(m,$,A,O);else if(D){for(m.beginPath(),C=0;s>C;C++)for(q=0;S>q;q++)O=f.getCellRect(C,q),O&&m.rect(O.x,O.y,O.width,O.height);m.strokeStyle=D,m.lineWidth=1,m.stroke()}if("h"===z)for(C=0;s>C;C++)O=pq(f.getCellRect(C,0),f.getCellRect(C,S-1)),Oj(O,T),Jq(m,l,O.x,O.y,O.width,O.height,F);else if("v"===z)for(q=0;S>q;q++)O=pq(f.getCellRect(0,q),f.getCellRect(s-1,q)),Oj(O,T),Jq(m,l,O.x,O.y,O.width,O.height,F);J._39O(m,J._83o)}});var ir=function(Z,_){Iq(ir,this,[Z,_])},Pi=H?Qb().getContext("2d"):N;ri(ir,De,{_checkEmptyRect:!1,_81o:function(){var Q=this._data,H=ir.superClass._81o.call(this),M=Q.s("text");if(M!=N){M+="";var b,r=Q.s("text.font"),X=Q.s("text.align"),E=Q.s("text.vAlign"),U=Q.s("text.wrap"),B=Q.s("text.vertical"),Y=Q.s("text.vertical.gap"),R=Q.s("text.letter.gap")||0,A=Q.getWidth(),c=Q.getHeight();if(null==Y&&(Y=1),B){var W;W=U?dp(M,c,r,R,B,Y):[M];var a=(W.length-1)*R,O=0;Pi.textBaseline=nc,Pi.font=r,W.forEach(function(Z){for(var d=Z.length,x=0,y=(d-1)*Y,p=0;d>p;p++){var h=Pi.measureText(Z[p]);y+=h.fontBoundingBoxDescent||ce(r,Z[p]).height,x=n(x,h.width)}a+=x,O=n(y,O)});var g=(W.length-1)*R;W.forEach(function(G){g+=G}),b={width:a,height:O}}else{var W=U?dp(M,A,r,R,B,Y):M.split("\n"),d=W.length;if(d>1){var i=ce(r,M).height,a=0,O=i*d+Y*(d-1);W.forEach(function(w){a=n(a,ce(r,w).width)}),b={width:a,height:O}}else b=ce(r,M),R&&(b.width+=(M.length-1)*R)}var h,f,K=b.width,m=b.height,Z=Q.getAnchor();"left"===X?h=-A*Z.x:"center"===X?h=-A*Z.x+(A-K)/2:"right"===X&&(h=A*(1-Z.x)-b.width),"top"===E?f=-c*Z.y:"middle"===E?f=-c*Z.y+(c-m)/2:"bottom"===E&&(f=c*(1-Z.y)-b.height);var S,I=Q.getMatrix();if(S=Jf([I.tf(h,f),I.tf(h+K,f),I.tf(h+K,f+m),I.tf(h,f+m)]),H=pq(H,S),H&&Q.s("text.shadow")){var v=iq(H);v.x+=Q.s("text.shadow.offset.x"),v.y+=Q.s("text.shadow.offset.y"),Oj(v,Q.s("text.shadow.blur")),H=pq(H,v)}}return H}});var ti=Nf.Interactor=function(c){this.gv=this._graphView=c};ol("Interactor",C,{ms_listener:1,getView:function(){return this.gv.getView()},setUp:function(){this.addListeners()},tearDown:function(){this.removeListeners(),this.clear()},clear:function(){},fi:function(C){this.gv.fi(C)},setCursor:function(D){Hi||this.gv.setCursor(D)},startDragging:function(Z){var W=this;W._lastClientPoint=oc(Z),W._lastLogicalPoint=W.gv.lp(Z),Gp(W,Z)},clearDragging:function(){var Z=this;Z._lastClientPoint=Z._lastLogicalPoint=Z._logicalPoint=N},autoScroll:function(z){return this.gv.autoScroll(z,this._lastClientPoint)}});var hs=N,Ig=function(p){hs.handleWindowTouchMove(p)},Ok=function(j){hs.handleWindowTouchEnd(j),V(w,_j,Ig),V(w,vn,Ok),hs=N},Lm=function(L){hs.handleWindowMouseMove(L)},os=function(Y){hs.handleWindowMouseUp(Y),V(w,Po,Lm),V(w,lj,os),hs=N},ml=function(b,l){if(b!==hs){var B=Qm(l);hs?B?hs.handleWindowTouchEnd(l):hs.handleWindowMouseUp(l):B?(q(w,_j,Ig),q(w,vn,Ok)):(q(w,Po,Lm),q(w,lj,os)),hs=b}},Cl=function(_){var w=this;w.gv=_,w._is2d=_ instanceof Nf.GraphView,w._eventListeners={},["mousedown","mousemove","mouseleave","touchstart","touchmove",Cj,"wheel"].forEach(function(p){w.addListener(p)}),w.initImageResource()};ri(Cl,ti,{enableVR:function(V){var x=this;!!x._vrEnable!==V&&(x._vrEnable=V,V?x.gv.vr.mp(x.onVRControllerChange,x):x.gv.vr.ump(x.onVRControllerChange,x))},onVRControllerChange:function(b){var O=this,G=b.property,e=b.newValue,f=e.id,N=O.gv.vr.getController(f),W=N.getRay();if(W){W.controllerId=f;var x=O.gv.vr.getRayEventType(W,G,e[Xg]);switch(x){case"down":O.handle_mousedown(W);break;case"up":hs&&os(W);break;case"move":O.handle_mousemove(W),hs&&O.handleWindowMouseMove(W)}}},setPreventEventDefault:function(K,h){var $=this,t=$._eventListeners[K];t?t._prevent=h:$._eventListeners[K]=t={_removal:I,_prevent:h}},removeListener:function($){var L=this,f=L._eventListeners[$];f&&f._removal&&(f._removal(),f._removal=I)},addListener:function(t){var D=this,X=D._eventListeners[t];if(X||(D._eventListeners[t]=X={_removal:I,_prevent:!0}),!X||!X._removal){var B=function(v){X._prevent&&F.preventDefault(v),D.disabled||D.gv._48Q||("wheel"===t?fr(D,v):D["handle_"+t](v))};q(D.gv.getView(),t,B),X._removal=function(){V(D.gv.getView(),t,B)}}},handleWindowTouchMove:function(s){this.handleWindowMouseMove(s)},handleWindowMouseMove:function(x){return!this.downInfo||Qm(x)&&1!==hm(x)?(this.isDragging&&(this.handleDownInfo("onEndDrag",x),this.isDragging=!1),void 0):(this.isDragging?this.handleDownInfo("onDrag",x):(this.handleDownInfo("onBeginDrag",x),this.isDragging=!0),void 0)},handleWindowTouchEnd:function(E){this.handleWindowMouseUp(E)},handleWindowMouseUp:function(d){if(this.isDragging&&(this.handleDownInfo("onEndDrag",d),this.isDragging=!1),this.downInfo){var v=this.handle("onUp",d);if(v&&v.data===this.downInfo.data){this.handleMissingUp(d);var H=this,h=2===d.button?"onContextMenu":"onClick",C=v.data;if(C.s("disableDoubleClick")||!H._dbclickTimer)return H._dbclickTimer=Jo(function(){delete H._dbclickTimer,H.handleClick(d,h,v),this.downInfo=N},F.clickDelay),void 0;wc(H._dbclickTimer),delete H._dbclickTimer,h="onDoubleClick",H.handleClick(d,h,v)}else this.handleDownInfo("onUp",d);this.downInfo=N,this.downComps=N}},handle_mouseleave:function(t){var l=this,$=l.gv;l._hoverTimer&&(wc(l._hoverTimer),delete l._hoverTimer);var O=l.currentInfo?l.currentInfo.data:N;if(O){O.s("onLeave")&&O.s("onLeave")(t,O,$),l.fire("data","onLeave",t,O);var R=l.currentInfo?l.currentInfo.hits:N;if(R)for(var o in R)l.handleLeave(t,o);l.currentInfo=N}},handle_mousewheel:function(T){T.scrollDelta=T.wheelDelta/40,this.handle("onScroll",T)},handle_DOMMouseScroll:function(z){z.scrollDelta=2===z.axis?-z.detail:0,this.handle("onScroll",z)},handle_touchstart:function(i){this.handle_mousedown(i)},handle_touchmove:function(G){this.handle("onMove",G)},handle_mousedown:function(k){this.isDragging&&(this.handleDownInfo("onEndDrag",k),this.isDragging=!1),this.downComps=[],this.downInfo=this.handle("onDown",k),this.downInfo&&ml(this,k)},handle_mousemove:function(z){var I=this,t=I.gv;if(I._hoverTimer&&(wc(I._hoverTimer),delete I._hoverTimer),!t._panning&&!t._moving){var $,i,p,T=I.handle("onMove",z),m=this.currentInfo?this.currentInfo.data:N,K=this.currentInfo?this.currentInfo.hits:N;if(T&&(i=T.data,p=T.hits,I._hoverTimer=Jo(function(){wc(I._hoverTimer),delete I._hoverTimer,I.handle("onHover",z,T)},t.getHoverDelay()||F.hoverDelay)),i!==m){if(m&&(m.s("onLeave")&&m.s("onLeave")(z,m,t),this.fire("data","onLeave",z,m)),i&&(i.s("onEnter")&&i.s("onEnter")(z,i,t),this.fire("data","onEnter",z,i)),K)for($ in K)this.handleLeave(z,$);if(p)for($ in p){var b=p[$],a=i._interactPrefix=b.prefix,S=a&&i.a(a+"onEnter")||b.target.onEnter;S&&S.call(b.target,z,i,t,b.point,b.width,b.height),this.fire(b.type,"onEnter",b.event,b.data,b.image,b.comp,b.point,b),i._interactPrefix=null}}else{if(K)for($ in K)p&&p[$]||this.handleLeave(z,$);if(p)for($ in p)if(!K||!K[$]){var b=p[$],a=i._interactPrefix=b.prefix,S=a&&i.a(a+"onEnter")||b.target.onEnter;S&&S.call(b.target,z,i,t,b.point,b.width,b.height),this.fire(b.type,"onEnter",b.event,b.data,b.image,b.comp,b.point,b),i._interactPrefix=null}}this.currentInfo=T}},handle:function(w,L,J){var m,I=this,d=I.gv;if(I._is2d){if(J=J||d.getDataInfoAt(L),!J||!d.isInteractive(J.data))return;if(m=J.ui.interactiveInfo){var v,_=J.data;if(_.s(w)&&_.s(w)(L,_,d),this.fire("data",w,L,_),"body"===J.part&&m.bodyInfo)v="body",J.hits=this.handleImage(v,d.getImage(_),w,L,_,J.point,m.bodyInfo);else if("icons"===J.part&&m._38o){var A=m._38o[J.name];A&&A[J.index]&&(v="icons|"+J.name+"|"+J.index,J.hits=this.handleImage(v,J.icon,w,L,_,J.point,A[J.index]))}}return J}var _,b;if(!J)if(L&&L instanceof y.Math.Ray&&d.isVREnabled()){var f=d.vr.intersectWorld(L);if(_=f.data,b=f.intersect,d.vr.renderRayDuringInteraction(L,_,b),!_)return;var j=d.getData3dUI(_);if(m=j.interactiveInfo,!m)return;J={data:_,part:b.part,ui:j}}else{if(J=this.getDataInfoAt(L),!J)return;J&&(J={data:J.data,part:J.part})}if(d.isInteractive(J.data)){if(!b){_=J.data;var j=d.getData3dUI(_);if(J.ui=j,m=j.interactiveInfo,!m)return J;if(b=d.intersectObject(L,_),!b)return J}_.s(w)&&_.s(w)(L,_,d),this.fire("data",w,L,_);var p,q=b.part;return"body"!==q&&(p=_.s(q+".image")||_.s("shape3d."+q+".image")),p||(p=_.s("all.image")||_.s("shape3d.image")),p?(m="object"==typeof p?m[p.uuid]:m[p],m&&m.bodyInfo?(J.part="body",J.interactiveInfo=m,J.point=this._convertUVToPoint(b.uv,m,_,q,p),J.image=p,J.hits=this.handleImage("body",p,w,L,_,J.point,m.bodyInfo),J):J):J
}},_handleLeaveOrMissing:function(L,h,l){var U="leave"===L?this.currentInfo:this.downInfo;if(U){var R=U.interactiveInfo||U.ui.interactiveInfo;if(R){var q,M,O=U.data;if(this._is2d){if(M=this.gv.lp(h),"body"===U.part&&R.bodyInfo)q="body","leave"===L?this.handleLeaveImage(l,q,this.gv.getImage(O),h,O,M,R.bodyInfo):this.handleMissingUpImage(q,this.gv.getImage(O),h,O,M,R.bodyInfo);else if("icons"===U.part&&R._38o){var H=R._38o[U.name];H&&H[U.index]&&(q="icons|"+U.name+"|"+U.index,"leave"===L?this.handleLeaveImage(l,q,U.icon,h,O,M,H[U.index]):this.handleMissingUpImage(q,U.icon,h,O,M,H[U.index]))}}else{if(!R.bodyInfo)return;var S=this.gv.intersectObject(h,O);M=S&&S.uv?this._convertUVToPoint(S.uv,R,O,S.part,U.image):{x:1/0,y:1/0},"leave"===L?this.handleLeaveImage(l,"body",U.image,h,O,M,R.bodyInfo):this.handleMissingUpImage("body",U.image,h,O,M,R.bodyInfo)}}}},handleClick:function(D,t,F){var L=this,P=this.downInfo;if(P&&F){var q,A=F.interactiveInfo||F.ui.interactiveInfo,x=F.data,g=this.gv;if(x.s(t)&&x.s(t)(D,x,g),L.fire("data",t,D,x),A)if(this._is2d){if(P.part===F.part){var i=g.lp(D);"body"===F.part&&A.bodyInfo&&(q="body",this.handleClickImage(q,g.getImage(x),t,D,x,i,A.bodyInfo,F))}}else{if(!A.bodyInfo)return;var u=g.intersectObject(D,x);if(!u)return;i=this._convertUVToPoint(u.uv,A,x,u.part,P.image),this.handleClickImage("body",P.image,t,D,x,i,A.bodyInfo,F)}}},handleDownInfo:function(y,s){if(this.downInfo){var W=this.downInfo,M=this.gv,K=W.interactiveInfo||W.ui.interactiveInfo;if(K){var R,w=W.data;if(w.s(y)&&w.s(y)(s,w,M),this.fire("data",y,s,w),this._is2d){var b=M.lp(s);if("body"===W.part&&K.bodyInfo)R="body",this.handleDownInfoImage(R,M.getImage(w),y,s,w,b,K.bodyInfo);else if("icons"===W.part&&K._38o){var P=K._38o[W.name];P&&P[W.index]&&(R="icons|"+W.name+"|"+W.index,this.handleDownInfoImage(R,W.icon,y,s,w,b,P[W.index]))}}else{if(!K.bodyInfo)return;var Z;if("onBeginDrag"===y?(Z=M._raycaster.intersectObjectAndRecordTriangle(s,w),Z&&(K.beginDragIntersectInfo=Z.triangleInfo)):Z=M.intersectObject(s,w),!Z&&("onDrag"!==y&&"onEndDrag"!==y||!K.beginDragIntersectInfo||(Z=M._raycaster.intersectLastTriangle(s,K.beginDragIntersectInfo)),!Z))return;b=this._convertUVToPoint(Z.uv,K,w,Z.part,W.image),this.handleDownInfoImage("body",W.image,y,s,w,b,K.bodyInfo)}}}},fire:function(f,b,H,V,Q,n,K,z){this.gv.fi({kind:b,type:f,event:H,data:V,image:Q,comp:n,view:this.gv,point:K,width:z?z.width:I,height:z?z.height:I})},handleImage:function(n,w,P,g,A,D,W){var d={};if(w&&(w=Fp(w))){var S=this.gv,T=W.rect,X=this.convertPoint(D,W);X.inRect&&(w[P]&&w[P](g,A,S,X,T.width,T.height),this.fire("image",P,g,A,w,I,X,T),d[n+"|image"]={target:w,type:"image",image:w,data:A,event:g,point:X,width:T.width,height:T.height});for(var R,N=W.compInfos,_=w,s=N.length-1;s>=0;s--){var v=N[s],O=v.comp;if(X=this.convertPoint(D,v,_,O,S,A),X.inRect){T=v.rect;var m=A._interactPrefix=v.prefix,V=m&&A.a(m+P)||O[P];if(V&&(R=V.call(O,g,A,S,X,T.width,T.height)),this.fire("comp",P,g,A,w,O,X,T),R!==!0&&(w=T.image)&&(w[P]&&(R=w[P](g,A,S,X,T.width,T.height)),this.fire("image",P,g,A,w,I,X,T)),A._interactPrefix=null,d[n+"|"+s]={target:O,type:"comp",comp:O,image:w,data:A,event:g,point:X,width:T.width,height:T.height,prefix:m},this.downComps&&this.downComps.push(O),w&&(d[n+"|"+s+"|image"]={target:w,type:"image",image:w,data:A,event:g,point:X,width:T.width,height:T.height,prefix:m}),R===!0)break}}}return d},handleLeave:function(e,E){return this._handleLeaveOrMissing("leave",e,E)},handleMissingUp:function(p){return this._handleLeaveOrMissing("missing",p)},handleLeaveImage:function(J,f,b,E,A,z,x){if(b&&(b=Fp(b))){var U=this.gv,r=x.rect,Z=this.convertPoint(z,x);J===f+"|image"&&(b.onLeave&&b.onLeave(E,A,U,Z,r.width,r.height),this.fire("image","onLeave",E,A,b,I,Z,r));for(var W,n=x.compInfos,V=b,o=n.length-1;o>=0;o--){var c=n[o],H=c.comp;Z=this.convertPoint(z,c,V,H,U,A),r=c.rect;var l=A._interactPrefix=c.prefix;if(J===f+"|"+o){var a=l&&A.a(l+"onLeave")||H.onLeave;a&&(W=a.call(H,E,A,U,Z,r.width,r.height)),this.fire("comp","onLeave",E,A,b,H,Z,r)}if(W!==!0&&(b=r.image)&&J===f+"|"+o+"|image"&&(b.onLeave&&(W=b.onLeave(E,A,U,Z,r.width,r.height)),this.fire("image","onLeave",E,A,b,I,Z,r)),A._interactPrefix=null,W===!0)break}}},handleMissingUpImage:function(R,s,C,l,E,f){var k="onUp",h=this.downInfo.hits;if(h&&s&&(s=Fp(s))){var m=this.gv,V=f.rect,M=this.convertPoint(E,f);!M.inRect&&h[R+"|image"]&&(s[k]&&s[k](C,l,m,M,V.width,V.height),this.fire("image",k,C,l,s,I,M,V));for(var t,z=f.compInfos,u=s,Q=z.length-1;Q>=0;Q--){var g=z[Q],a=g.comp;if(M=this.convertPoint(E,g,u,a,m,l),!M.inRect){V=g.rect;var q=l._interactPrefix=g.prefix;if(h[R+"|"+Q]){var P=q&&l.a(q+k)||a[k];P&&(t=P.call(a,C,l,m,M,V.width,V.height)),this.fire("comp",k,C,l,s,a,M,V)}if(t!==!0&&(s=V.image)&&h[R+"|"+Q+"|image"]&&(s[k]&&(t=s[k](C,l,m,M,V.width,V.height)),this.fire("image",k,C,l,s,I,M,V)),l._interactPrefix=null,t===!0)break}}}},handleDownInfoImage:function(p,W,Z,B,F,Q,s){var K=this.downInfo.hits;if(K&&W&&(W=Fp(W))){var f=this.gv,M=s.rect,u=this.convertPoint(Q,s);K[p+"|image"]&&(W[Z]&&W[Z](B,F,f,u,M.width,M.height),this.fire("image",Z,B,F,W,I,u,M));for(var j,v=s.compInfos,h=W,r=v.length-1;r>=0;r--){var g=v[r],U=g.comp;u=this.convertPoint(Q,g,h,U,f,F),M=g.rect;var c=F._interactPrefix=g.prefix,E=["onDrag","onEndDrag"].indexOf(Z)>=0;if(!E&&K[p+"|"+r]||E&&this.downComps&&this.downComps.indexOf(U)>=0){var x=c&&F.a(c+Z)||U[Z];x&&(j=x.call(U,B,F,f,u,M.width,M.height)),this.fire("comp",Z,B,F,W,U,u,M)}if(j!==!0&&(W=M.image)&&K[p+"|"+r+"|image"]&&(W[Z]&&(j=W[Z](B,F,f,u,M.width,M.height)),this.fire("image",Z,B,F,W,I,u,M)),F._interactPrefix=null,j===!0)break}}},handleClickImage:function(V,n,o,E,x,B,p,h){var C=this.downInfo.hits,M=h.hits;if(C&&n&&(n=Fp(n))){var m=this.gv,u=p.rect,K=this.convertPoint(B,p);C[V+"|image"]&&(n[o]&&n[o](E,x,m,K,u.width,u.height),this.fire("image",o,E,x,n,I,K,u));for(var k,H=p.compInfos,c=n,z=H.length-1;z>=0;z--){var T=H[z],L=T.comp;K=this.convertPoint(B,T,c,L,m,x),u=T.rect;var P=x._interactPrefix=T.prefix;if(C[V+"|"+z]&&M[V+"|"+z]){var s=P&&x.a(P+o)||L[o];s&&(k=s.call(L,E,x,m,K,u.width,u.height)),this.fire("comp",o,E,x,n,L,K,u)}if(k!==!0&&(n=u.image)&&C[V+"|"+z+"|image"]&&(n[o]&&(k=n[o](E,x,m,K,u.width,u.height)),this.fire("image",o,E,x,n,I,K,u)),x._interactPrefix=null,k===!0)break}}},initImageResource:function(){F.setImage("coreInteractorRayHitImage",{width:16,height:16,comps:[{type:"oval",background:"rgb(255,0,0)",borderWidth:1,borderColor:"rgb(250,120,120)",opacity:.3,rotation:-1.593,rect:[.73315,.6933,14.5337,14.61341]},{type:"oval",background:"rgb(255,0,0)",borderWidth:1,borderColor:"rgb(250,120,120)",rotation:-1.593,rect:[3.56695,3.75073,8.8661,8.49856]}]})},_convertUVToPoint:function(D,L,J,V,g){if(!D)return{x:1/0,y:1/0};var S=L.bodyInfo.rect;if(J&&g){var k,j;if("body"===V?(j=J.s("shape3d.uv.scale"),k=J.s("shape3d.uv.offset")):(j=J.s(V+".uv.scale")||J.s("all.uv.scale"),k=J.s(V+".uv.offset")||J.s("all.uv.offset")),j||k){g=F.getImage(g);var e=fl.isPOT(g.width)&&fl.isPOT(g.height),R=D.x*(j?j[0]:1)+(k?k[0]:0),h=D.y*(j?j[1]:1)+(k?k[1]:0);e&&(R=R%1+(R>0?0:1),h=h%1+(h>0?0:1)),D.set(R,h)}}var p=D.clone(),B=D.multiply({x:S.width,y:S.height});return B.local=p,B},convertPoint:function(S,J,o,D,r,Y){var p=J.rect,Z=J.matrix.applyInverse(S).sub(p),l=Z.x>=0&&Z.y>=0&&Z.x<=p.width&&Z.y<=p.height;if(!l)return Z;if(D&&Aq(D.pixelPerfect,Y,r)){var p,d=1;this._is2d?(d=r.getZoom(),p=rb(S.x,S.y,I,d)):p=rb(S.x,S.y);var q=!1,T=p.x,j=p.y,M=p.width,y=p.height,z=F.hitMaxArea,O=M*y*d*d;if(O>z){var t=Math.sqrt(z/O);d*=t}M*=d,y*=d,2>M&&(M=2),2>y&&(y=2),T*=d,j*=d;var w=tl(M,y),s=new Xn(0,-T,-j,d,d);s.append(J.matrix),r._drawForChecking=!0,D.transform=s;var k=o.fitSize;J.refRect&&J.refRect.fitSize?(D.refRect=J.refRect,o.fitSize=!0):o.fitSize=!1;var i=o.comps;o.comps=[D],He(w,o,0,0,M,y,Y,self),o.comps=i,o.fitSize=k,delete D.refRect,delete D.unionRect,delete D.transform,r._drawForChecking=!1;try{for(var G=0,C=w.getImageData(0,0,M,y).data;G<C.length;G+=4)if(0!==C[G+3]){q=!0;break}w.restore()}catch(e){Qh=N,q=!1}Z.inRect=q}else Z.inRect=!0;return Z},getDataInfoAt:function(K,J){return Qs.prototype.getDataInfoAt.call(this,K,J)}});var lr=Nf.DefaultInteractor=function(P){Iq(lr,this,[P])};ol("DefaultInteractor",ti,{handle_mousedown:function(e){vr(e);var _=this,V=_.gv,w=V.getDataAt(e);if(V.setFocus(e)&&!V._editing&&!V._scrolling){Jd(e)?V.handleDoubleClick(e,w):V.handleClick(e,w);var $=gd(e);!En()&&!$&&w&&(V.isMovable(w)||V._39Q(w))||!V.isPannable()||!bs(e)&&!$||Og(e)||(_._tx=V.tx(),_._ty=V.ty(),_.startDragging(e))}},handleWindowMouseUp:function(M){var i=this,Q=i.gv;Q._panning&&(delete Q._panning,Q.onPanEnded(),i.fi({kind:"endPan",event:M})),delete i._tx,delete i._ty,i.clearDragging()},handle_mousemove:function(x){var B=this,J=B.gv;B._hoverTimer&&(wc(B._hoverTimer),delete B._hoverTimer),B._hoverTimer=Jo(function(){B.fi({kind:"hover",event:x}),wc(B._hoverTimer),delete B._hoverTimer},J.getHoverDelay()||F.hoverDelay)},handle_mouseleave:function(){var p=this;p._hoverTimer&&(wc(p._hoverTimer),delete p._hoverTimer)},handleWindowMouseMove:function(v){var t=this,d=t.gv;t.fi({kind:d._panning?"betweenPan":"beginPan",event:v}),d._panning=1;var x=Gq(d,v,t._lastClientPoint);d.setTranslate(t._tx+x.x,t._ty+x.y)},handle_mousewheel:function(E){this.gv.handleScroll(E,E.wheelDelta)},handle_DOMMouseScroll:function(l){2===l.axis&&this.gv.handleScroll(l,-l.detail)},handle_keydown:function(b){this.gv.handleKeyDown(b)}});var Ej=Nf.SelectInteractor=function(n){Iq(Ej,this,[n])};ol("SelectInteractor",ti,{_42:function(){var b=this,U=b.gv,j=U.getZoom(),x=b.mark,$=b.div;$||($=b.div=jg(),Em(b.getView(),$));var X={};X.x=x.x*j+U.tx(),X.y=x.y*j+U.ty(),X.width=x.width*j,X.height=x.height*j,Xd($,X),this.intersects()?($.style.border="",$.style.background=U.getRectSelectBackground()):($.style.background="",$.style.border="1px solid "+U.getRectSelectBorderColor())},handle_mousedown:function(E){var V=this,r=V.gv;if(V._57I=N,V.pendingClickThrough=N,!(r._editing||r._scrolling||En()||gd(E))){var X=r.getDataAt(E),f=r.sm();X?Og(E)?f.co(X)?f.rs(X):f.as(X):f.co(X)?X instanceof Jc&&X.isClickThroughEnabled()&&bs(E)&&(V.pendingClickThrough=oc(E)):f.ss(X):Og(E)||!r.isPannable()?bs(E)&&(Og(E)||f.cs(),r.isRectSelectable()&&(V.startDragging(E),r._77O=1)):bs(E)&&(V._57I=oc(E))}},handle_mouseup:function(r){var B=this,F=B.gv,o=B._57I;if(o&&(So(o,oc(r))<=1&&F.sm().cs(),B._57I=N),B.pendingClickThrough){if(So(B.pendingClickThrough,oc(r))<=1){var n=F.getDataAt(r);if(n instanceof Jc&&n.isClickThroughEnabled()){var G=F.getDataAt(r,function(h){var m=h.getParent()===n&&F.isSelectable(h,!0);return m});G&&(r.clickThrough=!0,F.sm().ss(G))}}B.pendingClickThrough=N}},handleWindowMouseUp:function(X){this.clear(X)},handleWindowMouseMove:function(e){var v=this,C=v.gv;v._logicalPoint=C.lp(e),v.mark?(v.fi({kind:"betweenRectSelect",event:e}),C.isPannable()&&v.autoScroll(e),v.redraw()):v.fi({kind:"beginRectSelect",event:e}),v.mark=Jf(v._lastLogicalPoint,v._logicalPoint),v.redraw()},intersects:function(){var k=this,o=k._lastLogicalPoint,H=k._logicalPoint;return o.x>H.x||o.y>H.y},clear:function(p){var k=this,q=k.gv,A=k.mark;if(k._57I=N,k.pendingClickThrough=N,k._lastLogicalPoint){if(A){if(0!==A.width&&0!==A.height){var n=q.getDatasInRect(A,k.intersects());if(!n.isEmpty()){var h=q.sm(),Y=h.toSelection(),R=oo(p),T=p.altKey;n.each(function(v){h.co(v)?(!R||R&&T)&&Y.remove(v):(!T||R&&T)&&Y.add(v)}),h.ss(Y)}}Yf(k.div),delete k.div,delete k.mark,k.redraw(),k.fi({kind:"endRectSelect",event:p}),q.onRectSelectEnded()}k.clearDragging(),delete q._77O}},redraw:function(){var W=this;W._draw||(W._draw=1,Jo(function(){W.mark&&W._42(),delete W._draw},16))}});var Mc=Nf.MoveInteractor=function(I){Iq(Mc,this,[I])};ol("MoveInteractor",ti,{handle_mousedown:function(m){var q=this,n=q.gv;if(bs(m)&&!n._editing&&!n._scrolling&&!En()){var V=n.getSelectedDataAt(m);!V||n._39Q(V)&&!n.isMovable(V)?n._focusData=N:(q._data=V,n.handleMouseDown&&n.handleMouseDown(m,V),q.startDragging(m),n.isMovable(V)&&(n._moving=1))}},handleWindowMouseUp:function(g){var f=this,I=f.gv;I.handleMouseUp&&I.handleMouseUp(g,f._data),f.clear(g)},handleWindowMouseMove:function(R){var y=this,A=y._data,P=y.gv;if((!P._93O||!P._93O(R,A))&&P._moving){y._logicalPoint||y.fi({kind:"prepareMove",event:R});var E=y._logicalPoint?"betweenMove":"beginMove",O={kind:E,event:R},m=y._logicalPoint=P.lp(R);"beginMove"!==E||y._alreadyBeginTransaction||(y._alreadyBeginTransaction=!0,P.getDataModel().beginTransaction());var F=y._calcShift(E,R),l=F.x,t=F.y,M=y.gv.getMoveMode(R,A);M&&("x"===M?t=0:"y"===M?l=0:"xy"!==M&&(l=t=0)),P.moveSelection(l,t),y._lastLogicalPoint=m,y.autoScroll(R),y.fi(O)}},_calcShift:function(){var C=this,H=C._logicalPoint,r=C._lastLogicalPoint,z=H.x-r.x,p=H.y-r.y;return{x:z,y:p}},clear:function(a){var H=this,O=H.gv;H._lastLogicalPoint&&(H._lastLogicalPoint=H._data=O._moving=N,H._logicalPoint&&(H.fi({kind:"endMove",event:a}),O.onMoveEnded()),H.clearDragging()),H._alreadyBeginTransaction&&(H._alreadyBeginTransaction=!1,O.getDataModel().endTransaction())}});var eb=Nf.TextEditInteractor=function(s){Iq(eb,this,[s]),this.init()};ol("TextEditInteractor",ti,{setUp:function(){var k=this;eb.superClass.setUp.call(k),k.gv.mp(k.handleGvPropertyChange,k)},teatDown:function(){var t=this;eb.superClass.teatDown.call(t),t.gv.ump(t.handleGvPropertyChange,t)},handleGvPropertyChange:function(){this._editTarget&&this.endTextEdit()},init:function(){var U=this,z=this.input=H.createElement("input"),W=z.style;z.text="text",W.border="1px solid #d8d8d8",W.position="absolute",W.padding="2px 3px",W.outline="none",W.marginLeft="-90px",W.marginTop="-16px",W.backgroundColor="rgba(255,255,255, 1)",W.fontSize="14px",W.width="180px",W.height="32px",W.boxShadow="0 0 13px rgba(16,142,233, 0.5)",W.textAlign="center",W.boxSizing="border-box",q(z,"keyup",function(F){return Uc(F)&&U.endTextEdit(),zi(F)?(U.endTextEdit(!0),void 0):void 0}),q(z,"focus",function(){z.select()});var S=this.textarea=H.createElement("textarea"),J=this.wrap=H.createElement("div");J.appendChild(S),W=S.style,W.margin=0,W.padding="4px",W.overflow="hidden",W.boxSizing="border-box",W.position="absolute",W.outline="none",W.backgroundColor="transparent",W.resize="none",W.textAlign="center",W.fontSize="14px",W.borderWidth=0,W.width="100%",W=J.style,W.boxSizing="border-box",W.margin=0,W.padding=0,W.position="absolute",W.boxShadow="0 0 13px rgba(16,142,233, 0.5)",W.border="1px solid #d8d8d8",W.backgroundColor="rgba(255,255,255, 1)",W.zIndex="10",q(S,"keydown",function(h){return(oo()||Og())&&Uc(h)?(U.endTextEdit(),void 0):zi(h)?(U.endTextEdit(!0),void 0):(U._editTarget instanceof nn||U.calculateTextareaHeight(String.fromCharCode(h.keyCode)),void 0)}),q(S,"focus",function(){S.select()});var j=function(K){K.stopPropagation()};q(z,"mousedown",j),q(z,"touchstart",j),q(S,"mousedown",j),q(S,"touchstart",j),q(S,"click",j),U.SIZING_STYLE=["letter-spacing","line-height","padding-top","padding-bottom","font-family","font-weight","font-size","text-rendering","text-transform","width","text-indent","padding-left","padding-right","border-width","box-sizing"],U.HIDDEN_TEXTAREA_STYLE="visibility:hidden; min-height:0 !important;max-height:none !important;height:0 !important;visibility:hidden !important;overflow:hidden !important;position:absolute !important;z-index:-1000 !important;top:0 !important;right:0 !important",U.handleWindowClick=function(C){var Q=U._editingDOM;if(Q){var V=Q.getBoundingClientRect(),A=oc(C);zo(V,A)||U.endTextEdit()}}},handle_mousedown:function(y){var z=this,D=z.gv;if(Jd(y)&&!D._editing){var M=D.getDataAt(y);if(M){var Q=D.getTextEditInfo(M);Q&&(this._editInfo=Q,this._editTarget=M,D._editing=!0,Q.isMultiline?this.handleMultilineEdit():this.handleTextEdit())}}},handleMultilineEdit:function(){var K=this,h=K.gv,n=K._editTarget,z=K.getTargetValue(),m=K.textarea,Q=K.wrap,O=this._editInfo;this.hiddenTextarea||this.createHiddenTextarea(),(null===z||z===I)&&(z=""),m.value=z,O.font&&(m.style.font=O.font),K._editingDOM=m,h.appendHTML(Q),this.layoutHTML(Q,n),n instanceof nn?m.style.height="100%":(m.style.height="auto",this.calculateTextareaHeight()),Jo(function(){m.focus(),q(w,"mousedown",K.handleWindowClick),q(w,"touchstart",K.handleWindowClick)},10)},handleTextEdit:function(){var C=this,g=C.gv,M=C._editTarget,V=C.getTargetValue(),J=C.input;(null===V||V===I)&&(V=""),J.value=V,C._editingDOM=J,g.getView().appendChild(J),this.layoutHTML(J,M),Jo(function(){J.focus(),q(w,"mousedown",C.handleWindowClick),q(w,"touchstart",C.handleWindowClick)},10)},layoutHTML:function(S,D){var X=this.gv,K=X.getZoom();if(D instanceof nn){var l=X.getDataUI(D),V=l._6I,Y=D.getScale(),s=S.style;S.style.left=V.x*K+X.tx()+"px",S.style.top=V.y*K+X.ty()+"px",S.style.width=l._6I.width+"px",S.style.height=l._6I.height+"px",pp(s,"transform","scale("+K*Y.x+","+K*Y.y+")"),pp(s,"transformOrigin","0px 0px")}else if(D instanceof Oh){var V=D.getRect(),f=V.width*K;S.style.left=(V.x+V.width/2)*K+X.tx()+"px",S.style.top=(V.y+V.height/2)*K+X.ty()+"px",S.style.width=f+"px",S.style.marginLeft=-f/2+"px"}else if(D instanceof y.Edge){var l=X.getDataUI(D),V=l._6I;S.style.left=(V.x+V.width/2)*K+X.tx()+"px",S.style.top=(V.y+V.height/2)*K+X.ty()+"px"}},endTextEdit:function(E){var K=this,A=K._editInfo.isMultiline?K.wrap:K.input,h=K._editInfo.isMultiline?K.textarea:K.input;E||K.setTargetValue(h.value),K.gv.getView().removeChild(A),K.gv._editing=!1,delete K._editingDOM,delete K._editTarget,V(w,"mousedown",K.handleWindowClick),V(w,"touchstart",K.handleWindowClick)},setTargetValue:function(i){var F=this,u=F._editTarget,W=F._editInfo,s=W.accessType,A=W.name;if(A&&s||(s="p",A="name"),"p"===s){var q=y.Default.setter(A);u[q](i)}else"a"===s?u.a(A,i):u.s(A,i)},getTargetValue:function(){var d=this,m=d._editTarget,h=d._editInfo,u=h.accessType,K=h.name;if(K&&u||(u="p",K="name"),"p"===u){var Q=y.Default.getter(K);return m[Q]()}return"a"===u?m.a(K):m.s(K)},createHiddenTextarea:function(){this.hiddenTextarea=H.createElement("textarea"),this.hiddenTextarea.setAttribute("style","margin:0; padding:0; position:absolute; overflowY:scroll; resize:none; box-sizing:border-box;pointer-events: none;opacity:0;"),this.hiddenTextarea.setAttribute("rows","1"),this.gv.getView().appendChild(this.hiddenTextarea)},calculateHTMLStyle:function(x,Y){if(Y&&this.computedStyleCache)return this.computedStyleCache;var v=this,e=w.getComputedStyle(x),u=e.getPropertyValue("box-sizing")||e.getPropertyValue("-moz-box-sizing")||e.getPropertyValue("-webkit-box-sizing"),f=parseFloat(e.getPropertyValue("padding-bottom"))+parseFloat(e.getPropertyValue("padding-top")),q=parseFloat(e.getPropertyValue("border-bottom-width"))+parseFloat(e.getPropertyValue("border-top-width")),n=v.SIZING_STYLE.map(function(S){return S+":"+e.getPropertyValue(S)}).join(";"),C={sizingStyle:n,paddingSize:f,borderSize:q,boxSizing:u};return Y&&(this.computedStyleCache=C),C},calculateTextareaHeight:function(T){T=T||"";var F=this,b=F.textarea,D=F.hiddenTextarea,u=F.wrap,s=32,l=F.calculateHTMLStyle(b,!1),h=l.paddingSize,L=l.borderSize,p=l.boxSizing,g=l.sizingStyle;D.setAttribute("style",g+";"+F.HIDDEN_TEXTAREA_STYLE),D.value=b.value+T;var E=D.scrollHeight;"border-box"===p?E+=L:"content-box"===p&&(E-=h),b.style.height=E+"px",u.style.height=Math.max(E,s)+"px",u.style.marginTop=E*-.5+"px"}});var Ce=Nf.ScrollBarInteractor=function($){Iq(Ce,this,[$])};ol("ScrollBarInteractor",ti,{_41o:function(){return this.gv.getViewRect().height<this.gv.getScrollRect().height},_40o:function(){return this.gv.getViewRect().width<this.gv.getScrollRect().width},isV:function(g){var s=this.gv.getViewRect();return this._41o()&&(s.x+s.width-this.gv.lp(g).x)*this.gv.getZoom()<Yb},isH:function(O){var k=this.gv.getViewRect();return this._40o()&&(k.y+k.height-this.gv.lp(O).y)*this.gv.getZoom()<Yb},handle_mousemove:function(V){this.handle_touchmove(V)},handle_touchmove:function(Q){if(!br&&bs(Q)&&this.gv.isScrollBarVisible()){var H=this,h=H.isV(Q),V=H.isH(Q);(h||V)&&H.gv.showScrollBar(),H.gv._scrolling=h||V}},handleWindowMouseUp:function(A){this.handleWindowTouchEnd(A)},handleWindowTouchEnd:function(c){this._state=this._cp=this._tx=this._ty=this.gv._scrolling=N,this.fi({kind:"endScroll",event:c})},handle_mousedown:function(w){this.handle_touchstart(w)},handle_touchstart:function(F){var M=this;if(M.gv.setFocus(F),vr(F),M.handle_touchmove(F),!(hm(F)>1)&&M.gv._scrolling&&M.gv.isScrollBarVisible()){M._cp=oc(F),M._tx=M.gv.tx(),M._ty=M.gv.ty();var l=M.isV(F);M._state=l?"vScroll":"hScroll",Gp(M,F),M.fi({kind:"beginScroll",event:F})}},handleWindowMouseMove:function(z){this.handleWindowTouchMove(z)},handleWindowTouchMove:function(C){var A=oc(C),y=this.gv.getViewRect(),x=this.gv.getScrollRect();"vScroll"===this._state?this.gv.ty(this._ty+(this._cp.y-A.y)*x.height/y.height):"hScroll"===this._state&&this.gv.tx(this._tx+(this._cp.x-A.x)*x.width/y.width),this.fi({kind:"betweenScroll",event:C})}});var Qe=Nf.TouchInteractor=function(C,g){g=g||{},g.selectable===I&&(g.selectable=!0),g.movable===I&&(g.movable=!0),g.pannable===I&&(g.pannable=!0),g.pinchable===I&&(g.pinchable=!0),g.editable===I&&(g.editable=!0),this.params=g,Iq(Qe,this,[C])};ol("TouchInteractor",ti,{ms_edit:1,setUp:function(){var n=this;Qe.superClass.setUp.call(n),Hi&&n.params.editable&&n.gv.setEditInteractor(n)},tearDown:function(){var w=this;Qe.superClass.tearDown.call(w),Hi&&w.params.editable&&w.gv.setEditInteractor(N)},clear:function(r){var H=this,f=H.gv;f._moving&&(H.fi({kind:"endMove",event:r}),delete f._moving,f.onMoveEnded(),f.dm().endTransaction()),f._panning&&(H.fi({kind:"endPan",event:r}),delete f._panning,f.onPanEnded()),f._pinching&&(H.fi({kind:"endPinch",event:r}),delete f._pinching,f.onPinchEnded()),f._editing&&(H._46O(r),H._77I=H._node=H._edge=H._shape=H._rect=H._89I=H._index=f._editing=N),H.pendingClickThrough=H._moving=H._panning=H._pinching=H._editing=H._57I=H._data=H._beginHistory=N,H.clearDragging()},handle_touchstart:function(K){var I=this;if(!I.gv._editing){vr(K),I._57I=N,I.pendingClickThrough=N;var x=I.params,b=I.gv,X=b.sm(),O=b.getDataAt(K),C=hm(K);if(1===C){if(Jd(K))return b.handleDoubleClick(K,O),void 0;b.handleClick(K,O),O&&(b.handleMouseDown&&b.handleMouseDown(K,O),I._data=O),x.selectable||(O=N),O&&(X.co(O)?O instanceof Jc&&O.isClickThroughEnabled()&&(I.pendingClickThrough=oc(K)):X.ss(O),x.editable&&b.isEditable(O)&&I._79I(K,O,!0)?(I._editing=1,I.startDragging(K)):x.movable&&b.isMovable(O)&&(I._moving=1,I.startDragging(K))),O&&(b.isMovable(O)||b._39Q(O))||(I._57I=oc(K),x.pannable&&b.isPannable()&&(I._panning=1,I.startDragging(K),I._translate={x:b.tx(),y:b.ty()}))}else if(x.pinchable&&2===C){if(!b.getEditInteractor()&&O){var y=Fp(b.getImage(O));if(y&&Aq(y.scrollable,O,this))return}I._pinching=1,I.startDragging(K);var P=b.getView(),l=b.getZoom(),z=P.getBoundingClientRect(),Y=K.touches[0],H=K.touches[1],p={x:(Y.clientX+H.clientX)/2-z.left,y:(Y.clientY+H.clientY)/2-z.top};p.x-=b.tx(),p.y-=b.ty(),p.x/=l,p.y/=l,I._p=p,I._d=sl(K)}}},handle_touchend:function(I){var x=this,k=x.gv,V=x._57I,B=x._data;if(V&&(So(V,oc(I))<=1&&!k.getDataAt(I)&&k.sm().cs(),x._57I=N),B&&k.handleMouseUp&&k.handleMouseUp(I,B),x.pendingClickThrough){if(So(x.pendingClickThrough,oc(I))<=1){var B=k.getDataAt(I);if(B instanceof Jc&&B.isClickThroughEnabled()){var r=k.getDataAt(I,function(j){var W=j.getParent()===B&&k.isSelectable(j,!0);return W});r&&(I.clickThrough=!0,k.sm().ss(r))}}x.pendingClickThrough=N}},handleWindowTouchEnd:function(O){this.clear(O)},handleWindowTouchMove:function(g){var d=this,n=d.gv,W=hm(g);if(1===W){var Y=oc(g),b=Gq(n,Y,d._lastClientPoint),e=So({x:0,y:0},b);if(d._editing&&(d._beginHistory||(d._beginHistory=1,n.dm().beginTransaction()),n._editing=1,d._78I(g)),d._moving){if(!n._moving&&e<F.touchMoveThreshold)return;d._beginHistory||(d._beginHistory=1,n.dm().beginTransaction()),d.handleMove(g)}else if(d._panning){if(!n._panning&&e<F.touchMoveThreshold)return;n.setTranslate(d._translate.x+b.x,d._translate.y+b.y),d.fi({kind:n._panning?"betweenPan":"beginPan",event:g}),n._panning=1}}else if(2===W&&d._pinching){var X=sl(g);n.handlePinch(d._p,X,d._d),d._d=X,d.fi({kind:n._pinching?"betweenPinch":"beginPinch",event:g}),n._pinching=1}},handleMove:function(y){var z=this,A=z.gv,S=A.lp(y);A._93O&&A._93O(y,z._data)||(A.moveSelection(S.x-z._lastLogicalPoint.x,S.y-z._lastLogicalPoint.y),z._lastLogicalPoint=S,z.autoScroll(y),z.fi({kind:A._moving?"betweenMove":"beginMove",event:y}),A._moving=1)}});var y=w.ht,In=y.graph._editor={Math:y.Math,Guide:{}};In.getStyle=function(Q){var e,t=In.StyleMap;return t&&(e=t[Q],e!==I)?e:In.DefaultStyleMap[Q]},In.setStyle=function(C,v){var _=In.StyleMap;_||(_=In.StyleMap={}),_[C]=v},In.inEdit=function(Y){return Y._inXEdit===!0},In.startEdit=function(I){I._inXEdit=!0,In.Inject.doInject(I)},In._46O=function(a){a._inXEdit=!1,In.Inject.undoInject(a)},In.toScreenPosition=function(f,e){var n=f.tx(),p=f.ty(),S=f._zoom;return new In.Math.Vector2(e.x*S+n,e.y*S+p)},In.checkHit=function(p,S,E){return p.distanceTo(S)<E?!0:!1},In.toWorldPosition=function(C,O){var G=C.tx(),P=C.ty(),T=C._zoom;return{x:(O.x-G)/T,y:(O.y-P)/T}},In.setAntialias=function(A,i){for(var p,O=["imageSmoothingEnabled","webkitImageSmoothingEnabled","mozImageSmoothingEnabled","oImageSmoothingEnabled","msImageSmoothingEnabled"],U=0,R=O.length;R>U&&(p=O[U],!(p in A));U++);A[p],A[p]=i},In.getTargetCornersOnScreen=function(v,W){if(!W)return null;var Y,p=[];if(hf(W,v)){var n=Wg(v,W);Y=[{x:n.x,y:n.y},{x:n.x+n.width,y:n.y},{x:n.x+n.width,y:n.y+n.height},{x:n.x,y:n.y+n.height}]}else{if(!W.getCorners)return null;Y=W.getCorners()}return Y.forEach(function(X){var K=In.toScreenPosition(v,X);p.push(K.x,K.y)}),p},In.log=function(){};var Nb;In.updateTipInfo=function(m,j,v){if(v){var O=y.Default.getLogicalPoint(m,j._canvas);O.x+=In.Icons.TipShiftX,O.y+=In.Icons.TipShiftY,Nb={helperPos:O,text:v,size:v.length}}else Nb=N},In.drawTip=function(M,$){Nb&&In.Icons.DrawIcon($,M,In.Icons.TipHelper,Nb)};var on=In.Inject={_modules:[]};on.registAsModule=function(R,k){var x={},E={};for(var v in R){var D=k.prototype[v];x[v]=D}R.getBackup=function(K){return x[K]},R.getBackups=function(){return x},E.doInject=function(){for(var r in R)"getBackup"!==r&&(k.prototype[r]=R[r])},E.undoInject=function(){for(var _ in R)"getBackup"!==_&&(k.prototype[_]=x[_])},on._modules.push(E)},on.doInject=function(C){for(var O,e=on._modules,H=0,P=e.length;P>H;H++)O=e[H],O.doInject(C)},on.undoInject=function(w){for(var h,b=on._modules,n=0,g=b.length;g>n;n++)h=b[n],h.undoInject(w)};var ti=y.graph.EditInteractor=function(w){var z=this,l=H.createElement("canvas");l.className="editCanvas",l.style.position="absolute",z._uuid=y.Math.generateUUID(),z._styleMap={},z._canvas=l,z._context=l.getContext("2d"),ti.superClass.constructor.call(z,w),this._editDetail=!1,In.setAntialias(z._context,!1),z._subModules=z.initSubModule(),z._gridGuide=new In.Guide.Grid(z),z._rectGuide=new In.Guide.Rect(z),z._hoverGuide=new In.Guide.Hover(z)},Ae=ti;y.Default.def(ti,y.graph.Interactor,{ms_edit:1,ms_fire:1}),C.defineProperties(ti.prototype,{editDetail:{get:function(){var P=!!this._editDetail;return P},set:function(U){var R=this,h=R._editDetail;h!==U&&(R._editDetail=U,R.gv._editing=U,R.fp("editDetail",h,U),R.fp("pointsEditingMode",h,U),R.fi({kind:U?"beginEditPoints":"endEditPoints"}))}},gvEditing:{get:function(){return this.gv._editing},set:function(D){(!this._editDetail||D)&&(this.gv._editing=D,D||(this.editDetail=!1))}},editing:{get:function(){return this._editing},set:function(M){this._editing=M,this.gvEditing=M}},editingModule:{get:function(){return this._editMod}},pointsEditingMode:{get:function(){return this.editDetail},set:function(J){var V=this;V.editDetail!==J&&(J?V._tryEnterEditDetailMode():V._tryQuitEditDetailMode())}},gridEnabled:{get:function(){var G=this._gridEnabled;if(!G)return!1;var Z=this.gv;return Z?!0:!0},set:function(y){y!==this._gridEnabled&&(this._gridEnabled=y,this._42())}},alignmentGuideEnabled:{get:function(){return this._agEnabled},set:function(g){g!==this._agEnabled&&(this._agEnabled=g,this._42())}},gridGuide:{get:function(){return this._gridGuide}},rectGuide:{get:function(){return this._rectGuide}},hoverGuide:{get:function(){return this._hoverGuide}}}),ti.prototype.initSubModule=function(){var V=this;return[new In.Anchor(V),new In.RotateX(V),new In.MoveDummy(V),new In.Rect(V),new In.Curve(V),new In.MoveHelper(V)]},ti.prototype.getSubModule=function(U){var i,W,K,P=this._subModules;for(W=0,K=P.length;K>W;W++)if(i=P[W],i.catalog===U)return i},ti.prototype.invokeSubModule=function(e,X){for(var H,n,R,t=this,h=t._subModules,f=Array.prototype.slice.call(arguments,2),c=0,C=h.length;C>c;c++)if(H=h[c],n=H[e],n&&(R=n.apply(H,f),R!=I&&X))return H},ti.prototype.invokeSubModuleInverse=function(e,E){var O=this,y=O._subModules;if(y)for(var Y,x,p,X=Array.prototype.slice.call(arguments,2),D=y.length-1;D>=0;D--)if(Y=y[D],x=Y[e],x&&(p=x.apply(Y,X),p!=I&&E))return Y},ti.prototype.setUp=function(){In.log("setUp");var S=this,w=S.gv,y=w.getView(),R=S._canvas;ti.superClass.setUp.call(S),w.setEditInteractor(S),w._79O?y.insertBefore(R,w._79O):y.appendChild(R),In.startEdit(w),S.invokeSubModule("setUp"),w.dm().mm(S._onDataModelChanged,S),w.dm().md(S._onDataPropertyChanged,S)},ti.prototype.tearDown=function(){In.log("tearDown");var M=this,S=M.gv,c=S.getView();M._resetCustomCursorStyle(),ti.superClass.tearDown.call(M),S.dm().umm(M._onDataModelChanged,M),S.dm().umd(M._onDataPropertyChanged,M),S.setEditInteractor(null),c.removeChild(M._canvas),M._drawTimer&&(wc(M._drawTimer),M._drawTimer=null),In._46O(S),M.invokeSubModule("tearDown")},ti.prototype._onDataModelChanged=function(p){var z=this;("clear"===p.kind||"remove"===p.kind&&z.editDetail&&p.data===z.getSubModule("Curve").target)&&(z.editDetail=!1,z._42())},ti.prototype._onDataPropertyChanged=function(A){var G=this;if(G.editDetail){var Z=G.getSubModule("Curve"),i=A.data;i===Z.target&&(i._writing||Z._handleDataChanged(A))}},ti.prototype.clear=function(){In.log("clear")},ti.prototype.redraw=function(){this._42()},ti.prototype._42=function(){var A=this;A._drawTimer||(A._drawTimer=Jo(function(){A._drawTimer=null,A.drawImpl()},0))},ti.prototype.drawImpl=function(){var n;for(n in{_42:!0})break;return function(){var B=this,_=B._canvas,c=B.gv,Y=c.getWidth(),p=c.getHeight(),e=B._context,D=y.Default.getInternal(),f=F.devicePixelRatio;(_.width!==Y||_.height!==p)&&D.setCanvas(_,Y,p,f),e.clearRect(0,0,_.width,_.height);var H=B._getValidSelection();e.save(),e.scale(f,f),B._gridGuide._42(),B.invokeSubModuleInverse(n,!1,e,c,H),B._rectGuide._42(),B._hoverGuide._42(),e.restore()}}(),ti.prototype._getValidSelection=function(){var v=this,b=v.gv,z=b.sm().getSelection(),q=[];return z.each(function(E){b.isVisible(E)&&b.isEditable(E)&&q.push(E)}),q},ti.prototype.handle_touchmove=function(Q){return this.handle_mousemove(Q)},ti.prototype.handle_mousemove=function(e){if(!y.Default.isDragging()){var A=this;if((A.editDetail||!En()&&!gd(e))&&!A.gv._externalEditing){if(A.gvEditing=!1,A._checkEdit(e))A.gvEditing=!0;else{if(!A.getStyle("hoverGuideVisible"))return;A.hoverData=A.gv.getDataAt(e)}A._42()}}},ti.prototype.handle_touchstart=function(u){return this.handle_mousedown(u)},ti.prototype.handle_mousedown=function(U){vr(U);var a=this;if((a.editDetail||!En()&&!gd(U))&&!a.gv._externalEditing){if(Jd(U)&&!U.clickThrough){if(a.editDetail){if(a._tryQuitEditDetailMode(U))return}else if(a._tryEnterEditDetailMode())return;a.gv.dm().beginTransaction();var B=a.invokeSubModule("handleDoubleClick",!0,U);if(a.gv.dm().endTransaction(),B)return}var D=a._checkEdit(U);D&&(a._downPosition=a._getLogicalPoint(U),a.gv.dm().beginTransaction(),D.startEdit(a,U),a.editing=!0)}},ti.prototype._checkEdit=function(L){var c=this,i=c.gv,O=c._getLogicalPoint(L),Z=c.invokeSubModule("check",!0,i,L,O)||null;return c._editMod=Z,Z},ti.prototype.handleWindowTouchMove=function(b){return this.handleWindowMouseMove(b)},ti.prototype.handleWindowMouseMove=function(o){var K=this,O=K._downPosition;if(O){var G=K._getLogicalPoint(o);if(G.distanceTo(O)<K.getStyle("moveSensitivity"))return;delete K._downPosition}var n=K._editMod;
n&&n.handleEdit(K.gv,o),K.redraw()},ti.prototype._getLogicalPoint=function(O){var j=this,F=y.Default.getLogicalPoint(O,j._canvas);return new In.Math.Vector2(F)},ti.prototype.handleWindowTouchEnd=function(Z){return this.handleWindowMouseUp(Z)},ti.prototype.handleWindowMouseUp=function(){var i;for(i in{_46O:!0})break;return function(m){var X=this;X.editing=!1,X.setCursor("default"),X.invokeSubModule(i,!1,m),X._42(),X.gv.dm().endTransaction()}}(),ti.prototype.handle_mousewheel=function(A){var c=this;vr(A),c.invokeSubModule("preHandleScroll",!0)||c.gv.handleScroll(A,A.wheelDelta)},ti.prototype.handleDelete=function(){var J=this;if(!J.editDetail){J.gv.dm().beginTransaction();var z=J.invokeSubModule("handleNormalStateDelete",!0);return J.gv.dm().endTransaction(),z||J.gv.removeSelection(),void 0}J.gv.dm().beginTransaction(),J.invokeSubModule("handleDelete",!0),J.gv.dm().endTransaction(),J._42()},ti.prototype.handle_keydown=function(W){var v=this;if((W.metaKey||W.ctrlKey)&&v._42(),En(W)&&!v.editing)return v.gvEditing=!1,v.setCursor("default"),v._42(),void 0;var h=Uc(W);return v.editDetail?((h||zi(W))&&(v.editDetail=!1,v._42()),v.gv.dm().beginTransaction(),v.invokeSubModule("handle_keydown",!0,W),v.gv.dm().endTransaction(),void 0):(v.gv.dm().beginTransaction(),v.invokeSubModule("handleNormalStateKeyDown",!0,W),v.gv.dm().endTransaction(),h&&v._tryEnterEditDetailMode(),void 0)},ti.prototype.handle_keyup=function(w){this.gv.dm().beginTransaction(),this.invokeSubModule("handle_keyup",!0,w),this.gv.dm().endTransaction()},ti.prototype._tryEnterEditDetailMode=function(){var $=this;return!$.editDetail&&$.invokeSubModule("canEnterEditDetailMode",!0)&&1===$._getValidSelection().length?($.editDetail=!0,$._42(),!0):void 0},ti.prototype._tryQuitEditDetailMode=function(W){var _=this;return _.editDetail?!W||_.invokeSubModule("canQuitEditDetailMode",!0,W)?(_.editDetail=!1,_._42(),!0):!1:!1},ti.prototype.setStyle=function(A,U,F){var d=this;F?In.setStyle(A,U):d._styleMap[A]=U,"baseColor"===A&&(er=U),d.fp("styleChanged",null,{key:A,value:U,base:F}),d._42()},ti.prototype.getStyle=function($){var m=this,w=m._styleMap[$];return w!==I?w:In.getStyle($)},ti.prototype.setCursor=function(J){this._resetCustomCursorStyle(),y.graph.EditInteractor.superClass.setCursor.call(this,J)},ti.prototype._drawHostGuide=function(I){var T=this,j=T._context,H=T.gv;In.Icons.DrawIcon(T,j,In.Icons.NodeHoverGuide,I.corners);var W=I.host;if(W){var Y=H.getAttachPoints(W);if(Y&&Y.length)for(var $=0,_=Y.length;_>$;$++){var b=Y[$],p=Hn(H,W,0,b.offsetX||0,b.offsetY||0,b.x,b.y);p=In.toScreenPosition(H,p),p.isAttach=I.attach===$,In.Icons.DrawIcon(T,j,In.Icons.AttachPoint,p)}}},ti.prototype._resetCustomCursorStyle=function(){var D=this;if(D._customStyle){var P=this.gv.getView();P.classList&&P.classList.remove&&P.classList.remove(D._customStyle),D._customStyle=null}},ti.prototype._setRotateCursor=function(E){var f=this,W=f._cursorFactory;W||(W=f._cursorFactory=new In.CursorFactory(f));var C=W.getRotateCursor(E),U=f.gv.getView();f._resetCustomCursorStyle(),f._customStyle=C,U.classList&&U.classList.add&&U.classList.add(C)};var fd=In.Group=function(j){var Q=this;Q._entities=j,Q._64O=0,Q._position={x:0,y:0},Q._scale={x:1,y:1},Q._anchor={x:.5,y:.5},Q._anchor2={x:.5,y:.5}};fd.prototype={},fd.prototype.constructor=fd;var Ul=null,li=null;fd.findOrCreateGroup=function(U,m){if(li===m&&Ul&&Ul.checkIsMe(U))return Ul;li=m;var c=new In.Group(U);return c.getKeyOb()?(Ul=c,c):void 0},fd.prototype.checkIsMe=function(M){var U=this._entities;if(U.length!==M.length)return!1;var $,L={},X=M.length;for($=0;X>$;$++)L[M[$]._id]=!0;for($=0;X>$;$++)if(!L[U[$]._id])return!1;return!0},fd.prototype.getRotation=function(){return this._64O},fd.prototype.getPosition=function(){return this._position},fd.prototype.getAnchor=function(){return this._anchor},fd.prototype.getWidth=function(){return this._width},fd.prototype.getScale=function(){return this._scale},fd.prototype.getSize=function(){return{width:this._width,height:this._height}},fd.prototype.getHeight=function(){return this._height},fd.prototype.getKeyOb=function(){for(var d=this._entities,R=d.length-1;R>=0;R--){var y=d[R];if(this.isNode(y))return y}},fd.prototype.getAnchor2=function(){var p=this,W=p.rotateCenter;if(W)return W;var N=p.getKeyOb();if(!N)return p._anchor;var h=p._anchor2,$=N.getMatrix();return $.tf({x:N.getWidth()*(h.x-N.getAnchor().x),y:N.getHeight()*(h.y-N.getAnchor().y)})},fd.prototype.setAnchor2=function(Z,x){var H=this,I=H.getKeyOb();if(I){var T,A=I.getMatrix();T="number"==typeof Z?{x:Z,y:x}:Z;var u=A.tfi(T);H._anchor2={x:I.getAnchor().x+u.x/I.getWidth(),y:I.getAnchor().y+u.y/I.getHeight()}}},fd.prototype.setRotation=function(){},fd.prototype.beginRotate=function(o){this.rotateCenter=o.pos,this.rotateMode=o.groupRotateMode},fd.prototype.endRotate=function(){delete this.rotateCenter,delete this.rotateMode},fd.prototype.addRotation=function(W,k,t){return"batch"===k?this._addRotationInBatchMode(W,t):"block"===k?this._addRotationInBlockMode(W,t):void 0},fd.prototype._addRotationInBlockMode=function(e,R){var q=this,y=q.rotateCenter||q.getPosition();q._entities.forEach(function(d){if(q.isNode(d)&&(!R||R(d))){var H=d.getMatrix();H.translate(-y.x,-y.y),H.rotate(e),H.translate(y.x,y.y);var Y=Math.sign(d.getScale().x);d.setRotation(ge(H.b*Y,H.a*Y)),d.setPosition(H.tx,H.ty)}})},fd.prototype._addRotationInBatchMode=function(i,F){var y=this,L=y._anchor2;y._entities.forEach(function(s){if(y.isNode(s)&&(!F||F(s))){var k=s.getAnchor(),_=s.getMatrix(),c=_.tf({x:s.getWidth()*(L.x-k.x),y:s.getHeight()*(L.y-k.y)}),X=new In.Math.Matrix2d;X.set(_.a,_.b,_.c,_.d,_.tx,_.ty),X.translate(-c.x,-c.y),X.rotate(i),X.translate(c.x,c.y);var d=Math.sign(s.getScale().x);s.setRotation(ge(X.b*d,X.a*d)),s.setPosition(X.tx,X.ty)}})},fd.prototype.setPosition=function(E){var s,j,u,A,T=this,L=T._position,h=E.x-L.x,Y=E.y-L.y,i=T._entities;for(j=0,u=i.length;u>j;j++)s=i[j],cl(s)&&(A=s.getPosition(),s.setPosition(A.x+h,A.y+Y));T._position=E},fd.prototype.setScale=function(i,U){var u=this,s=i/u._scale.x,D=U/u._scale.y;u._adjustChildScaleOrSize(s,D,"size"),u._scale={x:i,y:U}},fd.prototype.getRect=function(){var O=this,t=O._position,A=O._width,i=O._height;return{x:t.x-A/2,y:t.y-i/2,width:A,height:i}},fd.prototype.setSize=function(i,Y){var b=this,i=Math.max(1,i),Y=Math.max(1,Y),$=i/b._width,j=Y/b._height;b._adjustChildScaleOrSize($,j,"size"),b._width=i,b._height=Y},fd.prototype._adjustChildScaleOrSize=function(t,y,u){var D,$,V,_,e,O,m,c,E,r,U,S,P,n,q=this,w=q._position,x=q._entities,i=new In.Math.Matrix2d;for($=0,V=x.length;V>$;$++)if(D=x[$],q.isNode(D)){if(_=D.getPosition(),e=D.getRotation(),O=D.getWidth(),m=D.getHeight(),c=D.getScale(),U=c.x*O,S=c.y*m,i.identity().scale(U,S).rotate(e).translate(_.x,_.y).translate(-w.x,-w.y).rotate(-q._64O),e=ge(i.b*Math.sign(U),i.a*Math.sign(U)),i.scale(t,y),E=Math.cos(e),r=Math.sin(e),Math.abs(E)<.001?(P=i.b/r,n=-i.c/r):(P=i.a/E,n=i.d/E),"scale"===u)D.setScale(P/O,n/m);else if("size"===u){var R=P/c.x,k=n/c.y;D.setScale(hi(P)*Math.abs(c.x),hi(n)*Math.abs(c.y)),D.setSize(Math.max(.1,Math.abs(R)),Math.max(.1,Math.abs(k)))}i.rotate(q._64O).translate(w.x,w.y),D.setPosition(i.tx,i.ty)}},fd.prototype.getMatrix=function(){var v=this,n=v._position,D=y.Default.getInternal(),I=v._scale;return new D.Mat(v._64O,n.x,n.y,I.x,I.y)},fd.prototype.toGlobal=function(N){return this.getMatrix().tf(N)},fd.prototype.getCorners=function(){var S=this,H=S._width,r=S._height,P=S._anchor,Q=-H*P.x,q=-r*P.y,x=S.getMatrix();return[x.tf(Q,q),x.tf(Q,q+r),x.tf(Q+H,q+r),x.tf(Q+H,q)]},fd.prototype.calcInfo=function(){var e,U,s,d,E,L,i=this,Y=[],Z=i._entities,w=i._64O;for(d=0,E=Z.length;E>d;d++)L=Z[d],i.isNode(L)&&L.getCorners&&Y.push.apply(Y,L.getCorners());if(Y.length){var H=Math.cos(-w),v=Math.sin(-w),P=1/0,V=-1/0,o=1/0,R=-1/0;for(d=0,E=Y.length;E>d;d++)s=Y[d],e=s.x,U=s.y,s.x=H*e-v*U,s.y=v*e+H*U,P=Math.min(P,s.x),V=Math.max(V,s.x),o=Math.min(o,s.y),R=Math.max(R,s.y);i._width=(V-P)/i._scale.x,i._height=(R-o)/i._scale.y,H=Math.cos(w),v=Math.sin(w);var f=i._anchor;e=P+(V-P)*f.x,U=o+(R-o)*f.y,i._position={x:H*e-v*U,y:v*e+H*U}}},fd.prototype.isNode=function($){return cl($)?hf($)?$.size()?!1:!0:!0:!1},fd.prototype._42=function(v,Q,n){var q,s,k,a,E,S,t,m,P=this,o=P._entities,A=P.rotateMode;for("batch"===A&&(m=P.getKeyOb()),q=0,s=o.length;s>q;q++)k=o[q],P.isNode(k)&&(S=k.getRect(),a=In.toScreenPosition(n,{x:S.x,y:S.y}),E=In.toScreenPosition(n,{x:S.x+S.width,y:S.y+S.height}),t={min:a,max:E},k===m&&(t.isKeyOb=!0),In.Icons.DrawIcon(v,Q,In.Icons.GroupSubEntityRect,t))};var wd=In.CurveActiving=function(Y,$){this._curve=Y,this._interactor=Y._interactor,this.silent=!0;for(var J in $)this[J]=$[J];delete this.silent};wd.prototype={},wd.prototype.constructor=wd,C.defineProperties(wd.prototype,{point:{get:function(){return this._point},set:function(K){var f=this;f._point=K,f.editingCtrl||f.silent||f._firePointChange()}},pairs:{get:function(){return this._pairs},set:function(b){var d=this;d._pairs=b,d.editingCtrl&&!d.silent&&d._firePointChange()}}}),wd.prototype._firePointChange=function(){var N=this,T=N.getCurrentEditingPoint(),X=N._interactor;if(!T)return X.fi({kind:"selectPoint"}),void 0;var t=this._curve.target;if(t){var G=In.getDataMatrix(t).invert(),S=T.e;T=G.apply(In.toWorldPosition(X.gv,T)),T.e=S;var e=N._lastFirePoint;e&&Math.abs(T.x-e.x)<1e-5&&Math.abs(T.y-e.y)<1e-5&&(T.e==I&&e.e==I||Math.abs(T.e-e.e)<1e-5)||(N._lastFirePoint=T,X.fi({kind:"selectPoint",x:T.x,y:T.y,e:T.e}))}},wd.prototype.dispose=function(){this._interactor.fi({kind:"selectPoint"})},wd.prototype.getCurrentEditingPoint=function(){var C=this,e=C.editingCtrl;if(e){var z=C.pairs;if(z){var b=z[e.pairId];if(b){var L=b[e.type];if(L)return L}}}return C._point};var Sb=In.CursorFactory=function(j){var B=this;B._interactor=j,B._rotateCursorStyles={}};Sb.prototype={},Sb.prototype.constructor=Sb,Sb.prototype.getRotateCursor=function(j){var m=this;0>j&&(j+=2*Math.PI);var H=m._interactor,T=H.getStyle("rotateCursorSize"),k=H.getStyle("rotateCursorRound"),K=Math.round(180*(j/Math.PI)/k);K*k>=360&&(K=0);var J=m._rotateCursorStyles,M="htCustomRotateStyle_"+T+"_"+k+"_"+K;return J[M]||(m._produceRotateCursor(M,T,k,K),J[M]=!0),M},Sb.prototype._produceRotateCursor=function(l,I,U,n){var K=this;K._interactor;var k=K._canvas;k||(k=K._canvas=H.createElement("canvas"));var D=F.devicePixelRatio;k.width=k.height=I*D,k.style.width=k.style.height=I+" px";var m=k.getContext("2d");In.setAntialias(m,!1),m.scale(D,D);var s,W,R,S,o,f=Math.round(I/2),a=""+f+" "+f+",auto !important;",X=4;s=Math.PI/180*n*U,m.clearRect(0,0,I,I),m.save(),m.scale(I/32,I/32),m.translate(16,15),m.rotate(s+Math.PI/2),m.beginPath(),m.moveTo(-8,0),m.lineTo(-8,X),m.lineTo(-8+X,X),m.moveTo(8,0),m.lineTo(8,X),m.lineTo(8-X,X),m.moveTo(-8,X),m.quadraticCurveTo(0,-6,8,X),m.restore(),m.lineCap="round",m.lineJoin="miter",m.strokeStyle="white",m.lineWidth=4,m.stroke(),m.strokeStyle="black",m.lineWidth=2,m.stroke(),W=JSON.stringify(k.toDataURL()),S="cursor:url("+W+")"+a,1!==D&&(R='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="'+I+'px" height="'+I+'px"><image xlink:href='+W+' width="'+I+'" height="'+I+'"/></svg>',S+="cursor:url(data:image/svg+xml;base64,"+btoa(R)+")"+a,S+="cursor:-webkit-image-set(url("+W+")"+D+"x,url("+W+")1x)"+a),o=H.createElement("style"),o.textContent="body."+l+" *, ."+l+"{"+S+"}",H.head.appendChild(o)};var zk=In.Guide.Grid=function(_){var T=this;T._interactor=_,T._alignmentGuideId=0,T._xAlignmentGuide=[],T._yAlignmentGuide=[]};zk.prototype={},zk.prototype.constructor=zk,C.defineProperties(zk.prototype,{gridBlockSize:{get:function(){var M=this;return M._gridBlockSize||M._interactor.getStyle("gridBlockSize")},set:function(b){this._gridBlockSize=b,this._interactor._42()}},gridThickLinesEvery:{get:function(){var l=this;return l._gridThickLinesEvery||l._interactor.getStyle("gridThickLinesEvery")},set:function(V){this._gridThickLinesEvery=V,this._interactor._42()}},gridEnabled:{get:function(){var f=this,X=f._interactor;return X.gridEnabled&&f.isValidGrid()}}}),zk.prototype._42=function(){var _=this,e=_._interactor;_.gridEnabled&&_.drawGrid(),e.alignmentGuideEnabled&&_.drawAlignmentGuide()},zk.prototype.makeMatrix=function(){var u=this,y=u._interactor.getStyle("gridAngle"),O=u._interactor.getStyle("gridRotation"),X=new In.Math.Matrix2d,C=Math.sin(y),h=Math.cos(y);return X.set(1,0,h,C,0,0),X.rotate(O),X},zk.prototype.isValidGrid=function(){var m=this,K=Math.PI,x=m._interactor,f=x.gv;if(f._zoom<x.getStyle("gridZoomThreshold"))return!1;var p=x.getStyle("gridAngle"),P=Math.abs(180*(p%K/K)),C=1-1e-8;return C>P||P>180-C?!1:!0},zk.prototype.drawAlignmentGuide=function(){var $=this,Q=$._interactor,b=Q.gv,e=Q._canvas,C=Q._context,D=e.width,r=e.height,T=b.tx(),L=b.ty(),x=b._zoom;C.beginPath(),C.strokeStyle=Q.getStyle("gridAlignmentGuideColor"),C.lineWidth=1,$._xAlignmentGuide.forEach(function(a){var O=a.p*x+T;C.moveTo(O,0),C.lineTo(O,r)}),$._yAlignmentGuide.forEach(function(A){var O=A.p*x+L;C.moveTo(0,O),C.lineTo(D,O)}),C.stroke()},zk.prototype.drawGrid=function(){function v(O,l,S,Q){var C=In.toScreenPosition(W,n.apply({x:O,y:l})),P=In.toScreenPosition(W,n.apply({x:S,y:Q}));$.moveTo(C.x,C.y),$.lineTo(P.x,P.y)}var H=this,i=H._interactor,f=H.gridBlockSize,c=H.gridThickLinesEvery,w=i.getStyle("gridThickColor"),V=i.getStyle("gridLightColor"),W=i.gv,J=i._canvas,$=i._context,T=J.width,M=J.height,n=H.makeMatrix(),o=n.applyInverse(In.toWorldPosition(W,{x:0,y:0})),R=n.applyInverse(In.toWorldPosition(W,{x:T,y:0})),d=n.applyInverse(In.toWorldPosition(W,{x:0,y:M})),N=n.applyInverse(In.toWorldPosition(W,{x:T,y:M})),q=Math.min(o.x,R.x,d.x,N.x),h=Math.max(o.x,R.x,d.x,N.x),L=Math.min(o.y,R.y,d.y,N.y),e=Math.max(o.y,R.y,d.y,N.y);T=h-q,M=e-L;var b=Math.ceil(q/f),z=Math.floor(h/f),P=Math.ceil(L/f),t=Math.floor(e/f);W.tx(),W.ty(),W._zoom;var r,s,S;for($.save(),$.lineWidth=1,$.beginPath(),$.strokeStyle=w,S=Math.ceil(b/c)*c;z>=S;S+=c)r=S*f,v(r,L,r,e);for(S=Math.ceil(P/c)*c;t>=S;S+=c)s=S*f,v(q,s,h,s);for($.stroke(),$.beginPath(),$.strokeStyle=V,S=b;z>=S;S++)0!==S%c&&(r=S*f,v(r,L,r,e));for(S=P;t>=S;S++)0!==S%c&&(s=S*f,v(q,s,h,s));$.stroke(),$.restore()},zk.prototype.getAlignmentGuides=function(){var X=this;return{x:X._xAlignmentGuide,y:X._yAlignmentGuide}},zk.prototype.addAlignmentGuide=function(K,i,R){var A=this,H="x"===K?A._xAlignmentGuide:A._yAlignmentGuide,R=R?R:++A._alignmentGuideId,s={p:i,id:R};if(H.length){var g=A._findClosestAlignmentGuide(s.p,H);g.dis<0?H.splice(g.index+1,0,s):H.splice(g.index,0,s)}else H.push(s);return A._interactor._42(),R},zk.prototype.findClosest=function(T,R,d){var z=this,i=z._interactor,Q=i.gv;d&&(T=In.toWorldPosition(Q,T));var y,Y,u,P=1/0,q=1/0,S=T.x,C=T.y;if(z.gridEnabled){var A=z.gridBlockSize,F=z.makeMatrix(),o=F.applyInverse(T);o=F.apply({x:Math.round(o.x/A)*A,y:Math.round(o.y/A)*A}),P=o.x-S,q=o.y-C,u=!0}if(i.alignmentGuideEnabled&&(y=z._findClosestAlignmentGuide(S,z._xAlignmentGuide).dis,Y=z._findClosestAlignmentGuide(C,z._yAlignmentGuide).dis,Math.abs(y)<Math.abs(P)&&(P=y,u=!0),Math.abs(Y)<Math.abs(q)&&(q=Y,u=!0)),u){u=!1;var p=Q._zoom,N=i.getStyle("smartGuideThreshold")/p,j={};if(Math.abs(P)<N&&"y"!==R&&(j.x=d?P*p:P,u=!0),Math.abs(q)<N&&"x"!==R&&(j.y=d?q*p:q,u=!0),u)return j}},zk.prototype._findClosestAlignmentGuide=function(G,M){if(!M.length)return{dis:1/0};for(var W,a=0,t=M.length-1;t-a>1;)W=Math.floor((a+t)/2),M[W].p<G?a=W:t=W;var A=M[a].p-G,e=M[t].p-G;return Math.abs(A)<=Math.abs(e)?{line:M[a],dis:A,index:a}:{line:M[t],dis:e,index:t}},zk.prototype.removeAllAlignmentGuide=function(o){var t=this;"y"!==o&&(t._xAlignmentGuide=[]),"x"!==o&&(t._yAlignmentGuide=[]),t._interactor._42()},zk.prototype.removeAlignmentGuide=function(O){for(var y,t,U,Y=this,b=Y._xAlignmentGuide,o=0;2>o;o++)for(b=0===o?Y._xAlignmentGuide:Y._yAlignmentGuide,y=0,t=b.length;t>y;y++)if(U=b[y],U.id===O)return b.splice(y,1),Y._interactor._42(),{axis:0===o?"x":"y",position:U.p};return!1},zk.prototype.adjustAlignmentGuide=function(I,J){var $=this,r=$.removeAlignmentGuide(I);return r?($.addAlignmentGuide(r.axis,J,I),!0):!1};var _m=In.Guide.Rect=function(g){var e=this;e._interactor=g};_m.prototype={},_m.prototype.constructor=_m,_m.prototype.gatherRects=function(){var P,B,f,g,D=this,r=D._interactor.gv,M=[],z=[],p={x:M,y:z},N={},C=r.getDataModel(),X=C.a("width"),y=C.a("height");X&&y&&(P=0,B=0,f=X,g=y,M.push({node:C,type:0,p:P},{node:C,type:1,p:P+f/2},{node:C,type:2,p:P+f}),z.push({node:C,type:0,p:B},{node:C,type:1,p:B+g/2},{node:C,type:2,p:B+g}),N[C._id||0]={x:P,y:B,width:f,height:g}),C.each(function(L){if(cl(L)&&!r.isSelected(L)&&r.isVisible(L)&&r.isValidGuideLineSource(L)){var R=!1;if(r.sm().getSelection().each(function(T){R||(L.isHostOn(T)?R=!0:L.isDescendantOf(T)&&(R=!0))}),!R){var y=L.getRect();P=y.x,B=y.y,f=y.width,g=y.height,M.push({node:L,type:0,p:P},{node:L,type:1,p:P+f/2},{node:L,type:2,p:P+f}),z.push({node:L,type:0,p:B},{node:L,type:1,p:B+g/2},{node:L,type:2,p:B+g}),N[L._id]=y}}}),M.sort(function(v,V){return v.p-V.p}),z.sort(function(P,s){return P.p-s.p}),D._grid=p,D._87I=N},_m.prototype.gatherLines=function(X,h,y){var f,O,e,w,C,R,U,z,t,o,p,M,F=this,P=[F.findClosest({x:X.x,y:X.y},h),F.findClosest({x:X.x+X.w/2,y:X.y+X.h/2},h),F.findClosest({x:X.x+X.w,y:X.y+X.h},h)],G={},W=F._87I;y=y||255;var g,Z;for(F._guideLine=[],f=0;2>f;f++)for(G={},0===f?(w="y",z=X.x,t=z+X.w):(w="x",z=X.y,t=z+X.h),O=0;3>O;O++)C=P[O],C&&isFinite(C[w])&&(g=1<<3*f+O,y&g&&(R=C[w+"Line"],U=R.node,Z=U._id||0,G[Z]||(G[Z]=!0,M=W[Z],"y"===w?(o=M.x,p=M.x+M.width):(o=M.y,p=M.y+M.height),e=R.p,F._guideLine.push({type:w,a:z,b:t,c:o,d:p,p:e,center:1===R.type}))))},_m.prototype._binarySearchClosest=function(x,B){if(!B.length)return{dis:1/0};for(var N,n=0,H=B.length-1;H-n>1;)N=Math.floor((n+H)/2),B[N].p<x?n=N:H=N;var e=B[n].p-x,r=B[H].p-x;return Math.abs(e)<=Math.abs(r)?{line:B[n],dis:e}:{line:B[H],dis:r}},_m.prototype.findClosest=function(e,l,g){var o=this,Z=o._interactor,w=Z.gv,r=o._grid;g&&(e=In.toWorldPosition(w,e));var A,S=o._binarySearchClosest(e.x,r.x),k=o._binarySearchClosest(e.y,r.y),b=S.dis,j=k.dis,n=w._zoom,F=Z.getStyle("smartGuideThreshold")/n,$={};return Math.abs(b)<F&&"y"!==l&&($.x=g?b*n:b,$.xLine=S.line,A=!0),Math.abs(j)<F&&"x"!==l&&($.y=g?j*n:j,$.yLine=k.line,A=!0),A?$:void 0},_m.prototype._42=function(){var O=this,v=O._guideLine;if(v&&!y.Default.isCtrlDown()){var s=O._interactor;if(s.getStyle("guideLineVisible")){var b,_,u,c,l,f,k,E,z,D,I,F,d,m,K,i,R,W=s.gv,x=s._context,q=W.tx(),e=W.ty(),H=W._zoom,J=s.getStyle("guideLineTextSpacing");for(b=0,_=v.length;_>b;b++)u=v[b],E=u.type,z=u.p,D=u.a,I=u.b,F=u.c,d=u.d,m=Math.min(D,F),K=Math.max(I,d),"x"===E?(c=z*H+q,l=m*H+e,f=c,k=K*H+e):(c=m*H+q,l=z*H+e,f=K*H+q,k=l),In.Icons.DrawIcon(s,x,In.Icons.MoveLineGuide,{rect:[c,l,f,k],center:u.center}),d>=D&&I>=F||(m=D>d?d:I,K=D>d?D:F,R=K-m,"x"===E?(u.center2center||(c-=J,f=c),l=m*H+e,k=K*H+e,i=In.Icons.MoveLineGuideDistanceV):"y"===E&&(u.center2center||(l-=J,k=l),c=m*H+q,f=K*H+q,i=In.Icons.MoveLineGuideDistanceH),In.Icons.DrawIcon(s,x,i,{x0:c,y0:l,x1:f,y1:k,dis:R}))}}},_m.prototype.clear=function(){this._guideLine=null};var Ni=In.Guide.Hover=function(k){var c=this;c._interactor=k};Ni.prototype={},Ni.prototype.constructor=Ni,C.defineProperties(Ni.prototype,{}),Ni.prototype._42=function(){var t=this._interactor;if(t.getStyle("hoverGuideVisible")&&!t.gvEditing){var H=t.hoverData,f=t.gv;if(!cl(H)||f.isSelected(H))return t.hoverData=null,void 0;var k=Wg(f,H),y=In.toScreenPosition(f,{x:k.x,y:k.y}),h=In.toScreenPosition(f,{x:k.x+k.width,y:k.y+k.height});In.Icons.DrawIcon(t,t._context,In.Icons.HoverDataRect,{min:y,max:h,color:t.getStyle("hoverGuideColor")||t.getStyle("baseColor"),borderWidth:t.getStyle("hoverGuideBorderWidth")||1,borderPattern:t.getStyle("hoverGuideBorderPattern")||[1,4]})}},In.DefaultStyleMap={baseColor:"rgb(51,153,255)",pointSize:[24,9],checkSize:7,rotateCheckSize:10,moveSensitivity:10,moveDummyThreshold:32,moveDummyPosition:[0,0,-16,-16],moveDummyLineExtraShift:[-32,0],moveDummySensitivity:16,keepAspectRatio:!1,rotateRound:Math.PI/2,shiftRotateRound:Math.PI/12,rotateSensitivity:Math.PI/60,rotateAsClock:!1,rotateTipVisible:!0,shiftLineRotateRound:Math.PI/4,anchorMovable:!0,anchorVisible:!0,anchorHideThreshold:25,anchorOutsideVisibleThreshold:.25,anchorRound:.25,anchorSensitivity:.02,smartGuideThreshold:8,curveIntersectSize:5,curvePointIntersectSize:8,edgeHostDetectPerFrame:!0,edgeHostEdgeMaxDistance:12,edgeHostEdgeHighlighColor:"#5d5d5d",edgeHostPointHighlighColor:"red",edgeHostHighlighPeriod:1500,edgeElevationEditable:!1,attachThreshold:25,guideLineVisible:!0,guideLineTextSpacing:0,hoverGuideVisible:!1,hoverGuideColor:null,gridBlockSize:40,gridThickLinesEvery:10,gridThickColor:"#5d5d5d",gridLightColor:"#d0d0d0",gridZoomThreshold:.25,gridAlignmentGuideColor:"#ff0000",gridAngle:Math.PI/2,gridRotation:0,groupRotateModeDefault:"block",groupRotateModeKey:["ctrlKey","metaKey"],rotateCursorSize:32,rotateCursorRound:45,tipTextColor:"#ffffff",tipBackground:"#333333",curveHighlightColor:"#30599e",rectPointBackground:"white",rectPointBorderColor:"#666666",rectPointShadowColor:"rgba(0,0,0,0.35)",shapeCtrlPointBackground:"white",shapeCtrlPointBorderColor:null,shapeCtrlPointHighlightBorder:null,shapeHighlighPointBackground:"#30599e",curveElevationVisible:!0,curveElevationIntersectSize:8,curveElevationGuideShift:[20,0],curveTipVisible:!0,connectGuideVisible:!0,connectGuideShift:[1,.25,8,0],connectGuideIntersectSize:8,connectGuideGarbageIntersectsize:25,connectGuideGarbageShift:[1,1,-48,-48]};var ue=In.Icons={},$p=1e4,vh=null,er=In.DefaultStyleMap.baseColor,ie="rgb(183,232,135)",db="rgb(255,204,153)",ip=6;y.Default.setImage("Icons.RectPoint",{width:ip,height:ip,comps:[{type:"rect",background:"rgb(247,247,247)",borderWidth:1,borderColor:{func:function(){return er}},rect:[0,0,ip,ip]}]}),ue.GroupSubEntityRect={comps:[{type:"shape",points:{func:function(){var s=ue.GroupSubEntityRect.data;if(!s)return[];var e=s.min,D=s.max;return[e.x,e.y,e.x,D.y,D.x,D.y,D.x,e.y]}},segments:[1,2,2,2,5],background:null,borderWidth:1,borderColor:{func:function(){return ue.GroupSubEntityRect.data.isKeyOb?er:er}}}]};var Fh=4;ue.HoverDataRect={comps:[{type:"shape",points:{func:function(){var t=ue.HoverDataRect.data;if(!t)return[];var J=t.min,y=t.max,w=Fh;return J.x-=w,J.y-=w,y.x+=w,y.y+=w,[J.x,J.y,J.x,y.y,y.x,y.y,y.x,J.y]}},segments:[1,2,2,2,5],background:null,borderWidth:{func:function(){return ue.HoverDataRect.data.borderWidth}},borderColor:{func:function(){return ue.HoverDataRect.data.color}},borderCap:"butt",borderPattern:{func:function(){return ue.HoverDataRect.data.borderPattern}}}]},ue.Line={comps:[{type:"image",name:"Icons.RectPoint",rect:{func:function(){return[[ue.Line.data.P1.x,ue.Line.data.P1.y],ip,ip]}}},{type:"image",name:"Icons.RectPoint",rect:{func:function(){return[[ue.Line.data.P2.x,ue.Line.data.P2.y],ip,ip]}}}]},ue.NodeHoverGuide={comps:[{type:"shape",points:{func:function(){return ue.NodeHoverGuide.data}},segments:[1,2,2,2,5],background:null,borderWidth:1,borderColor:"#3399FF"}]},ue.Rect={comps:[{type:"shape",points:{func:function(){var P=ue.Rect.data;if(!P)return[];var r=P.LT,w=P.LB,m=P.RB,R=P.RT;return[r.x,r.y,w.x,w.y,m.x,m.y,R.x,R.y]}},segments:[1,2,2,2,5],background:null,borderWidth:1,borderColor:{func:function(){return er}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return ue.Rect.data.rotation}},rect:{func:function(){return[[ue.Rect.data.LT.x,ue.Rect.data.LT.y],ip,ip]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return ue.Rect.data.rotation}},rect:{func:function(){return[[ue.Rect.data.LB.x,ue.Rect.data.LB.y],ip,ip]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return ue.Rect.data.rotation}},rect:{func:function(){return[[ue.Rect.data.RB.x,ue.Rect.data.RB.y],ip,ip]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return ue.Rect.data.rotation}},rect:{func:function(){return[[ue.Rect.data.RT.x,ue.Rect.data.RT.y],ip,ip]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return ue.Rect.data.rotation}},visible:{func:function(){return ue.Rect.data.L?!0:!1}},rect:{func:function(){return[[ue.Rect.data.L.x,ue.Rect.data.L.y],ip,ip]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return ue.Rect.data.rotation}},visible:{func:function(){return ue.Rect.data.R?!0:!1}},rect:{func:function(){return[[ue.Rect.data.R.x,ue.Rect.data.R.y],ip,ip]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return ue.Rect.data.rotation}},visible:{func:function(){return ue.Rect.data.T?!0:!1}},rect:{func:function(){return[[ue.Rect.data.T.x,ue.Rect.data.T.y],ip,ip]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return ue.Rect.data.rotation}},visible:{func:function(){return ue.Rect.data.B?!0:!1}},rect:{func:function(){return[[ue.Rect.data.B.x,ue.Rect.data.B.y],ip,ip]}}}]};var kc=16;y.Default.setImage("Icons.Anchor",{width:12,height:12,comps:[{type:"shape",borderWidth:1,borderColor:{func:function(){return er}},borderCap:"round",shadowColor:"#1ABC9C",points:[.50928,6,11.49072,6,6,6,6,.50928,6,11.49072]},{type:"circle",borderWidth:1,borderColor:{func:function(){return er}},shadowColor:"#1ABC9C",rect:[2.84391,2.84391,6.53697,6.53697]}]}),ue.Anchor={comps:[{type:"image",name:"Icons.Anchor",rect:{func:function(){return[[ue.Anchor.data.POS.x,ue.Anchor.data.POS.y],kc,kc]}}}]},ue.TipShiftX=12,ue.TipShiftY=12;var rn=[8,28];ue.TipHelper={comps:[{type:"roundRect",rect:{func:function(){return[ue.TipHelper.data.helperPos.x,ue.TipHelper.data.helperPos.y,rn[0]*ue.TipHelper.data.size,rn[1]]}},background:{func:function(){return vh.getStyle("tipBackground")}},opacity:.6},{type:"text",text:{func:function(){return ue.TipHelper.data.text}},rect:{func:function(){return[ue.TipHelper.data.helperPos.x,ue.TipHelper.data.helperPos.y,rn[0]*ue.TipHelper.data.size,rn[1]]}},color:{func:function(){return vh.getStyle("tipTextColor")}},font:"bold 12px Arial",align:"center"}]};var Ub=7;ue.ShapePoint={comps:[{type:"circle",visible:{func:function(){return!!ue.ShapePoint.data.dynamicVisible}},rect:{func:function(){var T=ue.ShapePoint.data.point,p=ue.ShapePoint.data.size||Ub;return[T,p+10,p+10]}},background:{func:function(){var X=Date.now(),U=ue.ShapePoint.data.dynamicPeriod||1500,Z=Math.sin(X%U/U*Math.PI);return"rgba(27,124,22,"+.5*Z+")"}},borderWidth:0},{type:"circle",rect:{func:function(){var X=ue.ShapePoint.data.point,m=ue.ShapePoint.data.size||Ub;return[X,m,m]}},background:{func:function(){var X=ue.ShapePoint.data.isEnd;return X?"rgba(27,124,222,0.7)":"#ffffff"}},borderWidth:1,borderColor:{func:function(){return ue.ShapePoint.data.color||er}}},{type:"rect",visible:{func:function(){return!!ue.ShapePoint.data.dynamicVisible}},background:"red",borderWidth:0,rotation:Math.PI/4,borderColor:{func:function(){return er}},rect:{func:function(){var P=5;return[ue.ShapePoint.data.point,P,P]}}}]},ue.ShapeBgCurve={comps:[{type:"shape",visible:{func:function(){return!!ue.ShapeBgCurve.data.dynamicVisible}},points:{func:function(){return ue.ShapeBgCurve.data.P}},segments:{func:function(){return ue.ShapeBgCurve.data.S}},background:null,borderWidth:6,borderColor:{func:function(){var T=Date.now(),M=ue.ShapeBgCurve.data.dynamicPeriod||1500,m=Math.sin(T%M/M*Math.PI);return"rgba(27,124,22,"+.3*m+")"}}},{type:"shape",points:{func:function(){return ue.ShapeBgCurve.data.P}},segments:{func:function(){return ue.ShapeBgCurve.data.S}},background:null,borderWidth:1,borderColor:{func:function(){return ue.ShapeBgCurve.data.color||er}}}]};var Ho=8;ue.ShapeHighlighPoint={comps:[{type:"circle",rect:{func:function(){var W=ue.ShapeHighlighPoint.data;return[[W.x,W.y],Ho,Ho]}},background:{func:function(){return vh.getStyle("shapeHighlighPointBackground")}},borderWidth:0}]};var Hm=10;ue.ShapeHighlighRealPoint={comps:[{type:"circle",rect:{func:function(){var $=ue.ShapeHighlighRealPoint.data;return[[$.x,$.y],Hm,Hm]}},background:"#ffffff",borderWidth:2,borderColor:{func:function(){return er}}}]};var tg=8;ue.ShapeHighlighCtrlPoint={comps:[{type:"shape",points:{func:function(){var j=ue.ShapeHighlighCtrlPoint.data,Z=j.x,s=j.y,v=tg/2;return[Z-v,s-v,Z-v,s+v,Z+v,s+v,Z+v,s-v]}},segments:[1,2,2,2,5],borderWidth:2,background:{func:function(){return vh.getStyle("shapeCtrlPointBackground")}},borderColor:{func:function(){return vh.getStyle("shapeCtrlPointBorderColor")||er}}}]};var Ij=3;ue.ShapeHighlightCurve={comps:[{type:"shape",points:{func:function(){return ue.ShapeHighlightCurve.data}},segments:[1,4],background:null,borderWidth:Ij,borderColor:{func:function(){return vh.getStyle("curveHighlightColor")}}}]},ue.ShapeGuideLine={comps:[{type:"shape",points:{func:function(){return ue.ShapeGuideLine.data}},background:null,borderWidth:1,borderColor:"rgb(255,204,153)"}]},ue.MoveLineGuide={comps:[{type:"shape",points:{func:function(){return ue.MoveLineGuide.data.rect}},background:null,borderWidth:1,borderColor:{func:function(){return ue.MoveLineGuide.data.center?ie:db}}}]};var cq=5;ue.MoveLineGuideDistanceH={comps:[{type:"shape",points:{func:function(){var D=ue.MoveLineGuideDistanceH.data,e=D.x0,r=D.y0;return[e,r-cq,e,r+cq]}},rotation:-Math.PI/4,segments:[1,2],background:null,borderWidth:1,borderColor:db},{type:"shape",points:{func:function(){var U=ue.MoveLineGuideDistanceH.data,b=U.x1,g=U.y1;return[b,g-cq,b,g+cq]}},rotation:-Math.PI/4,segments:[1,2],background:null,borderWidth:1,borderColor:db},{type:"text",text:{func:function(){return Math.round(ue.MoveLineGuideDistanceH.data.dis)}},rect:{func:function(){var L=ue.MoveLineGuideDistanceH.data;return[[(L.x0+L.x1)/2,L.y0-10],20,20]}},color:db,font:"12px Arial",align:"center"}]},ue.MoveLineGuideDistanceV={comps:[{type:"shape",points:{func:function(){var S=ue.MoveLineGuideDistanceV.data,b=S.x0,K=S.y0;return[b-cq,K,b+cq,K]}},rotation:Math.PI/4,segments:[1,2],background:null,borderWidth:1,borderColor:db},{type:"shape",points:{func:function(){var P=ue.MoveLineGuideDistanceV.data,m=P.x1,e=P.y1;return[m-cq,e,m+cq,e]}},rotation:Math.PI/4,segments:[1,2],background:null,borderWidth:1,borderColor:db},{type:"text",text:{func:function(){return Math.round(ue.MoveLineGuideDistanceV.data.dis)}},rect:{func:function(){var A=ue.MoveLineGuideDistanceV.data;return[[A.x0-10,(A.y0+A.y1)/2],20,20]}},color:db,font:"12px Arial",align:"center"}]},y.Default.setImage("Icons.EdgeElevationGuideImage",{width:16,height:16,comps:[{type:"oval",background:"rgb(255,255,255)",borderWidth:1,borderColor:"rgb(138,138,138)",rect:[.5,.5,15,15]},{type:"shape",borderWidth:2,borderColor:"rgb(44,44,44)",borderCap:"round",points:[4,8,8,4,12,8,8,4,8,13],segments:[1,2,2,1,2]}]}),ue.EdgeElevationGuide={comps:[{type:"image",name:"Icons.EdgeElevationGuideImage",rect:{func:function(){var f=ue.EdgeElevationGuide.data,K=f.x,d=f.y,r=vh.getStyle("curveElevationIntersectSize"),P=vh.getStyle("curveElevationGuideShift");return K+=P[0],d+=P[1],[K-r,d-r,2*r,2*r]}}}]},y.Default.setImage("Icons.ConnectGuideBgImage",{width:12,height:12,comps:[{type:"shape",background:"#3399ff",fillRule:"evenodd",shadowColor:"#1ABC9C",rotation:3.14159,points:[6.00001,11.99999,6.00001,11.99999,2.6863,11.99999,1e-5,9.30695,1e-5,5.99999,1e-5,5.99999,1e-5,2.68628,2.69305,-1e-5,6.00001,-1e-5,12.00001,-1e-5,11.99998,12.00001,6.00001,11.99999],segments:[1,2,4,2,4,2,2,2]}]}),y.Default.setImage("Icons.ConnectGuideHeaderImage",{width:12,height:12,comps:[{type:"oval",background:"#3399FF",borderColor:"#3399FF",shadowColor:"#1ABC9C",rect:[0,0,12,12]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[4.76,2.56,8.2,5.98,4.76,9.44]}]}),ue.ConnectGuide={comps:[{type:"image",name:"Icons.ConnectGuideBgImage",rotation:{func:function(){return ue.ConnectGuide.data.rotation}},rect:{func:function(){var N=ue.ConnectGuide.data.connect;N.x,N.y;var l=vh.getStyle("connectGuideIntersectSize");return[[N.x,N.y],2*l,2*l]}}},{type:"image",name:"Icons.ConnectGuideHeaderImage",rect:{func:function(){var $=ue.ConnectGuide.data.cursorPos||ue.ConnectGuide.data.connect,G=vh.getStyle("connectGuideIntersectSize");
return[[$.x,$.y],2*G-2,2*G-2]}}},{type:"shape",background:null,borderColor:"#3399ff",borderWidth:2,segments:[1,4],points:{func:function(){var k=ue.ConnectGuide.data.connect,y=ue.ConnectGuide.data.cursorPos||k;return[k.x,k.y,k.x+.5*(y.x-k.x),k.y,y.x+.5*(k.x-y.x),y.y,y.x,y.y]}}}]},y.Default.setImage("Icons.ConnectGuideGarbageImage",{width:48,height:48,comps:[{type:"oval",background:"rgba(0,0,0,0.1)",borderColor:"#979797",shadowColor:"#1ABC9C",rect:[0,0,48,48]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[19.84721,19.69091,19.84721,32.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[24.10371,19.69091,24.10371,32.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[28.15279,19.69091,28.15279,32.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[11.23055,15.22377,36.76945,15.189,19.12302,15.17121,20.94722,11.5228,26.41985,11.5228,28.24406,15.17121]},{type:"rect",borderWidth:2,borderColor:"rgb(255,255,255)",shadowColor:"#1ABC9C",rect:[15.48702,15.22377,17.02595,21.25344]}]}),y.Default.setImage("Icons.ConnectGuideDeletingImage",{width:56,height:56,comps:[{type:"oval",background:"rgba(232,0,0,0.75)",borderColor:"#979797",shadowColor:"#1ABC9C",rect:[0,0,56,56]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[22.67939,27.69091,22.67939,40.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[26.93588,27.69091,26.93588,40.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[30.98497,27.69091,30.98497,40.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",anchorX:0,anchorY:1,rotation:5.65062,points:[14.06272,23.22377,39.60163,23.189,21.9552,23.17121,23.7794,19.5228,29.25203,19.5228,31.07623,23.17121]},{type:"rect",borderWidth:2,borderColor:"rgb(255,255,255)",shadowColor:"#1ABC9C",rect:[18.3192,23.22377,17.02595,21.25344]}]}),ue.ConnectGuideGarbage={comps:[{type:"image",name:{func:function(){var s=ue.ConnectGuideGarbage.data.hover;return s?"Icons.ConnectGuideDeletingImage":"Icons.ConnectGuideGarbageImage"}},rect:{func:function(){var y=ue.ConnectGuideGarbage.data,x=vh.getStyle("connectGuideGarbageIntersectsize");return y.hover&&(x+=5),[[y.x,y.y],2*x,2*x]}}}]};var ug=6;ue.ShapeActivingCtrl={comps:[{type:"shape",visible:{func:function(){return ue.ShapeActivingCtrl.data.c1?!0:!1}},points:{func:function(){var b=ue.ShapeActivingCtrl.data;return[b.point.x,b.point.y,b.c1.x,b.c1.y]}},segments:[1,2],background:null,borderWidth:1,borderColor:{func:function(){return er}}},{type:"shape",visible:{func:function(){return ue.ShapeActivingCtrl.data.c2?!0:!1}},points:{func:function(){var w=ue.ShapeActivingCtrl.data;return[w.point.x,w.point.y,w.c2.x,w.c2.y]}},segments:[1,2],background:null,borderWidth:1,borderColor:{func:function(){return er}}},{type:"shape",visible:{func:function(){return ue.ShapeActivingCtrl.data.c1?!0:!1}},points:{func:function(){var Q=ue.ShapeActivingCtrl.data.c1,n=Q.x,P=Q.y,S=ug/2;return"c1"===ue.ShapeActivingCtrl.data.hl&&(S+=.5),[n-S,P-S,n-S,P+S,n+S,P+S,n+S,P-S]}},segments:[1,2,2,2,5],borderWidth:2,background:{func:function(){return vh.getStyle("shapeCtrlPointBackground")}},borderColor:{func:function(){return"c1"===ue.ShapeActivingCtrl.data.hl?vh.getStyle("shapeCtrlPointHighlightBorder")||er:vh.getStyle("shapeCtrlPointBorderColor")||er}}},{type:"shape",visible:{func:function(){return ue.ShapeActivingCtrl.data.c2?!0:!1}},points:{func:function(){var W=ue.ShapeActivingCtrl.data.c2,L=W.x,Q=W.y,F=ug/2;return"c2"===ue.ShapeActivingCtrl.data.hl&&(F+=.5),[L-F,Q-F,L-F,Q+F,L+F,Q+F,L+F,Q-F]}},segments:[1,2,2,2,5],borderWidth:2,background:{func:function(){return vh.getStyle("shapeCtrlPointBackground")}},borderColor:{func:function(){return"c2"===ue.ShapeActivingCtrl.data.hl?vh.getStyle("shapeCtrlPointHighlightBorder")||er:vh.getStyle("shapeCtrlPointBorderColor")||er}}}]},ue.RoundPoint={comps:[{type:"circle",background:"rgb(247,247,247)",borderWidth:1,borderColor:{func:function(){return er}},rect:{func:function(){return[[ue.RoundPoint.data.x,ue.RoundPoint.data.y],ip,ip]}}}]},ue.AttachPoint={comps:[{type:"rect",background:{func:function(){return ue.AttachPoint.data.isAttach?"rgb(51,153,255)":"rgb(247,247,247)"}},borderWidth:1,rotation:Math.PI/4,borderColor:{func:function(){return er}},rect:{func:function(){var S=ue.AttachPoint.data.isAttach?ip+4:ip;return[[ue.AttachPoint.data.x,ue.AttachPoint.data.y],S,S]}}}]},ue.SimpleRect={comps:[{type:"rect",background:null,borderWidth:{func:function(){return ue.SimpleRect.data.borderWidth||1}},borderColor:{func:function(){return ue.SimpleRect.data.color||er}},rect:{func:function(){var D=ue.SimpleRect.data;return[D.x,D.y,D.width,D.height]}}}]},y.Default.setImage("Icons.MoveDummyImage",{width:32,height:32,boundExtend:12,attachStyle:"close",comps:[{type:"oval",background:"rgb(255,255,255)",borderColor:"#979797",shadow:!0,shadowColor:"rgba(0,0,0,0.25)",shadowOffsetX:0,rect:[0,0,32,32]},{type:"shape",background:"rgb(51,153,255)",pixelPerfect:!0,points:[8.65079,11.90713,9.05502,11.46921,9.70629,11.46921,10.11052,11.90713,10.51476,12.28891,10.51476,12.92895,10.11052,13.34441,8.49359,14.97258,12.2889,14.97258,12.85034,14.97258,13.29949,15.42172,13.29949,15.99439,13.29949,16.57828,12.85034,17.0162,12.2889,17.0162,8.49359,17.0162,10.11052,18.6556,10.51476,19.0486,10.51476,19.7111,10.11052,20.09288,9.70629,20.50834,9.05502,20.50834,8.65079,20.09288,5.32709,16.76917,5.28217,16.71303,4.87794,16.32002,4.87794,15.67998,5.28217,15.26452,8.65079,11.90713,8.65079,11.90713,8.65079,11.90713,13.3444,10.09931,13.3444,10.09931,12.94017,10.50354,12.2889,10.50354,11.88467,10.09931,11.48043,9.69507,11.48043,9.0438,11.88467,8.63957,15.27574,5.25973,15.66874,4.86672,16.32001,4.86672,16.73547,5.25973,16.76917,5.31586,20.10409,8.63957,20.50832,9.0438,20.50832,9.68385,20.10409,10.09931,19.69986,10.49231,19.07105,10.50354,18.64436,10.09931,17.02742,8.45991,17.02742,12.26646,17.02742,12.83912,16.55581,13.31072,15.99438,13.31072,15.43295,13.31072,14.98379,12.83912,14.98379,12.26646,14.96134,8.45991,13.3444,10.09931,13.3444,10.09931,13.3444,10.09931,21.90069,13.33318,21.90069,13.33318,21.49646,12.91771,21.49646,12.27768,21.90069,11.89591,22.31615,11.45798,22.94497,11.45798,23.36043,11.89591,26.72904,15.2533,27.12205,15.66876,27.12205,16.3088,26.72904,16.7018,26.6729,16.75794,23.36043,20.08165,22.94497,20.49711,22.31615,20.49711,21.90069,20.08165,21.49646,19.69987,21.49646,19.03737,21.90069,18.64437,23.51763,17.00498,19.72231,17.00498,19.14965,17.00498,18.71173,16.56705,18.71173,15.98316,18.71173,15.41049,19.14965,14.96135,19.72231,14.96135,23.51763,14.96135,21.90069,13.33318,21.90069,13.33318,21.90069,13.33318,11.88467,23.32675,11.88467,23.32675,11.48043,22.94498,11.48043,22.27125,11.88467,21.88948,12.2889,21.48523,12.94017,21.48523,13.3444,21.88948,14.96134,23.52887,14.98379,19.7111,14.98379,19.14966,15.43295,18.67805,15.99438,18.67805,16.55581,18.67805,17.02742,19.14966,17.02742,19.7111,17.02742,23.52887,18.64436,21.88948,19.07105,21.48523,19.69986,21.48523,20.10409,21.88948,20.50832,22.27125,20.50832,22.94498,20.10409,23.32675,16.76917,26.65045,16.73547,26.72905,16.32001,27.13329,15.66874,27.13329,15.27574,26.72905,11.88467,23.32675,11.88467,23.32675,11.88467,23.32675],segments:[1,4,4,2,2,4,4,2,2,4,4,2,2,4,2,2,2,1,2,4,4,2,4,2,2,4,4,2,2,4,4,2,2,2,2,1,2,4,4,2,4,2,2,4,4,2,2,4,4,2,2,2,2,1,2,4,4,2,2,4,4,2,2,4,4,2,2,4,2,2,2]}]}),ue.MoveDummy={comps:[{type:"image",name:"Icons.MoveDummyImage",rect:{func:function(){var N=ue.MoveDummy.data;return[[N.pos.x,N.pos.y],2*N.size,2*N.size]}}}]},In.Icons.DrawIcon=function(J,F,i,K){i.width=i.height=$p,i.data=K,vh=J,y.Default.drawImage(F,i,0,0,$p,$p),vh=I},In.Icons.MapPoints=function(q,M){for(var L=0,A=q.length;A>L;L++)q[L]/=M},In.roundTo=function(p,C,H){var t=Math.abs(p%C);return H>t||H>C-t?C*Math.round(p/C):p},In.toFixed=function(h){return Math.round(100*h)/100},In.getDataMatrix=function(J){if(J instanceof y.Shape){var l=new y.Math.Matrix2d,M=J.getPosition();return l.translate(-M.x,-M.y).scale(J.getScale().x,J.getScale().y).rotate(J.getRotation()).translate(M.x,M.y),l}return J.getMatrix?J.getMatrix():new y.Math.Matrix2d};var xg=In.Math.Curve=function(){this._curves=[]};xg.prototype={},xg.prototype.constructor=xg,xg.prototype.createFromHtShape=function(Z,n,F){n instanceof y.List&&(n=n.toArray());var L,B,p,X,E,W,R,c=this,f=null,w=null,G=0,T=In.Math.Vector2,M=In.Math.CubicBezier,h=function(D){return new T(Z[D],Z[D+1],F?F[D/2]:I)};for(B=0,p=n.length;p>B;B++){switch(X=n[B],E=null,X){case 1:w=h(G),f=w,G+=2;break;case 2:L=h(G),G+=2,E=new M(w,w.clone(),L.clone(),L),w=L;break;case 3:W=h(G),L=h(G+2),G+=4,E=new M(w,W.clone().sub(w).multiplyScalar(2/3).add(w),W.clone().sub(L).multiplyScalar(2/3).add(L),L),w=L;break;case 4:W=h(G),R=h(G+2),L=h(G+4),G+=6,E=new M(w,W,R,L),w=L;break;case 5:if(!f)break;E=new M(w,w.clone(),f.clone(),f),w=null,f=null}E&&(E._index=c._curves.length,c._curves.push(E))}},xg.prototype.checkPoint=function(B,f){var t,v,Q,l,p,O=this,h=O._curves;for(t=0,v=h.length;v>t;t++)if(l=h[t],p=l.intersectRect(B,f,f),p.length)return Q=0,p.forEach(function(r){Q+=r.t}),Q/=p.length,B=l.getPointAt(Q),B.t=Q,{bezier:l,intersection:B}},xg.prototype.insertKnot=function(G,P){var y=G.insertKnot(P),i=this,O=i._curves;O.splice(G._index,1,y[0],y[1])},xg.prototype._isCloseEnough=function(E,y){return Math.abs(E.x-y.x)<1e-6&&Math.abs(E.y-y.y)<1e-6},xg.prototype._isSamePoint=function(F,l){return F===l},xg.prototype.moveRealPoint=function(D,S){var W=this,w=W._curves,t=S.clone().sub(D);w.forEach(function(q){var N=q._p1;q._p2,q._p3;var m=q._p4;W._isSamePoint(N,D)&&(q._p2.add(t),q._p1=S),W._isSamePoint(m,D)&&(q._p3.add(t),q._p4=S)})},xg.prototype.moveCtrlDueToRealPointMovement=function(U,E){var g=this,q=g._curves,m=function(K){K.add(E),K.e&&E.e&&(K.e+=E.e)};q.forEach(function(L){var f=L._p1;L._p2,L._p3;var P=L._p4;g._isSamePoint(f,U)&&m(L._p2),g._isSamePoint(P,U)&&m(L._p3)})},xg.prototype.moveCtrlPoint=function(d,R,p){var G=d[p];if(G){G.e!==I&&(R.e=G.e);var M=this,t=M._curves;R.clone().sub(G),t.forEach(function(k){var q;"c2"===p?q="_p2":"c1"===p&&(q="_p3"),M._isSamePoint(k[q],G)&&(k[q]=R)}),d[p]=R}},xg.prototype.deleteRealPoint=function(g,V){var r,x,n,k,J,Y,u,h=this,s=h._curves,_={},b=[],O=In.Math.CubicBezier;for(x=0,n=s.length;n>x;x++)r=s[x],k=r._p1,J=r._p2,Y=r._p3,u=r._p4,(_[x]||!h._isSamePoint(k,g))&&(h._isSamePoint(u,g)?n>x+1&&h._isSamePoint(s[x+1]._p1,g)&&(V||b.push(new O(k,J,s[x+1]._p3,s[x+1]._p4))):b.push(r));h._curves=b},xg.prototype.findPairs=function(o,F){var q,E,D,A,i,g,h,W,s=this,x=s._curves,H={},S=[];for(E=0,D=x.length;D>E;E++)q=x[E],A=q._p1,i=q._p2,g=q._p3,h=q._p4,!H[E]&&s._isSamePoint(A,o)&&(F?S.push({point:A,r2:h}):S.push({point:A,c2:i})),s._isSamePoint(h,o)&&(W=F?{point:h,r1:A}:{point:h,c1:g},D>E+1&&s._isSamePoint(x[E+1]._p1,o)&&(F?W.r2=x[E+1]._p4:W.c2=x[E+1]._p2,H[E+1]=!0),S.push(W));return S},xg.prototype.toHtShape=function(){var _=this,F=_._curves,S=[],E=[],P={x:1/0,y:1/0};return F.forEach(function(M){var O=M._p1,e=M._p2,N=M._p3,z=M._p4;return _._isCloseEnough(O,P)||(S.push(1),E.push(O.clone())),P=z,_._isCloseEnough(O,e)&&_._isCloseEnough(N,z)?(S.push(2),E.push(z.clone()),void 0):(S.push(4),E.push(e.clone(),N.clone(),z.clone()),void 0)}),{segments:S,points:E}};var ck=In.Math.CubicBezier=function(P,x,K,s){var O=this;O._id=In.Math.CubicBezier._globalId++,O._p1=P,O._p2=x,O._p3=K,O._p4=s};ck._globalId=1,ck.prototype={},ck.prototype.constructor=ck,ck.prototype.toString=function(){return this._id},ck.prototype.intersectRect=function(Q,P,L){var u=P/2,J=L/2,n=Q.x,s=Q.y,x=In.Math.Vector2,D=new x(-u+n,-J+s),r=new x(u+n,J+s),H=new x(r.x,D.y),i=new x(D.x,r.y),U=this,K=U.intersectLine(D,H),h=U.intersectLine(H,r),A=U.intersectLine(r,i),F=U.intersectLine(i,D),p=K.concat(h).concat(A).concat(F);return p},ck.prototype.intersectLine=function(c,q){var l,w,T,V,u,y,j,A,$,e,U,I,J,Z=this,f=c.clone().min(q),F=c.clone().max(q);V=Z._p1,u=Z._p2,y=Z._p3,j=Z._p4,l=V.clone().multiplyScalar(-1),w=u.clone().multiplyScalar(3),T=y.clone().multiplyScalar(-3),U=l.add(w).add(T).add(j),l=V.clone().multiplyScalar(3),w=u.clone().multiplyScalar(-6),T=y.clone().multiplyScalar(3),e=l.add(w).add(T),l=V.clone().multiplyScalar(-3),w=u.clone().multiplyScalar(3),$=l.add(w),A=V.clone(),J=new In.Math.Vector2(c.y-q.y,q.x-c.x),I=c.x*q.y-q.x*c.y;for(var m=Z.getRoots(J.dot(U),J.dot(e),J.dot($),J.dot(A)+I),E=new Array,z=0,k=m.length;k>z;z++){var x=m[z];if(!(0>x||x>1)){var D=Z.getPointAt(x);D.t=x,c.x==q.x?f.y<=D.y&&D.y<=F.y&&E.push(D):c.y==q.y?f.x<=D.x&&D.x<=F.x&&E.push(D):D.x>=f.x&&D.y>=f.y&&D.x<=F.x&&D.y<=F.y&&E.push(D)}}return E},ck.prototype.solveTForPoint=function(m){var a,A,V,n,r=this;a=r._p1.x-m.x,A=r._p2.x-m.x,V=r._p3.x-m.x,n=r._p4.x-m.x;for(var k=r.getRoots(n-3*V+3*A-a,3*V-6*A+3*a,3*A-3*a,a),z=I,p=1/0,P=0,J=k.length;J>P;P++){var v=k[P];if(!(0>v||v>1)){var E=r.getPointAt(v);E.t=v;var F=Math.abs(E.y-m.y);p>F&&(p=F,z=E)}}return z},ck.prototype.getPointAt=function(q){var C=this,M=C._p1,D=C._p2,V=C._p3,r=C._p4,H=M.clone().lerp(D,q),n=D.clone().lerp(V,q),N=V.clone().lerp(r,q),z=H.lerp(n,q),s=n.lerp(N,q);return z.lerp(s,q)},ck.prototype.getPointByPercentage=function(r){var b=this.length*r,p=this._cacheLength,F=p.length;if(0===b)return p[0].point;if(r>=1)return p[F-1].point;for(var T=0;F>T;T++){var c=p[T];if(!(c.len<b)){var q=p[T-1];return c.point.clone().sub(q.point).setLength(b-q.len).add(q.point)}}},ck.prototype.getTByPercentage=function(s){var F=this.length*s,t=this._cacheLength,P=t.length;if(0===F||0>=s)return t[0].t;if(s>=1)return t[P-1].t;for(var b=0;P>b;b++){var i=t[b];if(!(i.len<F)){var _=t[b-1];return(F-_.len)/(i.len-_.len)*(i.t-_.t)+_.t}}},ck.prototype.getRoots=function(Y,_,T,U){var K,s,Z,X,t,g=new Array;if(Math.abs(Y)<1e-6){var K=_,s=T/K,Z=U/K,X=s*s-4*Z;if(X>0){var t=Math.sqrt(X);g.push(.5*(-s+t)),g.push(.5*(-s-t))}else 0==X&&g.push(.5*-s)}_/=Y,T/=Y,U/=Y,K=(3*T-_*_)/3,s=(2*_*_*_-9*T*_+27*U)/27;var l=_/3,m=s*s/4+K*K*K/27,R=s/2;if(Math.abs(m)<=1e-6&&(m=0),m>0){var N,I,t=Math.sqrt(m);N=-R+t,I=N>=0?Math.pow(N,1/3):-Math.pow(-N,1/3),N=-R-t,N>=0?I+=Math.pow(N,1/3):I-=Math.pow(-N,1/3),g.push(I-l)}else if(0>m){var S=Math.sqrt(-K/3),j=Math.atan2(Math.sqrt(-m),-R)/3,o=Math.cos(j),H=Math.sin(j),C=Math.sqrt(3);g.push(2*S*o-l),g.push(-S*(o+C*H)-l),g.push(-S*(o-C*H)-l)}else{var N;N=R>=0?-Math.pow(R,1/3):Math.pow(-R,1/3),g.push(2*N-l),g.push(-N-l)}return g},ck.prototype._70I=function(){var v=this;return v._p1.distanceToSquared(v._p2)<1e-10&&v._p3.distanceToSquared(v._p4)<1e-10},ck.prototype.insertKnot=function(R){var r=this,_=r._p1,o=r._p2,h=r._p3,K=r._p4,p=_.clone().lerp(o,R),g=o.clone().lerp(h,R),y=h.clone().lerp(K,R),V=p.clone().lerp(g,R),F=g.clone().lerp(y,R),j=V.clone().lerp(F,R);return r._70I()?(_.clone().lerp(K,R),[new In.Math.CubicBezier(_,_.clone(),j.clone(),j),new In.Math.CubicBezier(j,j.clone(),K.clone(),K)]):[new In.Math.CubicBezier(_,p,V,j),new In.Math.CubicBezier(j,F,y,K)]},C.defineProperties(ck.prototype,{length:{get:function(){var G=this._cacheLength;if(!G){G=this._cacheLength=[];for(var W=this._p1,I=0,U=0;1>=I;){var C=this.getPointAt(I+=.001);U+=C.clone().sub(W).length(),W=C,G.push({len:U,t:I,point:C.clone()})}}return G[G.length-1].len}},p1:{get:function(){return this._p1},set:function(l){this._p1=l,this._cacheLength=I}},p2:{get:function(){return this._p2},set:function(Y){this._p2=Y,this._cacheLength=I}},p3:{get:function(){return this._p3},set:function(y){this._p3=y,this._cacheLength=I}},p4:{get:function(){return this._p4},set:function(k){this._p4=k,this._cacheLength=I}}});var Co=y.Default.getInternal().ui().EdgeUI,Ad={_47O:function(k){var t=this,s=Ad.getBackups()._47O;In.inEdit(t.gv)||s.call(t,k)}};In.Inject.registAsModule(Ad,Co);var De=y.Default.getInternal().ui().NodeUI,Ko={_47O:function(y){var q=this,Z=Ko.getBackups()._47O;In.inEdit(q.gv)||Z.call(q,y)},getSelectWidth:function(){var $=this,O=$.gv,g=$._data;if(O.isEditable(g)&&In.inEdit(O))return 0;var H=Ko.getBackup("getSelectWidth");return H.call($)}};In.Inject.registAsModule(Ko,De);var Mb=y.graph.GraphView,$j={_editPointSize:function(){var k=y.Default.isTouchable,a=In.getStyle("pointSize");return a[k?0:1]}(),isPointEditable:function(r){var c=this;if(In.inEdit(c))return c._pointEditableFunc?c._pointEditableFunc(r):!0;var K=$j.getBackup("isPointEditable");K.call(c,r)},isEditable:function(q){var j,i=this,L=$j.getBackup("isEditable");if(j=q instanceof In.Group?!0:L.call(i,q),!In.inEdit(i))return j;if(!(q instanceof y.Edge))return j;if(!q.s("2d.editable"))return!1;var x=i.getEditableFunc();return x?x(q):!0},_42:function(K,X){var d=this,y=$j.getBackups()._42;if(y.call(d,K,X),In.inEdit(d)){var H=d.getEditInteractor();H.drawImpl()}}};In.Inject.registAsModule($j,Mb);var qb=y.Default.getInternal().ui().ShapeUI,lf={_47O:function(f){var B=this,m=lf.getBackups()._47O;In.inEdit(B.gv)||m.call(B,f)}};In.Inject.registAsModule(lf,qb);var lr=y.graph.DefaultInteractor,Qc={handle_mousewheel:function($){var D=this,R=Qc.getBackup("handle_mousewheel");In.inEdit(D.gv)||R.call(D,$)}};In.Inject.registAsModule(Qc,lr);var Mc=y.graph.MoveInteractor,jp={_calcShift:function(G,U){var E=this,Y=jp.getBackup("_calcShift"),w=E.gv;if(!In.inEdit(w))return Y.call(E,G,U);var q=w.getEditInteractor(),r=q.getSubModule("Move").calcShift(G,U,E);return r||Y.call(E,G,U)},clear:function(m){var y=this,O=jp.getBackup("clear");O.call(y,m);var f=y.gv;if(In.inEdit(f)){var B=f.getEditInteractor();B.getSubModule("Move").clear(m)}}};In.Inject.registAsModule(jp,Mc);var _m=In.Rect=function(j){this.catalog="Rect",this._interactor=j};_m.prototype={},_m.prototype.constructor=_m,_m.prototype.gatherInfo=function(J,c){var z=this;if(1===c.length){var K=c[0];return K instanceof y.Shape&&K._70I()?z.gatherLine(J,K):hf(K,J)?!1:z.gatherSingleTarget(J,K)}return c.length>1?z.gatherMultiTargets(J,c):!1},_m.prototype.gatherSingleTarget=function(U,g){if(g.getCorners){var t,R=this,x=R.info;R.target=g,t=R.screenInfo={};var E=g.getCorners();x.LT=new In.Math.Vector2(E[0]),x.LB=new In.Math.Vector2(E[1]),x.RB=new In.Math.Vector2(E[2]),x.RT=new In.Math.Vector2(E[3]),x.T=x.LT.clone().add(x.RT).divideScalar(2),x.B=x.LB.clone().add(x.RB).divideScalar(2),x.L=x.LT.clone().add(x.LB).divideScalar(2),x.R=x.RT.clone().add(x.RB).divideScalar(2);for(var $ in x)t[$]=In.toScreenPosition(U,x[$]);var h=R._interactor,u=h.getStyle("checkSize"),j=function(Q,o,j){var e=o.clone().sub(Q).setLength(-u),t=j.clone().sub(Q).setLength(-u),w=e.add(t).add(Q);return w};return t.rotLT=j(t.LT,t.RT,t.LB),t.rotLB=j(t.LB,t.LT,t.RB),t.rotRB=j(t.RB,t.LB,t.RT),t.rotRT=j(t.RT,t.LT,t.RB),t.rotT=t.rotLT.clone().add(t.rotRT).divideScalar(2),t.rotB=t.rotLB.clone().add(t.rotRB).divideScalar(2),t.rotL=t.rotLT.clone().add(t.rotLB).divideScalar(2),t.rotR=t.rotRT.clone().add(t.rotRB).divideScalar(2),t.rotation=g.getRotation(),R.gatherConnectInfo(),!0}},_m.prototype.gatherConnectInfo=function(){var f=this,j=f.target,u=f._interactor,M=f.screenInfo,W=u.gv;if(W.isConnectActionVisible(j)&&u.getStyle("connectGuideVisible")){var l;j.s&&(l=j.s("connectGuideShift")),l||(l=u.getStyle("connectGuideShift"));var s=j.getAnchor(),K=j.getSize(),t=j.toGlobal({x:K.width*(l[0]-s.x),y:K.height*(l[1]-s.y)});t=In.toScreenPosition(W,t),M.P1?t.add(M.P2.clone().sub(M.P1).setLength(l[2])):(t.add(M.RT.clone().sub(M.LT).setLength(l[2])),t.add(M.LB.clone().sub(M.LT).setLength(l[3]))),M.connect=t}},_m.prototype.gatherMultiTargets=function(Y,X){var T=In.Group.findOrCreateGroup(X,this._interactor._uuid);if(!T)return!1;var O=this;return O.editing&&"rotate"!==O.editing.mode||T.calcInfo(),O.gatherSingleTarget(Y,T)},_m.prototype.gatherLine=function(E,W){this.target=W;var k=this.screenInfo={},A=W.getPoints(),K=In.getDataMatrix(W);return k.P1=In.toScreenPosition(E,K.apply(A.get(0))),k.P2=In.toScreenPosition(E,K.apply(A.get(1))),this.gatherConnectInfo(),!0},_m.ResizeKeys=["LT","RB","LB","RT","L","R","B","T"],_m.ResizeDirection=[{x:-1,y:-1},{x:1,y:1},{x:-1,y:1},{x:1,y:-1},{x:-1,y:0},{x:1,y:0},{x:0,y:1},{x:0,y:-1}],_m.RotateKeys=["rotLT","rotRB","rotLB","rotRT","rotL","rotR","rotB","rotT"],_m.prototype.check=function(i,p,R){if(y.Default.isLeftButton(p)){var w=this;if(w.editing=null,w.tipInfo=null,w.screenInfo){var S=w.target,j=i.isEditable(S),K=w.screenInfo;if(j&&K.connect){var U=w._checkConnect(R);if(U)return U}if(K.P1)return w._checkLine(R);var z,t,f,H=null,q=w._interactor,Z=q.getStyle("checkSize");if(j&&i.isRectEditable(S))for(t=0;t<In.Rect.ResizeKeys.length;t++)if(f=In.Rect.ResizeKeys[t],In.checkHit(R,K[f],Z)){H=f,z="resize";break}if(!H&&j&&i.isRotationEditable(S)&&!q.getStyle("rotateAsClock")){var m=q.getStyle("rotateCheckSize");for(t=0;t<In.Rect.RotateKeys.length;t++)if(f=In.Rect.RotateKeys[t],In.checkHit(R,K[f],m)){H=f,z="rotate";break}}if(!H)return q.setCursor("default"),void 0;if("rotate"===z){var F,k=i.lp(p);if(S instanceof In.Group){var M=q.getStyle("groupRotateModeKey");"string"==typeof M&&(M=[M]);for(var l=!1,n=0,b=M.length;b>n;n++)if(p[M[n]]){l=!0;break}var $=q.getStyle("groupRotateModeDefault");F=l?"batch"===$?"block":"batch":$}var e="batch"===F?S.getAnchor2():S.getPosition(),d=Math.atan2(k.y-e.y,k.x-e.x);q._setRotateCursor(d),w.editing={mode:z,key:H,pos:e,flipY:S.getScale().y<0,rotation:S.getRotation(),hitRot:d},F&&(w.editing.groupRotateMode=F)}else{var u=In.Rect.ResizeKeys.indexOf(H),C=In.Rect.ResizeDirection[u],J=Math.cos(S.getRotation()),B=Math.sin(S.getRotation()),g=C.x*Math.sign(S.getScale().x),D=C.y*Math.sign(S.getScale().y),P=Math.atan2(-B*g-J*D,J*g-B*D),W=(Math.round(P/(Math.PI/4))+8)%8,_=["ew-resize","nesw-resize","ns-resize","nwse-resize","ew-resize","nesw-resize","ns-resize","nwse-resize"][W];this._interactor.setCursor(_);var O=S.getWidth(),Y=S.getHeight(),v=S.getAnchor();w.editing={mode:z,key:H,rect:{x:-O*v.x,y:-Y*v.y,width:O,height:Y},anchor:v,matrix:S.getMatrix()}}return H}}},_m.prototype._checkLine=function(V){var a=this;a.screenInfo;var L,g=a._interactor.getStyle("checkSize");if(In.checkHit(V,a.screenInfo.P1,g))L="P1";else{if(!In.checkHit(V,a.screenInfo.P2,g))return this._interactor.setCursor("default"),void 0;L="P2"}return a.editing={mode:"line",key:L},L},_m.prototype._checkConnect=function(g){var n=this,y=n.screenInfo,$=n._interactor,x=$.getStyle("connectGuideIntersectSize"),Y=y.connect,t=g.x,f=Y.x;if(f>t&&x>f-t&&Math.abs(Y.y-g.y)<x||t>=f&&In.checkHit(g,Y,x)){var G="connect",X=F.getConnectAction($.gv);if(n.editing={mode:G},X&&X.delete)if(n.target instanceof In.Group){var U=!0;$.gv.sm().getSelection().each(function(z){X.delete.visible.call(null,$.gv,z)||(U=!1)}),n.editing.hasDeleteAction=U}else X.delete.visible.call(null,$.gv,n.target)&&(n.editing.hasDeleteAction=!0);return $.setCursor("default"),G}},_m.prototype._fireEditEvent=function(l,f){var W=this._interactor,F=this.editing;if(F){var T=F.mode;T="rotate"===T?"Rotation":"connect"===T?"Connection":"resize"===T?"Rect":T[0].toUpperCase()+T.slice(1),W.fi({kind:l+"Edit"+T,event:f})}},_m.prototype.startEdit=function(R,g){R.startDragging(g);var Y=this;Y._interactor.fi({kind:"prepareEdit",event:g});var K=Y.editing,F=Y.target;if(K){if(Y._fireEditEvent("begin",g),K.started=!0,"rotate"===K.mode)return K.groupRotateMode&&F.beginRotate(K),R._42(),void 0;if("connect"!==K.mode)("line"===K.mode||F&&0===F.getRotation())&&(Y._inSmartGuide=!0,Y._interactor.rectGuide.gatherRects());else if(K.hasDeleteAction){var y=R.gv,X=Y._interactor.getStyle("connectGuideGarbageShift");K.garbageInfo={x:y.getWidth()*X[0]+X[2],y:y.getHeight()*X[1]+X[3],size:Y._interactor.getStyle("connectGuideGarbageIntersectsize")},R._42()}}},_m.prototype._46O=function(L){var $,x,q=this,H=q.editing,z=q.target;if(H){if("connect"===H.mode&&!H.canceled&&!H.deleted)try{H.garbageInfo&&H.garbageInfo.hover?F.doDeleteConnectionAction(q._interactor.gv,z):F.doConnectAction(q._interactor.gv,z,H.target)}catch(h){console.error(h)}x=H.freezeFlag,$=q.editing.groupRotateMode,q._fireEditEvent("end",L),q.editing=null}q.tipInfo=null,q._inSmartGuide&&(q._interactor.rectGuide.clear(),q._inSmartGuide=!1),$&&z&&z.endRotate(),z instanceof y.Block&&(x===I?delete z._freezeSyncFromChildren:z._freezeSyncFromChildren=x,z.updateFromChildren())},_m.prototype.handleNormalStateDelete=function(){var e=this,K=e.editing;if(K&&"connect"===K.mode&&!K.canceled&&!K.deleted){if(K.garbageInfo){try{F.doDeleteConnectionAction(e._interactor.gv,e.target)}catch(N){console.error(N)}K.garbageInfo=null}return K.cursorPos=null,K.targetCorners=null,K.deleted=!0,e._interactor._42(),!0}},_m.prototype.handleNormalStateKeyDown=function(U){var o=this,M=o.editing;return!M||"connect"!==M.mode||M.canceled||M.deleted?void 0:y.Default.isEsc(U)?(M.cursorPos=null,M.targetCorners=null,M.canceled=!0,o._interactor._42(),!0):void 0},_m.prototype.handleEdit=function(q,A){var _=this,c=_.editing;if(c){var L,z,M,b,t,F=_.target,J=c.key,I=c.mode,f=q.lp(A),u=_._interactor;if("connect"===I){if(c.canceled)return;if(c.deleted)return;c.cursorPos=u._getLogicalPoint(A);var x=c.garbageInfo;return x&&In.checkHit(c.cursorPos,x,x.size)?(x.hover=!0,c.target=null,c.targetCorners=null):(x&&(x.hover=!1),c.target=q.getDataAt(f,function(s){return q.isSelectable(s)?cl(s)?!0:!1:!1})||null,c.targetCorners=In.getTargetCornersOnScreen(q,c.target)),u._42(),void 0}if("rotate"===I){var N,k,X=c.pos,w=Math.atan2(f.y-X.y,f.x-X.x);if(c.groupRotateMode?k=w-c.hitRot:(N=w-c.hitRot,k=c.rotation+N),k%=2*Math.PI,0>k&&(k+=2*Math.PI),!y.Default.isCtrlDown(A)){var B,D;oo(A)?(B=u.getStyle("shiftRotateRound"),D=B/2):(B=u.getStyle("rotateRound"),D=u.getStyle("rotateSensitivity")),k=In.roundTo(k,B,D)}c.groupRotateMode?(N=k-(c.lastRotation||0),0!==N&&(F.addRotation(N,c.groupRotateMode,function(k){return q.isRotationEditable(k)}),c.lastRotation=k)):F.setRotation(k),u._setRotateCursor(w),k>Math.PI&&(k-=2*Math.PI);var e=180*(k/Math.PI);e=e.toFixed(2),L=""+e+"°"}else if("resize"===I){var Z=c.rect;M=Z.x,b=Z.y;var V,j=Z.width,p=Z.height,d=c.anchor,l=c.matrix,Q=F.s&&F.s("keepAspectRatio")||u.getStyle("keepAspectRatio");oo(A)&&(Q=!Q);var U=_._unionPointMode1,o=_._unionPointMode2;if(_._inSmartGuide&&!y.Default.isCtrlDown(A)&&!Q){var R;"L"===J||"R"===J?R="x":("T"===J||"B"===J)&&(R="y"),_._adsorbedToClosest(f,R),t=!0}V=l.tfi(f);var g;"LT"===J?(Z=U(V,{x:M+j,y:b+p},j,p,Q),g=9):"T"===J?(Z=o({x:M,y:V.y},{x:M+j,y:b+p},j,p,Q,"v"),g=1):"RT"===J?(Z=U(V,{x:M,y:b+p},j,p,Q),g=33):"L"===J?(Z=o({x:V.x,y:b},{x:M+j,y:b+p},j,p,Q,"h"),g=8):"R"===J?(Z=o({x:M,y:b},{x:V.x,y:b+p},j,p,Q,"h"),g=32):"LB"===J?(Z=U(V,{x:M+j,y:b},j,p,Q),g=12):"B"===J?(Z=o({x:M,y:b},{x:M+j,y:V.y},j,p,Q,"v"),g=4):"RB"===J&&(Z=U(V,{x:M,y:b},j,p,Q),g=36);var r=l.tf(Z.x+Z.width*d.x,Z.y+Z.height*d.y);F instanceof y.Block&&(c.hasOwnProperty("freezeFlag")||(c.freezeFlag=F._freezeSyncFromChildren,F._freezeSyncFromChildren=!0)),F.setPosition(r),F.setSize(Z.width,Z.height),t&&(z=F.getRect(),u.rectGuide.gatherLines({node:F,x:z.x,y:z.y,w:z.width,h:z.height},R,g)),L=""+Math.round(Z.width)+" * "+Math.round(Z.height)}else if("line"===I){if(oo(A)){var S=F.getPoints(),H="P1"===J?S.get(1):S.get(0),O={x:f.x-H.x,y:f.y-H.y},E=u.getStyle("shiftLineRotateRound"),m=_._shiftDirList;if(!m||_._shiftRotateRound!==E){_._shiftRotateRound=E,_._shiftDirList=m=[];for(var P=0;P<Math.PI;P+=E)m.push({x:W(P),y:s(P)})}for(var G,T=0,v=0,Y=m.length;Y>v;v++){var h=m[v],a=h.x*O.x+h.y*O.y;Math.abs(a)>Math.abs(T)&&(T=a,G=h)}f={x:H.x+G.x*T,y:H.y+G.y*T},u.rectGuide.clear()}else _._inSmartGuide&&!y.Default.isCtrlDown(A)&&(_._adsorbedToClosest(f),t=!0);var C=In.getDataMatrix(F).applyInverse(f);F.setPoint("P1"===J?0:1,C,!0);var K=F.getPoints(),n=K.get(0),$=K.get(1);M=n.x-$.x,b=n.y-$.y,L=" "+Math.round(Math.sqrt(M*M+b*b))+" ",t&&(z=F.getRect(),u.rectGuide.gatherLines({node:F,x:z.x,y:z.y,w:z.width,h:z.height}))}if(L){var i=y.Default.getLogicalPoint(A,u._canvas);i.x+=In.Icons.TipShiftX,i.y+=In.Icons.TipShiftY,_.tipInfo={helperPos:i,text:L,size:L.length}}_._fireEditEvent("between",A)}},_m.prototype._unionPointMode1=function(k,s,i,B,x){if(x&&i&&B){var M=k.x-s.x,N=k.y-s.y;Math.abs(M*B)<Math.abs(N*i)?(N=Math.sign(N)*Math.abs(M*B/i),k.y=s.y+N):(M=Math.sign(M)*Math.abs(N*i/B),k.x=s.x+M)}return y.Default.unionPoint(k,s)},_m.prototype._unionPointMode2=function(d,N,P,c,l,b){var A=y.Default.unionPoint(d,N);if(l&&P&&c){var T;"v"===b?(T=A.x+A.width/2,A.width=P*A.height/c,A.x=T-A.width/2):(T=A.y+A.height/2,A.height=c*A.width/P,A.y=T-A.height/2)}return A},_m.prototype._adsorbedToClosest=function(b,B){var h=this,$=h._interactor,e=$.rectGuide.findClosest(b,B),x=$.gridGuide.findClosest(b,B),N=1/0,Z=1/0;e&&(isFinite(e.x)&&(N=e.x),isFinite(e.y)&&(Z=e.y)),x&&(isFinite(x.x)&&Math.abs(x.x)<Math.abs(N)&&(N=x.x),isFinite(x.y)&&Math.abs(x.y)<Math.abs(Z)&&(Z=x.y)),isFinite(N)&&(b.x+=N),isFinite(Z)&&(b.y+=Z)},_m.prototype._42=function(h,u,Z){var e=this;e.info={},e.screenInfo=null;var W=e._interactor;if(!W.editDetail&&e.gatherInfo(u,Z)){var b=e.editing,Q=b?b.groupRotateMode:null,D=e.screenInfo;if("block"!==Q||!b||!b.started){if(D.P1?In.Icons.DrawIcon(W,h,In.Icons.Line,D):In.Icons.DrawIcon(W,h,In.Icons.Rect,D),D.connect&&(In.Icons.DrawIcon(W,h,In.Icons.ConnectGuide,{rotation:D.rotation,connect:D.connect,cursorPos:b?b.cursorPos:null}),b)){if(b.targetCorners){for(var y={x:1/0,y:1/0},K={x:-1/0,y:-1/0},r=0,w=b.targetCorners.length;w>r;r+=2)y.x=Math.min(y.x,b.targetCorners[r]),K.x=Math.max(K.x,b.targetCorners[r]),y.y=Math.min(y.y,b.targetCorners[r+1]),K.y=Math.max(K.y,b.targetCorners[r+1]);In.Icons.DrawIcon(W,h,In.Icons.HoverDataRect,{min:y,max:K,color:W.getStyle("hoverGuideColor")||W.getStyle("baseColor")})}b.garbageInfo&&In.Icons.DrawIcon(W,h,In.Icons.ConnectGuideGarbage,b.garbageInfo)}W.getStyle("rotateTipVisible")&&e.tipInfo&&In.Icons.DrawIcon(W,h,In.Icons.TipHelper,e.tipInfo)}e.target instanceof In.Group&&e.target._42(W,h,u)}};var Om=In.Anchor=function(j){this.catalog="Anchor",this._interactor=j};Om.prototype={},Om.prototype.constructor=Om,Om.prototype.gatherInfo=function(Q,c){var u=this;if(1===c.length){var N=c[0];if(!N.getAnchor)return;if(N instanceof y.Shape&&N._70I())return;if(hf(N,Q))return;return u.gatherSingleTarget(Q,c[0])}return c.length>1?u.gatherMultiTargets(Q,c):!1},Om.prototype.gatherSingleTarget=function(z,B){var L=this;return L.info.POS=B.getPosition(),L.screenInfo.POS=In.toScreenPosition(z,L.info.POS),L.target=B,!0},Om.prototype.gatherMultiTargets=function(k,x){var U=this,B=In.Group.findOrCreateGroup(x,this._interactor._uuid);return B?(U.screenInfo.POS=In.toScreenPosition(k,B.getAnchor2()),U.target=B,!0):!1},Om.prototype.isVisible=function(){var o=this,M=o._interactor;if(M.getStyle("anchorVisible")===!1)return!1;var H=o.target;if(H){if(this.editing)return!0;var N=H.getAnchor(),z=M.getStyle("anchorOutsideVisibleThreshold");if(N.x<-z||N.x>1+z||N.y<-z||N.y>1+z)return!0;var s=H.getSize(),B=H.getScale(),C=Math.min(Math.abs(s.width*B.x),Math.abs(s.height*B.y));if(C*M.gv._zoom<M.getStyle("anchorHideThreshold"))return!1}return!0},Om.prototype.check=function(e,W,b){if(y.Default.isLeftButton(W)){var t=this,R=t._interactor;if(t.isVisible()&&R.getStyle("anchorMovable")!==!1){t.editing=null,t.tipInfo=null;var o=t.target;if(o&&e.isAnchorEditable(o)&&e.isEditable(o)){var r;if(t.screenInfo&&(r=t.screenInfo.POS)&&In.checkHit(b,new In.Math.Vector2(r),R.getStyle("checkSize"))){if(o instanceof In.Group)return t.editing={},!0;var N=o.getWidth(),J=o.getHeight(),j=o.getAnchor();return t.editing={rect:{x:-N*j.x,y:-J*j.y,width:N,height:J},anchor:j,matrix:o.getMatrix()},!0}}}}},Om.prototype.startEdit=function(f,V){f.startDragging(V),f.fi({kind:"beginEditAnchor",event:V})},Om.prototype._46O=function(t){var $=this;$.editing&&($.editing=null,$._interactor.fi({kind:"endEditAnchor",event:t})),$.tipInfo=null},Om.prototype.handleEdit=function(N,w){var B=this,k=B.target;if(k){var L=B.editing;if(L){var P=N.lp(w),X=B._interactor;if(k instanceof In.Group)return k.setAnchor2(P),X._42(),void 0;
var Z=L.matrix,i=Z.tfi(P),J=L.rect,m=(i.x-J.x)/J.width,t=(i.y-J.y)/J.height;if(!y.Default.isCtrlDown(w)){var g=X.getStyle("anchorRound"),T=X.getStyle("anchorSensitivity");m=In.roundTo(m,g,T),t=In.roundTo(t,g,T)}k.setAnchor(m,t,!0);var I=y.Default.getLogicalPoint(w,X._canvas);I.x+=In.Icons.TipShiftX,I.y+=In.Icons.TipShiftY;var x=""+m.toFixed(2)+", "+t.toFixed(2);B.tipInfo={helperPos:I,text:x,size:x.length},X.fi({kind:"betweenEditAnchor",event:w})}}},Om.prototype._42=function(s,r,v){var b=this;b.info={},b.screenInfo={};var H=b._interactor;H.editDetail||b.gatherInfo(r,v)&&b.isVisible()&&(In.Icons.DrawIcon(H,s,In.Icons.Anchor,b.screenInfo),b.tipInfo&&In.Icons.DrawIcon(H,s,In.Icons.TipHelper,b.tipInfo))};var Sp=In.MoveDummy=function(C){this.catalog="MoveDummy",this._interactor=C};Sp.prototype={},Sp.prototype.constructor=Sp,Sp.prototype.gatherInfo=function(){var j=this,h=this._interactor.getSubModule("Rect");if(h){var L=h.screenInfo;if(L){var Y=j._interactor,F=j.getMovableTarget(h.target);if(F){var c=Y.getStyle("moveDummyThreshold");if(c!==!1){var z=L.LT||L.P1,w=L.RT||L.P2,Q=L.LB||z;if(z){var U=L.P1,G=Math.min(z.distanceTo(Q),z.distanceTo(w));if(!(c!==!0&&G>c)){var r=Y.getStyle("moveDummyPosition"),l=w.clone().sub(z),i=Q.clone().sub(z),y=r[2],x=r[3];if(U){var I=Y.getStyle("moveDummyLineExtraShift");I&&(y+=I[0],x+=I[1])}var K=z.clone().add(l.clone().multiplyScalar(r[0])).add(l.setLength(y)).add(i.clone().multiplyScalar(r[1])).add(i.setLength(x));return j.screenInfo.pos=K,j.screenInfo.size=Y.getStyle("moveDummySensitivity"),!0}}}}}}},Sp.prototype.getMovableTarget=function(T){var h=this._interactor.gv;if(cl(T)){if(h.isMovable(T))return T}else if(T instanceof In.Group)for(var G=T._entities,R=G.length-1;R>=0;R--){var F=G[R];if(cl(F)&&h.isMovable(F))return F}return null},Sp.prototype.getMoveInteractor=function(){for(var F,N,A,n=this._interactor.gv,S=n.getInteractors(),F=0,N=S.length;N>F;F++)if(A=S.get(F),A instanceof Mc)return A},Sp.prototype.startEdit=function(H,l){H.startDragging(l);var G=this.getMoveInteractor();if(G){var m=this.selectedTarget,g=H.gv;g._moving=1,G._data=m,g.handleMouseDown&&g.handleMouseDown(l,m)}},Sp.prototype._46O=function($){var A=this,r=A.getMoveInteractor();r&&(r.handleWindowMouseUp($),A.selectedTarget=null)},Sp.prototype.handleEdit=function(o,Y){var l=this.getMoveInteractor();l&&l.handleWindowMouseMove(Y)},Sp.prototype.check=function(L,Q,f){if(this.selectedTarget=null,y.Default.isLeftButton(Q)&&!L._scrolling&&!En()){var t=this;if(t.screenInfo){var R=t.screenInfo.pos;if(R&&!(f.distanceTo(R)>t.screenInfo.size)){var I=t._interactor;return t.selectedTarget=t.getMovableTarget(I.getSubModule("Rect").target),I.setCursor("default"),!0}}}},Sp.prototype._42=function(F,X,d){var V=this;V.screenInfo={};var y=V._interactor;y.editDetail||V.gatherInfo(X,d)&&(!y.editing||V.selectedTarget)&&In.Icons.DrawIcon(y,F,In.Icons.MoveDummy,V.screenInfo)};var bi=In.RotateX=function(y){this.catalog="RotateX",this._interactor=y};bi.prototype={},bi.prototype.constructor=bi,bi.prototype.gatherInfo=function(f,G){var n=this;if(1===G.length){var H=G[0];return H instanceof y.Shape&&H._70I()||hf(H,f)?!1:n.gatherSingleTarget(f,H)}return G.length>1?n.gatherMultiTargets(f,G):!1},bi.prototype.gatherSingleTarget=function(){var f=new y.Math.Vector2,s=new y.Math.Vector2,r=new y.Math.Vector2,b=new y.Math.Vector2,h=function(U,b){var s=U.x-b.x,d=U.y-b.y;return s*s+d*d};return function(I,p){if(p.getCorners){var m=this,E=p.getCorners(),g=15,A=p.getPosition();f.copy(E[0]),r.copy(E[1]),b.copy(E[3]),s.copy(f).add(b).divideScalar(2).add(f.sub(r).setLength(g/I.getZoom()));var X=Math.max(h(A,E[0]),h(A,E[1]),h(A,E[2]),h(A,E[3]));return m.info.POS=s.clone(),m.screenInfo.POS=In.toScreenPosition(I,m.info.POS),m.screenInfo.LEN=Math.sqrt(X)*I.getZoom()+g,m.screenInfo.CENTER=In.toScreenPosition(I,A),m.target=p,!0}}}(),bi.prototype.gatherMultiTargets=function(j,o){var G=this,O=In.Group.findOrCreateGroup(o,this._interactor._uuid);if(!O)return!1;var G=this;return G.gatherSingleTarget(j,O)},bi.prototype.isVisible=function(){var O=this._interactor;if(!O.getStyle("rotateAsClock"))return!1;var g=this.target;if(!g)return!0;var Y=O.gv;return Y.isEditable(g)&&Y.isRotationEditable(g)?!0:!1},bi.prototype.check=function(G,I,F){var o=this,e=o._checkImpl(G,I,F);return(e||o._clockPainted)&&o._interactor._42(),e},bi.prototype._checkImpl=function(g,N,H){if(y.Default.isLeftButton(N)){var p=this;p.editing=null,p.tipInfo=null;var q;if(p.screenInfo&&(q=p.screenInfo.POS)&&p.isVisible()){var l=p._interactor;if(In.checkHit(H,q,l.getStyle("checkSize"))){var r=p.target,V=g.lp(N),T=r.getPosition(),e=Math.atan2(V.y-T.y,V.x-T.x);return l._setRotateCursor(e),p.editing={pos:T,rotation:r.getRotation(),hitRot:e,groupRotateMode:"block",screenInfo:{CENTER:p.screenInfo.CENTER,LEN:p.screenInfo.LEN}},!0}}}},bi.prototype.startEdit=function(F,X){F.startDragging(X),F.fi({kind:"beginEditRotation",event:X}),this.target instanceof In.Group&&this.target.beginRotate(this.editing)},bi.prototype._46O=function(n){var H=this;H.editing&&(H.editing=null,H._interactor.fi({kind:"endEditRotation",event:n})),H.target instanceof In.Group&&H.target.endRotate(),H.tipInfo=null},bi.prototype.handleEdit=function($,n){var X=this,_=X.editing;if(_){var u,J,K=X.target,w=$.lp(n),C=X._interactor,g=_.pos,V=Math.atan2(w.y-g.y,w.x-g.x),M=K instanceof In.Group;if(M?J=V-_.hitRot:(u=V-_.hitRot,J=_.rotation+u),J%=2*Math.PI,0>J&&(J+=2*Math.PI),!y.Default.isCtrlDown(n)){var I,P;oo(n)?(I=C.getStyle("shiftRotateRound"),P=I/2):(I=C.getStyle("rotateRound"),P=C.getStyle("rotateSensitivity")),J=In.roundTo(J,I,P)}M?(u=J-(_.lastRotation||0),0!==u&&(K.addRotation(u,_.groupRotateMode,function(f){return $.isRotationEditable(f)}),_.lastRotation=J)):K.setRotation(J),C._setRotateCursor(V),J>Math.PI&&(J-=2*Math.PI);var G=180*(J/Math.PI),j=""+G.toFixed(2)+"°",t=y.Default.getLogicalPoint(n,C._canvas);t.x+=In.Icons.TipShiftX,t.y+=In.Icons.TipShiftY,X.tipInfo={helperPos:t,text:j,size:j.length},C.fi({kind:"betweenEditRotation",event:n})}},bi.prototype._42=function(O,m,k){var I=this;I._clockPainted=!1,I.info={},I.screenInfo={};var n=I._interactor;n.editDetail||I.gatherInfo(m,k)&&I.isVisible()&&(In.Icons.DrawIcon(n,O,In.Icons.RoundPoint,I.screenInfo.POS),n.getStyle("rotateTipVisible")&&I.tipInfo&&In.Icons.DrawIcon(n,O,In.Icons.TipHelper,I.tipInfo),I.editing&&I.drawClock(O))},bi.prototype.drawClock=function(B){B.save();var I=this;I._clockPainted=!0;var d=I.editing||{},q=d.screenInfo||I.screenInfo,L=q.LEN,y=L+8,M=L+18;B.save(),B.translate(q.CENTER.x,q.CENTER.y),B.beginPath(),B.strokeStyle="rgb(150, 150, 150)";for(var f,K,T,h,j,o=0;360>o;o++)f=o*Math.PI/180,0===o%5&&(K=s(f)*L,T=W(f)*L,h=s(f)*y,j=W(f)*y,B.moveTo(K,T),B.lineTo(h,j)),0===o%45&&(K=s(f)*L,T=W(f)*L,h=s(f)*M,j=W(f)*M,B.moveTo(K,T),B.lineTo(h,j));B.stroke(),B.rotate(-Rd);var n=d.lastRotation||I.target.getRotation();B.beginPath(),B.fillStyle="rgba(255, 0, 0, 0.1)",B.strokeStyle="rgb(157, 157, 157)",B.moveTo(0,0),B.arc(0,0,M,0,n,!1),B.fill(),B.beginPath(),B.moveTo(0+M,0),B.arc(0,0,M,0,n,!1),B.stroke(),B.restore()};var xg=In.Curve=function(V){this.catalog="Curve",this._interactor=V};xg.prototype={},xg.prototype.constructor=xg,C.defineProperties(xg.prototype,{activing:{get:function(){return this._activing},set:function(P){var e=this;if(P)e._activing=new In.CurveActiving(this,P),e.gatherSingleTarget(e._interactor.gv,e.target);else{var q=e._activing;q&&q.dispose(),e._activing=null}}}}),xg.PointType={Mirrored:0,Straight:1,Disconnected:2,Asymmetric:3},xg.prototype.setUp=function(){var z=this,B=z._interactor;B&&B.gv.mp(z._onGraphviewPropertyChanged,z)},xg.prototype._onGraphviewPropertyChanged=function(b){("zoom"===b.property||"translateX"===b.property||"translateY"===b.property)&&this._handleDataChanged()},xg.prototype.tearDown=function(){var o=this,V=o._interactor;V&&V.gv.ump(o._onGraphviewPropertyChanged,o)},xg.prototype.canEnterEditDetailMode=function(){var m=Yo(this._interactor);return m?this.target=m:void 0},xg.prototype.canQuitEditDetailMode=function(y){var X=this,I=X._interactor._getLogicalPoint(y);return X._checkEditRealPoint(I)?void 0:X._interactor.gv.getDataAt(y)!==X.target?!0:void 0},xg.prototype.preHandleScroll=function(){var $=this.editing;return $&&$.inEdit?!0:void 0},xg.prototype.getCurrentSelectintStatus=function(){var S=this;if(S.activing&&!S.activing.selections){if(S.activing.status!=I)return S.activing.status;var g=function(I){var D=S.activing.status;S.activing.status=I,S._interactor.fp("shapePointStatus",D,I)},y=In.Curve.PointType,E=S.activing.point,O=S.activing.pairs;if(!O||1!==O.length)return g(y.Mirrored);var T=O[0],$=T.c1&&T.c1.isNearEnough(E),Q=T.c2&&T.c2.isNearEnough(E);if(!T.c1||!T.c2)return $||Q?g(y.Straight):g(y.Disconnected);if($&&Q)return g(y.Straight);if($||Q)return g(y.Asymmetric);var G=T.c1.clone().sub(E),Y=T.c2.clone().sub(E);return Math.abs(G.x*Y.y-G.y*Y.x)>1e-5||G.x*Y.x>0?g(y.Disconnected):Math.abs(G.length()-Y.length())>1e-5?g(y.Asymmetric):g(y.Mirrored)}},xg.prototype.handle_keydown=function(q){var w=this;if(w._interactor.editDetail){var P=In.Curve.PointType;"1"===q.key?w._setCurrentSelectionStatus(P.Straight):"2"===q.key?w._setCurrentSelectionStatus(P.Mirrored):"3"===q.key?w._setCurrentSelectionStatus(P.Disconnected):"4"===q.key&&w._setCurrentSelectionStatus(P.Asymmetric)}},xg.prototype.setCurrentSelectionStatus=function(X){var W=this,u=W._interactor;if(u){var Z=u.gv;Z.dm().beginTransaction(),this._setCurrentSelectionStatus(X),Z.dm().endTransaction()}},xg.prototype._setCurrentSelectionStatus=function(F){var g=this,M=g.activing;if(M){var d=g.getCurrentSelectintStatus();if(null!==d&&d!==F){M.status=F;var P=g.activing.point,q=g.activing.pairs;if(q&&1===q.length){var s=q[0],o=g.screenInfo.curve,O=In.Curve.PointType,E=g._interactor,_=function(){g._writeToHt(),E.fp("shapePointStatus",d,F),g.check(E.gv,null,new In.Math.Vector2(E._lastLogicalPoint))};if(F===O.Straight)return o.moveCtrlPoint(s,P,"c1"),o.moveCtrlPoint(s,P,"c2"),_(),void 0;if(d===O.Straight){var i=o.findPairs(P,!0),c=i[0],n=c.r1||P,p=c.r2||P,u=p.clone().sub(n).multiplyScalar(.25);return o.moveCtrlPoint(s,P.clone().sub(u),"c1"),o.moveCtrlPoint(s,P.clone().add(u),"c2"),_(),void 0}var V=s.c1,J=s.c2;if(V&&J){if(F===O.Mirrored)return o.moveCtrlPoint(s,P.clone().multiplyScalar(2).sub(J),"c1"),_(),void 0;if(F===O.Asymmetric&&d===O.Disconnected){var Q=V.clone().sub(P).length(),u=P.clone().sub(J).setLength(Q).add(P);return o.moveCtrlPoint(s,u,"c1"),_(),void 0}}M._firePointChange(),E.fp("shapePointStatus",d,F),g.check(E.gv,null,new In.Math.Vector2(E._lastLogicalPoint))}}}},xg.prototype._handleDataChanged=function(){var x="s:edge.points,s:edge.segments,points,segments,shape,position,rotation,scale".split(",");return function(N){var t=this;if(t.screenInfo&&t.target){if(N&&x.indexOf(N.property)<0)return;var G=t._interactor;t.gatherSingleTarget(G.gv,t.target,!0),t.check(G.gv,null,new In.Math.Vector2(G._lastLogicalPoint)),G._42()}}}(),xg.prototype.gatherSingleTarget=function(z,$,A){var Q,W,b=this;b.screenInfo&&b.screenInfo.curve&&(W=b.screenInfo.curve._curves);var U=b.editing;Q=U?b.screenInfo:b.screenInfo={};var S,v,V=$ instanceof y.Edge;V?(S=$.s("edge.segments"),v=$.s("edge.points")||new y.List):(S=$._58O,v=$._59O),Q.S=S;var o,Y=Q.P=[],_=In.getDataMatrix($);if($ instanceof y.Polyline||$ instanceof y.Edge&&b._interactor.getStyle("edgeElevationEditable"))o=$.getElevation&&$.getElevation()||0,Q.E=[];else{var n=!1;v.each(function(L){L.e!==I&&(n=!0)}),n&&(Q.E=[])}if(v.each(function(T){Q.E&&Q.E.push(T.e!=I?T.e:o),T=_.apply(T);var f=In.toScreenPosition(z,T);Y.push(f.x,f.y)}),V){var J=Y.length,m=In.toScreenPosition(z,$._lastSourcePoint||(J?{x:Y[0],y:Y[1]}:{x:0,y:0})),K=In.toScreenPosition(z,$._lastTargetPoint||(J?{x:Y[J-2],y:Y[J-1]}:{x:0,y:0}));if(Y.splice(0,0,m.x,m.y),Y.push(K.x,K.y),Q.E){var s=$.getSourceAgent();s instanceof y.Edge?Q.E.splice(0,0,$.s("edge.source.offset.elevation")):Q.E.splice(0,0,(($.s("edge.source.anchor.elevation")||.5)-.5)*s.getTall()*s.getScaleTall()+s.getElevation()+$.s("edge.source.offset.elevation"));var x=$.getTargetAgent();x instanceof y.Edge?Q.E.push($.s("edge.target.offset.elevation")):Q.E.push((($.s("edge.target.anchor.elevation")||.5)-.5)*x.getTall()*x.getScaleTall()+x.getElevation()+$.s("edge.target.offset.elevation"))}}if(!Q.S||!Q.S.size()){Q.S=new y.List,Q.S.add(1);for(var f=0;f<Y.length/2-1;f++)Q.S.add(2)}if((!U||A)&&b.convertToCubicBezier(W),b.activing&&(A||!b.editing||"realPoint"===b.editing.type)){var D=Q.curve.findPairs(b.activing.point);b.activing.pairs=D}},xg.prototype._convertToNewPoint=function(S,z,w,D){var T,g,X;for(T=0,g=z.length;g>T;T++){if(X=z[T],X._p1.isNearEnough(S)&&(!D||D.indexOf(X._p1)<0))return X._p1;if(X._p4.isNearEnough(S)&&(!D||D.indexOf(X._p4)<0))return X._p4}if(w)for(T=0,g=Math.min(w.length,g);g>T;T++){if(X=w[T],X._p1===S&&(!D||D.indexOf(z[T]._p1)<0))return z[T]._p1;if(X._p4===S&&(!D||D.indexOf(z[T]._p4)<0))return z[T]._p4}},xg.prototype.convertToCubicBezier=function(k){var G,Y,c=this,D=new In.Math.Curve,$=c.screenInfo;if(D.createFromHtShape($.P,$.S,$.E),$.curve=D,c.activing){var S=D._curves;G=c.activing.point,Y=c._convertToNewPoint(G,S,k);var K=[];if(Y&&(c.activing.point=Y,K.push(Y)),c.activing.selections){var w=-1,R=c.activing.selections;R.forEach(function(M){w++,Y=c._convertToNewPoint(M,S,k,K),Y&&(R[w]=Y,K.push(Y))})}}},xg.prototype.check=function(b,B,I){if(!B||bs(B)||gd(B)){var G=this;if(G._interactor.setCursor("default"),G.editing=null,G.highlight=null,G.tipInfo=null,G.edgeEditResult=null,G.screenInfo){if(En()||B&&gd(B))return G._interactor._42(),!0;if(G._checkEditCtrlPoint(I))return G._interactor._42(),!0;if(G._checkEditRealPoint(I))return G._interactor._42(),!0;if(G._checkEditElevation(I))return G._interactor._42(),!0;var N=G.screenInfo.curve,q=N.checkPoint(I,G._interactor.getStyle("curveIntersectSize"));if(q){var H=G.highlight={};H.type="insertKnot",H.bezier=q.bezier,H.point=q.intersection}return G._interactor._42(),!0}}},xg.prototype.getAdjacentBeziers=function(k){var x=this.screenInfo;if(x){var r,H,v,T=x.curve._curves,e=[],Z=I;for(r=0,H=T.length;H>r;r++)if(v=T[r],Z===I){if(v._p4.isNearEnough(k)){e.push(v),Z=r;continue}}else{if(v._p1.isNearEnough(k))return e.push(v),e;if(v._p4.isNearEnough(k)){e[0]=v,Z=r;continue}}}},xg.prototype.roundCorner=function(m){if(this.activing&&this.screenInfo){var e=this.screenInfo.curve,c=e._curves,s=this.getAdjacentBeziers(this.activing.point),A=s[1],L=A._index;A=A.insertKnot(A.getTByPercentage(m/A.length))[1],c[L]=A;var R=A.p1,x=s[0],X=x._index;x=x.insertKnot(x.getTByPercentage(1-m/x.length))[0],c[X]=x;var _=x.p4,I=this.activing.point,d=new In.Math.CubicBezier(_,I.clone().sub(_).multiplyScalar(2/3).add(_),I.clone().sub(R).multiplyScalar(2/3).add(R),R);c.splice(L,0,d),this._writeToHt(),this.activing=null,this._interactor._42()}},xg.prototype._checkEditRealPoint=function(K){var d,r,P,i,h,X,a=this,o=a.screenInfo.curve._curves,V=a._interactor.getStyle("curvePointIntersectSize"),T=1/0;for(V*=V,P=0,i=o.length;i>P;P++)d=o[P],h=d._p1,X=K.distanceToSquared(h),T>X&&(T=X,r=h),h=d._p4,X=K.distanceToSquared(h),T>X&&(T=X,r=h);if(T>V)return!1;var l=a.highlight={};return l.type="changeRealPoint",l.point=r,a.editing={type:"realPoint",point:r,shiftGuide:{point:r.clone(),dir:"x",limit:0}},a._interactor.setCursor("crosshair"),!0},xg.prototype._checkEditElevation=function(f){var L=this;if(!L._interactor.getStyle("curveElevationVisible"))return!1;var Q=L.target;if(Q instanceof y.Edge&&!L._interactor.getStyle("edgeElevationEditable"))return!1;var d=L.activing;if(!d)return!1;var $=d.getCurrentEditingPoint();if(!$)return!1;var b=L._interactor,e=b.getStyle("curveElevationGuideShift"),X=b.getStyle("curveElevationIntersectSize"),i=f.distanceToSquared({x:$.x+e[0],y:$.y+e[1]});if(!(i>X*X)){var g=L.highlight={};g.type="elevation";var r=new In.Math.Vector2(f.x,f.y,$.e);return L.editing={type:"elevation",startPoint:r},L._interactor.setCursor("crosshair"),!0}},xg.prototype._checkEditCtrlPoint=function(D){var C=this;if(C.activing&&!C.activing.selections){var l=C.getCurrentSelectintStatus();if(l!==In.Curve.PointType.Straight){var A=C.activing.pairs;if(A){var Q=C._interactor.getStyle("curvePointIntersectSize");Q*=Q;var n,x,P,S,R,Y,s,y,e,c=1/0;for(s=0,e=A.length;e>s;s++)for(S=A[s],y=0;2>y;y++)R=0===y?"c1":"c2",S[R]&&(Y=D.distanceToSquared(S[R]),c>Y&&(c=Y,n=S,x=s,P=R));if(c>Q)return!1;C.activing.hlpair=n,C.activing.hltype=P;var i=C.highlight={};return i.type="changeCtrlPoint",i.point=n[P],C.editing={type:"ctrlPoint",pair:n,pairId:x,ctrlType:P,direction:n[P].clone().sub(C.activing.point).normalize()},C._interactor.setCursor("crosshair"),!0}}}},xg.prototype.startEdit=function(W,b){W.startDragging(b);var F=this;F.highlight&&"insertKnot"===F.highlight.type&&(F.insertKnot(),F.gatherSingleTarget(F._interactor.gv,F.target),F.activing=null,F._checkEditRealPoint(F._interactor._getLogicalPoint(b)));var i=F._activing;if(i){var V=F.editing?F.editing.type:null;"ctrlPoint"===V?i.editingCtrl={pairId:F.editing.pairId,type:i.hltype}:"realPoint"===V&&(i.editingCtrl=!1)}var U=F.highlight,u=y.Default.isCtrlDown(b);if(!U||En()||gd(b)){var n=F._interactor.gv;if(!n.setFocus(b)||n._scrolling)return;return u?F._multiSelect={startPoint:n.lp(b)}:n.isPannable()&&(bs(b)||gd(b))&&(F._pan={tx:n.tx(),ty:n.ty()},W.fi({kind:"beginPan",event:b})),void 0}if("changeRealPoint"===U.type){var H,s=F.activing?F.activing.point:null,k=F.activing?F.activing.selections:null;if(u&&F.activing)s===U.point?(k?(F.activing={point:k[0]},k.length>1&&(k.splice(0,1),F.activing.selections=k)):F.activing=null,F.editing=null):k&&(H=k.indexOf(U.point))>=0?(k.length>1?k.splice(H,1):delete F.activing.selections,F.editing=null):k?(k.push(s),F.activing={point:U.point,selections:k}):F.activing={point:U.point,selections:[s]};else if(k)s===U.point||((H=k.indexOf(U.point))>=0?(k.splice(H,1,s),F.activing={point:U.point,selections:k}):F.activing={point:U.point});else{var X;s===U.point&&(X=F.activing.status),F.activing={point:U.point},X&&(F.activing.status=X)}W.fi({kind:"beginEditPoint",event:b})}},xg.prototype.insertKnot=function(){var P=this,A=P.highlight,$=P.screenInfo.curve;$.insertKnot(A.bezier,A.point.t),P._writeToHt()},xg.prototype._writeToHt=function(){var g,I,m=this,V=m.screenInfo.curve,C=V.toHtShape(),U=C.points,n=[],_=C.segments,x=m._interactor.gv;x.dm().beginTransaction();var K,h,H=m.target,b=H instanceof y.Edge,N=In.getDataMatrix(H).invert();h=H instanceof y.Polyline||b&&m._interactor.getStyle("edgeElevationEditable"),h&&(K=H.getElevation&&H.getElevation()||0);for(var X=0,q=U.length;q>X;X++)g=U[X],I=In.toWorldPosition(x,g),I=N.apply(I),isFinite(g.e)&&g.e!==K&&(I.e=g.e),n.push(I);if(H._writing=!0,b){H.s("edge.type","points"),H.setStyle("edge.segments",_),H.setStyle("edge.points",n.slice(1,n.length-1)),H.setStyle("edge.source.offset.x",0),H.setStyle("edge.source.offset.y",0),H.setStyle("edge.target.offset.x",0),H.setStyle("edge.target.offset.y",0);var A=m._nextChangeEdgeHost;delete m._nextChangeEdgeHost,A&&("source"===A.type?H.setSource(A.host):H.setTarget(A.host)),m._writeEdgeHostAnchor("source",n[0]),m._writeEdgeHostAnchor("target",n[n.length-1])}else n.length?(H.setSegments(_),H.setPoints(n,!0)):H.removeFromDataModel();x.dm().endTransaction(),delete H._writing},xg.prototype._writeEdgeHostAnchor=function(W,Z){var o=this,K=o.target,t=o._calcHostAnchor(K,W,Z);t.index!==I?(K.setStyle("edge."+W+".index",t.index),K.setStyle("edge."+W+".percent",I),K.setStyle("edge."+W+".anchor.x",I),K.setStyle("edge."+W+".anchor.y",I),K.setStyle("edge."+W+".anchor.elevation",I),K.setStyle("edge."+W+".offset.elevation",Z.e)):t.percent!==I?(K.setStyle("edge."+W+".percent",t.percent),K.setStyle("edge."+W+".index",I),K.setStyle("edge."+W+".anchor.x",I),K.setStyle("edge."+W+".anchor.y",I),K.setStyle("edge."+W+".anchor.elevation",I),K.setStyle("edge."+W+".offset.elevation",Z.e)):(K.s("edge."+W+".anchor.x",t.x),K.s("edge."+W+".anchor.y",t.y),K.s("edge."+W+".anchor.elevation",t.e),t.offsetX||t.offsetY||t.offsetElevation?(K.s("edge."+W+".offset.x",t.offsetX),K.s("edge."+W+".offset.y",t.offsetY),K.s("edge."+W+".offset.elevation",t.offsetElevation)):(K.s("edge."+W+".offset.x",0),K.s("edge."+W+".offset.y",0),K.s("edge."+W+".offset.elevation",0)))},xg.prototype._calcHostAnchor=function(N,S,W,m){m||(m="source"===S?N.getSource():N.getTarget());var T=this._interactor.gv,c=T.calculateAttachPoint(m,W);if(c)return c.info;if(lm(m)){var R=T.calculateEdgePosition(m,W);return R}var C=m.getRotation(),t=m.getAnchor();hf(m,T)&&(C=0);var k=m.getElevation(),F=m.getTall()*m.getScaleTall();k=((W.e||0)-N.s("edge."+S+".offset.elevation")-k)/F+.5;var M=m.getScale();if(C||M.x<0||M.y<0){var w=m.getMatrix(),Z=w.tfi(W),x=m.getSize();return{x:Z.x/x.width+t.x,y:Z.y/x.height+t.y,e:k}}var $=Wg(T,m),g={x:(W.x-$.x)/$.width,y:(W.y-$.y)/$.height,e:k};return g},xg.prototype._handlePanning=function(x){var X=this,h=X._pan;if(h){h.started=!0;var f=X._interactor,I=f.gv,T=f._lastClientPoint,z=oc(x),d=Gq(I,z,T);I.setTranslate(h.tx+d.x,h.ty+d.y),X.gatherSingleTarget(f.gv,X.target),f._42(),f.fi({kind:"betweenPan",event:x})}},xg.prototype.handleEdit=function(N,F){var h=this,Q=h.editing;if(h._pan)return h._handlePanning(F),void 0;if(h._multiSelect)return h._multiSelect.endPoint=N.lp(F),h._interactor.redraw(),void 0;if(Q){Q.inEdit=!0;var e,f,x,J=h._interactor._getLogicalPoint(F),_=y.Default.isCtrlDown(F),q=y.Default.isShiftDown(F),t=Q.type,z=h.activing;if(h._guideInfo=null,"ctrlPoint"===t&&q){var L=h.editing.direction.clone();e=z.point;var D=L.dot(J.clone().sub(e));J=L.setLength(D).add(e)}else if("ctrlPoint"===t||"realPoint"===t){var L;if("realPoint"===t&&q){var p=h.editing.shiftGuide;f=p.point;var Z=Math.abs(J.x-f.x),d=Math.abs(J.y-f.y);Z>d&&Z>p.limit&&"y"===p.dir&&(p.dir="x"),d>Z&&d>p.limit&&"x"===p.dir&&(p.dir="y"),L=p.dir,"x"===L?(J.y=f.y,p.limit=Math.max(p.limit,Z)):"y"===L&&(J.x=f.x,p.limit=Math.max(p.limit,d))}if(!_){var m,X=h._isEditEdgeSourceTarget();X&&(m=J.clone());var A=h._guidingToEdit(J,L),O="realPoint"===t?h._interactor.gridGuide.findClosest(J,L,!0):null,R=1/0,a=1/0;O&&(O.x&&(R=O.x),O.y&&(a=O.y));var $=!1;if(A&&(A.xList&&(Math.abs(A.x)<=Math.abs(R)?($=!0,R=A.x):delete A.xList),A.yList&&(Math.abs(A.y)<=Math.abs(a)?($=!0,a=A.y):delete A.yList),$&&(h._guideInfo=A)),isFinite(R)&&(J.x+=R),isFinite(a)&&(J.y+=a),$&&(A.v=J),X){var n=$?J.clone():null;J.copy(m);var s=h._editEdgeSourceTarget(X,J,_,n);s&&(h.edgeEditResult=s,x=s.tipText,s.isFixed&&(h._guideInfo=null))}}}var k=h.screenInfo.curve;if("realPoint"===Q.type){e=Q.point,e.e!==I&&(J.e=e.e),k.moveRealPoint(e,J),Q.point=J,h.highlight.point=J;var c=z.status,S=z.selections;if(h.activing={point:J,status:c},S){var B=J.clone().sub(e),P=0;S.forEach(function(Q){var G=Q.clone().add(B);k.moveRealPoint(Q,G),S[P++]=G}),h.activing.selections=S}}else if("ctrlPoint"===Q.type){var l=z.pairs,W=l[Q.pairId];k.moveCtrlPoint(W,J,Q.ctrlType);var r=z.status,v=In.Curve.PointType;if((r===v.Mirrored||r===v.Asymmetric)&&W.c1&&W.c2){var e=new In.Math.Vector2(z.point),G="c1"===Q.ctrlType?"c2":"c1";if(r===In.Curve.PointType.Mirrored)k.moveCtrlPoint(W,e.clone().multiplyScalar(2).sub(J),G);else if(r===v.Asymmetric){var D=W[G].clone().sub(e).length(),K=e.clone().sub(W[Q.ctrlType]).setLength(D).add(e);isNaN(K.x)||k.moveCtrlPoint(W,K,G)}}z._firePointChange()}else if("elevation"===Q.type){f=Q.startPoint;var i=f.e+(f.y-J.y)/N._zoom;h._setCurrentPointImpl("e",i),z._firePointChange(),x="E: "+In.toFixed(i)}var U=y.Default.getLogicalPoint(F,h._interactor._canvas);if(U.x+=In.Icons.TipShiftX,U.y+=In.Icons.TipShiftY,!x){var E=In.toWorldPosition(N,J);x=""+In.toFixed(E.x)+", "+In.toFixed(E.y)}h.tipInfo={helperPos:U,text:x,size:x.length},h._writeToHt(),h._interactor.fi({kind:"betweenEditPoint",event:F})}},xg.prototype._setCurrentPointImpl=function(M,P){var Y=this,o=Y._activing;if(!o)return!1;var X=Y.target;if(!X)return!1;var h=o.getCurrentEditingPoint();if(!h)return!1;var c=o.editingCtrl;if(!c)var j=h.clone();if("e"===M)h.e=P;else{var R;if("x"===M||"y"===M){var N=o._lastFirePoint;R="x"===M?{x:P,y:N?N.y:0}:{x:N?N.x:0,y:P}}else"object"==typeof M?(R=M,M.e!==I&&(h.e=M.e)):(R={x:arguments[0],y:arguments[1]},arguments[2]!==I&&(h.e=arguments[2]));var A=In.getDataMatrix(X);R=In.toScreenPosition(Y._interactor.gv,A.apply(R)),h.x=R.x,h.y=R.y}if(!c){var i=j.multiplyScalar(-1).add(h);dm(h.e)&&dm(j.e)&&(i.e=h.e-j.e);var l=Y.screenInfo.curve;l.moveCtrlDueToRealPointMovement(h,i);var e=o.selections;if(e){var b=0;e.forEach(function(U){var t=U.clone().add(i);isFinite(i.e)&&(t.e=(isFinite(U.e)?U.e:X.getElevation()||0)+i.e),l.moveRealPoint(U,t),e[b++]=t}),o.selections=e}}return!0},xg.prototype.setCurrentPoint=function(Q,p){return this._setCurrentPointImpl(Q,p)?(this._writeToHt(),!0):!1},xg.prototype._isEditEdgeSourceTarget=function(){var n=this,m=n.target;if(!(m instanceof y.Edge))return!1;var k=n.editing.point,a=n.screenInfo.curve._curves;return k===a[0]._p1?"source":k===a[a.length-1]._p4?"target":!1},xg.prototype._editEdgeSourceTarget=function(r,B,m,O){var J,S=this,C=S.target;if(J="source"===r?C.getSource():C.getTarget()){var R,k=S._interactor.gv,P=In.toWorldPosition(k,B),c=S._calcHostAnchor(C,r,P,J);if(R=c.index!==I||c.percent!==I?c.distance*k.getZoom()>S._interactor.getStyle("edgeHostEdgeMaxDistance"):S._interactor.getStyle("edgeHostDetectPerFrame")?!0:c.x<0||c.x>1||c.y<0||c.y>1?!0:!1){var j=k.getDataAt(P,function(I){return k.isSelectable(I)?k.isSourceTargetEditable(C,I,r)?C.canSetSourceTarget(I,r)?!0:!1:!1:!1});if(j){var D=S._calcHostAnchor(C,r,P,j);J=j,S._nextChangeEdgeHost={type:r,host:j},c=D}}var g,a,q,l=!1;if(m||c.x===I)(c.percent!==I||c.index!==I)&&(l=!0,a=c.point);else{var _=S._interactor.getStyle("anchorRound"),o=S._interactor.getStyle("anchorSensitivity");g=k.calculateAttachPoint(J,P),g?(c=g.info,l=!0):(O&&(c=S._calcHostAnchor(C,r,In.toWorldPosition(k,O),J)),c.x=In.roundTo(c.x,_,o),c.y=In.roundTo(c.y,_,o)),a=Hn(k,J,0,c.offsetX||0,c.offsetY||0,c.x,c.y)}a&&(q=In.toScreenPosition(k,a),B.x=q.x,B.y=q.y),S._edgeHostGuideInfo={corners:In.getTargetCornersOnScreen(k,J),attach:g?g.index:-1,host:J};var M;return c.percent!==I?M="percent: "+c.percent.toFixed(2):c.index!==I?M="index: "+c.index:(M=""+c.x.toFixed(2)+", "+c.y.toFixed(2),(c.offsetX||c.offsetY)&&(M+=" offset: "+c.offsetX.toFixed(2)+", "+c.offsetY.toFixed(2))),{host:J,anchor:c,tipText:M,isFixed:l}}},xg.prototype._guidingToEdit=function(o,P){var G,$,v=this;if(G=v.screenInfo.curve){$=G._curves;var D,S,r,j,A,q,X,C,B=1/0,z=1/0,O=[];for(v.editing&&"realPoint"===v.editing.type&&(C=v.editing.point),A=0,q=2*$.length;q>A;A++)X=$[Math.floor(A/2)][A%2?"_p4":"_p1"],O.indexOf(X)>=0||(O.push(X),C&&C===X||(r=X.x-o.x,j=X.y-o.y,Math.abs(r)<Math.abs(B)?(B=r,D=[X]):r===B&&D.push(X),Math.abs(j)<Math.abs(z)?(z=j,S=[X]):j===z&&S.push(X)));var g=v._interactor.getStyle("smartGuideThreshold");if((Math.abs(B)>g||"y"===P)&&(D=null),(Math.abs(z)>g||"x"===P)&&(S=null),D||S){var Z=!1,n={};if(D&&(Z=!0,n.xList=D,n.x=B),S&&(Z=!0,n.yList=S,n.y=z),Z)return n}}},xg.prototype._46O=function(Z){var j=this;j.editing&&(j.editing=null,j._interactor.fi({kind:"endEditPoint",event:Z})),j._guideInfo=null,j._edgeHostGuideInfo=null,j._pan&&(j._pan=null,j._interactor.fi({kind:"endPan",event:Z})),j._multiSelect&&(j._handleMultiSelect(j._multiSelect,Z),j._multiSelect=null),j.tipInfo=null,j.edgeEditResult=null},xg.prototype._handleMultiSelect=function(S,w){if(S.startPoint&&S.endPoint){var N,H,K,f,J,C,h=this,t=h._interactor,n=t.gv,j=In.toScreenPosition(n,S.startPoint),Y=In.toScreenPosition(n,S.endPoint),D=y.Default.unionPoint(j,Y),L=h.screenInfo.curve._curves,a=[],B=function(Z){Z.x>=D.x&&Z.y>=D.y&&Z.x<=D.x+D.width&&Z.y<=D.y+D.height&&a.indexOf(Z)<0&&a.push(Z)};for(N=0,H=L.length;H>N;N++)J=L[N],B(J._p1),B(J._p4);if(a.length){var Z=h.activing||{},s=Z.selections||[];Z.point&&s.push(Z.point);var X=y.Default.isShiftDown(w),e=w.altKey;if(e&&!X)for(C=a,a=[],N=0,H=C.length;H>N;N++)K=C[N],f=s.indexOf(K),f>=0&&a.push(K);for(N=0,H=s.length;H>N;N++)K=s[N],f=a.indexOf(K),f>=0?(!X||X&&e)&&(a[f]=I):a.push(K);for(C=a,a=[],N=0,H=C.length;H>N;N++)C[N]&&a.push(C[N]);H=a.length,0===H?h.activing=null:1===H?h.activing={point:a[0]}:(K=a[H-1],h.activing={point:K,selections:a.splice(0,H-1)}),t.redraw()}}},xg.prototype._canDeletePoint=function(V,N){var Z=this.target;if(!(Z instanceof y.Edge))return!0;var G=V._curves[0],O=V._curves[V._curves.length-1];return G._p1===N||O._p4===N?!1:!0},xg.prototype.handleDelete=function(){var r=this;if(r.activing&&r.screenInfo){var G=y.Default.isShiftDown(),v=r.screenInfo.curve;r._canDeletePoint(v,r.activing.point)&&v.deleteRealPoint(r.activing.point,G),r.activing.selections&&r.activing.selections.forEach(function(W){r._canDeletePoint(v,W)&&v.deleteRealPoint(W,G)}),r.activing=null,delete r.editing,delete r.tipInfo,delete r.edgeEditResult,delete r._pan,delete r._multiSelect,r._writeToHt(),r._interactor.fp("deleteShapePoint",!1,!0)}},xg.prototype.handleDoubleClick=function(W){var K=this,o=K._interactor._getLogicalPoint(W);if(K.screenInfo&&K._checkEditRealPoint(o)){var L=K.getCurrentSelectintStatus(),c=In.Curve.PointType;return L=L===c.Mirrored?c.Straight:c.Mirrored,K._setCurrentSelectionStatus(L),K._interactor._42(),!0}},xg.prototype._drawHighlight=function(U){var V=this,K=V.highlight;if(K){var o=K.bezier,X=V._interactor;o&&In.Icons.DrawIcon(X,U,In.Icons.ShapeHighlightCurve,[o._p1.x,o._p1.y,o._p2.x,o._p2.y,o._p3.x,o._p3.y,o._p4.x,o._p4.y]);var F=K.point;F&&"insertKnot"===K.type&&In.Icons.DrawIcon(X,U,In.Icons.ShapeHighlighPoint,F)}},xg.prototype._drawGuide=function(m){var T=this,$=T._guideInfo;if($){var q,h,n,K,E=$.v;for(q=0;2>q;q++)if(K=0===q?$.xList:$.yList)for(h=0,n=K.length;n>h;h++)In.Icons.DrawIcon(T._interactor,m,In.Icons.ShapeGuideLine,[E.x,E.y,K[h].x,K[h].y])}},xg.prototype._drawCurrentPoint=function(Y){var o=this;if(o.activing){var k=o.activing,e=o.getCurrentSelectintStatus(),S=o._interactor;if(e!==In.Curve.PointType.Straight){var h=k.pairs;k.hlpair,k.hltype;var i=k.selections,X=k.editingCtrl;if(h&&!i){var $,f,g;for(f=0,g=h.length;g>f;f++)$=h[f],X&&f===X.pairId&&$[X.type]?In.Icons.DrawIcon(S,Y,In.Icons.ShapeActivingCtrl,{point:$.point,c1:$.c1,c2:$.c2,hl:X.type}):In.Icons.DrawIcon(S,Y,In.Icons.ShapeActivingCtrl,$)}}In.Icons.DrawIcon(S,Y,In.Icons.ShapeHighlighRealPoint,o.activing.point),i&&i.forEach(function(u){In.Icons.DrawIcon(S,Y,In.Icons.ShapeHighlighRealPoint,u)})}},xg.prototype.clear=function(){var E=this;E.editing=null,E._guideInfo=null,E.activing=null,E.highlight=null},xg.prototype._42=function(b){var z=this;z.info={},z.editing||(z.screenInfo=null);var i=z._interactor;if(!i.editDetail)return z.clear(),void 0;var L=i.gv;if(!z.target||!L.isSelected(z.target)||!L.isVisible(z.target))return i.editDetail=!1,z.clear(),void 0;if(z.gatherSingleTarget(L,z.target),In.Icons.DrawIcon(i,b,In.Icons.ShapeBgCurve,z.screenInfo),z._interactor.getStyle("curveElevationVisible")&&(z.target instanceof y.Polyline||z.target instanceof y.Edge&&z._interactor.getStyle("edgeElevationEditable"))&&z.activing){var G=z.activing.getCurrentEditingPoint();G&&"string"!=typeof G.e&&In.Icons.DrawIcon(i,b,In.Icons.EdgeElevationGuide,G)}if(z._drawHighlight(b),z._drawCurrentPoint(b),z._getRealPoint().forEach(function(Q){In.Icons.DrawIcon(i,b,In.Icons.ShapePoint,Q)}),z._drawGuide(b),z.tipInfo&&z._interactor.getStyle("curveTipVisible")&&In.Icons.DrawIcon(i,b,In.Icons.TipHelper,z.tipInfo),z._edgeHostGuideInfo&&i._drawHostGuide(z._edgeHostGuideInfo),z.edgeEditResult&&z._drawEdgeHostHighlight(b,z.edgeEditResult.host,z.edgeEditResult.anchor),z._multiSelect&&z._multiSelect.endPoint){var E=y.Default.unionPoint(In.toScreenPosition(L,z._multiSelect.startPoint),In.toScreenPosition(L,z._multiSelect.endPoint));E.color=L.getRectSelectBorderColor(),b.save(),b.setTransform(1,0,0,1,0,0);var A=F.devicePixelRatio,K=E.borderWidth=Math.round(A);K/=2,E.x=Math.round(E.x*A)+K,E.y=Math.round(E.y*A)+K,E.width=Math.round(E.width*A),E.height=Math.round(E.height*A),In.Icons.DrawIcon(i,b,In.Icons.SimpleRect,E),b.restore()}},xg.prototype._drawEdgeHostHighlight=function(D,p,c){this.drawEdgeHostHighlight(D,p,c),this._interactor.redraw()
},xg.prototype.drawEdgeHostHighlight=function(n,L,c){if(lm(L)){var T,S,G,b,f=this,r=f._interactor,w=r.gv,N=w.getDataUI(L),t=Sj(N),p=[];for(G=0,b=t.points.length;b>G;G++)S=In.toScreenPosition(w,t.points.get(G)),p.push(S.x,S.y);t.segments&&(T=t.segments.toArray());var m=r.getStyle("edgeHostHighlighPeriod"),P=r.getStyle("edgeHostEdgeHighlighColor");In.Icons.DrawIcon(r,n,In.Icons.ShapeBgCurve,{P:p,S:T,color:P,dynamicVisible:c.index===I,dynamicPeriod:m}),P=r.getStyle("edgeHostPointHighlighColor");var B=qd(N);for(G=0,b=B.length;b>G;G++){var F=B[G],A=In.toScreenPosition(w,F);In.Icons.DrawIcon(r,n,In.Icons.ShapePoint,{point:{x:A.x,y:A.y},color:P,size:12,dynamicVisible:G===c.index,dynamicPeriod:m})}}},xg.prototype._getRealPoint=function(){var q,j=this.screenInfo,g=j.P,f=j.S,o=-1,h=[],U=-1,P=f.length;return f.each(function(v){U++;var H=1;if(3===v)H=2;else if(4===v)H=3;else if(5===v)return;o+=H,q=U+1>=P?!0:1===f.get(U+1)?!0:!1,h.push({point:{x:g[2*o],y:g[2*o+1]},segmentIndex:U,pointIndex:o,isEnd:q})}),h},xg.prototype.getEditingPointsInfo=function(S){var b=this,L=b.activing;if(!L)return!1;var d=L.point;if(!d)return!1;var c=this._getRealPoint(),y=[{screen:d}];L.selections&&L.selections.forEach(function(r){y.push({screen:r})});var H,K,f=c.length;return y.forEach(function(S){for(H=0;f>H;H++)if(K=c[H],S.screen.isNearEnough(K.point)){S.segmentIndex=K.segmentIndex,S.pointIndex=K.pointIndex,S.point=b.target.getPoints().get(K.pointIndex);break}}),S&&y.sort(function(B,l){return B.segmentIndex-l.segmentIndex}),y};var Ei=In.MoveHelper=function(T){var E=this;E.catalog="Move",E._interactor=T};Ei.prototype={},Ei.prototype.constructor=Ei,Ei.prototype.calcShift=function(S,A,p){var f,n,h=this,W=h._interactor.gv,P=W.lp(A);if("beginMove"===S&&h._gatherGridInfo(p._lastLogicalPoint||P),f=h._target){var O=f.downPosition;if(O){var T=h._interactor.getStyle("moveSensitivity")/W._zoom;if(O.distanceTo(P)<T)return{x:0,y:0};delete f.downPosition}var w;n=y.Default.isShiftDown(A),n&&(P=h._dealShiftDown(P),w=f.shiftGuide.dir);var d,Y=f.rawPos={x:f.pos.x+P.x-f.lp.x,y:f.pos.y+P.y-f.lp.y};if(y.Default.isCtrlDown(A)){if(d=h._calcShiftByAddon(),h._target.node instanceof In.Group){var L=h._target.node;L._position.x+=d.x,L._position.y+=d.y}return d}var B=h._interactor.rectGuide;if(f.node instanceof y.Data&&f.node.s("2d.attachable")){var l=h._calcAttachNodeShift(f.node,Y);if(B.clear(),l)return l}for(var z,N=f.x+Y.x,_=f.y+Y.y,c={x:N,y:_},R={x:N+f.w/2,y:_+f.h/2},F={x:N+f.w,y:_+f.h},V=h._interactor.gridGuide,q=[B.findClosest(c,w),B.findClosest(R,w),B.findClosest(F,w),V.findClosest(c,w),V.findClosest(R,w),V.findClosest(F,w)],j=1/0,Z=1/0,o=0,K=q.length;K>o;o++)z=q[o],z&&(N=z.x,_=z.y,isFinite(N)&&Math.abs(N)<Math.abs(j)&&(j=N),isFinite(_)&&Math.abs(_)<Math.abs(Z)&&(Z=_));if(isFinite(j)||(j=0),isFinite(Z)||(Z=0),d=h._calcShiftByAddon(j,Z),h._target.node instanceof In.Group){var L=h._target.node;L._position.x+=d.x,L._position.y+=d.y}var g=f.node;if(!hf(g,W)){var i=Y.x+j,D=Y.y+Z;h._interactor.rectGuide.gatherLines({node:g,x:f.x+i,y:f.y+D,w:f.w,h:f.h},w)}return d}},Ei.prototype._calcShiftByAddon=function(Z,A){var h=this._target,f=h.rawPos,v=h.node.getPosition();return Z=Z||0,A=A||0,{x:f.x-v.x+Z,y:f.y-v.y+A}},Ei.prototype._dealShiftDown=function(h){var X=this,f=X._target.shiftGuide,Y=X._target.lp,T=Math.abs(h.x-Y.x),P=Math.abs(h.y-Y.y);T>P&&T>f.limit&&"y"===f.dir&&(f.dir="x"),P>T&&P>f.limit&&"x"===f.dir&&(f.dir="y");var Q=f.dir;return"x"===Q?(h.y=Y.y,f.limit=Math.max(f.limit,T)):"y"===Q&&(h.x=Y.x,f.limit=Math.max(f.limit,P)),h},Ei.prototype._isAttachableLineShape=function(L){if(!L.getSegments)return!1;var U=L.getSegments();if(!U)return!0;U instanceof y.List&&(U=U.getArray());for(var Q=1,j=U.length;j>Q;Q++)if(2!==U[Q])return!1;return!0},Ei.prototype._calcAttachNodeShift=function(){var e=new of,X=new of,t=new of,P=new of;return function(B,n){var Y=this._interactor.gv,L=B.getHost(),f=Y.getDataAt(n,function(v){return v.s("2d.hostable")?!0:!1});if(f&&L!==f&&B.setHost(f),!f)return this._edgeHostGuideInfo=null,B.setHost(null);var d=this._edgeHostGuideInfo={corners:In.getTargetCornersOnScreen(Y,f),host:f,attach:-1};if(this._isAttachableLineShape(f)){for(var C,p,w,u,O,v,a=f.getPoints(),y=a.size(),Z=f.getPointsMatrix2d(),x=1/0,$=0;y>$&&($!==y-1||f.isClosePath());$++)0!==$?X.copy(t):Z.apply(a.get($),X),Z.apply($===y-1?a.get(0):a.get($+1),t),e.copy(n).sub(X),P.copy(t).sub(X),C=P.length(),P.divideScalar(C),p=e.dot(P),0>p?p=0:p>C&&(p=C),P.multiplyScalar(p).add(X),w=e.copy(n).sub(P).lengthSq(),x>w&&(x=w,v=$,u=p,O=C);return Math.sqrt(x)*Y.getZoom()>this._interactor.getStyle("attachThreshold")?(B.s({"attach.index":-1}),B.setHost(null),void 0):(B.s("attach.offset.opposite")&&(u=O-u),B.s({"attach.index":v,"attach.offset":B.s("attach.offset.relative")?u/O:u}),{x:0,y:0})}var j=Y.calculateAttachPoint(f,n);if(j){var U=j.point;return d.attach=j.index,this._calcShiftByAddon(U.x-n.x,U.y-n.y)}}}(),Ei.prototype._gatherGridInfo=function(c){var f,w=this,$=w._interactor,F=$._getValidSelection();if(F.length){if(1===F.length){if(f=F[0],!f.getRect)return w._target=null,void 0}else if(f=In.Group.findOrCreateGroup(F,$._uuid),!f)return w._target=null,void 0}else{var F=$.gv.sm().getSelection();if(F.length&&(f=F.get(0),!f.getRect))return w._target=null,void 0}if(f){var Z=f.getPosition(),K=f.getRect();w._target={node:f,x:K.x-Z.x,y:K.y-Z.y,w:K.width,h:K.height,lp:{x:c.x,y:c.y},pos:{x:Z.x,y:Z.y},shiftGuide:{dir:"x",limit:0},downPosition:new In.Math.Vector2(c)},$.rectGuide.gatherRects()}},Ei.prototype.clear=function(){var x=this;x._edgeHostGuideInfo=null,x._interactor.rectGuide.clear(),x._interactor._42()},Ei.prototype._42=function(){var q=this._edgeHostGuideInfo;q&&this._interactor._drawHostGuide(q)};var sm=C.freeze({DEPTH_BUFFER_BIT:256,STENCIL_BUFFER_BIT:1024,COLOR_BUFFER_BIT:16384,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA_SATURATE:776,FUNC_ADD:32774,BLEND_EQUATION:32777,BLEND_EQUATION_RGB:32777,BLEND_EQUATION_ALPHA:34877,FUNC_SUBTRACT:32778,FUNC_REVERSE_SUBTRACT:32779,BLEND_DST_RGB:32968,BLEND_SRC_RGB:32969,BLEND_DST_ALPHA:32970,BLEND_SRC_ALPHA:32971,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,BLEND_COLOR:32773,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,ARRAY_BUFFER_BINDING:34964,ELEMENT_ARRAY_BUFFER_BINDING:34965,STREAM_DRAW:35040,STATIC_DRAW:35044,DYNAMIC_DRAW:35048,BUFFER_SIZE:34660,BUFFER_USAGE:34661,CURRENT_VERTEX_ATTRIB:34342,FRONT:1028,BACK:1029,FRONT_AND_BACK:1032,CULL_FACE:2884,BLEND:3042,DITHER:3024,STENCIL_TEST:2960,DEPTH_TEST:2929,SCISSOR_TEST:3089,POLYGON_OFFSET_FILL:32823,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_COVERAGE:32928,NO_ERROR:0,INVALID_ENUM:1280,INVALID_VALUE:1281,INVALID_OPERATION:1282,OUT_OF_MEMORY:1285,CW:2304,CCW:2305,LINE_WIDTH:2849,ALIASED_POINT_SIZE_RANGE:33901,ALIASED_LINE_WIDTH_RANGE:33902,CULL_FACE_MODE:2885,FRONT_FACE:2886,DEPTH_RANGE:2928,DEPTH_WRITEMASK:2930,DEPTH_CLEAR_VALUE:2931,DEPTH_FUNC:2932,STENCIL_CLEAR_VALUE:2961,STENCIL_FUNC:2962,STENCIL_FAIL:2964,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STENCIL_BACK_FUNC:34816,STENCIL_BACK_FAIL:34817,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,VIEWPORT:2978,SCISSOR_BOX:3088,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,UNPACK_ALIGNMENT:3317,PACK_ALIGNMENT:3333,MAX_TEXTURE_SIZE:3379,MAX_VIEWPORT_DIMS:3386,SUBPIXEL_BITS:3408,RED_BITS:3410,GREEN_BITS:3411,BLUE_BITS:3412,ALPHA_BITS:3413,DEPTH_BITS:3414,STENCIL_BITS:3415,POLYGON_OFFSET_UNITS:10752,POLYGON_OFFSET_FACTOR:32824,TEXTURE_BINDING_2D:32873,SAMPLE_BUFFERS:32936,SAMPLES:32937,SAMPLE_COVERAGE_VALUE:32938,SAMPLE_COVERAGE_INVERT:32939,COMPRESSED_TEXTURE_FORMATS:34467,DONT_CARE:4352,FASTEST:4353,NICEST:4354,GENERATE_MIPMAP_HINT:33170,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DEPTH_COMPONENT:6402,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,FRAGMENT_SHADER:35632,VERTEX_SHADER:35633,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VARYING_VECTORS:36348,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_FRAGMENT_UNIFORM_VECTORS:36349,SHADER_TYPE:35663,DELETE_STATUS:35712,LINK_STATUS:35714,VALIDATE_STATUS:35715,ATTACHED_SHADERS:35717,ACTIVE_UNIFORMS:35718,ACTIVE_ATTRIBUTES:35721,SHADING_LANGUAGE_VERSION:35724,CURRENT_PROGRAM:35725,NEVER:512,LESS:513,EQUAL:514,LEQUAL:515,GREATER:516,NOTEQUAL:517,GEQUAL:518,ALWAYS:519,KEEP:7680,REPLACE:7681,INCR:7682,DECR:7683,INVERT:5386,INCR_WRAP:34055,DECR_WRAP:34056,VENDOR:7936,RENDERER:7937,VERSION:7938,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TEXTURE_2D:3553,TEXTURE:5890,TEXTURE_CUBE_MAP:34067,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,MAX_CUBE_MAP_TEXTURE_SIZE:34076,TEXTURE0:33984,TEXTURE1:33985,TEXTURE2:33986,TEXTURE3:33987,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE30:34014,TEXTURE31:34015,ACTIVE_TEXTURE:34016,REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,SAMPLER_2D:35678,SAMPLER_CUBE:35680,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,IMPLEMENTATION_COLOR_READ_TYPE:35738,IMPLEMENTATION_COLOR_READ_FORMAT:35739,COMPILE_STATUS:35713,LOW_FLOAT:36336,MEDIUM_FLOAT:36337,HIGH_FLOAT:36338,LOW_INT:36339,MEDIUM_INT:36340,HIGH_INT:36341,FRAMEBUFFER:36160,RENDERBUFFER:36161,RGBA4:32854,RGB5_A1:32855,RGB565:36194,DEPTH_COMPONENT16:33189,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,DEPTH_STENCIL:34041,RENDERBUFFER_WIDTH:36162,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_STENCIL_SIZE:36181,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,COLOR_ATTACHMENT0:36064,DEPTH_ATTACHMENT:36096,STENCIL_ATTACHMENT:36128,DEPTH_STENCIL_ATTACHMENT:33306,NONE:0,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_UNSUPPORTED:36061,FRAMEBUFFER_BINDING:36006,RENDERBUFFER_BINDING:36007,MAX_RENDERBUFFER_SIZE:34024,INVALID_FRAMEBUFFER_OPERATION:1286,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,HALF_FLOAT_OES:36193,DOUBLE:5130,READ_BUFFER:3074,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_ROWS:3315,UNPACK_SKIP_PIXELS:3316,PACK_ROW_LENGTH:3330,PACK_SKIP_ROWS:3331,PACK_SKIP_PIXELS:3332,COLOR:6144,DEPTH:6145,STENCIL:6146,RED:6403,RGB8:32849,RGBA8:32856,RGB10_A2:32857,TEXTURE_BINDING_3D:32874,UNPACK_SKIP_IMAGES:32877,UNPACK_IMAGE_HEIGHT:32878,TEXTURE_3D:32879,TEXTURE_WRAP_R:32882,MAX_3D_TEXTURE_SIZE:32883,UNSIGNED_INT_2_10_10_10_REV:33640,MAX_ELEMENTS_VERTICES:33e3,MAX_ELEMENTS_INDICES:33001,TEXTURE_MIN_LOD:33082,TEXTURE_MAX_LOD:33083,TEXTURE_BASE_LEVEL:33084,TEXTURE_MAX_LEVEL:33085,MIN:32775,MAX:32776,DEPTH_COMPONENT24:33190,MAX_TEXTURE_LOD_BIAS:34045,TEXTURE_COMPARE_MODE:34892,TEXTURE_COMPARE_FUNC:34893,CURRENT_QUERY:34917,QUERY_RESULT:34918,QUERY_RESULT_AVAILABLE:34919,STREAM_READ:35041,STREAM_COPY:35042,STATIC_READ:35045,STATIC_COPY:35046,DYNAMIC_READ:35049,DYNAMIC_COPY:35050,MAX_DRAW_BUFFERS:34852,DRAW_BUFFER0:34853,DRAW_BUFFER1:34854,DRAW_BUFFER2:34855,DRAW_BUFFER3:34856,DRAW_BUFFER4:34857,DRAW_BUFFER5:34858,DRAW_BUFFER6:34859,DRAW_BUFFER7:34860,DRAW_BUFFER8:34861,DRAW_BUFFER9:34862,DRAW_BUFFER10:34863,DRAW_BUFFER11:34864,DRAW_BUFFER12:34865,DRAW_BUFFER13:34866,DRAW_BUFFER14:34867,DRAW_BUFFER15:34868,MAX_FRAGMENT_UNIFORM_COMPONENTS:35657,MAX_VERTEX_UNIFORM_COMPONENTS:35658,SAMPLER_3D:35679,SAMPLER_2D_SHADOW:35682,FRAGMENT_SHADER_DERIVATIVE_HINT:35723,PIXEL_PACK_BUFFER:35051,PIXEL_UNPACK_BUFFER:35052,PIXEL_PACK_BUFFER_BINDING:35053,PIXEL_UNPACK_BUFFER_BINDING:35055,FLOAT_MAT2x3:35685,FLOAT_MAT2x4:35686,FLOAT_MAT3x2:35687,FLOAT_MAT3x4:35688,FLOAT_MAT4x2:35689,FLOAT_MAT4x3:35690,SRGB:35904,SRGB8:35905,SRGB8_ALPHA8:35907,COMPARE_REF_TO_TEXTURE:34894,RGBA32F:34836,RGB32F:34837,RGBA16F:34842,RGB16F:34843,VERTEX_ATTRIB_ARRAY_INTEGER:35069,MAX_ARRAY_TEXTURE_LAYERS:35071,MIN_PROGRAM_TEXEL_OFFSET:35076,MAX_PROGRAM_TEXEL_OFFSET:35077,MAX_VARYING_COMPONENTS:35659,TEXTURE_2D_ARRAY:35866,TEXTURE_BINDING_2D_ARRAY:35869,R11F_G11F_B10F:35898,UNSIGNED_INT_10F_11F_11F_REV:35899,RGB9_E5:35901,UNSIGNED_INT_5_9_9_9_REV:35902,TRANSFORM_FEEDBACK_BUFFER_MODE:35967,MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS:35968,TRANSFORM_FEEDBACK_VARYINGS:35971,TRANSFORM_FEEDBACK_BUFFER_START:35972,TRANSFORM_FEEDBACK_BUFFER_SIZE:35973,TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN:35976,RASTERIZER_DISCARD:35977,MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS:35978,MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS:35979,INTERLEAVED_ATTRIBS:35980,SEPARATE_ATTRIBS:35981,TRANSFORM_FEEDBACK_BUFFER:35982,TRANSFORM_FEEDBACK_BUFFER_BINDING:35983,RGBA32UI:36208,RGB32UI:36209,RGBA16UI:36214,RGB16UI:36215,RGBA8UI:36220,RGB8UI:36221,RGBA32I:36226,RGB32I:36227,RGBA16I:36232,RGB16I:36233,RGBA8I:36238,RGB8I:36239,RED_INTEGER:36244,RGB_INTEGER:36248,RGBA_INTEGER:36249,SAMPLER_2D_ARRAY:36289,SAMPLER_2D_ARRAY_SHADOW:36292,SAMPLER_CUBE_SHADOW:36293,UNSIGNED_INT_VEC2:36294,UNSIGNED_INT_VEC3:36295,UNSIGNED_INT_VEC4:36296,INT_SAMPLER_2D:36298,INT_SAMPLER_3D:36299,INT_SAMPLER_CUBE:36300,INT_SAMPLER_2D_ARRAY:36303,UNSIGNED_INT_SAMPLER_2D:36306,UNSIGNED_INT_SAMPLER_3D:36307,UNSIGNED_INT_SAMPLER_CUBE:36308,UNSIGNED_INT_SAMPLER_2D_ARRAY:36311,DEPTH_COMPONENT32F:36012,DEPTH32F_STENCIL8:36013,FLOAT_32_UNSIGNED_INT_24_8_REV:36269,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE:33297,FRAMEBUFFER_ATTACHMENT_RED_SIZE:33298,FRAMEBUFFER_ATTACHMENT_GREEN_SIZE:33299,FRAMEBUFFER_ATTACHMENT_BLUE_SIZE:33300,FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE:33301,FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE:33302,FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE:33303,FRAMEBUFFER_DEFAULT:33304,UNSIGNED_INT_24_8:34042,DEPTH24_STENCIL8:35056,UNSIGNED_NORMALIZED:35863,DRAW_FRAMEBUFFER_BINDING:36006,READ_FRAMEBUFFER:36008,DRAW_FRAMEBUFFER:36009,READ_FRAMEBUFFER_BINDING:36010,RENDERBUFFER_SAMPLES:36011,FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER:36052,MAX_COLOR_ATTACHMENTS:36063,COLOR_ATTACHMENT1:36065,COLOR_ATTACHMENT2:36066,COLOR_ATTACHMENT3:36067,COLOR_ATTACHMENT4:36068,COLOR_ATTACHMENT5:36069,COLOR_ATTACHMENT6:36070,COLOR_ATTACHMENT7:36071,COLOR_ATTACHMENT8:36072,COLOR_ATTACHMENT9:36073,COLOR_ATTACHMENT10:36074,COLOR_ATTACHMENT11:36075,COLOR_ATTACHMENT12:36076,COLOR_ATTACHMENT13:36077,COLOR_ATTACHMENT14:36078,COLOR_ATTACHMENT15:36079,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:36182,MAX_SAMPLES:36183,HALF_FLOAT:5131,RG:33319,RG_INTEGER:33320,R8:33321,RG8:33323,R16F:33325,R32F:33326,RG16F:33327,RG32F:33328,R8I:33329,R8UI:33330,R16I:33331,R16UI:33332,R32I:33333,R32UI:33334,RG8I:33335,RG8UI:33336,RG16I:33337,RG16UI:33338,RG32I:33339,RG32UI:33340,VERTEX_ARRAY_BINDING:34229,R8_SNORM:36756,RG8_SNORM:36757,RGB8_SNORM:36758,RGBA8_SNORM:36759,SIGNED_NORMALIZED:36764,COPY_READ_BUFFER:36662,COPY_WRITE_BUFFER:36663,COPY_READ_BUFFER_BINDING:36662,COPY_WRITE_BUFFER_BINDING:36663,UNIFORM_BUFFER:35345,UNIFORM_BUFFER_BINDING:35368,UNIFORM_BUFFER_START:35369,UNIFORM_BUFFER_SIZE:35370,MAX_VERTEX_UNIFORM_BLOCKS:35371,MAX_FRAGMENT_UNIFORM_BLOCKS:35373,MAX_COMBINED_UNIFORM_BLOCKS:35374,MAX_UNIFORM_BUFFER_BINDINGS:35375,MAX_UNIFORM_BLOCK_SIZE:35376,MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS:35377,MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS:35379,UNIFORM_BUFFER_OFFSET_ALIGNMENT:35380,ACTIVE_UNIFORM_BLOCKS:35382,UNIFORM_TYPE:35383,UNIFORM_SIZE:35384,UNIFORM_BLOCK_INDEX:35386,UNIFORM_OFFSET:35387,UNIFORM_ARRAY_STRIDE:35388,UNIFORM_MATRIX_STRIDE:35389,UNIFORM_IS_ROW_MAJOR:35390,UNIFORM_BLOCK_BINDING:35391,UNIFORM_BLOCK_DATA_SIZE:35392,UNIFORM_BLOCK_ACTIVE_UNIFORMS:35394,UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES:35395,UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER:35396,UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER:35398,INVALID_INDEX:4294967295,MAX_VERTEX_OUTPUT_COMPONENTS:37154,MAX_FRAGMENT_INPUT_COMPONENTS:37157,MAX_SERVER_WAIT_TIMEOUT:37137,OBJECT_TYPE:37138,SYNC_CONDITION:37139,SYNC_STATUS:37140,SYNC_FLAGS:37141,SYNC_FENCE:37142,SYNC_GPU_COMMANDS_COMPLETE:37143,UNSIGNALED:37144,SIGNALED:37145,ALREADY_SIGNALED:37146,TIMEOUT_EXPIRED:37147,CONDITION_SATISFIED:37148,WAIT_FAILED:37149,SYNC_FLUSH_COMMANDS_BIT:1,VERTEX_ATTRIB_ARRAY_DIVISOR:35070,ANY_SAMPLES_PASSED:35887,ANY_SAMPLES_PASSED_CONSERVATIVE:36202,SAMPLER_BINDING:35097,RGB10_A2UI:36975,INT_2_10_10_10_REV:36255,TRANSFORM_FEEDBACK:36386,TRANSFORM_FEEDBACK_PAUSED:36387,TRANSFORM_FEEDBACK_ACTIVE:36388,TRANSFORM_FEEDBACK_BINDING:36389,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_SRGB8_ETC2:37493,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37494,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37495,COMPRESSED_RGBA8_ETC2_EAC:37496,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37497,TEXTURE_IMMUTABLE_FORMAT:37167,MAX_ELEMENT_INDEX:36203,TEXTURE_IMMUTABLE_LEVELS:33503,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047}),rk=function(){function V(s,C){var q=I;return function(){return q||(q=s.getExtension(C)),q}}function $(S,c){c==I&&(c={}),c.version=W&&(S instanceof WebGL2RenderingContext||C.prototype.toString.call(S)===J)?2:1,c.extensions=function(){for(var t={},Y=S.getSupportedExtensions(),F=Y.length;F--;)t[Y[F]]=V(S,Y[F]);return t}();for(var u=C.keys(w),p=0,n=u.length;n>p;++p){var x=u[p];c[x]=S.getParameter(w[x])}if(c.version>1){u=C.keys(O);for(var p=0,n=u.length;n>p;++p){var x=u[p];c[x]=S.getParameter(O[x])}}return c}var W="undefined"!=typeof WebGL2RenderingContext,J="[object WebGL2RenderingContext]",w={aliasedLineWidthRange:sm.ALIASED_LINE_WIDTH_RANGE,aliasedPointSizeRange:sm.ALIASED_POINT_SIZE_RANGE,maxCombinedTextureImageUnits:sm.MAX_COMBINED_TEXTURE_IMAGE_UNITS,maxCubeMapTextureSize:sm.MAX_CUBE_MAP_TEXTURE_SIZE,maxFragmentUniformVectors:sm.MAX_FRAGMENT_UNIFORM_VECTORS,maxRenderBufferSize:sm.MAX_RENDERBUFFER_SIZE,maxTextureImageUnits:sm.MAX_TEXTURE_IMAGE_UNITS,maxTextureSize:sm.MAX_TEXTURE_SIZE,maxVaryingVectors:sm.MAX_VARYING_VECTORS,maxVertexAttribs:sm.MAX_VERTEX_ATTRIBS,maxVertexTextureImageUnits:sm.MAX_VERTEX_TEXTURE_IMAGE_UNITS,maxVertexUniformVectors:sm.MAX_VERTEX_UNIFORM_VECTORS,maxViewportDIMs:sm.MAX_VIEWPORT_DIMS},O={max3DTextureSize:sm.MAX_3D_TEXTURE_SIZE,maxArrayTextureLayers:sm.MAX_ARRAY_TEXTURE_LAYERS,maxColorAttachments:sm.MAX_COLOR_ATTACHMENTS,maxCombinedFragmentUniformComponents:sm.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS,maxCombinedUniformBlocks:sm.MAX_COMBINED_UNIFORM_BLOCKS,maxCombinedVertexUniformComponents:sm.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS,maxDrawBuffers:sm.MAX_DRAW_BUFFERS,maxElementIndex:sm.MAX_ELEMENT_INDEX,maxElementsIndices:sm.MAX_ELEMENTS_INDICES,maxElementsVertices:sm.MAX_ELEMENTS_VERTICES,maxFragmentInpuComponents:sm.MAX_FRAGMENT_INPUT_COMPONENTS,maxFragmentUniformBlocks:sm.MAX_FRAGMENT_UNIFORM_BLOCKS,maxFragmentUniformComponents:sm.MAX_FRAGMENT_UNIFORM_COMPONENTS,maxProgramTexelOffset:sm.MAX_PROGRAM_TEXEL_OFFSET,maxSamples:sm.MAX_SAMPLES,maxTextureLODBias:sm.MAX_TEXTURE_LOD_BIAS,maxTransformFeedbackInterleavedComponents:sm.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS,maxTransformFeedbackSeparateAttribs:sm.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS,maxTransformFeedbackSeparateComponents:sm.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS,maxUniformBlockSize:sm.MAX_UNIFORM_BLOCK_SIZE,maxUniformBufferBindings:sm.MAX_UNIFORM_BUFFER_BINDINGS,maxVaryingComponents:sm.MAX_VARYING_COMPONENTS,maxVertexOutputComponents:sm.MAX_VERTEX_OUTPUT_COMPONENTS,maxVertexUniformBlocks:sm.MAX_VERTEX_UNIFORM_BLOCKS,maxVertexUniformComponents:sm.MAX_VERTEX_UNIFORM_COMPONENTS,minProgramTexelOffset:sm.MIN_PROGRAM_TEXEL_OFFSET};return{"for":function(k){var _=k._info;return _||(k._info=_=$(k,_)),_}}}(),Tg=function(){function y(O,n,L){return{def:O,getter:L?function(K){var r=rk.for(K);return r.version>1?K.getParameter(n):O}:function(L){return L.getParameter(n)},setter:L?function(M,o){var N=rk.for(M);N.version>1&&M.pixelStorei(n,o)}:function(d,I){d.pixelStorei(n,I)}}}function P(R){return"string"==typeof R?Ng(R):R.r!==I?(Y[0]=R.r,Y[1]=R.g,Y[2]=R.b,Y[3]=R.a,Y):R.red!==I?(Y[0]=R.red,Y[1]=R.green,Y[2]=R.blue,Y[3]=R.alpha,Y):R}function o(d){return Z(d)?Array.prototype.slice.call(d,0):d}function H(s,E,i){this.gl=E,this._record=i||{},this._branches={},this._leafSync={},this._struct=s;for(var F=s.children,m=F.length;m--;){var K=F[m],V=K.name;K.isLeaf?(this._leafSync[V]=!1,this._record[V]=o(K.desc.def)):this._record[V]={}}}function O(W){function Q(D,o){H.call(this,W,D,o);for(var N=G.length;N--;){var J=G[N];this._branches[J._name]=new J._type(D,this._record[J._name])}}function P(q,X){function s(j,C){for(var K=v,E=!1;K--;)j[K]!==C[K]&&(j[K]=C[K],E=!0);return E}var T=q.name,I=Z(q.desc.def),v=I&&q.desc.def.length;if(q.isLeaf){var i=q.desc.setter,p=q.desc.parse;C.defineProperty(X,T,{configurable:!1,enumerable:!0,get:function(){return this._record[T]},set:I?function(q){p&&(q=p(q)),(s(this._record[T],q)||!this._leafSync[T])&&(i(this.gl,this._record[T]),this._leafSync[T]=!0)}:function(x){this._record[T]===x&&this._leafSync[T]||(i(this.gl,x),this._record[T]=x,this._leafSync[T]=!0)}})}else G.push({_name:T,_type:O(q)}),C.defineProperty(X,T,{configurable:!1,enumerable:!0,get:function(){return this._branches[T]},set:function(q){this._branches[T].apply(q)}})}var G=[];return l(Q,H),W.forEach(P,Q.prototype),Q}var Y="undefined"!=typeof Float32Array&&new Float32Array(4),q={viewport:{def:[0,0,0/0,0/0],getter:function(t){return t.getParameter(t.VIEWPORT)},setter:function(A,T){var k=T[2]!==T[2]?A.drawingBufferWidth-T[0]:T[2],B=T[3]!==T[3]?A.drawingBufferHeight-T[1]:T[3];A.viewport(T[0],T[1],k,B)}},dither:{def:!1,getter:function(Y){return Y.isEnabled(Y.DITHER)},setter:function(i,T){T?i.enable(i.DITHER):i.disable(i.DITHER)}},rasterizerDiscard:{def:!1,getter:function(n){var Z=rk.for(n);return Z.version>1&&n.isEnabled(n.RASTERIZER_DISCARD)},setter:function(k,o){var S=rk.for(k);1!==S.version&&(o?k.enable(k.RASTERIZER_DISCARD):k.disable(k.RASTERIZER_DISCARD))}},lineWidth:{def:1,getter:function(T){return T.lineWidth?T.getParameter(T.LINE_WIDTH):1},setter:function(n,P){n.lineWidth&&n.lineWidth(P)}},color:{clear:{def:[0,0,0,0],getter:function(K){return K.getParameter(K.COLOR_CLEAR_VALUE)},setter:function(S,G){S.clearColor(G[0],G[1],G[2],G[3])},parse:P},mask:{def:[!0,!0,!0,!0],getter:function(c){return c.getParameter(c.COLOR_WRITEMASK)},setter:function(Y,k){Y.colorMask(k[0],k[1],k[2],k[3])}}},blend:{enabled:{def:!1,getter:function(n){return n.isEnabled(n.BLEND)},setter:function(p,u){u?p.enable(p.BLEND):p.disable(p.BLEND)}},color:{def:[0,0,0,0],getter:function(j){return j.getParameter(j.BLEND_COLOR)},setter:function(_,X){_.blendColor(X[0],X[1],X[2],X[3])},parse:P},equation:{def:[sm.FUNC_ADD,sm.FUNC_ADD],getter:function(w){return[w.getParameter(w.BLEND_EQUATION_RGB),w.getParameter(w.BLEND_EQUATION_ALPHA)]},setter:function(R,I){R.blendEquationSeparate(I[0],I[1])},parse:function(e){var S=e.length;return S>1?e:1===S?(Y[1]=Y[0]=e[0],Y):(Y[1]=Y[0]=e,Y)}},func:{def:[sm.ONE,sm.ZERO,sm.ONE,sm.ZERO],getter:function(b){return[b.getParameter(b.BLEND_SRC_RGB),b.getParameter(b.BLEND_DST_RGB),b.getParameter(b.BLEND_SRC_ALPHA),b.getParameter(b.BLEND_DST_ALPHA)]},setter:function(h,I){h.blendFuncSeparate(I[0],I[1],I[2],I[3])},parse:function(C){var p=C.length;return p>3?C:(Y[2]=Y[0]=C[0],Y[3]=Y[1]=C[1],Y)}}},cullFace:{enabled:{def:!1,getter:function(D){return D.isEnabled(D.CULL_FACE)},setter:function(B,c){c?B.enable(B.CULL_FACE):B.disable(B.CULL_FACE)}},mode:{def:sm.BACK,getter:function(y){return y.getParameter(y.CULL_FACE_MODE)},setter:function(P,V){P.cullFace(V)}},frontFace:{def:sm.CCW,getter:function(Y){return Y.getParameter(Y.FRONT_FACE)},setter:function(j,x){j.frontFace(x)}}},scissor:{enabled:{def:!1,getter:function($){return $.isEnabled($.SCISSOR_TEST)},setter:function(w,e){e?w.enable(w.SCISSOR_TEST):w.disable(w.SCISSOR_TEST)}},box:{def:[0,0,0/0,0/0],getter:function(s){return s.getParameter(s.SCISSOR_BOX)},setter:function(y,V){var p=V[2]!==V[2]?y.drawingBufferWidth-V[0]:V[2],U=V[3]!==V[3]?y.drawingBufferHeight-V[1]:V[3];y.scissor(V[0],V[1],p,U)}}},depth:{enabled:{def:!1,getter:function(f){return f.isEnabled(f.DEPTH_TEST)},setter:function($,E){E?$.enable($.DEPTH_TEST):$.disable($.DEPTH_TEST)}},clear:{def:1,getter:function(f){return f.getParameter(f.DEPTH_CLEAR_VALUE)},setter:function(G,x){G.clearDepth(x)}},mask:{def:!0,getter:function(p){return p.getParameter(p.DEPTH_WRITEMASK)},setter:function(M,U){M.depthMask(U)}},range:{def:[-1,1],getter:function(X){return X.getParameter(X.DEPTH_RANGE)},setter:function(Z,m){Z.depthRange(m[0],m[1])}},func:{def:sm.LESS,getter:function(c){return c.getParameter(c.DEPTH_FUNC)},setter:function(q,K){q.depthFunc(K)}}},stencil:{enabled:{def:!1,getter:function($){return $.isEnabled($.STENCIL_TEST)},setter:function(N,i){i?N.enable(N.STENCIL_TEST):N.disable(N.STENCIL_TEST)}},clear:{def:0,getter:function(O){return O.getParameter(O.STENCIL_CLEAR_VALUE)},setter:function(m,I){m.clearStencil(I)}},frontMask:{def:255,getter:function(V){return V.getParameter(V.STENCIL_WRITEMASK)},setter:function(Z,z){Z.stencilMaskSeparate(Z.FRONT,z)}},frontOp:{def:[sm.KEEP,sm.KEEP,sm.KEEP],getter:function(J){return[J.getParameter(J.STENCIL_FAIL),J.getParameter(J.STENCIL_PASS_DEPTH_FAIL),J.getParameter(J.STENCIL_PASS_DEPTH_PASS)]},setter:function(M,k){M.stencilOpSeparate(M.FRONT,k[0],k[1],k[2])}},frontFunc:{def:[sm.ALWAYS,0,255],getter:function(U){return[U.getParameter(U.STENCIL_FUNC),U.getParameter(U.STENCIL_REF),U.getParameter(U.STENCIL_VALUE_MASK)]},setter:function(d,x){d.stencilFuncSeparate(d.FRONT,x[0],x[1],x[2])}},backMask:{def:255,getter:function(Q){return Q.getParameter(Q.STENCIL_BACK_WRITEMASK)},setter:function(e,N){e.stencilMaskSeparate(e.BACK,N)}},backOp:{def:[sm.KEEP,sm.KEEP,sm.KEEP],getter:function($){return[$.getParameter($.STENCIL_BACK_FAIL),$.getParameter($.STENCIL_BACK_PASS_DEPTH_FAIL),$.getParameter($.STENCIL_BACK_PASS_DEPTH_PASS)]},setter:function(B,h){B.stencilOpSeparate(B.BACK,h[0],h[1],h[2])}},backFunc:{def:[sm.ALWAYS,0,255],getter:function(F){return[F.getParameter(F.STENCIL_BACK_FUNC),F.getParameter(F.STENCIL_BACK_REF),F.getParameter(F.STENCIL_BACK_VALUE_MASK)]},setter:function(X,W){X.stencilFuncSeparate(X.BACK,W[0],W[1],W[2])}}},hint:{generateMipmap:{def:sm.DONT_CARE,getter:function(W){return W.getParameter(W.GENERATE_MIPMAP_HINT)},setter:function(F,k){F.hint(F.GENERATE_MIPMAP_HINT,k)}},fragmentShaderDerivative:{def:sm.DONT_CARE,getter:function(f){var y=rk.for(f);return 1!==y.version||y.extensions.OES_standard_derivatives?f.getParameter(sm.FRAGMENT_SHADER_DERIVATIVE_HINT):sm.DONT_CARE},setter:function(E,R){var d=rk.for(E);return d.version>1||d.extensions.OES_standard_derivatives?(E.hint(sm.FRAGMENT_SHADER_DERIVATIVE_HINT,R),void 0):void 0}}},pixelStore:{packAlignment:y(4,sm.PACK_ALIGNMENT,!1),unpackAlignment:y(4,sm.UNPACK_ALIGNMENT,!1),unpackFlipY:y(!1,sm.UNPACK_FLIP_Y_WEBGL,!1),unpackPremultiplyAlpha:y(!1,sm.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),unpackColorspaceConversion:y(sm.BROWSER_DEFAULT_WEBGL,sm.UNPACK_COLORSPACE_CONVERSION_WEBGL,!1),packRowLength:y(0,sm.PACK_ROW_LENGTH,!0),packSkipPixels:y(0,sm.PACK_SKIP_PIXELS,!0),packSkipRows:y(0,sm.PACK_SKIP_ROWS,!0),unpackRowLength:y(0,sm.UNPACK_ROW_LENGTH,!0),unpackImageHeight:y(0,sm.UNPACK_IMAGE_HEIGHT,!0),unpackSkipPixels:y(0,sm.UNPACK_SKIP_PIXELS,!0),unpackSkipRows:y(0,sm.UNPACK_SKIP_ROWS,!0),unpackSkipImages:y(0,sm.UNPACK_SKIP_IMAGES,!0)},polygonOffset:{enabled:{def:!1,getter:function(i){return i.isEnabled(i.POLYGON_OFFSET_FILL)},setter:function(h,i){i?h.enable(h.POLYGON_OFFSET_FILL):h.disable(h.POLYGON_OFFSET_FILL)}},value:{def:[0,0],getter:function(W){return[W.getParameter(W.POLYGON_OFFSET_FACTOR),W.getParameter(W.POLYGON_OFFSET_UNITS)]},setter:function(E,B){E.polygonOffset(B[0],B[1])}}},sampleCoverage:{enabled:{def:!1,getter:function(k){return k.isEnabled(k.SAMPLE_COVERAGE)},setter:function(d,O){O?d.enable(d.SAMPLE_COVERAGE):d.disable(d.SAMPLE_COVERAGE)}},alpha:{def:!1,getter:function(Q){return Q.isEnabled(Q.SAMPLE_ALPHA_TO_COVERAGE)},setter:function(P,W){W?P.enable(P.SAMPLE_ALPHA_TO_COVERAGE):P.disable(P.SAMPLE_ALPHA_TO_COVERAGE)}},value:{def:[1,!1],getter:function(d){return[d.getParameter(d.SAMPLE_COVERAGE_VALUE),d.getParameter(d.SAMPLE_COVERAGE_INVERT)]},setter:function(J,X){J.sampleCoverage(X[0],X[1])}}}},w=Lb.create(q,function(m){return"def"in m});H.prototype.reset=function(){for(var X=this._struct.children,A=X.length;A--;){var x=X[A],g=x.name;x.isLeaf?this[g]=x.desc.def:this._branches[g].reset()}},H.prototype.save=function(X){X==I&&(X={});for(var d=this._struct.children,b=d.length;b--;){var L=d[b],a=L.name;if(L.isLeaf)X[a]=o(this._record[a]);else{var N=X[a];N==I&&(X[a]=N={}),this._branches[a].save(N)}}return X},H.prototype.sync=function(D,b){for(var T=this._struct.children,h=T.length;h--;){var e=T[h],M=e.name;e.isLeaf?(b||!this._leafSync[M])&&(D?(this._record[M]=e.desc.getter(this.gl),this._leafSync[M]=!0):(e.desc.setter(this.gl,this._record[M]),this._leafSync[M]=!0)):this._branches[M].sync(D,b)}},H.prototype.syncLoss=function(){for(var r=this._struct.children,K=r.length;K--;){var P=r[K];P.isLeaf?this._leafSync[P.name]=!1:this._branches[P.name].syncLoss()}},H.prototype.apply=function(N){for(var M=this._struct.children,U=M.length;U--;){var l=M[U],z=l.name;z in N&&(l.isLeaf?this[z]=N[z]:this._branches[z].apply(N[z]))}},H.prototype.append=function(M){var p=this._struct.childMap;for(var s in M){var N=p[s];N&&(N.isLeaf?this[s]=M[s]:this._branches[s].append(M[s]))}};var R=O(w);return function(P){var s=P._state;return s||(P._state=s=new R(P)),s}}(),gn=function(){function a(R,z,e,M){if(R){var F=R.length;if(F!=I)for(var k=0;M>k;++k)z[e+k]=R[k];else R.toArray&&R.toArray(z,e)}else for(var k=0;M>k;++k)z[e+k]=0}function f(p,R,n){var E=p[0];if(0>=E||E>0)return p;var g=R*n,O=_[g];if(O==I&&(_[g]=O=new Float32Array(g)),0!==R){a(E,O,0,n);for(var m=1,D=0;m!==R;++m)D+=n,a(p[m],O,D,n)}return O}function o(w,D){w.uniform1f(this.addr,D)}function P(w,t){w.uniform1fv(this.addr,t)
}function K(L,y){if(y.x!=I)L.uniform2f(this.addr,y.x,y.y);else{var Y=_[2];Y.set(y,0),L.uniform2fv(this.addr,Y)}}function S(M,F){M.uniform2fv(this.addr,f(F,this.size,2))}function g(p,g){if(g.x!=I)p.uniform3f(this.addr,g.x,g.y,g.z);else if(g.r!=I)p.uniform3f(this.addr,g.r,g.g,g.b);else if(g.red!=I)p.uniform3f(this.addr,g.red,g.green,g.blue);else{var l=_[3];l.set(g,0),p.uniform3fv(this.addr,l)}}function X(g,s){g.uniform3fv(this.addr,f(s,this.size,3))}function J(S,W){if("string"==typeof W&&(W=Ng(W)),W.x!=I)S.uniform4f(this.addr,W.x,W.y,W.z,W.w);else if(W.r!=I)S.uniform4f(this.addr,W.r,W.g,W.b,W.a);else if(W.red!=I)S.uniform4f(this.addr,W.red,W.green,W.blue,W.alpha);else{var Y=_[4];Y.set(W,0),S.uniform4fv(this.addr,Y)}}function y(w,N){w.uniform4fv(this.addr,f(N,this.size,4))}function d(T,C){T.uniform1i(this.addr,C)}function k(k,Q){k.uniform1iv(this.addr,Q)}function Q(V,q){V.uniform2iv(this.addr,q)}function Y(s,r){s.uniform3iv(this.addr,r)}function u(s,x){s.uniform4iv(this.addr,x)}function N(o,k){o.uniform1i(this.addr,E[k?1:0])}function D(E,z){var u=_[4];u.set(z,0),E.uniformMatrix2fv(this.addr,!1,u)}function j(B,D){B.uniformMatrix2fv(this.addr,!1,f(D,this.size,4))}function U(u,W){var K=_[9];K.set(W,0),u.uniformMatrix3fv(this.addr,!1,K)}function $(q,t){q.uniformMatrix3fv(this.addr,!1,f(t,this.size,9))}function e($,d){var o=_[16];o.set(d,0),$.uniformMatrix4fv(this.addr,!1,o)}function T(p,b){p.uniformMatrix4fv(this.addr,!1,f(b,this.size,16))}function i(n,Z){n.uniform1i(this.addr,this.slots[0]),n.activeTexture(n.TEXTURE0+this.slots[0]),n.bindTexture(n.TEXTURE_2D,Z||n._emptyTexture)}function A(H,c){H.uniform1iv(this.addr,this.slots);for(var I=this.slots.length;I--;)H.activeTexture(H.TEXTURE0+this.slots[I]),H.bindTexture(H.TEXTURE_2D,c[I]||H._emptyTexture)}function p(t,N){t.uniform1i(this.addr,this.slots[0]),t.activeTexture(t.TEXTURE0+this.slots[0]),t.bindTexture(t.TEXTURE_CUBE_MAP,N||t._emptyCubeTexture)}function m(X,s){X.uniform1iv(this.addr,this.slots);for(var T=this.slots.length;T--;)X.activeTexture(X.TEXTURE0+this.slots[T]),X.bindTexture(X.TEXTURE_CUBE_MAP,s[T]||X._emptyCubeTexture)}function s(N,o,k){h[N]=[o,k]}function H($,Z,k){switch($.type){case 35678:case 35680:if("uSampler"===k)return[0];if("uBlendSampler"===k)return[1];for(var R=$.size,W=new Int32Array(R),D=0;R>D;++D)W[D]=Z.usedTextureSlot++;return W}return I}function r(r,$,q,A,O){this.name=r,this.addr=$,this.size=A?q.size:0,this.activeInfo=q,this.setter=h[q.type][A?1:0],this.slots=H(q,O,r),Jr(this)}function L(y,Q,X,J){var h=y.name,$=h.length;for(W.lastIndex=0;;){var L=W.exec(h),c=W.lastIndex,w=L[1],p="]"===L[2],B=L[3];if(p&&(w=0|w),B===I||"["===B&&c+2===$){X[w]=new r(w,Q,y,B!==I,J);break}var F=X[w];F==I&&(X[w]=F={}),X=F}}function n(S,Z,g){this.gl=Z,this._program=g,this._leaves={},this._branches={},this._struct=S}function v(F){function O(t,Y){n.call(this,F,t,Y);for(var r=k.length;r--;){var W=k[r];this._branches[W._name]=new W._type(t,Y)}this.uuid=fl.generateUUID()}function V(u,H){var K=u.name;if(u.isLeaf){var y=t("d.setter(this.gl, v);",["v"],["d"],[u.desc]);C.defineProperty(H,K,{configurable:!1,enumerable:!0,get:function(){return y},set:y})}else k.push({_name:K,_type:v(u)}),C.defineProperty(H,K,{configurable:!1,enumerable:!0,get:function(){return this._branches[K]},set:function(z){this._branches[K].apply(z)}})}var k=[];return l(O,n),F.forEach(V,O.prototype),O}function V(q,G){for(var D=q.getProgramParameter(G,q.ACTIVE_UNIFORMS),Y={},M={usedTextureSlot:2};D--;){var i=q.getActiveUniform(G,D),f=i.name,W=q.getUniformLocation(G,f);L(i,W,Y,M)}var d=Lb.create(Y,function(w){return"addr"in w}),g=v(d);return C.defineProperty(g.prototype,"textureCount",{configurable:!1,enumerable:!1,writable:!1,value:M.usedTextureSlot}),new g(q,G)}var _=[];if("function"==typeof Float32Array)for(var q=1;17>q;++q)_[q]=new Float32Array(q);var E=[0,1],h=[];s(sm.FLOAT,o,P),s(sm.FLOAT_VEC2,K,S),s(sm.FLOAT_VEC3,g,X),s(sm.FLOAT_VEC4,J,y),s(sm.INT,d,k),s(sm.INT_VEC2,Q,Q),s(sm.INT_VEC3,Y,Y),s(sm.INT_VEC4,u,u),s(sm.BOOL,N,k),s(sm.BOOL_VEC2,Q,Q),s(sm.BOOL_VEC3,Y,Y),s(sm.BOOL_VEC4,u,u),s(sm.FLOAT_MAT2,D,j),s(sm.FLOAT_MAT3,U,$),s(sm.FLOAT_MAT4,e,T),s(sm.SAMPLER_2D,i,A),s(sm.SAMPLER_CUBE,p,m);var W=/([\w\d_]+)(\])?(\[|\.)?/g;return n.prototype.apply=function(z){for(var k=this._struct.children,d=k.length;d--;){var R=k[d],J=R.name;J in z&&(R.isLeaf?this[J]=z[J]:this._branches[J].apply(z[J]))}},n.prototype.append=function(u){var j=this._struct.childMap;for(var m in u){var N=j[m];N&&(N.isLeaf?this[m]=u[m]:this._branches[m].append(u[m]))}},function(w,_){var c=_._uniforms;return c||(_._uniforms=c=V(w,_)),c}}(),Ug=function(){function p(M,A,y){A.vertexAttrib1f(M.addr,y)}function o(T,C,y){if(y.x!=I)C.vertexAttrib2f(T.addr,y.x,y.y);else{var j=M[2];j.set(y,0),C.vertexAttrib2fv(T.addr,j)}}function e(G,_,L){if(L.x!=I)_.vertexAttrib3f(G.addr,L.x,L.y,L.z);else if(L.r!=I)_.vertexAttrib3f(G.addr,L.r,L.g,L.b);else if(L.red!=I)_.vertexAttrib3f(G.addr,L.red,L.green,L.blue);else{var m=M[3];m.set(L,0),_.vertexAttrib3fv(G.addr,m)}}function Q(t,P,C){if("string"==typeof C&&(C=Ng(C)),C.x!=I)P.vertexAttrib4f(t.addr,C.x,C.y,C.z,C.w);else if(C.r!=I)P.vertexAttrib4f(t.addr,C.r,C.g,C.b,C.a);else if(C.red!=I)P.vertexAttrib4f(t.addr,C.red,C.green,C.blue,C.alpha);else{var u=M[4];u.set(C,0),P.vertexAttrib4fv(t.addr,u)}}function q(V,I,l){l=l.el||l;for(var N=0,Y=0;2>N;++N)I.vertexAttrib2f(V.addr,l[Y++],l[Y++])}function F(i,$,Q){Q=Q.el||Q;for(var I=0,C=0;3>I;++I)$.vertexAttrib3f(i.addr,Q[C++],Q[C++],Q[C++])}function g(L,g,E){E=E.el||E;for(var O=0,w=0;4>O;++O)g.vertexAttrib4f(L.addr,E[w++],E[w++],E[w++],E[w++])}function u(p,w,Z,t){for(var Q,P=Z?1:0,m=w.addr,L=p._divisorState,v=0;t>v;v++)Q=L[m+v]||0,Q!==P&&(L[m+v]=P,p.vertexAttribDivisor(m+v,P))}function B(p,M,y,q,T,A,w){M.bindBuffer(M.ARRAY_BUFFER,y);var m=p.addr;M.enableVertexAttribArray(m),u(M,p,y.instanced,1),M.vertexAttribPointer(m,1,q||M.FLOAT,!!T,A||0,w||0),M.bindBuffer(M.ARRAY_BUFFER,null)}function Z(Y,V,G,N,c,L,B){V.bindBuffer(V.ARRAY_BUFFER,G);var X=Y.addr;V.enableVertexAttribArray(X),u(V,Y,G.instanced,1),V.vertexAttribPointer(X,2,N||V.FLOAT,!!c,L||0,B||0),V.bindBuffer(V.ARRAY_BUFFER,null)}function L(N,J,i,B,g,q,x){J.bindBuffer(J.ARRAY_BUFFER,i);var S=N.addr;J.enableVertexAttribArray(S),u(J,N,i.instanced,1),J.vertexAttribPointer(S,3,B||J.FLOAT,!!g,q||0,x||0),J.bindBuffer(J.ARRAY_BUFFER,null)}function b(L,i,R,$,H,K,D){i.bindBuffer(i.ARRAY_BUFFER,R);var T=L.addr;i.enableVertexAttribArray(T),u(i,L,R.instanced,1),i.vertexAttribPointer(T,4,$||i.FLOAT,!!H,K||0,D||0),i.bindBuffer(i.ARRAY_BUFFER,null)}function D(U,j,c,B,t,H,G){var H=H||16,G=G||0,T=U.addr;j.bindBuffer(j.ARRAY_BUFFER,c),j.enableVertexAttribArray(T),j.vertexAttribPointer(T,2,B||j.FLOAT,!!t,H,G),j.enableVertexAttribArray(T+1),j.vertexAttribPointer(T+1,2,B||j.FLOAT,!!t,H,G+8),u(j,U,c.instanced,2),j.bindBuffer(j.ARRAY_BUFFER,null)}function k(C,V,a,b,k,A,x){var A=A||36,x=x||0,m=C.addr;V.bindBuffer(V.ARRAY_BUFFER,a);for(var D=0;3>D;D++)V.enableVertexAttribArray(m+D),V.vertexAttribPointer(m+D,3,b||V.FLOAT,!!k,A,x+12*D);u(V,C,a.instanced,3),V.bindBuffer(V.ARRAY_BUFFER,null)}function m(m,G,D,X,R,c,e){var c=c||64,e=e||0,o=m.addr;G.bindBuffer(G.ARRAY_BUFFER,D);for(var _=0;4>_;_++)G.enableVertexAttribArray(o+_),G.vertexAttribPointer(o+_,4,X||G.FLOAT,!!R,c,e+16*_);u(G,m,D.instanced,4),G.bindBuffer(G.ARRAY_BUFFER,null)}function i(t,e,K,q){r[t]=function(z,D,u,d,C,h){this.addr==I||this.addr<0||(D==I||D===!1?q(z,this.addr):en(D)===Y?K(this,z,D,u,d,C,h):(q(z,this.addr),e(this,z,D)))}}function h(T,e){T.disableVertexAttribArray(e)}function n(f,e){f.disableVertexAttribArray(e),f.disableVertexAttribArray(e+1)}function w(h,m){h.disableVertexAttribArray(m),h.disableVertexAttribArray(m+1),h.disableVertexAttribArray(m+2)}function X(m,i){m.disableVertexAttribArray(i),m.disableVertexAttribArray(i+1),m.disableVertexAttribArray(i+2),m.disableVertexAttribArray(i+3)}function U(d,u,L){this.name=d,this.addr=u,this.activeInfo=L,this.setter=r[L.type],Jr(this)}function a(v,S,x){this.gl=S,this.program=x,this._branches={},this._struct=v}function s(P){function W(D,M){a.call(this,P,D,M);for(var S=p.length;S--;){var v=p[S];this._branches[v._name]=new v._type(D,M)}}function x(Y,S){var D=Y.name;if(Y.isLeaf){var Z=t("d.setter(this.gl, v);",["v"],["d"],[Y.desc]);C.defineProperty(S,D,{configurable:!1,enumerable:!0,get:function(){return Z},set:Z})}else p.push({_name:D,_type:s(Y)}),C.defineProperty(S,D,{configurable:!1,enumerable:!0,get:function(){return this._branches[D]},set:function(d){this._branches[D].apply(d)}})}var p=[];return l(W,a),P.forEach(x,W.prototype),W}function j(k,X){for(var z=k.getProgramParameter(X,k.ACTIVE_ATTRIBUTES),n={};z--;){var P=k.getActiveAttrib(X,z),j=P.name,R=k.getAttribLocation(X,j);n[j]=new U(j,R,P)}var W=Lb.create(n,function(m){return"addr"in m}),d=s(W);return new d(k,X)}for(var M=[],N=1;17>N;++N)M[N]=new ub(N);var r=[],Y="undefined"!=typeof WebGLBuffer&&WebGLBuffer.prototype;return i(sm.FLOAT,p,B,h),i(sm.FLOAT_VEC2,o,Z,h),i(sm.FLOAT_VEC3,e,L,h),i(sm.FLOAT_VEC4,Q,b,h),i(sm.FLOAT_MAT2,q,D,n),i(sm.FLOAT_MAT3,F,k,w),i(sm.FLOAT_MAT4,g,m,X),a.prototype.disable=function(){for(var U=this._struct.children,d=U.length;d--;){var n=U[d],W=n.name;n.isLeaf?this[W]=I:this._branches[W].disable()}},a.prototype.apply=function(I){for(var J=this._struct.children,w=J.length;w--;){var H=J[w],V=H.name;V in I&&(H.isLeaf?this[V]=I[V]:this._branches[V].apply(I[V]))}},a.prototype.append=function(z){var I=this._struct.childMap;for(var c in z){var A=I[c];A&&(A.isLeaf?this[c]=z[c]:this._branches[c].append(z[c]))}},function(P,r){var l=r._attribs;return l||(r._attribs=l=j(P,r)),l}}(),dk=function(U){var m=this;C.defineProperties(this,{gl:{configurable:!1,enumerable:!1,value:U,writable:!1},glState:{configurable:!1,enumerable:!1,value:Tg(U),writable:!1}}),m._currProgram=I,m._currUniforms=I,m._currAttribs=I,m._sync=!0};C.defineProperties(dk.prototype,{program:{configurable:!1,enumerable:!1,get:function(){return this._currProgram},set:function(W){var N=this;N._sync&&W===N._currProgram||(N.gl.useProgram(W),N._currProgram=W,N._currUniforms=gn(N.gl,W),N._currAttribs=Ug(N.gl,W),N._sync=!0)}},uniforms:{configurable:!1,enumerable:!1,get:function(){var R=this;return R._currProgram&&!R._sync&&(R.gl.useProgram(R._currProgram),R._sync=!0),R._currUniforms},set:function(b){var y=this;y._currUniforms&&(y._currProgram&&!y._sync&&(y.gl.useProgram(y._currProgram),this._sync=!0),y._currUniforms.apply(b))}},attribs:{configurable:!1,enumerable:!1,get:function(){var J=this;return J._currProgram&&!J._sync&&(J.gl.useProgram(J._currProgram),J._sync=!0),J._currAttribs},set:function(W){var D=this;D._currUniforms&&(D._currProgram&&!D._sync&&(D.gl.useProgram(D._currProgram),this._sync=!0),D._currAttribs.apply(W))}}}),dk.prototype.useProgram=function(y){var S=this;S._sync&&y===S._currProgram||(S.gl.useProgram(y),S._currProgram=y,S._currUniforms=gn(S.gl,y),S._currAttribs=Ug(S.gl,y),S._sync=!0)},dk.prototype.directState=function(){return this.glState},dk.prototype.directUniforms=function(){return this._currUniforms},dk.prototype.directAttribs=function(){return this._currAttribs},dk.prototype.syncLoss=function(){this._sync=!1,this.glState.syncLoss()},dk.for=function(Z){var L=Z._renderState;return L||(Z._renderState=L=new dk(Z)),L};var ds="directional",wm="point",sd="spot",kk="light.color",kh=4294967295,ar=0,yk={},an=[],Yg=0,Uk=function(K,g){Je(g)&&ok.test(g)?Fm(K,g):Go(g)&&g.modelType?Sk(K,g):g===I?delete bf[K]:bf[K]=g},Mh=function(L){return L},oi=function(t){t=F.convertShape3dModelName(t);var H;if(Go(t)){if(t.modelType){if(t.uuid){if(H=bf[t.uuid])return H}else t.uuid=y.Math.generateUUID();return H===I&&(Or&&Or[t.uuid]||Sk(t.uuid,t)),I}return t}return H=bf[t],t&&H===I&&ok.test(t)&&(Or&&Or[t]||Fm(t,t)),H},Kp=function(u,n){u.frameStack?u.frameStack.push(n):u.frameStack=[n],u.bindFramebuffer(u.FRAMEBUFFER,n)},Fk=function(m){var j=m.frameStack;if(j){if(j.pop(),j.length)return m.bindFramebuffer(m.FRAMEBUFFER,j[j.length-1]),void 0;m.frameStack=null}m.bindFramebuffer(m.FRAMEBUFFER,null)};xo(F,{graph3dViewAttributes:N,graph3dViewFirstPersonMode:!1,graph3dViewMouseRoamable:!0,graph3dViewMoveStep:15,graph3dViewRotateStep:G/60,graph3dViewSortable:!1,graph3dViewBlockSelectable:!0,graph3dViewEditHelperDisabled:!1,graph3dViewPannable:!0,graph3dViewRotatable:!0,graph3dViewWalkable:!0,graph3dViewResettable:!0,graph3dViewZoomable:!0,graph3dViewRectSelectable:!0,graph3dViewRectSelectBackground:wj,graph3dViewGridVisible:!1,graph3dViewGridSize:50,graph3dViewGridGap:50,graph3dViewGridColor:[.4,.75,.85,1],graph3dViewRotateMaxPhi:G,graph3dViewRotateMinPhi:0,graph3dViewShadowDisabled:!0,graph3dViewShadowQuality:"high",graph3dViewShadowIntensity:.3,graph3dViewShadowBias:-.005,graph3dViewShadowRadius:.1,graph3dViewShadowType:"hard",graph3dViewShadowDegreeX:30,graph3dViewShadowDegreeZ:-10,graph3dViewOriginAxisVisible:!1,graph3dViewCenterAxisVisible:!1,graph3dViewAxisXColor:[1,0,0,1],graph3dViewAxisYColor:[0,1,0,1],graph3dViewAxisZColor:[0,0,1,1],graph3dViewEditSizeColor:[1,1,0,1],graph3dViewOrtho:!1,graph3dViewOrthoWidth:2e3,graph3dViewSyncEyeWithOrthoWidth:!1,graph3dViewFovy:G/4,graph3dViewNear:10,graph3dViewFar:1e4,graph3dViewEye:[0,300,1e3],graph3dViewCenter:[0,0,0],graph3dViewUp:[0,1,-1e-7],graph3dViewDataNumWarningLine:1e4,graph3dViewHeadlightDirection:"camera",graph3dViewHeadlightRange:0,graph3dViewHeadlightGroup:0,graph3dViewHeadlightColor:[1,1,1,1],graph3dViewHeadlightIntensity:1,graph3dViewHeadlightDisabled:!1,graph3dViewHeadlightAmbientIntensity:.7,graph3dViewFogDisabled:!0,graph3dViewFogMode:"linear",graph3dViewFogDensity:5e-4,graph3dViewFogColor:"white",graph3dViewFogNear:1,graph3dViewFogFar:2e3,graph3dViewPickerResolution:.5,graph3dViewDashDisabled:!0,graph3dViewUvClipEnabled:!1,graph3dViewBatchBlendDisabled:!0,graph3dViewBatchBrightnessDisabled:!0,graph3dViewBatchColorDisabled:!1,graph3dViewBatchInstancedDisabled:!0,graph3dViewFlowBlendMode:"addRGB",graph3dViewEnvmapType:"legacy",graph3dMaxVectorCacheTime:50,graph3dEnvmapCapabilityRequire:8,setShape3dModel:Uk,getShape3dModel:oi,convertShape3dModelName:Mh,getShape3dModelMap:function(){return bf},getCachedShape3dModelMap:function(){return vg},createMatrix:function(b,U){hr(b)||(b=[b]);for(var m=b.length-1;m>=0;m--){var c=b[m];U=xm(c.mat,c.s3,c.r3,c.rotationMode,c.t3,U)}return U},transformVec:function(K,L){return wq(K,L)},glBindFrame:Kp,glUnbindFrame:Fk,createBoxModel:function(){return{vs:Er,ns:Bb,uv:qs,is:Kl}},createRoundRectModel:function(m,Q){return jl.roundRect(m,Q)},createStarModel:function(R,g){return jl.star(R,g)},createRectModel:function(m,r){return jl.rect(m,r)},createTriangleModel:function(Q,x){return jl.triangle(Q,x)},createRightTriangleModel:function(P,N){return jl.rightTriangle(P,N)},createParallelogramModel:function(F,P){return jl.parallelogram(F,P)},createTrapezoidModel:function(R,d){return jl.trapezoid(R,d)},createSmoothSphereModel:function(k,V,i,n,$,K,M){return Hb(new bq(k,V,i,n,$,K,M))},createSphereModel:function(t,K,T,p,$,C,M){return t?md(t,K,T,p,$,C,M):F.createSmoothSphereModel()},createSmoothConeModel:function(I,a,U,G,m){return hg(I,a,U,G,m)},createConeModel:function(m,B,A,Q,$,O,E,b){return m?_c(m,B,A,Q,$,O,E,b):hg(O)},createSmoothCylinderModel:function(A,n,P,W,p,N,a,c){return Hb(new Lk(A,n,P,W,p,N,a,c))},createCylinderModel:function(C,y,u,G,k,z,c,J){return C?cd(C,y,u,G,k,z,c,J):Uo(z,c)},createSmoothTorusModel:function(v,A,C,x,R,h){return Hb(new Ri(v,A,C,x,R,h))},createTorusModel:function(Y,q,J,w,u,E,g,H){return Y?ho(Y,q,J,w,u,E,g,H):$b(E,g)},createExtrusionModel:function(F,h,o,$,w,H,N,p){return kq(F,h,o,$,w,H,N,p)},createSmoothRingModel:function(P,o,a,Q,$,k){for(var H=[],l=0;l<P.length-1;l+=2)H.push({x:P[l],y:P[l+1]});for(P=$m(H,o,a)[0],H=[],l=0;l<P.length;l++){var r=P[l];H.push(new zh(r.x,0,r.y))}return Hb(new $f(H,k,Q,$))},createTextGeometry:function(H,v){var R=Hb(new aj(H,v));if(v.cube)for(var P=cg(R),f=P.min,W=P.max,n=f.x,X=f.y,e=f.z,z=W.x-n||1,y=W.y-X||1,t=W.z-e||1,N=["vs","top_vs","bottom_vs"],Q=0,o=N.length;o>Q;Q++){var T=R[N[Q]];if(T)for(var K=0,J=T.length;J>K;K+=3)T[K]=(T[K]-n)/z-.5,T[K+1]=(T[K+1]-X)/y-.5,T[K+2]=(T[K+2]-e)/t-.5}return R},loadFontFace:function(v,U){F.xhrLoad(v,function(L){if(!L)return U();var q;try{q=JSON.parse(L)}catch(I){q=JSON.parse(L.substring(65,L.length-2))}io.loadFace(q),U&&U(q.familyName.toLowerCase())},U?null:{sync:!0})},getShaderErrorLog:function(){return an.join("\n")},createRingModel:function(v,l,O,S,P,j,h,A,I,G){for(var r=[],T=0;T<v.length-1;T+=2)r.push({x:v[T],y:v[T+1]});j=j||F.shapeSide,h=h||0,A=A||j;var X,t,b,B,f,i,q,D,m,Z,T,M,U,$,Q,x,u,E,e=[],H=[],C=I?[]:N,Y=I?[]:N,K=G?[]:N,k=G?[]:N,R=S?[]:N,o=S?[]:N,p=P?[]:N,V=P?[]:N,v=$m(r,l,O),J=Rg(v),_=0,d=2*Math.PI/j;return v.forEach(function(n){if(b=n.length,b>1){if(B=n[0],S)for(i=B.x,D=B.y,T=h;A>T;T++)M=T+1,U=T*d,$=M*d,Q=s(U),x=W(U),u=s($),E=W($),R.push(Q*i,D,-x*i,u*i,D,-E*i,0,D,0),o.push(.5-.5*Q,.5-.5*x,.5-.5*u,.5-.5*E,.5,.5);for(Z=0;b>Z;Z++){for(f=n[Z],i=B.x,q=f.x,D=B.y,m=f.y,X=_/J,_+=So(B,f),t=_/J,T=h;A>T;T++)M=T+1,U=T*d,$=M*d,Q=s(U),x=W(U),u=s($),E=W($),e.push(Q*q,m,-x*q,u*q,m,-E*q,Q*i,D,-x*i,u*q,m,-E*q,u*i,D,-E*i,Q*i,D,-x*i),H.push(T/j,t,M/j,t,T/j,X,M/j,t,M/j,X,T/j,X),I&&T===h&&(C.push(0,D,0,0,m,0,Q*q,m,-x*q,Q*q,m,-x*q,Q*i,D,-x*i,0,D,0),Y.push(0,.5-D,0,.5-m,2*q,.5-m,2*q,.5-m,2*i,.5-D,0,.5-D)),G&&M===A&&(K.push(0,D,0,u*q,m,-E*q,0,m,0,u*q,m,-E*q,0,D,0,u*i,D,-E*i),k.push(1,.5-D,1-2*q,.5-m,1,.5-m,1-2*q,.5-m,1,.5-D,1-2*i,.5-D));B=f}if(P)for(i=B.x,D=B.y,T=h;A>T;T++)M=T+1,U=T*d,$=M*d,Q=s(U),x=W(U),u=s($),E=W($),p.push(u*i,D,-E*i,Q*i,D,-x*i,0,D,0),V.push(.5-.5*u,.5+.5*E,.5-.5*Q,.5+.5*x,.5,.5)}}),{vs:e,uv:H,bottom_vs:p,bottom_uv:V,top_vs:R,top_uv:o,from_vs:C,from_uv:Y,to_vs:K,to_uv:k}}},!0),xo(O,{"3d.move.mode":I,"3d.selectable":!0,"3d.visible":!0,"3d.movable":!0,"3d.editable":!0,"3d.clip.direction":null,"3d.clip.percentage":1,"3d.reflectable":!0,"shape.border.gradient.color":I,"edge.gradient.color":I,"edge.source.t3":I,"edge.target.t3":I,"light.type":wm,"light.group":0,"light.center":[0,0,0],"light.color":[1,1,1,1],"light.disabled":!1,"light.angle":G/4,"light.range":0,"light.exponent":1,"light.intensity":1,"light.mask":kh,"headlight.ambientIntensity":I,"wf.visible":!1,"wf.width":1,"wf.fog":!0,"wf.color":Bg,"wf.short":!1,"wf.mat":I,"wf.boundingBox":!1,"wf.geometry":!1,"wf.loadQuadWireframe":!1,"wf.combineTriangle":!0,batch:I,"transparent.mask":!1,brightness:I,"select.brightness":.7,"repeat.uv.length":I,"shadow.cast":!0,"shadow.receive":!0,"3d.clipbox":I,"3d.clipbox.mask":kh,"3d.clipbox.group":0,"3d.clipbox.shape":"cube","effect.flow":!1,"effect.flow.gradient":"spread.horizontal","effect.flow.uvshape":"rect","effect.flow.size":512,"effect.flow.group":0,"effect.flow.intensity":1,"effect.flow.blend":I,"effect.flow.mask":kh,bloom:!1,envmap:0,"envmap.probe":0,roughness:0,renderTextureSamples:4,alphaTest:.4,autorotate:!1,fixSizeOnScreen:!1,"texture.cache":!1,"hide.overlapping.group":I,"vector.dynamic":!1,"vector.dynamic.maxsize":2048,"texture.scale":1,"geometry.cache":!1,"highlight.mode":!1,"highlight.type":"hard","highlight.visible":!0,"highlight.width":.8,"highlight.color":"rgba(190, 210, 250, 1)","highlight.glow":.8,"highlight.strength":2,"color.empty":[0,0,0,0],"label.face":Ki,"label.t3":I,"label.r3":I,"label.texture.scale":2,"label.rotationMode":Cn,"label.light":!1,"label.blend":I,"label.reverse.flip":!1,"label.reverse.color":ap,"label.reverse.cull":!1,"label.transparent":!1,"label.autorotate":!1,"label2.face":Ki,"label2.t3":I,"label2.r3":I,"label2.texture.scale":2,"label2.rotationMode":Cn,"label2.light":!1,"label2.blend":I,"label2.reverse.flip":!1,"label2.reverse.color":ap,"label2.reverse.cull":!1,"label2.transparent":!1,"label2.autorotate":!1,"note.face":Ki,"note.t3":I,"note.r3":I,"note.texture.scale":2,"note.rotationMode":Cn,"note.light":!1,"note.blend":I,"note.reverse.flip":!1,"note.reverse.color":ap,"note.reverse.cull":!1,"note.transparent":!1,"note.autorotate":!1,"note2.face":Ki,"note2.t3":I,"note2.r3":I,"note2.texture.scale":2,"note2.rotationMode":Cn,"note2.light":!1,"note2.blend":I,"note2.reverse.flip":!1,"note2.reverse.color":ap,"note2.reverse.cull":!1,"note2.transparent":!1,"note2.autorotate":!1,"part.boundingBox":!1,shape3d:I,"shape3d.color":Cs,"shape3d.top.color":I,"shape3d.bottom.color":I,"shape3d.from.color":I,"shape3d.to.color":I,"shape3d.image":I,"shape3d.image.projection":I,"shape3d.top.image":I,"shape3d.bottom.image":I,"shape3d.from.image":I,"shape3d.to.image":I,"shape3d.light":!0,"shape3d.side":0,"shape3d.side.from":I,"shape3d.side.to":I,"shape3d.smooth":I,"shape3d.visible":!0,"shape3d.from.visible":!0,"shape3d.to.visible":!0,"shape3d.top.visible":!0,"shape3d.bottom.visible":!0,"shape3d.torus.radius":.17,"shape3d.resolution":0,"shape3d.blend":I,"shape3d.opacity":I,"shape3d.reverse.flip":!1,"shape3d.reverse.color":ap,"shape3d.reverse.cull":!1,"shape3d.transparent":!1,"shape3d.uv.offset":I,"shape3d.uv.scale":I,"shape3d.uv.rotation":I,"shape3d.uv.anchor":I,"shape3d.uv.union":I,"shape3d.top.uv.offset":I,"shape3d.top.uv.scale":I,"shape3d.top.uv.rotation":I,"shape3d.top.uv.anchor":I,"shape3d.bottom.uv.offset":I,"shape3d.bottom.uv.scale":I,"shape3d.bottom.uv.rotation":I,"shape3d.bottom.uv.anchor":I,"shape3d.from.uv.offset":I,"shape3d.from.uv.scale":I,"shape3d.from.uv.rotation":I,"shape3d.from.uv.anchor":I,"shape3d.to.uv.offset":I,"shape3d.to.uv.scale":I,"shape3d.to.uv.rotation":I,"shape3d.to.uv.anchor":I,"shape3d.top.cap":I,"shape3d.bottom.cap":I,"shape3d.start.angle":0,"shape3d.sweep.angle":f,"shape3d.point.epsilon":1e-6,"shape3d.discard.selectable":!0,"shape3d.top.discard.selectable":!0,"shape3d.bottom.discard.selectable":!0,"shape3d.from.discard.selectable":!0,"shape3d.to.discard.selectable":!0,"shape3d.scaleable":!0,"shape3d.reflector":!1,"shape3d.reflector.color":"rgb(128,128,128)","shape3d.reflector.blur":0,"shape3d.reflector.blur.iterations":1,"shape3d.reflector.background":null,"shape3d.reflector.clip":.003,"shape3d.reflector.shadow":"scene","camera.type":"perspective","camera.aspect":1,"camera.fovy":I,"camera.ortho.width":I,"camera.near":I,"camera.far":I,"camera.background":0,"camera.renderSky":!0,"camera.renderAxis":!1,"camera.renderGrid":!1,"camera.renderEdit":!1,"camera.onlySky":!1,"texture.mipmap.max":I,"texture.filter":I,"texture.filter.min":I,"texture.filter.mag":I,"texture.wrap":I,"points.image":"rect","points.color":"white","points.transparent":!1,"points.size":20,"points.opacity":1,"points.uv.scale":[1,1],"points.uv.offset":[0,0],"points.discard.selectable":!1,"all.light":!0,"all.visible":!0,"all.color":Cs,"all.image":I,"all.blend":I,"all.opacity":I,"all.reverse.flip":!1,"all.reverse.color":ap,"all.reverse.cull":!1,"all.transparent":!1,"all.uv":I,"all.uv.offset":I,"all.uv.scale":I,"all.uv.rotation":I,"all.uv.anchor":I,"all.uv.union":I,"all.discard.selectable":!0,mat:I,"left.mat":I,"right.mat":I,"top.mat":I,"bottom.mat":I,"front.mat":I,"back.mat":I,"edge.source.anchor.elevation":I,"edge.target.anchor.elevation":I,"edge.source.offset.elevation":0,"edge.target.offset.elevation":0},!0);var nd,Mo=!1,Kk=[0,0,0,0],Lo=function(N){return N instanceof Es},uc=function(v){return[v.x,v.e||0,v.y]},Id=function(U,V,k){for(var V=Ng(V||0),l=V[0],Z=V[1],d=V[2];k--;)U.push(l,Z,d)},ak=function(v,f,I){for(var f=Ng(f||0),X=f[0],o=f[1],p=f[2],V=f[3];I--;)v.push(X,o,p,V)},gg=function(a,Q,u){if(Q)for(var r,e,N,T=Q[0],o=Q[1],H=Q[2],A=Q[4],w=Q[5],J=Q[6],Z=Q[8],q=Q[9],t=Q[10],v=Q[12],P=Q[13],B=Q[14],g=u.length,F=0,F=0;g>F;F+=3)r=u[F],e=u[F+1],N=u[F+2],a.push(T*r+A*e+Z*N+v,o*r+w*e+q*N+P,H*r+J*e+t*N+B);else Bm(a,u);return a},ke=function(h,H,A){var _=H.s("light.intensity"),q=Ng(H.s(kk)),M=q[0],Y=q[1],d=q[2];1!==_&&(M*=_,Y*=_,d*=_);var l=H.s("light.disabled");h.push(M,Y,d,l?1:0),A.c.push(M,Y,d),A.g.push(l?-1:H.s("light.group")),A.e.push(l?1:0)},Jm=function(W,P){var T,S=dk.for(P),L=S.directUniforms(),p=W._lastLightUploadInfo={c:[],g:[],e:[]},H=W._headlightDirection;H&&3===H.length?T=H:"shadow"===H&&(T=W.shadowMap.getDirection()),T=T?Vg.normalizeArray(W._transformDirectionToViewSpace(null,T)):[0,0,0],L.uHeadlightDirection=T,L.uHeadlightRange=W._headlightRange;var O=L.uHeadlightAmbientIntensity=W._headlightAmbientIntensity,w=W._headlightIntensity,R=Ng(W._headlightColor);1!==w&&(R=[R[0]*w,R[1]*w,R[2]*w]);var o;L.uHeadlightColor=[R[0],R[1],R[2],(o=W._headlightDisabled)?1:0],p.c.push(R[0],R[1],R[2]),p.g.push(o?-1:W._headlightGroup),p.e.push(o?1:0);var e=W._59O,k=W._spots,f=W._dirs;if(e.length){var K=[],l=[],q=[];e.forEach(function(P){ke(K,P,p),Bm(l,W._transformPointToViewSpace(P.p3())),q.push(P.s("light.range"))}),L.uPointColor=K,L.uPointRange=q,L.uPointPosition=l}if(k.length){var b=[],X=[],B=[],Y=[],j=[],$=[];k.forEach(function(w){ke(b,w,p),Bm(X,W._transformPointToViewSpace(w.p3())),Bm(j,W._transformDirectionToViewSpace(w.p3(),w.s("light.center"))),B.push(w.s("light.range")),Y.push(s(w.s("light.angle")/2)),$.push(w.s("light.exponent"))}),L.uSpotColor=b,L.uSpotRange=B,L.uSpotAngle=Y,L.uSpotExponent=$,L.uSpotPosition=X,L.uSpotDirection=j}if(f.length){var U=[],Z=[];f.forEach(function(u){ke(U,u,p),Bm(Z,W._transformDirectionToViewSpace(u.p3()))}),L.uDirColor=U,L.uDirDirection=Z}W._lastLightMask=kh,W._lastHeadlightAmbientIntensity=O},eh=function(F,C,T,O){if(O===I&&(O=F._headlightAmbientIntensity),O!==F._lastHeadlightAmbientIntensity&&(C.uHeadlightAmbientIntensity=F._lastHeadlightAmbientIntensity=O),T!==F._lastLightMask){F._lastLightMask=T;var e=F._lastLightUploadInfo;if(e){var k,$,y,V=e.g,Y=e.e,h=V.length,t=new Array(h),q=!1;for($=0;h>$;$++)k=V[$],y=0>k||k>=32?1:T&1<<k?0:1,t[$]=y,y!==Y[$]&&(q=!0);if(q){e.e=Y=t;var E=e.c;C.uHeadlightColor=[E[0],E[1],E[2],Y[0]];var N,r=F._59O,A=F._spots,J=F._dirs,S=3,x=1;if(h=r.length){for($=0,N=[];h>$;$++)N.push(E[S++],E[S++],E[S++],Y[x++]);C.uPointColor=N}if(h=A.length){for($=0,N=[];h>$;$++)N.push(E[S++],E[S++],E[S++],Y[x++]);C.uSpotColor=N}if(h=J.length){for($=0,N=[];h>$;$++)N.push(E[S++],E[S++],E[S++],Y[x++]);C.uDirColor=N}}}}},jb=function(G,E){return Math.max(G.getRotateMinPhi()+Qq,Math.min(G.getRotateMaxPhi()-Qq,E))},Hh=function(){return.05+sr()/2},Rm=function(X,n,C,h){var H,u=X.getEye();return X.isOrtho()?(H=Zo(X.getCenter(),u),H[0]+=h[0],H[1]+=h[1],H[2]+=h[2]):H=u,Fi(n,C,h,H)},Fi=function(x,w,W,O){var A=Cr(x,w),o=Zo(O,W,!0),_=Cr(o,w);if(u(_)<Qq)return N;var r=(A-Cr(W,w))/_;return[W[0]+o[0]*r,W[1]+o[1]*r,W[2]+o[2]*r]},wb=function(u,P){return{x:2*u.x-P.x,y:2*u.y-P.y}},sg=function(t,Y,k,Q){var X,m;if(!t)return X=ge(Y.y-k.y,k.x-Y.x),{x:Y.x+Q*W(X),y:Y.y+Q*s(X)};if(!k)return X=ge(t.y-Y.y,Y.x-t.x),{x:Y.x+Q*W(X),y:Y.y+Q*s(X)};var f=Zo([t.x,t.y,0],[Y.x,Y.y,0],!0),P=Zo([k.x,k.y,0],[Y.x,Y.y,0],!0),g=-(f[0]+P[0])/2,o=-(f[1]+P[1])/2,h=U(g*g+o*o);if(Qq>h)return X=ge(t.y-Y.y,Y.x-t.x),{x:Y.x+Q*W(X),y:Y.y+Q*s(X)};var e=t.x-Y.x,L=t.y-Y.y,R=k.x-Y.x,I=k.y-Y.y,b=U(e*e+L*L),z=U(R*R+I*I);X=_(Cr(f,P))/2,m=f[1]*P[0]-f[0]*P[1]>0?-1:1,g/=h,o/=h;var M=Q/W(X),c=n(b,z)/s(X);h=Math.min(M,c);var w={x:Y.x+m*h*g,y:Y.y+m*h*o};return k.b&&M>z/s(X)&&(w.adjust=!0),w},Fd=function(u){var U=u[1],a=u[2],d=u[3],r=u[6],P=u[7],A=u[11];u[1]=u[4],u[2]=u[8],u[3]=u[12],u[4]=U,u[6]=u[9],u[7]=u[13],u[8]=a,u[9]=r,u[11]=u[14],u[12]=d,u[13]=P,u[14]=A},ag=function(V){var o=V[0],b=V[1],x=V[2],T=V[3],A=V[4],M=V[5],W=V[6],C=V[7],h=V[8],E=V[9],P=V[10],U=V[11],m=V[12],L=V[13],l=V[14],q=V[15],F=o*M-b*A,z=o*W-x*A,G=o*C-T*A,I=b*W-x*M,e=b*C-T*M,D=x*C-T*W,B=h*L-E*m,v=h*l-P*m,O=h*q-U*m,d=E*l-P*L,X=E*q-U*L,f=P*q-U*l,J=F*f-z*X+G*d+I*O-e*v+D*B;return J?(J=1/J,V[0]=(M*f-W*X+C*d)*J,V[1]=(x*X-b*f-T*d)*J,V[2]=(L*D-l*e+q*I)*J,V[3]=(P*e-E*D-U*I)*J,V[4]=(W*O-A*f-C*v)*J,V[5]=(o*f-x*O+T*v)*J,V[6]=(l*G-m*D-q*z)*J,V[7]=(h*D-P*G+U*z)*J,V[8]=(A*X-M*O+C*B)*J,V[9]=(b*O-o*X-T*B)*J,V[10]=(m*e-L*G+q*F)*J,V[11]=(E*G-h*e-U*F)*J,V[12]=(M*v-A*d-W*B)*J,V[13]=(o*d-b*v+x*B)*J,V[14]=(L*z-m*I-l*F)*J,V[15]=(h*I-E*z+P*F)*J,void 0):N},Yc=function(S,B){if(B){var V=B[0],f=B[1],R=B[2];S[12]=S[0]*V+S[4]*f+S[8]*R+S[12],S[13]=S[1]*V+S[5]*f+S[9]*R+S[13],S[14]=S[2]*V+S[6]*f+S[10]*R+S[14],S[15]=S[3]*V+S[7]*f+S[11]*R+S[15]}},gr=function(j,w){if(w){var H=w[0],x=w[1],e=w[2];j[0]=j[0]*H,j[1]=j[1]*H,j[2]=j[2]*H,j[3]=j[3]*H,j[4]=j[4]*x,j[5]=j[5]*x,j[6]=j[6]*x,j[7]=j[7]*x,j[8]=j[8]*e,j[9]=j[9]*e,j[10]=j[10]*e,j[11]=j[11]*e}},Im=function(g,R,$){var o=R[0],j=R[1],s=R[2],X=R[3],d=R[4],n=R[5],l=R[6],V=R[7],T=R[8],W=R[9],k=R[10],M=R[11],y=R[12],u=R[13],v=R[14],E=R[15],z=$[0],O=$[1],f=$[2],Q=$[3];return g[0]=z*o+O*d+f*T+Q*y,g[1]=z*j+O*n+f*W+Q*u,g[2]=z*s+O*l+f*k+Q*v,g[3]=z*X+O*V+f*M+Q*E,z=$[4],O=$[5],f=$[6],Q=$[7],g[4]=z*o+O*d+f*T+Q*y,g[5]=z*j+O*n+f*W+Q*u,g[6]=z*s+O*l+f*k+Q*v,g[7]=z*X+O*V+f*M+Q*E,z=$[8],O=$[9],f=$[10],Q=$[11],g[8]=z*o+O*d+f*T+Q*y,g[9]=z*j+O*n+f*W+Q*u,g[10]=z*s+O*l+f*k+Q*v,g[11]=z*X+O*V+f*M+Q*E,z=$[12],O=$[13],f=$[14],Q=$[15],g[12]=z*o+O*d+f*T+Q*y,g[13]=z*j+O*n+f*W+Q*u,g[14]=z*s+O*l+f*k+Q*v,g[15]=z*X+O*V+f*M+Q*E,g},sk=function(m,s,a,R){var Y,B,L,l,Q,d,j,q,c,J,y=s[0],S=s[1],M=s[2],A=R[0],x=R[1],k=R[2],T=a[0],H=a[1],W=a[2];return u(y-T)<Qq&&u(S-H)<Qq&&u(M-W)<Qq?Nh(m):(j=y-T,q=S-H,c=M-W,J=1/U(j*j+q*q+c*c),j*=J,q*=J,c*=J,Y=x*c-k*q,B=k*j-A*c,L=A*q-x*j,J=U(Y*Y+B*B+L*L),J?(J=1/J,Y*=J,B*=J,L*=J):(Y=0,B=0,L=0),l=q*L-c*B,Q=c*Y-j*L,d=j*B-q*Y,J=U(l*l+Q*Q+d*d),J?(J=1/J,l*=J,Q*=J,d*=J):(l=0,Q=0,d=0),m[0]=Y,m[1]=l,m[2]=j,m[3]=0,m[4]=B,m[5]=Q,m[6]=q,m[7]=0,m[8]=L,m[9]=d,m[10]=c,m[11]=0,m[12]=-(Y*y+B*S+L*M),m[13]=-(l*y+Q*S+d*M),m[14]=-(j*y+q*S+c*M),m[15]=1,m)},Ud=function(g,j,y,N,A){var s=1/aq(j/2),U=1/(N-A);return g[0]=s/y,g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[5]=s,g[6]=0,g[7]=0,g[8]=0,g[9]=0,g[10]=(A+N)*U,g[11]=-1,g[12]=0,g[13]=0,g[14]=2*A*N*U,g[15]=0,g},ui=function(d,i,M,b,H,F,Q){var B=1/(i-M),v=1/(b-H),p=1/(F-Q);return d[0]=-2*B,d[1]=0,d[2]=0,d[3]=0,d[4]=0,d[5]=-2*v,d[6]=0,d[7]=0,d[8]=0,d[9]=0,d[10]=2*p,d[11]=0,d[12]=(i+M)*B,d[13]=(H+b)*v,d[14]=(Q+F)*p,d[15]=1,d},Ec=function(C,e){var g=e[0],j=e[1],h=e[2],q=e[3],X=g*g+j*j+h*h+q*q,t=X?1/X:0;return C[0]=-g*t,C[1]=-j*t,C[2]=-h*t,C[3]=q*t,C},Fc=function(Y,S){var V=S[0]+S[5]+S[10],_=0;return V>0?(_=2*Math.sqrt(V+1),Y[3]=.25*_,Y[0]=(S[6]-S[9])/_,Y[1]=(S[8]-S[2])/_,Y[2]=(S[1]-S[4])/_):S[0]>S[5]&S[0]>S[10]?(_=2*Math.sqrt(1+S[0]-S[5]-S[10]),Y[3]=(S[6]-S[9])/_,Y[0]=.25*_,Y[1]=(S[1]+S[4])/_,Y[2]=(S[8]+S[2])/_):S[5]>S[10]?(_=2*Math.sqrt(1+S[5]-S[0]-S[10]),Y[3]=(S[8]-S[2])/_,Y[0]=(S[1]+S[4])/_,Y[1]=.25*_,Y[2]=(S[6]+S[9])/_):(_=2*Math.sqrt(1+S[10]-S[0]-S[5]),Y[3]=(S[1]-S[4])/_,Y[0]=(S[8]+S[2])/_,Y[1]=(S[6]+S[9])/_,Y[2]=.25*_),Y},Dg=function(Z,K,A){var H=K[0],J=K[1],l=K[2],Y=K[3],t=H+H,N=J+J,E=l+l,U=H*t,F=H*N,z=H*E,p=J*N,G=J*E,V=l*E,S=Y*t,X=Y*N,O=Y*E;return Z[0]=1-(p+V),Z[1]=F+O,Z[2]=z-X,Z[3]=0,Z[4]=F-O,Z[5]=1-(U+V),Z[6]=G+S,Z[7]=0,Z[8]=z+X,Z[9]=G-S,Z[10]=1-(U+p),Z[11]=0,Z[12]=A[0],Z[13]=A[1],Z[14]=A[2],Z[15]=1,Z},we=function(u,s){if(u.isVREnabled()){var H=u.vr.getViewMatrix(s);if(H)return H}return u._camera?u._camera.getViewMatrix(s):sk(s?s:Gj(),u._eye,u._center,u._up)},bp=function(w,y){if(w.isVREnabled()){var C=w.vr.getProjectMatrix();if(C)return C}if(w._camera)return w._camera.getProjectMatrix();if(!y&&w._computedProjectMatrix)return Sc(w._computedProjectMatrix);var G=w.getAspect(),$=w._near,s=w._far,v=Gj();if(w._ortho){var M=w._orthoWidth/2,f=M/G;ui(v,-M,M,-f,f,$,s)}else Ud(v,w._fovy,G,$,s);return v},Bc=function(z,w){if(!z)return N;var V=0,C=1,Z=2,H=[],y=0,g=z.length,c=g/3;if(w){for(;g>y;y++)H[y]=0;for(y=0;y<w.length;y+=3){var W=[],Q=[],o=[];W[V]=z[3*w[y+1]+V]-z[3*w[y]+V],W[C]=z[3*w[y+1]+C]-z[3*w[y]+C],W[Z]=z[3*w[y+1]+Z]-z[3*w[y]+Z],Q[V]=z[3*w[y+2]+V]-z[3*w[y+1]+V],Q[C]=z[3*w[y+2]+C]-z[3*w[y+1]+C],Q[Z]=z[3*w[y+2]+Z]-z[3*w[y+1]+Z],o[V]=W[C]*Q[Z]-W[Z]*Q[C],o[C]=W[Z]*Q[V]-W[V]*Q[Z],o[Z]=W[V]*Q[C]-W[C]*Q[V];for(var s=0;3>s;s++)H[3*w[y+s]+V]+=o[V],H[3*w[y+s]+C]+=o[C],H[3*w[y+s]+Z]+=o[Z]}}else for(y=0;c>y;y+=3){var W=[],Q=[],o=[];W[V]=z[3*(y+1)+V]-z[3*y+V],W[C]=z[3*(y+1)+C]-z[3*y+C],W[Z]=z[3*(y+1)+Z]-z[3*y+Z],Q[V]=z[3*(y+2)+V]-z[3*(y+1)+V],Q[C]=z[3*(y+2)+C]-z[3*(y+1)+C],Q[Z]=z[3*(y+2)+Z]-z[3*(y+1)+Z],o[V]=W[C]*Q[Z]-W[Z]*Q[C],o[C]=W[Z]*Q[V]-W[V]*Q[Z],o[Z]=W[V]*Q[C]-W[C]*Q[V];for(var s=0;3>s;s++)H[3*(y+s)+V]=o[V],H[3*(y+s)+C]=o[C],H[3*(y+s)+Z]=o[Z]}for(y=0;g>y;y+=3){var D=[];D[V]=H[y+V],D[C]=H[y+C],D[Z]=H[y+Z];var k=U(D[V]*D[V]+D[C]*D[C]+D[Z]*D[Z]);
0===k&&(k=Qq),D[V]=D[V]/k,D[C]=D[C]/k,D[Z]=D[Z]/k,H[y+V]=D[V],H[y+C]=D[C],H[y+Z]=D[Z]}return new ub(H)},_g=function(y,p,j,S){if(j||(j=y.createTexture()),p){var l=y.TEXTURE_2D,o=y.REPEAT,E=y.CLAMP_TO_EDGE,C=y.TEXTURE_MIN_FILTER;S=S||go;var f=S.minFilter||S.filter||y.LINEAR,U=S.magFilter||S.filter||y.LINEAR;y.activeTexture(y.TEXTURE0),Qn(y,j),y.pixelStorei(y.UNPACK_FLIP_Y_WEBGL,!1),y.pixelStorei(y.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),y.texImage2D(l,0,y.RGBA,y.RGBA,y.UNSIGNED_BYTE,p),Af(y,y.TEXTURE_MAG_FILTER,U);var Z=p.naturalWidth||p.width,G=p.naturalHeight||p.height;fl.isPOT(Z)&&fl.isPOT(G)&&!S.clampToEdge&&!p.clampToEdge?(Af(y,y.TEXTURE_WRAP_S,o),Af(y,y.TEXTURE_WRAP_T,o),Af(y,C,f===y.NEAREST?y.NEAREST_MIPMAP_NEAREST:y.LINEAR_MIPMAP_LINEAR),S.mipmapMaxLevel!==I&&Af(y,y.TEXTURE_MAX_LEVEL,S.mipmapMaxLevel),y.generateMipmap(l)):(Af(y,y.TEXTURE_WRAP_S,E),Af(y,y.TEXTURE_WRAP_T,E),Af(y,C,f)),Qn(y,N)}return j},mb=function(j,h,i){var A=new Uint8Array(i||4);return h=h||j.createTexture(),j.activeTexture(j.TEXTURE0),Qn(j,h),Af(j,j.TEXTURE_MIN_FILTER,j.LINEAR),j.texImage2D(j.TEXTURE_2D,0,j.RGBA,1,1,0,j.RGBA,j.UNSIGNED_BYTE,A),h},Ur=function(e,j,G){var y=new Uint8Array(G||4);return j=j||e.createTexture(),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_CUBE_MAP,j),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+0,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,y),e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+1,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,y),e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+2,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,y),e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+3,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,y),e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+4,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,y),e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+5,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,y),j},gk=function(B){B._26I&&B._prg&&(B._26I.deleteProgram(B._prg),B._prg=N)},us=function(){function I(W){if(W.match(B))return Oc(W);var l=S[W];if(l)return l;var i=new RegExp("#define\\s+"+W+"\\s+(\\d+)"),F=J.match(i);return S[W]=F?Oc(F[1]):0}function E(i){S={},J=i;var l=i.replace(c,v).replace(d,P);return J=null,S=null,l}function v(i,U,L){L=I(L);for(var W="",Q=0;L>Q;Q++)W+=U+Q+";";return W}function P(V,T,S,K){for(var O="",e=I(T);e<I(S);e++)O+=K.replace(/\[\s*i\s*\]/g,"["+e+"]").replace(/\[\s*I\s*\]/g,e);return O}var S,J,c=/(uniform\s+sampler2D\s+\w+)\[([\S\d]+)\];/g,d=/#UNROLL_LOOP_START\s+for\s*\(\s*int\s+i\s*=\s*([\S\d]+)\s*;\s*i\s*<\s*([\S\d]+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#UNROLL_LOOP_END/g,B=/^\d+$/;return function(v){return E(v)}}(),bn=function(I,i,x,n){var X=I.createShader(x);return I.shaderSource(X,us(n)),I.compileShader(X),I.attachShader(i,X),X},Ck=function(A){return A.createBuffer()},Qn=function(d,i){d.bindTexture(d.TEXTURE_2D,i||d._emptyTexture)},Af=function(j,r,S){j.texParameteri(j.TEXTURE_2D,r,S)},$o=function(O,R){var G=dk.for(O).directState();G.polygonOffset.enabled=!0,G.polygonOffset.value=R},ks=function(N){var I=dk.for(N).directState();I.polygonOffset.enabled=!1},Wp=function(s,T){if(T){var $=dk.for(s).directState();$.color.clear=Ng(T)}},Pe=function(Q,V,C){if(C!==V._lastClipboxEnabled){var o=Q._boxClipperGroups,m=Q._boxClipperShape,X=o?o.length:0,i=new Array(X);if(C)for(var J=0;X>J;J++)i[J]=C&1<<o[J]?m[J]:0;V._lastClipboxEnabled=C,V.uClipperShape=i}},yc=Pe,sq=function(F){var D=dk.for(F),h=D.directUniforms(),v=D.directAttribs();h.uFix=!0,v.aNormal=!1},Qp=function(_){var Q=dk.for(_),A=Q.directUniforms();A.uFix=!1},ym=function(e,h,W,T,j,b,S,g){var J=dk.for(e),$=J.directState(),A=J.directUniforms();e._picking||(W?(A.uBlend=!0,A.uBlendColor=W):A.uBlend=!1,A.uLight=A.uFog=T==N?!0:T,dm(j)&&1!==j&&(A.uPartOpacity=j),A.uReverseFlip=b==N?!1:b,A.uFixPickReverseColor=S||ap),$.cullFace.enabled=g?!0:!1},Kh=function(k){if(!k._picking){var j=dk.for(k),P=j.directUniforms();P.uPartOpacity=1}},Nd=function(){var e=new y.Math.Matrix2d,d=[1,0,0,0,1,0,0,0,0];return function(Z,H,Q,x,I,a,M,w,u,$,A){var O=dk.for(Z),q=O.directUniforms(),l=O.directAttribs();return Q?(q.uTexture=!0,q.uDiscardSelectable=xj(x)?x:!0,l.aUv=Ch(Z,I,a,N,2),A?(q.uBlendTexture=!0,q.uBlendSampler=A):(q.uBlendTexture=!1,q.uBlendSampler=Z._emptyBlendTexture),q.uSampler=Q,q.uUvMatrix=M||w||u||$?xe(u,M,w,$,e).toArray9():d,void 0):(q.uSampler=Z._emptyTexture,q.uBlendSampler=Z._emptyBlendTexture,void 0)}}(),ab=function($,u,z){var Z=dk.for($),i=Z.directUniforms(),B=Z.directAttribs();$.activeTexture($.TEXTURE0),Qn($,N),$.activeTexture($.TEXTURE1),Qn($,N),z&&(B.aUv=!1,i.uTexture=!1,i.uSampler=$._emptyTexture,i.uBlendTexture=!1,i.uBlendSampler=$._emptyBlendTexture)},Fe=function(E,Z,S,$,x,h){var O=dk.for(E),l=O.directUniforms(),F=O.directAttribs();!S||ts||rr||E.lineWidth(S),$&&!E._picking&&(l.uFixPickReverseColor=$),x&&(F.aPosition=Ch(E,x,h,N))},fj=function(L,$,P,f,u){nd&&(f=L[nd]),u?L.drawArraysInstanced(f==N?L.TRIANGLES:f,$,P,u):L.drawArrays(f==N?L.TRIANGLES:f,$,P);var b=L._renderInfo;b&&(b.calls++,u&&(P*=u),b.vertices+=P,(f==N||f===L.TRIANGLES)&&(b.faces+=P/3),f===L.LINES&&(b.lines+=P/2),f===L.POINTS&&(b.points+=P))},yp=function(w,C,P,f,L,z){nd&&(f=w[nd]),z?w.drawElementsInstanced(f==N?w.TRIANGLES:f,P,L==N?w.UNSIGNED_SHORT:L,C==N?0:2*C,z):w.drawElements(f==N?w.TRIANGLES:f,P,L==N?w.UNSIGNED_SHORT:L,C==N?0:2*C);var F=w._renderInfo;F&&(F.calls++,z&&(P*=z),F.vertices+=P,(f==N||f===w.TRIANGLES)&&(F.faces+=P/3),f===w.LINES&&(F.lines+=P/2),f===w.POINTS&&(F.points+=P))},Kn=function(q,r,n){var t=q.ARRAY_BUFFER;return q.bindBuffer(t,r),n&&q.bufferData(t,n,q.STATIC_DRAW),r},Bk=function(Q,K,P,b,o){var K=Ch(Q,K,P,b,o);return K.instanced=!0,K},Ch=function(Z,o,v,W,O){return v?Mp(Z,Z.ARRAY_BUFFER,o,v):Kn(Z,o,v,W,O)},$g=function(p,M,k){var N=p.ELEMENT_ARRAY_BUFFER;p.bindBuffer(N,M),k&&p.bufferData(N,k,p.STATIC_DRAW)},te=function(c,N,g){Mp(c,c.ELEMENT_ARRAY_BUFFER,N,g)},Mp=function(A,n,F,f){var a=f._bufId;a||(a=f._bufId=y.Math.generateIncreasingID());var F,e=A._bufPool;return(F=e[a])&&F._buf?A.bindBuffer(n,F._buf):(F=e[a]={_buf:Ck(A)},A.bindBuffer(n,F._buf),A.bufferData(n,f,A.STATIC_DRAW)),F._fid=A._renderInfo.frame,F._buf},ne=function(S,J){J!=N&&J>=0&&S.enableVertexAttribArray(J)},km=function(g,L){L!=N&&L>=0&&g.disableVertexAttribArray(L)},mn=function(v,l){var Z=v.getGL(),p=dk.for(Z),w=p.directUniforms();v._7O=v._8O.pop(),l&&(w.uMVMatrix=v._7O,v._6O=l,w.uNMatrix=l)},ln=function(o,n){return n||(n=Gj()),ai(n,o),ag(n),Fd(n),n},dc=function(w,i){var C=w.getGL(),l=w._7O,v=dk.for(C),z=v.directUniforms();i?(w._8O.push(Sc(l)),z.uMMatrix=i,Im(l,l,i),w._7O=l):z.uMMatrix=Ol,z.uMVMatrix=l,z.uNMatrix=ln(l,w._6O)},fn={body:0,label:1,label2:2,note:3,note2:4,symbol:5},ki=10,Rk=function(L,u,P,E,a,n){var Y;if(P){var m=E._pickId;m||(m=E._pickId=u._pickIdUsed,u._pickIdUsed+=ki);var i,T=fn[a];if(null!=T)i=m+T;else{var e=E._pickExtraPartMap;e||(e=E._pickExtraPartMap={}),(i=e[a])||(i=e[a]=u._pickIdUsed++)}u[i]||(u[i]={data:E.data,part:a}),Y=Ws(i)}else Y=Kk;if(!n){var g=dk.for(L),z=g.directUniforms();z.uFixPickReverseColor=Y}return Y},vi=Rk,Tf=function(E,A,r){"target"!==r&&(r="source");var k="target"===r?A.getTargetAgent():A.getSourceAgent(),V="edge."+r+".";if(cl(k)){var D=A.s(V+"anchor.x"),$=A.s(V+"anchor.elevation"),M=A.s(V+"anchor.y"),U=rg(k,E.getMat(k)),g=k.getAnchor3d(),w=wq([(D===I?.5:D)-g.x,($===I?.5:$)-g.y,(M===I?.5:M)-g.z],U);return w[1]+=A.s(V+"offset.elevation"),w}var _=A.s(V+"index"),d=E.getData3dUI(k);if(!d.info||!d.info.list)return!1;if(_>=0){var Q,K,f,j,W,R=d.info._lastPointsSegments,o=R.points,t=R.segments,F=-1,b=-1;for(f=0,j=t?t.length:o.length;j>f;f++){if(K=t?t.get(f):1,3===K)W=2;else if(4===K)W=3;else{if(5===K)continue;W=1}if(F+=W,b++,b===_){Q=o.get(F);break}}return Q||(Q=o.get(o.length-1)),[Q.x,(Q.e||0)+A.s(V+"offset.elevation"),Q.y]}var X=A.s(V+"percent")||.5;if(X=Math.max(0,Math.min(X,1)),!d||!d.getCache)return!1;var v=d.getCache(),j=v[v.length-1].length,R=E.getLineOffset(k,X*j),w=R.point;return[w.x,w.y+A.s(V+"offset.elevation"),w.z]},Vh=function(){var u={center:function(c,m,o,Z,j){var Q=-m[1]/2,I={x:-m[0]/2,y:Q,width:m[0],height:m[1]},J=Sh(c,I,o);return[J.x+Z,-J.y-j,F.getPosition3dGap()]},front:function(P,G,W,p,C){var s=-G[1]/2,c={x:-G[0]/2,y:s,width:G[0],height:G[1]},E=Sh(P,c,W);return[E.x+p,-E.y-C,G[2]/2+F.getPosition3dGap()]},back:function(y,U,$,R,N){var f=-U[0]/2,i=-U[1]/2,q={x:f,y:i,width:U[0],height:U[1]},W=Sh(y,q,$);return[-W.x-R,-W.y-N,-U[2]/2-F.getPosition3dGap()]},left:function(Y,L,f,d,r){var u=-L[1]/2,Q={x:-L[2]/2,y:u,width:L[2],height:L[1]},O=Sh(Y,Q,f);return[-L[0]/2-F.getPosition3dGap(),-O.y-r,O.x+d]},right:function(E,Z,i,T,w){var V=-Z[2]/2,m=-Z[1]/2,Y={x:V,y:m,width:Z[2],height:Z[1]},g=Sh(E,Y,i);return[Z[0]/2+F.getPosition3dGap(),-g.y-w,-g.x-T]},top:function(e,n,A,s,E){var Y={x:-n[0]/2,y:-n[2]/2,width:n[0],height:n[2]},t=Sh(e,Y,A);return[t.x+s,n[1]/2+F.getPosition3dGap(),t.y+E]},bottom:function(W,s,g,p,n){var b=-s[2]/2,w={x:-s[0]/2,y:b,width:s[0],height:s[2]},A=Sh(W,w,g);return[A.x+p,-s[1]/2-F.getPosition3dGap(),-A.y-n]}};return function(y,n,m,j,$,q){return u[j](y,n,m,$||0,q||0)}}(),qi=function(Z,e,c,T,q,j,z,h,M,_){if(q&&(e[0]+=q[0],e[1]+=q[1],e[2]+=q[2]),Yc(Z,c),h){var $=Gj();if(ao($,M,_),wq(e,$),Yc(Z,e),Z.auto=h,Z.pos=wq([0,0,0],Z),j){var N=Z.mat2=Gj();ao(N,j,z)}}else ao(Z,M,_),Yc(Z,e),T===hp?Rj(Z,-Rd):T===Il?Rj(Z,Rd):T===nc?gl(Z,-Rd):T===yf?gl(Z,Rd):T===Mj&&Rj(Z,G),ao(Z,j,z);return Z},nk=function(m,i){var F=i.auto,w=i.mat2,B=m.gv;if(F){var b,$=Gj(),j=[0,0,0,0];b="string"==typeof F?[F.indexOf("x")<0?B._eye[0]:B._center[0],F.indexOf("y")<0?B._eye[1]:B._center[1],F.indexOf("z")<0?B._eye[2]:B._center[2]]:B._eye,Fc(j,sk(Gj(),b,B._center,B._up)),Dg($,Ec(j,j),i.pos),w&&Im($,$,w),dc(B,$)}else dc(B,i)},qo=function(T,n,k,X,F){var z=T.s,K=T.gv,O=K.getGL(),v=K._prg,R=K._buffer,S=K._1O,A=dk.for(O),s=A.directAttribs();_g(O,Qh,S),nk(T,k),ym(O,v,z(n+".blend"),z(n+".light"),z(n+".opacity"),z(n+".reverse.flip"),z(n+".reverse.color"),z(n+".reverse.cull")),Nd(O,v,S,F,R.uv,jd),s.aPosition=Ch(O,R.vs,X,N),s.aNormal=Ch(O,R.ns,Eb,N),te(O,R.is,lg),yp(O,0,lg.length),ab(O,v,S),Kh(O,v),mn(K)},_n=function(J,p,V){var F=J.gv,D=J.data,m=J[p]={blend:F.getBodyColor(D)||F.getFaceBlend(D,p),light:F.getFaceLight(D,p),color:F.getFaceColor(D,p),opacity:F.getFaceOpacity(D,p),transparent:F.getFaceTransparent(D,p),reverseFlip:F.getFaceReverseFlip(D,p),reverseColor:F.getFaceReverseColor(D,p),reverseCull:F.getFaceReverseCull(D,p),texture:F.getFaceImage(D,p),blendTexture:F.getFaceBlendImage(D,p),discardSelectable:F.getFaceDiscardSelectable(D,p)};if("csg"!==p){m.uv=F.getFaceUv(D,p)||V&&V[p+"Uv"],m.uvScale=F.getFaceUvScale(D,p)||V&&V[p+"UvScale"],m.uvOffset=F.getFaceUvOffset(D,p)||V&&V[p+"UvOffset"],m.uvRotation=F.getFaceUvRotation(D,p)||V&&V[p+"uvRotation"],m.uvAnchor=F.getFaceUvAnchor(D,p)||V&&V[p+"uvAnchor"];var q=F.getFaceMat(D,p);if(q){var $=rg(D,q);D.appendAnchorMatrix3d($),m.mat=$}}return m},dh=function(x,h,e,c,B){var d=x[c];if(d){if(!B(d.transparent))return;var f=x.data,$=x.gv,j=$._buffer,E=$.getTexture(d.texture,f,c),t=$.getTexture(d.blendTexture,f),S=dk.for(h),i=S.directUniforms(),g=S.directAttribs();Nd(h,e,E,d.discardSelectable,j.uv,d.tuv,d.uvOffset,d.uvScale,d.uvRotation,d.uvAnchor,t),ym(h,e,d.blend,d.light,d.opacity,d.reverseFlip,d.reverseColor,d.reverseCull),d.cs&&!$._batchColorDisabled?(i.uBatchColor=!0,g.aBatchColor=Ch(h,j.batchColor,d.cs,e.aBatchColor,4)):i.uDiffuse=d.color||O["color.empty"],g.aPosition=Ch(h,j.vs,d.vs,N),g.aNormal=Ch(h,j.ns,d.ns,N),fj(h,0,d.vs.length/3),d.cs&&!$._batchColorDisabled&&(i.uBatchColor=!1,km(h,e.aBatchColor)),Kh(h,e),ab(h,e,E)}},me=function(g,$,P){hr(g)?g.forEach(function(b){me(b,$,P)}):Je(g)?me(Kd($,g),$,P):Go(g)?g.shape3d?me(g.shape3d,$,P):P.push(g):P.push(g)},rl=function(){for(var H=50,V=arguments.length,N=[],U=0;V>U;U++)N[U]=arguments[U];an[Yg]="Time : "+(new Date).toLocaleString()+", Info :"+N.join(", "),Yg=(Yg+1)%H,console.error("Failed to create shader.")},xe=function(){var P=new fl.Matrix2d;return function(g,n,d,C,b){return b||(b=P),b.identity(),C&&b.translate(-C[0],-C[1]),d&&b.scale(d[0],d[1]),g&&b.rotate(g),C&&b.translate(C[0],C[1]),n&&b.translate(n[0],n[1]),b}}(),ih=function(i,$,Z,C,O,o){var u,A,V,g,r,w,a,b,e,Y,h,f=[C-$,O-Z],l=i?i.length:0;for(V=0;l>V;V++){for(g=2,u=i[V],r=u[0],w=u[1];g+1<u.length;){if(a=u[g],b=u[g+1],A=Gh($,Z,C,O,r,w,a,b,!0)){e=[a-r,b-w],Y=So(e),e[0]/=Y,e[1]/=Y,Y=Cr(f,e),Y=Y>0?o:-o,h=[e[0]*Y,e[1]*Y];break}r=a,w=b,g+=2}if(h)break}if(h)for(C=$+h[0],O=Z+h[1],V=0;l>V;V++)for(g=2,u=i[V],r=u[0],w=u[1];g+1<u.length;){if(a=u[g],b=u[g+1],A=Gh($,Z,C,O,r,w,a,b,!0))return[0,0];r=a,w=b,g+=2}return h?h:[C-$,O-Z]},Hj=function(m){return"nearest"===m?sm.NEAREST:"linear"===m?sm.LINEAR:m},Lq=y.graph3d={WebGLConstants:sm},hd=function(i,J,L){ri(D+".graph3d."+i,J,L)},Hk="!~!<yfusfw!+!yjsubNQv!>!opjujtpQ`mh!gjeof$!~!<6/1!,!*{/mbdpMwVxpmg!,!z/mbdpMwVxpmg!-y/mbdpMwVxpmg)3dfw!>!^j]wVxpmg!<{zy/*enspgtobsu!+!yjsubNNv!+!^j]yjsubNxpmg)!>!mbdpMwVxpmg!|!*,,j!<UDFKCP`XPMG`YBN!=!j!<1!>!j!uoj)!spg!<mbdpMwVxpmg!4dfw!1!?!UDFKCP`XPMG`YBN!gj$!gjeof$!<enspgtobsu!+!yjsubNNv!+!yjsubNxpebit!>!esppDxpebit!QBNXPEBIT`FTV!gfegj$!gjeof$!~!<fdobutjEfojMb!>!fdobutjEfojMw!|!*itbEv)!gj!ITBE!gfegj$!gjeof$!~!<ttfouihjsCidubCb!>!ttfouihjsCidubCw!|!*ttfouihjsCidubCv)!gj!TTFOUIHJSCIDUBC!gfegj$!gjeof$!~!<eofmCidubCb!>!eofmCidubCw!|!*eofmCidubCv)!gj!EOFMCIDUBC!gfegj$!gjeof$!~!<spmpDidubCb!>!spmpDidubCw!|!*spmpDidubCv)!gj!SPMPDIDUBC!gfegj$!gjeof$!~!<**1/2!-wVb)4dfw!+!yjsubNwVv)3dfw!>!wVw!|!*fsvuyfUv)!gj!ftmf$!<*y/wVb!-**1/2!-wVb)4dfw!+!yjsubNwVv)3dfw)4dfw!>!wVw!QJMD`WV!gfegj$!<*enspgtobsu)4dfw!>!opjujtpQw!gjeof$!~!1!>>!SFQQJMD`YPC`YBN!gj$!<*enspgtobsu!+!yjsubNNv)4dfw!>!emspXw!<*yfusfw)4dfw!>!yfusfWw!gjeof$!<**1/2!-mbnspOb)5dfw!+!yjsubNOv)4dfw!>!mbnspOw!ftmf$!<**1/2!-mbnspOb)5dfw!+!yjsubNOv)4dfw!>!mbnspOw!ftmf!~!<**1/2!-mbnspOw!+!n)5dfw!+!yjsubNOv)4dfw!>!mbnspOw!<**^3]n!-^3]n)upe!-*^2]n!-^2]n)upe!-*^1]n!-^1]n)upe)4dfw!0!mbnspOb!>!mbnspOw!<*!efdobutoJyjsubNb!)4ubn!>!n!4ubn!|!*fdobutoJftVv)!gj!FDOBUTOJIDUBC!gfegj$!gjeof$!|!*ldjQva)!gj!1!>>!SFQQJMD`YPC`YBN!gj$!<enspgtobsu!+!yjsubNWNv!>!yfusfw!5dfw!gjeof$!~!<enspgtobsu!+!efdobutoJyjsubNb!>!enspgtobsu!|!*fdobutoJftVv)!gj!FDOBUTOJIDUBC!gfegj$!<*1/2!-opjujtpQb)5dfw!>!enspgtobsu!5dfw!|!*ejpw)ojbn!ejpw!gjeof$!<^UDFKCP`XPMG`YBN]wVxpmg!3dfw!hojzsbw!<^UDFKCP`XPMG`YBN]yjsubNxpmg!5ubn!nspgjov!1!?!UDFKCP`XPMG`YBN!gj$!gjeof$!<esppDxpebit!5dfw!hojzsbw!<yjsubNxpebit!5ubn!nspgjov!QBNXPEBIT`FTV!gfegj$!gjeof$!<fdobutjEfojMw!ubpmg!hojzsbw!<fdobutjEfojMb!ubpmg!fuvcjsuub!<itbEv!mppc!nspgjov!ITBE!gfegj$!gjeof$!<^UPQT`YBN]opjudfsjEupqTv!4dfw!nspgjov!<^UPQT`YBN]opjujtpQupqTv!4dfw!nspgjov!<^UPQT`YBN]spmpDupqTv!5dfw!nspgjov!1!?!UPQT`YBN!gj$!gjeof$!<^UOJPQ`YBN]opjujtpQuojpQv!4dfw!nspgjov!<^UOJPQ`YBN]spmpDuojpQv!5dfw!nspgjov!1!?!UOJPQ`YBN!gj$!gjeof$!<^SJE`YBN]opjudfsjEsjEv!4dfw!nspgjov!<^SJE`YBN]spmpDsjEv!5dfw!nspgjov!1!?!SJE`YBN!gj$!gjeof$!<eofmCidubCw!4dfw!hojzsbw!<eofmCidubCb!4dfw!fuvcjsuub!<eofmCidubCv!mppc!nspgjov!EOFMCIDUBC!gfegj$!gjeof$!<ttfouihjsCidubCw!ubpmg!hojzsbw!<ttfouihjsCidubCb!ubpmg!fuvcjsuub!<ttfouihjsCidubCv!mppc!nspgjov!TTFOUIHJSCIDUBC!gfegj$!gjeof$!<spmpDidubCw!5dfw!hojzsbw!<spmpDidubCb!5dfw!fuvcjsuub!<spmpDidubCv!mppc!nspgjov!SPMPDIDUBC!gfegj$!<opjujtpQw!4dfw!hojzsbw!<emspXw!4dfw!hojzsbw!<yfusfWw!4dfw!hojzsbw!<mbnspOw!4dfw!hojzsbw!<yjGv!mppc!nspgjov!<ldjQv!mppc!nspgjov!<yjsubNxfjWv!5ubn!nspgjov!<yjsubNOv!5ubn!nspgjov!<yjsubNQv!5ubn!nspgjov!<yjsubNNv!5ubn!nspgjov!<yjsubNWNv!5ubn!nspgjov!<opjujtpQb!4dfw!fuvcjsuub!gjeof$!~!<*{zy/**1/1!-sje)5dfw!+!yjsubn))f{jmbnspo!osvufs!|!*yjsubn!5ubn!oj!-sje!4dfw!oj!)opjudfsjEnspgtobsu!4dfw!<efdobutoJyjsubNb!5ubn!fuvcjsuub!<fdobutoJftVv!mppc!nspgjov!FDOBUTOJIDUBC!gfegj$!<mbnspOb!4dfw!fuvcjsuub!gjeof$!<wVw!3dfw!hojzsbw!ftmf$!<wVw!4dfw!hojzsbw!QJMD`WV!gfegj$!<wVb!3dfw!fuvcjsuub!<yjsubNwVv!4ubn!nspgjov!<fsvuyfUeofmCv!mppc!nspgjov!<fsvuyfUv!mppc!nspgjov!YJGFSQ$!^#CBRBEJxTT87hJFI,,bX1XrIwcn3UM{ZeZ,M6HEN6nLxe2Z72s2:3johr6foKrpqwxNKYkdbJ2CN[mBbf[wXU,T0oGuSEd190ohLZkEn8IuCe[OHoWeKz:Sf,VS7xdSLw23W1YJLU:jdv2{hiDbhDzNNEh9tp3xsuEp94Sl4c3wRzqwShMDRhCLRjCDEBOH5BBVRBCFRE4cJTHrTDH1BNgHJN",np="!~!~!<eJ!>!spmpDhbsG`mh!~!<spmpDsfmqnbTwv!>+!eJ!<*zy/wVw!-sfmqnbTeofmCv)E3fsvuyfu!>!spmpDsfmqnbTwv!5dfw!|!*fsvuyfUeofmCv)!gj!gjeof$!~!<ttfouihjsCidubCw!>+!chs/eJ!|*ttfouihjsCidubCv)gj!TTFOUIHJSCIDUBC!gfegj$!~!<ttfouihjsCv!>+!chs/eJ!|*1/2!>a!ttfouihjsCv)gj!gjeof$!~!<*spudbGhpg!-*x/eJ!-chs/spmpDhpGv)5dfw!-eJ)yjn!>!eJ!gjeof$!<*iuqfe!-sbGhpGv!-sbfOhpGv)qfutiuppnt!>!spudbGhpg!ubpmg!ftmf$!<*iuqfe!+!iuqfe!+!zujtofEhpGv!+!zujtofEhpGv!.)qyf!.!1/2!>!spudbGhpg!ubpmg!3QYF`HPG!gfegj$!<{/yfusfWw.!>!iuqfe!ubpmg!|!*hpGv)!gj!HPG!gfegj$!~!~!<zujdbqPusbQv!>+!b/eJ!|*1/2!>a!zujdbqPusbQv)gj!~!gjeof$!~!<zujwjudfmgfSv!+!{zy/spmpDwof!>,!chs/eJ!gjeof$!<*spmpDwof)sbfojMpUmfyfUqbNwof!>!spmpDwof!<**{z/dfWudfmgfs!-y/dfWudfmgfs)4dfw!-qbNwoFv)fcvDfsvuyfu!>!spmpDwof!5dfw!ftmf$!<**ttfoihvps!-*{z/dfWudfmgfs!-y/dfWudfmgfs.)4dfw!-qbNwoFv)WVfcvDfsvuyfu)CHStpUsbfojM!>!spmpDwof!5dfw!WV`FCVD`FQZU`QBNWOF!gfegj$!gjeof$!<*mbnspOemspx!-yfusfWpUbsfnbd)udfmgfs!>!dfWudfmgfs!4dfw!ftmf$!<***mbnspOemspx!-yfusfWpUbsfnbd)udfmgfs!-ubvRqbnwoFv)spudfWfubups)f{jmbnspo!>!dfWudfmgfs!4dfw!FUBUPS`QBNWOF!gfegj$!<*yjsubNxfjWv!-O)opjudfsjEnspgtobsUftsfwoj!>!mbnspOemspx!4dfw!<*opjujtpQbsfnbDv!.!emspXw)f{jmbnspo!>!yfusfWpUbsfnbd!4dfw!|*qbNwoFftVv)!gj!QBNWOF`FTV!gfegj$!gjeof$!~!~!~!~!<chs/^j]spmpDupqTv!+!udfggFupqt!+!fhobSm!+!*1/1!-*mbnspOm.!-O)upe)ybn!>,!chs/eJ!<*1/1!-*^j]uofopqyFupqTv!-udfggFupqt)xpq)ybn!>!udfggFupqt!|*^j]fmhoBupqTv!?!udfggFupqt)gj!<*mbnspOm!-^j]opjudfsjEupqTv)upe!>!udfggFupqt!ubpmg!<*spudfWm)f{jmbnspo!>!mbnspOm!4dfw!|*1/1!?!fhobSm)!gj!~!<*1/2!-*^j]fhobSupqTv!0!*spudfWm)iuhofm))ojn!.!1/2!>!fhobSm!|*1/1!?!^j]fhobSupqTv)!gj!<1/2!>!fhobSm!ubpmg!<^j]opjujtpQupqTv!.!yfusfWw!>!spudfWm!4dfw!|*1/1!>>!x/^j]spmpDupqTv)gj!|!*,,j!<UPQT`YBN!=!j!<1>j!uoj)spg!1!?!UPQT`YBN!gj$!gjeof$!~!~!~!<chs/^j]spmpDuojpQv!+!fhobSm!+!*1/1!-**spudfWm)f{jmbnspo.!-O)upe)ybn!>,!chs/eJ!|*1/1!?!fhobSm)!gj!~!<*1/2!-*^j]fhobSuojpQv!0!*spudfWm)iuhofm))ojn!.!1/2!>!fhobSm!|*1/1!?!^j]fhobSuojpQv)!gj!<1/2!>!fhobSm!ubpmg!<^j]opjujtpQuojpQv!.!yfusfWw!>!spudfWm!4dfw!|*1/1!>>!x/^j]spmpDuojpQv)gj!|!*,,j!<UOJPQ`YBN!=!j!<1>j!uoj)spg!1!?!UOJPQ`YBN!gj$!gjeof$!~!~!<chs/^j]spmpDsjEv!+!*1/1!-**^j]opjudfsjEsjEv)f{jmbnspo.!-O)upe)ybn!>,!chs/eJ!|*1/1!>>!x/^j]spmpDsjEv)gj!|!*,,j!<SJE`YBN!=!j!<1>j!uoj)spg!1!?!SJE`YBN!gj$!~!<chs/spmpDuihjmebfIv!+!nsfUusfcnbm!>+!chs/eJ!gjeof$!~!<fvmbWxpebit!+!zujtofuoJxpebit!.!1/2!>+!nsfUusfcnbm!~!<osvufs!<esbdtje!|!*1/1!>>!fvmbWxpebit!%%!mmvDxpebit)!gj!<*esppDxpebit!-tvjebSxpebit!-tbjCxpebit!-f{jTxpebit!-qbNxpebit)xpebiTufh!.!1/2!>!fvmbWxpebit!ubpmg!|!*fwjfdfSxpebit)!gj!QBNXPEBIT`FTV!gfegj$!~!<*1/2!-fhobSuihjmebfIv0*yfusfWw)iuhofm)ojn!.!1/2!>+!nsfUusfcnbm!|*1/1!?!fhobSuihjmebfIv)gj!<*1/1!-zujtofuoJuofjcnBuihjmebfIv!,!*zujtofuoJuofjcnBuihjmebfIv!.!1/2)!+!nsfUusfcnbm)ybn!>!nsfUusfcnbm!<*opjudfsjEuihjmebfIv.!-O)upe!>!nsfUusfcnbm!ftmf!<*M.!-O)upe!>!nsfUusfcnbm!*1/1!>>!{/opjudfsjEuihjmebfIv!%%!1/1!>>!z/opjudfsjEuihjmebfIv!%%!1/1!>>!y/opjudfsjEuihjmebfIv)!gj!<nsfUusfcnbm!ubpmg!|*1/1!>>!x/spmpDuihjmebfIv)gj!gjeof$!EOF`QPPM`MMPSOV$!~!gjeof$!<chs/mfyfUxpmg!>,!chs/eJ!ftmf$!<bchs/mfyfUxpmg!>,!bchs/eJ!*!BCHS`EEB`FEPN`EOFMC`XPMG!)efojgfe!gjmf$!<bchs/mfyfUxpmg!>!bchs/eJ!*!BCHS`FEJSSFWP`FEPN`EOFMC`XPMG!)efojgfe!gjmf$!<b/mfyfUxpmg!>!b/eJ!*!B`FEJSSFWP`FEPN`EOFMC`XPMG!)efojgfe!gjmf$!<chs/mfyfUxpmg!>!chs/eJ!*!CHS`FEJSSFWP`FEPN`EOFMC`XPMG!)efojgfe!gjmf$!<bchs/mfyfUxpmg!>+!bchs/eJ!*!BCHS`ZMQJUMVN`FEPN`EOFMC`XPMG!)efojgfe!gjmf$!<chs/mfyfUxpmg!>+!chs/eJ!*!CHS`ZMQJUMVN`FEPN`EOFMC`XPMG!)efojgfe!gj$!****1/1)3dfw!-^j]wVxpmg)obiUsfubfsh)mmb!%%!***1/2)3dfw!-^j]wVxpmg)obiUttfm)mmb!%%!^j]efmcboFxpmg)!gj!<*^j]wVxpmg!-^J]fsvuyfUxpmg)E3fsvuyfu!>!mfyfUxpmg!|!*,,j!<UDFKCP`XPMG`YBN!=!j!<1>j!uoj)!spg!USBUT`QPPM`MMPSOV$!<mfyfUxpmg!5dfw!1!?!UDFKCP`XPMG`YBN!gj$!|!*uihjMv)!gj!~!gjeof$!~!<spmpDeofmCv!>+!eJ!|*eofmCv)gj!ftmf$!~!<spmpDeofmCv!>+!eJ!|*eofmCv)gj!ftmf!~!<eofmCidubCw!>+!chs/eJ!|*eofmCidubCv)gj!EOFMCIDUBC!gfegj$!~!~!<esbdtje!|*1/1!>>!x/eJ)gj!gjeof$!<ftvggjEv!>!eJ!ftmf$!~!<ftvggjEv!>!eJ!|ftmf~!<spmpDidubCw!>!eJ!|*spmpDidubCv)gj!SPMPDIDUBC!gfegj$!|!ftmf!~!<spmpDwv!>!eJ!|*fsvuyfUv)gj!|!ftmf!~!<spmpDftsfwfSldjQyjGv!>!eJ!|*qjmGftsfwfSva!%%!ldbCtj)gj!~!<fvsu!>!ldbCtj!<O.!>!O!|*1/1!=!*O!-F)upe)gj!<ftmbg!>!ldbCtj!mppc!<F.!>!M!4dfw!gjeof$!<*yfusfWw.)f{jmbnspo!>!F!4dfw!ftmf$!<*2!-1!-1)4dfw!>!F!4dfw!DJIQBSHPIUSP!gfegj$!<*mbnspOw)f{jmbnspo!>!O!4dfw!|!ftmf!~!gjeof$!~!~!<ftvggjEv!>!eJ!|ftmf!~!<esbdtje!|*1/1!>>!x/ftvggjEv)gj!|!*fdobutjEitbEv!?!*fdobutjEqbHitbEv!-fdobutjEfojMw)epn!%%!itbEv)!gj!ITBE!gfegj$!gjeof$!<spmpDftsfwfSldjQyjGv!>!eJ!ftmf$!~!<spmpDftsfwfSldjQyjGv!>!eJ!|!ftmf!~!<spmpDidubCw!>!eJ!|*spmpDidubCv)gj!SPMPDIDUBC!gfegj$!|!*yjGv)!gj!<eJ!5dfw!|!ftmf!~!~!<esbdtje!|!*1/1!>>!b/spmpDhbsG`mh)!gj!gjeof$!<spmpDftsfwfSldjQyjGv!>!spmpDhbsG`mh!ftmf$!~!<spmpDftsfwfSldjQyjGv!>!spmpDhbsG`mh!|!ftmf!~!<spmpDidubCw!>!spmpDhbsG`mh!|!*spmpDidubCv)!gj!SPMPDIDUBC!gfegj$!|!*ldjQv)!gj!~!<osvufs!<*1/2!-1/1!-1/1!-1/1)5dfw!>!spmpDhbsG`mh!|!*uvpldbmc)!gj!gjeof$!~!~!<osvufs!<esbdtje!|!**6/1!=!*mbdpMw)iuhofm)!>a!^j]sfooJqjmDsfqqjmDv!%%!3!>>!^j]fqbiTsfqqjmDv!}}!***ojNqjmd!-mbdpMw)obiUsfubfsh)mmb!%%!**ybNqjmd!-mbdpMw)obiUttfm)mmb)!>a!^j]sfooJqjmDsfqqjmDv!%%!2!>>!^j]fqbiTsfqqjmDv)!gj!<**1/2!-emspXw)5dfw!+!^j]yjsubNsfqqjmDv)4dfw!>!mbdpMw!|!*,,j!<SFQQJMD`YPC`YBN!=!j!<1!>!j!uoj)!spg!<mbdpMw!4dfw!1!?!SFQQJMD`YPC`YBN!gj$!~!gjeof$!~!<esbdtje!|!**sje!-*uofdsfQqjmDv)4dfw)upe!?!*opjujtpQw!-sje)upe)!gj!ftmf$!~!<esbdtje!|!**sje!-*uofdsfQqjmDv)4dfw)upe!?!*opjujtpQqjmd!-sje)upe)!gj!~!<*1/1!-1/1!-{/wVw)4dfw!>!opjujtpQqjmd!<1/2.!>!y/sje!|!*:!=!opjudfsjEqjmDv)!gj!ftmf!~!<*1/1!-1/1!-{/wVw)4dfw!>!opjujtpQqjmd!<1/2!>!y/sje!|!*9!=!opjudfsjEqjmDv)!gj!ftmf!QJMD`WV!gfegj$!~!<1/2.!>!{/sje!|!*8!=!opjudfsjEqjmDv)!gj!ftmf!~!<1/2!>!{/sje!|!*7!=!opjudfsjEqjmDv)!gj!ftmf!~!<1/2.!>!z/sje!|!*6!=!opjudfsjEqjmDv)!gj!ftmf!~!<1/2!>!z/sje!|!*5!=!opjudfsjEqjmDv)!gj!ftmf!~!<1/2.!>!y/sje!|!*4!=!opjudfsjEqjmDv)!gj!ftmf!~!<1/2!>!y/sje!|!*3!=!opjudfsjEqjmDv)!gj!gjeof$!<opjujtpQw!>!opjujtpQqjmd!4dfw!QJMD`WV!gfegj$!<*1/1!-1/1!-1/1)4dfw!>!sje!4dfw!|!*1!?!opjudfsjEqjmDv)!gj!~!~!~!<esbdtje!|!*utfUbiqmBv!>=!b/spmpDwv)!gj!|!ftmf!~!~!<esbdtje!|!*1/1!>>!b/spmpDwv)!gj!|!*uofsbqtobsUv)!gj!gjeof$!<*wVw!-sfmqnbTv)E3fsvuyfu!>!spmpDwv!ftmf$!<*zy/wVw!-sfmqnbTv)E3fsvuyfu!>!spmpDwv!QJMD`WV!gfegj$!|!**fmcbudfmfTesbdtjEv!%%!ldjQv)a!%%!fsvuyfUv)!gj!<spmpDwv!5dfw!|!*ejpw)ojbn!ejpw!<uvpldbmc!mppc!nspgjov!gjeof$!<^UDFKCP`XPMG`YBN]wVxpmg!3dfw!hojzsbw!<^UDFKCP`XPMG`YBN]efmcboFxpmg!mppc!nspgjov!<^UDFKCP`XPMG`YBN]fsvuyfUxpmg!E3sfmqnbt!nspgjov!1!?!UDFKCP`XPMG`YBN!gj$!gjeof$!gjeof$!~!~!<*1/2!-*Gqjn!-2spmpd!-1spmpd)yjn)5dfw!osvufs!<*1/2!,!uoJqjn!-sjEfmqnbt!-qbNwof)WVfcvDsbfojmjc!>!2spmpd!4dfw!|!ftmf!~!<*1/2!-1spmpd)5dfw!osvufs!|!*1/1!>>!Gqjn)!gj!<*uoJqjn!-sjEfmqnbt!-qbNwof)WVfcvDsbfojmjc!>!1spmpd!4dfw!<*qjn)sppmg!>!uoJqjn!ubpmg!<*qjn)udbsg!>!Gqjn!ubpmg!<*mfwfMqjNybn`WVfcvd!-1n!-*ttfoihvps)qjNpUttfoihvps)qnbmd!>!qjn!ubpmg!|!*ttfoihvps!ubpmg!-sjEfmqnbt!4dfw!-qbNwof!E3sfmqnbt)WVfcvDfsvuyfu!5dfw!~!<qjn!osvufs!~!<*ttfoihvps!+!72/2)3hpm!+!1/3!.!>!qjn!|!ftmf!~!<6n!,!*7s!.!6s)!0!*6n!.!7n)!+!*ttfoihvps!.!6s)!>!qjn!|!*7s!>?!ttfoihvps)!gj!ftmf!~!<5n!,!*6s!.!5s)!0!*5n!.!6n)!+!*ttfoihvps!.!5s)!>!qjn!|!*6s!>?!ttfoihvps)!gj!ftmf!~!<2n!,!*5s!.!2s)!0!*2n!.!5n)!+!*ttfoihvps!.!2s)!>!qjn!|!*5s!>?!ttfoihvps)!gj!ftmf!~!<1n!,!*2s!.!1s)!0!*1n!.!2n)!+!*ttfoihvps!.!1s)!>!qjn!|!*2s!>?!ttfoihvps)!gj!<1/1!>!qjn!ubpmg!|!*ttfoihvps!ubpmg)qjNpUttfoihvps!ubpmg!1/5!7n!fojgfe$!9411/1!7w!fojgfe$!23/1!7s!fojgfe$!1/4!6n!fojgfe$!721/1!6w!fojgfe$!614/1!6s!fojgfe$!1/3!5n!fojgfe$!751/1!5w!fojgfe$!5/1!5s!fojgfe$!1/2!.!2n!fojgfe$!783/1!2w!fojgfe$!9/1!2s!fojgfe$!1/3!.!1n!fojgfe$!:44/1!1w!fojgfe$!1/2!1s!fojgfe$!~!<*z/g!-nc!-nu)yjn!osvufs!<*y/g!-sc!-mc)yjn!>!nc!4dfw!<*y/g!-su!-mu)yjn!>!nu!4dfw!<chs/**wv!-qbNwof)E3fsvuyfu)sbfojMpUmfyfUqbNwof!>!mc!4dfw!<f{jTmfyfu!>.!y/wv!<chs/**wv!-qbNwof)E3fsvuyfu)sbfojMpUmfyfUqbNwof!>!sc!4dfw!<f{jTmfyfu!>,!z/wv!<chs/**wv!-qbNwof)E3fsvuyfu)sbfojMpUmfyfUqbNwof!>!su!4dfw!<f{jTmfyfu!>,!y/wv!<chs/**wv!-qbNwof)E3fsvuyfu)sbfojMpUmfyfUqbNwof!>!mu!4dfw!<f{jTmfyfu!>+!wv!<*f{jTfdbg!+!1/3!.!f{jTfmjUybn`WVfcvd!-1/1)ybn!+!1/4!>,!y/wv!<f{jTfmjUojn`WVfcvd!+!1/3!+!uoJsfumjg!>,!z/wv!~!<f{jTfmjUybn`WVfcvd!+!1/3!>,!z/wv!|!*mfwfMqjNybn`WVfcvd!=!uoJqjn)!gj!<f{jTfdbg!+!fdbg!>,!y/wv!~!<1/4!>.!fdbg!<f{jTfdbg!>,!z/wv!|!*1/3!?!fdbg)!gj!<g!.!6/1!>,!wv!<*wv)udbsg!>!g!3dfw!<*1/2!.!f{jTfdbg)!+!*fdbg!-opjudfsje)WVufh!>!wv!3dfw!<*f{jTfmjUybn`WVfcvd!+!1/4)!0!1/2!>!f{jTmfyfu!ubpmg!<*uoJqjn)3qyf!>!f{jTfdbg!ubpmg!<*mfwfMqjNojn`WVfcvd!-uoJqjn)ybn!>!uoJqjn!<*1/1!-uoJqjn!.!mfwfMqjNojn`WVfcvd)ybn!>!uoJsfumjg!ubpmg!<*opjudfsje)fdbGufh!>!fdbg!ubpmg!|!*uoJqjn!ubpmg!-opjudfsje!4dfw!-qbNwof!E3sfmqnbt)WVfcvDsbfojmjc!4dfw!~!<*1/2!,!wv)!+!6/1!osvufs!~!<*{/opjudfsje)tcb!0!*z/opjudfsje!-y/opjudfsje)3dfw!>!wv!|!ftmf!~!<*z/opjudfsje)tcb!0!*{/opjudfsje!-y/opjudfsje!.)3dfw!>!wv!|!*1/5!>>!fdbg)!gj!ftmf!~!<*y/opjudfsje)tcb!0!*z/opjudfsje!-{/opjudfsje!.)3dfw!>!wv!|!*1/4!>>!fdbg)!gj!ftmf!~!<*{/opjudfsje)tcb!0!*z/opjudfsje!-y/opjudfsje!.)3dfw!>!wv!|!*1/3!>>!fdbg)!gj!ftmf!~!<*z/opjudfsje)tcb!0!*{/opjudfsje!.!-y/opjudfsje!.)3dfw!>!wv!|!*1/2!>>!fdbg)!gj!ftmf!~!<*y/opjudfsje)tcb!0!*z/opjudfsje!-{/opjudfsje)3dfw!>!wv!|!*1/1!>>!fdbg)!gj!<wv!3dfw!|!*fdbg!ubpmg!-opjudfsje!4dfw)WVufh!3dfw!~!<fdbg!osvufs!~!<1/5!;!1/2!@!1/1!?!z/opjudfsje!>!fdbg!ftmf!<1/6!;!1/3!@!1/1!?!{/opjudfsje!>!fdbg!*z/opjudfsjEtcb!?!{/opjudfsjEtcb)!gj!|!ftmf!~!<1/5!;!1/2!@!1/1!?!z/opjudfsje!>!fdbg!ftmf!<1/4!;!1/1!@!1/1!?!y/opjudfsje!>!fdbg!*z/opjudfsjEtcb!?!y/opjudfsjEtcb)!gj!|!*{/opjudfsjEtcb!?!y/opjudfsjEtcb)!gj!<1/2!.!>!fdbg!ubpmg!<*opjudfsje)tcb!>!opjudfsjEtcb!4dfw!|!*opjudfsje!4dfw)fdbGufh!ubpmg!1/72!f{jTfmjUojn`WVfcvd!fojgfe$!1/763!f{jTfmjUybn`WVfcvd!fojgfe$!1/5!mfwfMqjNojn`WVfcvd!fojgfe$!1/9!mfwfMqjNybn`WVfcvd!fojgfe$!WV`FCVD`FQZU`QBNWOF!gfegj$!~!<*{zy/*yjsubn!+!*1/1!-sje)5dfw))f{jmbnspo!osvufs!|!*yjsubn!5ubn!oj!-sje!4dfw!oj)opjudfsjEnspgtobsUftsfwoj!4dfw!gjeof$!~!<*x/fvmbw!-**SPUDBG`BNNBH)4dfw!-{zy/fvmbw)xpq)5dfw!osvufs!|!*fvmbw!5dfw)sbfojMpUmfyfUqbNwof!5dfw!ftmf$!~<*!b/fvmbw!-*!*!*!*!9142411/1!)4dfw!-chs/fvmbw!)mbvrFobiUttfm!)4dfw!-3:/32!+!chs/fvmbw!-*!661/1!)4dfw!.!661/2!+!*!*!77725/1!)4dfw!-chs/fvmbw!)xpq!)yjn!)5dfw!osvufs!|!*!fvmbw!5dfw!oj!)CHStpUsbfojM!5dfw!~!<*b/fvmbw!-****65151/1)4dfw!-chs/fvmbw)mbvrFobiUttfm)4dfw!-9194::4881/1!+!chs/fvmbw!-**5/3)4dfw!-*5218342361/1)4dfw!,!79:387985:/1!+!chs/fvmbw)xpq)yjn)5dfw!osvufs!|!*fvmbw!5dfw)sbfojMpUmfyfUqbNwof!5dfw!WV`FCVD`FQZU`QBNWOF!gfegj$!gjeof$!~!<{zy/*!*x/ubvr!-{/ubvr.!-z/ubvr.!-y/ubvr.)5dfw!-wr!)ubvRumvn!osvufs!<*!*1/1!-dfw)5dfw!-ubvr!)ubvRumvn!>!wr!5dfw!|!*!dfw!4dfw!-ubvr!5dfw!)spudfWfubups!4dfw!~!<*!{/3r!+!{/2r!.!z/3r!+!z/2r!.!y/3r!+!y/2r!.!x/3r!+!x/2r!-z/3r!+!y/2r!.!y/3r!+!z/2r!,!x/3r!+!{/2r!,!{/3r!+!x/2r!-y/3r!+!{/2r!.!{/3r!+!y/2r!,!x/3r!+!z/2r!,!z/3r!+!x/2r!-{/3r!+!z/2r!.!z/3r!+!{/2r!,!x/3r!+!y/2r!,!y/3r!+!x/2r)5dfw!osvufs!|!*3r!5dfw!-2r!5dfw)ubvRumvn!5dfw!<ubvRqbnwoFv!5dfw!nspgjov!FUBUPS`QBNWOF!gfegj$!<1/3!>!SPUDBG`BNNBH!ubpmg!utopd!QBNWOF`FTV!gfegj$!gjeof$!~!gjeof$!<*qe!-*z/f{jTmfyfu!-E4ec)WVpUfcvd!-qbNxpebit)fsbqnpDE3fsvuyfu!osvufs!ftmf$!<*1/:!0!1/2)!+!*!*qe!-*z/f{jTmfyfu!-yyz/uftggp!,!E4ec)WVpUfcvd!-qbNxpebit)fsbqnpDE3fsvuyfu!,!*qe!-*z/f{jTmfyfu!-yyy/uftggp!,!E4ec)WVpUfcvd!-qbNxpebit)fsbqnpDE3fsvuyfu!,!*qe!-*z/f{jTmfyfu!-zyz/uftggp!,!E4ec)WVpUfcvd!-qbNxpebit)fsbqnpDE3fsvuyfu!,!*qe!-*z/f{jTmfyfu!-zyy/uftggp!,!E4ec)WVpUfcvd!-qbNxpebit)fsbqnpDE3fsvuyfu!,!*qe!-*z/f{jTmfyfu!-E4ec)WVpUfcvd!-qbNxpebit)fsbqnpDE3fsvuyfu!,!*qe!-*z/f{jTmfyfu!-yzz/uftggp!,!E4ec)WVpUfcvd!-qbNxpebit)fsbqnpDE3fsvuyfu!,!*qe!-*z/f{jTmfyfu!-yzy/uftggp!,!E4ec)WVpUfcvd!-qbNxpebit)fsbqnpDE3fsvuyfu!,!*qe!-*z/f{jTmfyfu!-zzz/uftggp!,!E4ec)WVpUfcvd!-qbNxpebit)fsbqnpDE3fsvuyfu!,!*qe!-*z/f{jTmfyfu!-zzy/uftggp!,!E4ec)WVpUfcvd!-qbNxpebit)fsbqnpDE3fsvuyfu!)!osvufs!<z/f{jTmfyfu!+!tvjebSxpebit!+!*2!-2!.)3dfw!>!uftggp!3dfw!*UGPT`GDQ`FQZU`QBNXPEBIT)efojgfe!}}!*GDQ`FQZU`QBNXPEBIT)efojgfe!gj$!<*opjujtpQpUuihjm)f{jmbnspo!>!E4ec!4dfw!<tbjCxpebit!>,!qe!<*sbfObsfnbDxpebit!.!sbGbsfnbDxpebit)!0!*sbfObsfnbDxpebit!.!*opjujtpQpUuihjm)iuhofm)!>!qe!ubpmg!<{zy/esppDxpebit!>!opjujtpQpUuihjm!4dfw!<**1/3!-1/5)3dfw!+!f{jTqbNxpebit)!0!*1/2)3dfw!>!f{jTmfyfu!3dfw!|!*sbGbsfnbDxpebit!ubpmg!-sbfObsfnbDxpebit!ubpmg!-esppDxpebit!5dfw!-tvjebSxpebit!ubpmg!-tbjCxpebit!ubpmg!-f{jTqbNxpebit!3dfw!-qbNxpebit!E3sfmqnbt)xpebiTuojpQufh!ubpmg!~!<*68/1!-684/1)3dfw!,!sbobmq!+!*63/1!-632/1)3dfw!osvufs!~!<1/3!.!Zohjt!+!{/w!>!z/sbobmq!<1/3!,!Zohjt!+!1/3!,!y/w!>!y/sbobmq!<*z/w)ohjt!>!Zohjt!ubpmg!|!*foPutpnmb!>?!z/Wtcb)!gj!ftmf!~!<Yohjt!+!1/3!,!Yohjt!+!{/w!>!y/sbobmq!<*y/w)ohjt!>!Yohjt!ubpmg!|!*foPutpnmb!>?!y/Wtcb)!gj!ftmf!~!<y/w!.!1/5!>!y/sbobmq!*1/1!?!{/w)!gj!|!*foPutpnmb!>?!{/Wtcb)!gj!<mfyfUButpnmb!.!1/2!>!foPutpnmb!ubpmg!<Zf{jTmfyfu!+!6/2!>!mfyfUButpnmb!ubpmg!<zy/w!>!sbobmq!3dfw!<*Zf{jTmfyfu!+!1/3!.!1/2)!+!fcvDpUfmbdt!>+!w!<fcvDpUfmbdt!>+!Wtcb!<**{/Wtcb!-z/Wtcb)ybn!-y/Wtcb)ybn!0!1/2!>!fcvDpUfmbdt!ubpmg!<*w)tcb!>!Wtcb!4dfw!|!*Zf{jTmfyfu!ubpmg!-w!4dfw)WVpUfcvd!3dfw!~!<xpebit!osvufs!~!gjeof$!<*{/esppDxpebit!-zy/esppDxpebit!-qbNxpebit)fsbqnpDE3fsvuyfu!>!xpebit!ftmf$!<*1/:!0!1/2)!+!*!*{/esppDxpebit!-*2ze!-2ye)3dfw!,!zy/esppDxpebit!-f{jTqbNxpebit!-qbNxpebit)qsfMxpebiTE3fsvuyfu!,!*{/esppDxpebit!-*2ze!-1/1)3dfw!,!zy/esppDxpebit!-f{jTqbNxpebit!-qbNxpebit)qsfMxpebiTE3fsvuyfu!,!*{/esppDxpebit!-*2ze!-1ye)3dfw!,!zy/esppDxpebit!-f{jTqbNxpebit!-qbNxpebit)qsfMxpebiTE3fsvuyfu!,!*{/esppDxpebit!-*1/1!-2ye)3dfw!,!zy/esppDxpebit!-f{jTqbNxpebit!-qbNxpebit)qsfMxpebiTE3fsvuyfu!,!*{/esppDxpebit!-zy/esppDxpebit!-f{jTqbNxpebit!-qbNxpebit)qsfMxpebiTE3fsvuyfu!,!*{/esppDxpebit!-*1/1!-1ye)3dfw!,!zy/esppDxpebit!-f{jTqbNxpebit!-qbNxpebit)qsfMxpebiTE3fsvuyfu!,!*{/esppDxpebit!-*1ze!-2ye)3dfw!,!zy/esppDxpebit!-f{jTqbNxpebit!-qbNxpebit)qsfMxpebiTE3fsvuyfu!,!*{/esppDxpebit!-*1ze!-1/1)3dfw!,!zy/esppDxpebit!-f{jTqbNxpebit!-qbNxpebit)qsfMxpebiTE3fsvuyfu!,!*{/esppDxpebit!-*1ze!-1ye)3dfw!,!zy/esppDxpebit!-f{jTqbNxpebit!-qbNxpebit)qsfMxpebiTE3fsvuyfu!)!>!xpebit!<tvjebSxpebit!+!z/f{jTmfyfu!,!>!2ze!ubpmg!<tvjebSxpebit!+!y/f{jTmfyfu!,!>!2ye!ubpmg!<tvjebSxpebit!+!z/f{jTmfyfu!.!>!1ze!ubpmg!<tvjebSxpebit!+!y/f{jTmfyfu!.!>!1ye!ubpmg!<f{jTqbNxpebit!0!*1/2)3dfw!>!f{jTmfyfu!3dfw!*UGPT`GDQ`FQZU`QBNXPEBIT)efojgfe!gjmf$!<*1/:!0!1/2)!+!*!*{/esppDxpebit!-*2ze!-2ye)3dfw!,!zy/esppDxpebit!-qbNxpebit)fsbqnpDE3fsvuyfu!,!*{/esppDxpebit!-*2ze!-1/1)3dfw!,!zy/esppDxpebit!-qbNxpebit)fsbqnpDE3fsvuyfu!,!*{/esppDxpebit!-*2ze!-1ye)3dfw!,!zy/esppDxpebit!-qbNxpebit)fsbqnpDE3fsvuyfu!,!*{/esppDxpebit!-*1/1!-2ye)3dfw!,!zy/esppDxpebit!-qbNxpebit)fsbqnpDE3fsvuyfu!,!*{/esppDxpebit!-zy/esppDxpebit!-qbNxpebit)fsbqnpDE3fsvuyfu!,!*{/esppDxpebit!-*1/1!-1ye)3dfw!,!zy/esppDxpebit!-qbNxpebit)fsbqnpDE3fsvuyfu!,!*{/esppDxpebit!-*1ze!-2ye)3dfw!,!zy/esppDxpebit!-qbNxpebit)fsbqnpDE3fsvuyfu!,!*{/esppDxpebit!-*1ze!-1/1)3dfw!,!zy/esppDxpebit!-qbNxpebit)fsbqnpDE3fsvuyfu!,!*{/esppDxpebit!-*1ze!-1ye)3dfw!,!zy/esppDxpebit!-qbNxpebit)fsbqnpDE3fsvuyfu!)!>!xpebit!<tvjebSxpebit!+!z/f{jTmfyfu!,!>!2ze!ubpmg!<tvjebSxpebit!+!y/f{jTmfyfu!,!>!2ye!ubpmg!<tvjebSxpebit!+!z/f{jTmfyfu!.!>!1ze!ubpmg!<tvjebSxpebit!+!y/f{jTmfyfu!.!>!1ye!ubpmg!<f{jTqbNxpebit!0!*1/2)3dfw!>!f{jTmfyfu!3dfw!*GDQ`FQZU`QBNXPEBIT)efojgfe!gj$!|!*utfUnvutvsg)!gj!<*dfWutfUnvutvsg)mmb!>!utfUnvutvsg!mppc!<*1/2!>=!{/esppDxpebit!-nvutvsGoj)3dfwc!>!dfWutfUnvutvsg!3dfwc!<*dfWnvutvsGoj)mmb!>!nvutvsGoj!mppc!<*1/2!>=!z/esppDxpebit!-1/1!>?!z/esppDxpebit!-1/2!>=!y/esppDxpebit!-1/1!>?!y/esppDxpebit)!5dfwc!>!dfWnvutvsGoj!5dfwc!<*::::::/1!-{/esppDxpebit)ojn!>!{/esppDxpebit!<tbjCxpebit!>,!{/esppDxpebit!<x/esppDxpebit!>0!{zy/esppDxpebit!<1/2!>!xpebit!ubpmg!|!*esppDxpebit!5dfw!-tvjebSxpebit!ubpmg!-tbjCxpebit!ubpmg!-f{jTqbNxpebit!3dfw!-qbNxpebit!E3sfmqnbt)xpebiTufh!ubpmg!~!<d!osvufs!<*y/g!-c!-b)yjn!>!d!ubpmg!<*z/g!-us!-cs)yjn!>!c!ubpmg!<*z/g!-um!-cm)yjn!>!b!ubpmg!<*6/1!,!f{jt!+!wv)udbsg!>!g!3dfw!<*fsbqnpd!-zz/uftggp!+!f{jTmfyfu!,!WVejpsuofd!-tiuqfe)fsbqnpDE3fsvuyfu!>!us!ubpmg!<*fsbqnpd!-yz/uftggp!+!f{jTmfyfu!,!WVejpsuofd!-tiuqfe)fsbqnpDE3fsvuyfu!>!cs!ubpmg!<*fsbqnpd!-zy/uftggp!+!f{jTmfyfu!,!WVejpsuofd!-tiuqfe)fsbqnpDE3fsvuyfu!>!um!ubpmg!<*fsbqnpd!-yy/uftggp!+!f{jTmfyfu!,!WVejpsuofd!-tiuqfe)fsbqnpDE3fsvuyfu!>!cm!ubpmg!<f{jt!0!*6/1!,!f{jt!+!wv)sppmg!>!WVejpsuofd!3dfw!<f{jt!0!*1/2)3dfw!>!f{jTmfyfu!3dfw!<*1/2!-1/1)3dfw!>!uftggp!3dfw!utopd!|!*fsbqnpd!ubpmg!-wv!3dfw!-f{jt!3dfw!-tiuqfe!E3sfmqnbt)qsfMxpebiTE3fsvuyfu!ubpmg!~!<***wv!-tiuqfe)E3fsvuyfu)iuqfEpUBCHSldbqov!-fsbqnpd)qfut!osvufs!|!*fsbqnpd!ubpmg!-wv!3dfw!-tiuqfe!E3sfmqnbt)fsbqnpDE3fsvuyfu!ubpmg!~!<*tspudbGldbqoV!-w)upe!osvufs!|!*w!5dfw!oj!utopd)iuqfEpUBCHSldbqov!ubpmg!<*/2!-tspudbGldbQ)5dfw!0!fmbdtoxpEldbqoV!>!tspudbGldbqoV!5dfw!utopd!<*/763!-/763!+!/763!-/763!+!/763!+!/763)4dfw!>!tspudbGldbQ!4dfw!utopd!</763!0!/663!>!fmbdtoxpEldbqoV!ubpmg!utopd!</663!0!/763!>!fmbdtqVldbQ!ubpmg!utopd!<esppDxpebit!5dfw!hojzsbw!<fwjfdfSxpebit!mppc!nspgjov!<tvjebSxpebit!ubpmg!nspgjov!<tbjCxpebit!ubpmg!nspgjov!<zujtofuoJxpebit!ubpmg!nspgjov!<f{jTxpebit!3dfw!nspgjov!<qbNxpebit!E3sfmqnbt!nspgjov!<mmvDxpebit!mppc!nspgjov!QBNXPEBIT`FTV!gfegj$!gjeof$!<fdobutjEfojMw!ubpmg!hojzsbw!<fdobutjEqbHitbEv!ubpmg!nspgjov!<fdobutjEitbEv!ubpmg!nspgjov!<itbEv!mppc!nspgjov!ITBE!gfegj$!gjeof$!gjeof$!<sbGhpGv!ubpmg!nspgjov!<sbfOhpGv!ubpmg!nspgjov!ftmf$!<zujtofEhpGv!ubpmg!nspgjov!3QYF`HPG!gfegj$!<hpGv!mppc!nspgjov!<spmpDhpGv!5dfw!nspgjov!HPG!gfegj$!gjeof$!<*6/1!-6/1!-6/1)4dfw!>!ybNqjmd!4dfw!utopd!<*6/1.!-6/1.!-6/1.)4dfw!>!ojNqjmd!4dfw!utopd!<^SFQQJMD`YPC`YBN]yjsubNsfqqjmDv!5ubn!nspgjov!<^SFQQJMD`YPC`YBN]sfooJqjmDsfqqjmDv!mppc!nspgjov!<^SFQQJMD`YPC`YBN]fqbiTsfqqjmDv!uoj!nspgjov!1!?!SFQQJMD`YPC`YBN!gj$!gjeof$!<^UPQT`YBN]opjudfsjEupqTv!4dfw!nspgjov!<^UPQT`YBN]opjujtpQupqTv!4dfw!nspgjov!<^UPQT`YBN]fhobSupqTv!ubpmg!nspgjov!<^UPQT`YBN]fmhoBupqTv!ubpmg!nspgjov!<^UPQT`YBN]uofopqyFupqTv!ubpmg!nspgjov!<^UPQT`YBN]spmpDupqTv!5dfw!nspgjov!1!?!UPQT`YBN!gj$!gjeof$!<^UOJPQ`YBN]opjujtpQuojpQv!4dfw!nspgjov!<^UOJPQ`YBN]fhobSuojpQv!ubpmg!nspgjov!<^UOJPQ`YBN]spmpDuojpQv!5dfw!nspgjov!1!?!UOJPQ`YBN!gj$!gjeof$!<^SJE`YBN]opjudfsjEsjEv!4dfw!nspgjov!<^SJE`YBN]spmpDsjEv!5dfw!nspgjov!1!?!SJE`YBN!gj$!gjeof$!<eofmCidubCw!4dfw!hojzsbw!<eofmCidubCv!mppc!nspgjov!EOFMCIDUBC!gfegj$!gjeof$!<ttfouihjsCidubCw!ubpmg!hojzsbw!<ttfouihjsCidubCv!mppc!nspgjov!TTFOUIHJSCIDUBC!gfegj$!gjeof$!<spmpDidubCw!5dfw!hojzsbw!<spmpDidubCv!mppc!nspgjov!SPMPDIDUBC!gfegj$!<opjudfsjEuihjmebfIv!4dfw!nspgjov!<spmpDuihjmebfIv!5dfw!nspgjov!<zujtofuoJuofjcnBuihjmebfIv!ubpmg!nspgjov!<fhobSuihjmebfIv!ubpmg!nspgjov!<emspXw!4dfw!hojzsbw!<opjujtpQbsfnbDv!4dfw!nspgjov!<yjsubNxfjWv!5ubn!nspgjov!gjeof$!gjeof$!<qbNwoFv!fcvDsfmqnbt!nspgjov!ftmf$!<ttfoihvps!ubpmg!nspgjov!<qbNwoFv!E3sfmqnbt!nspgjov!WV`FCVD`FQZU`QBNWOF!gfegj$!<zujwjudfmgfSv!ubpmg!nspgjov!<qbNwoFftVv!mppc!nspgjov!QBNWOF`FTV!gfegj$!<opjujtpQw!4dfw!hojzsbw!<yfusfWw!4dfw!hojzsbw!<mbnspOw!4dfw!hojzsbw!<ftvggjEv!5dfw!nspgjov!<zujdbqPusbQv!ubpmg!nspgjov!<ttfouihjsCv!ubpmg!nspgjov!<uihjMv!mppc!nspgjov!<spmpDeofmCv!5dfw!nspgjov!<eofmCv!mppc!nspgjov!<uofdsfQqjmDv!ubpmg!nspgjov!<opjudfsjEqjmDv!uoj!nspgjov!<sfmqnbTeofmCv!E3sfmqnbt!nspgjov!<sfmqnbTv!E3sfmqnbt!nspgjov!gjeof$!<wVw!3dfw!hojzsbw!ftmf$!<wVw!4dfw!hojzsbw!QJMD`WV!gfegj$!<fsvuyfUeofmCv!mppc!nspgjov!<fsvuyfUv!mppc!nspgjov!<uofsbqtobsUv!mppc!nspgjov!<utfUbiqmBv!ubpmg!nspgjov!<spmpDftsfwfSldjQyjGv!5dfw!nspgjov!<qjmGftsfwfSv!mppc!nspgjov!<ldjQv!mppc!nspgjov!<yjGv!mppc!nspgjov!<fmcbudfmfTesbdtjEv!mppc!nspgjov!YJGFSQ$!gjeof$!gjeof$!<ubpmg!qnvjefn!opjtjdfsq!ftmf$!<ubpmg!qihji!opjtjdfsq!IHJI`OPJTJDFSQ`UOFNHBSG`MH!gfegj$!TF`MH!gfegj$!";
xo(F,{setBatchInfo:function(x,b){al[x]=b},getBatchInfo:function(v){return al[v]},getBatchInfoMap:function(){return al},setBatchInfoMap:function(Y){al=Y}},!0);var Se=[1,1,1],tc=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],be=[1,0,0,0,0,1,0,1,1,1,1,0],Bf=[-.5,.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,.5],Di=[.5,.5,-.5,.5,.5,.5,.5,-.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5],Oe=[.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,.5,.5,.5,-.5],Ap=[.5,-.5,.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,.5],cm=[.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5],bc=[-.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5],yr=function(M,u){var F=M._40Q;F.each(function(P){P.ivBatch(u)})},Dq=function(N,t,Q){var z=Q._id,k=t[z];if(k){var H=k.batch,w=N[H],E=w.ds,L=k.index;if(w.invalidate=!0,delete t[z],E.splice(L,1),pi(E))return delete N[H],void 0;for(var q=L,Y=k.begin,p=k.size;L<E.length;L++)k=t[E[L]._id],k.index--,k.begin-=p;if(w.ms&&w.ms.length)return w.ms.splice(16*q,16),w.ics&&w.ics.splice(4*q,4),w.ps&&w.ps.splice(4*q,4),void 0;var _=3*Y,F=3*p,V=4*Y,n=4*p,J=w.vs,R=w.ps,W=w.uv,l=w.cs,$=w.bs,b=w.rs,B=w.ns,r=w.ls;J.splice(_,F),R.splice(V,n),W&&W.splice(2*Y,2*p),l&&l.splice(V,n),$&&$.splice(_,F),b&&b.splice(Y,p),B&&B.splice(_,F),r&&r.splice(Y,p)}},Vc=function(o,O,t,x,E){if(!x)return N;var U=O[x];if(!U){var m=E.getBatchInfo(x)||go,k=m.image?[]:N;U=O[x]={vs:[],ns:[],uv:k,cs:k?N:m.color?N:[],bs:m.blend?[]:N,ps:[],rs:m.brightness?[]:N,ds:[],ms:m.instanced?[]:N,ics:k?N:m.color||!m.instanced?N:[]}}return U.invalidate=!0,o[t._id]={index:U.ds.length,begin:U.vs.length/3,batch:x},U.ds.push(t),U},ys=function(O,e){return e!=N&&1!==e?[O[0]*e,O[1]*e,O[2]*e,O[3]]:O},Bl=function(U){var u=U.shapeModel;u||(u=Kd(U)),u&&(u._ctlineModel=[],u._lineModel=I)},Vd=function(){var U;return function(X,k){var B,o=X.data,M=o.s("wf.combineTriangle");if(!k&&(o instanceof y.Node&&!(o instanceof y.Shape)?(U||(U={vs:Er,is:Kl,uv:qs}),k=U):k=[X.left,X.front,X.right,X.back,X.top,X.bottom],!k))return I;if(M){var v=o.s("wf.normEpsilon");isNaN(v)&&(v=2),M=0|Math.min(3,Math.max(1,isNaN(M)?1:M)),B=om[M-1](k,X,180/(Math.PI*v))}else B=tm(k,X);return B}}(),ae=function(){return function(p,M,s){var g=p.getData3dUI(M),R=g.shapeModel;if(R||(R=Kd(g)),R||!g.shapeName){var L,J;if(s.geometry){if(g.wfGeometry?(J=g.wfMatrix,L=g.wfGeometry,g.wfGeometry=I):L=Vd(g,R),!L||0===L.length)return}else if(L=s.short?Zk:fq,M.s("wf.boundingBox")){var l=g.getBoundingBox(!0);if(l){var j=(new Ic).scale(l.max.clone().sub(l.min)).setPosition(l.max.clone().add(l.min).divideScalar(2)).toArray();L=gg([],j,L)}}var i,n,W,G=p.getBrightness(M),x=M.s("bloom"),q=M.s("3d.reflectable"),N=Ng(s.color||"white"),v=N[3]<1,P=Math.ceil(s.width)||1,w=M.s("3d.clipbox")?ar:M.s("3d.clipbox.mask"),K=M.s("wf.fog"),U=M.getRenderLayer(),f=p._40Q.get(U),a=f.wireframeIndexMap,V=f.wireframeModelMap,k=M.s("batch"),z=M.s("3d.clip.direction");if(z){if(n=M.s("3d.clip.percentage"),0===n)return;i="_"+M._id,W=g._formatClipUniforms(z,n,M)}else i=k?(v?"T":"O")+k:(v?"T":"O")+(x?"_1":"_0")+(q?"1_":"0_")+w+"_"+P+(K?"1_":"0_");var $=V[i];$||($=V[i]={vs:[],cs:[],ps:[],ds:[],T:v,B:x,clipboxMask:w,reflectable:!!q,W:P,batch:k,fog:K}),$.invalidate=!0;var e=$.vs,m=$.cs,d=$.ds,r=a[M._id]={index:d.length,begin:e.length/3,batch:i};d.push(M);var Z,S=J||g.mat;s.geometry&&M instanceof y.Shape&&(F.extractShapeTranslation||F.extractPolylineTranslation||F.extractVerticesTranslation)&&(Z=g._vsTranslation)&&S&&(S=(new fl.Matrix4).fromArray(S).multiply(Z).toArray()),M instanceof y.Edge||!(!S||!s.geometry&&M instanceof y.Shape)||(S=rg(M,s.mat),M.appendAnchorMatrix3d(S)),W?($.mat=Sc(S),$.clipDirection=W[0],$.clipPercent=W[1],gg(e,null,L)):gg(e,S,L);var Q=r.size=e.length/3-r.begin;ak(m,ys(N,G),Q)}}}(),$d=function(w,K,C,A,g,h,W,x,E){var b=w.getBrightness(K);b==N&&(b=1);var G=ys(Ng(A),b),L=G[3]<1;h=Math.ceil(h)||1;var u=K.s("3d.clipbox")?ar:K.s("3d.clipbox.mask"),s=(L?"T":"O")+h+"_"+u;if(W){var M=W[0],d=(W[1]||M)+M;s+="-"+M+"-"+d,E&&(s+="-"+_f(E)+"-"+b,E=ys(Ng(E),b))}var Z=K.getRenderLayer(),D=w._40Q.get(Z),X=D.polylineIndexMap,J=D.polylineModelMap,r=J[s];r||(r=J[s]={vs:[],cs:[],ps:[],ds:[],ls:W?[]:N,T:L,clipboxMask:u,W:h},W&&(r.D=M,r.G=d,r.A=E)),r.invalidate=!0;var p,e=r.vs,Y=r.cs,t=r.ds,B=r.ls,i=X[K._id]={index:t.length,begin:e.length/3,batch:s};t.push(K);var k;!(k=w.getData3dUI(K).mat)&&K instanceof y.Polyline&&(k=rg(K),K.appendAnchorMatrix3d(k)),gg(e,k,C);var S,U=i.size=e.length/3-i.begin,j=C.length,f=0,P=[];if(W||g)for(p=0;j>p;p+=6)S=So([C[p],C[p+1],C[p+2]],[C[p+3],C[p+4],C[p+5]]),P.push(S),f+=S;if(f&&g){var Q,I=ys(Ng(g),b),V=[I[0]-G[0],I[1]-G[1],I[2]-G[2],I[3]-G[3]],z=0;for(p=0;j>p;p+=6)Q=z/f,ak(Y,[G[0]+V[0]*Q,G[1]+V[1]*Q,G[2]+V[2]*Q,G[3]+V[3]*Q],1),z+=P[p/6],Q=z/f,ak(Y,[G[0]+V[0]*Q,G[1]+V[1]*Q,G[2]+V[2]*Q,G[3]+V[3]*Q],1)}else ak(Y,G,U);if(W)for(z=x||0,p=0;j>p;p+=6)B.push(z),z+=P[p/6],B.push(z)},Fq=function(o,t,p){if(t){var s=p[t.batch],M=s.ps,l=s.ms&&s.ms.length,P=l?4*t.index:4*t.begin,m=l?1:t.size;if(M[P]!==o[0]||M[P+1]!==o[1]||M[P+2]!==o[2]||M[P+3]!==o[3]){for(var x=0;m>x;x++)M[P++]=o[0],M[P++]=o[1],M[P++]=o[2],M[P++]=o[3];M._invalidateThisFrame=!0}}},Md=function(){var P=new y.Math.Vector3,X=new y.Math.Vector3;return function(m,W){var B=W+["32"],d=m[W],Q=m[B];if(d){if((F.extractBatchTranslation||F.extractVerticesTranslation)&&"vs"===W){X.set(0,0,0);for(var h=d.length,k=0;h>k;k+=3)X.add(P.fromArray(d,k));X.divideScalar(h/3);for(var H=X.x,R=X.y,g=X.z,I=new Array(h),k=0;h>k;k+=3)I[k]=d[k]-H,I[k+1]=d[k+1]-R,I[k+2]=d[k+2]-g;d=I,m.translate=[H,R,g]}Q&&Q.length===d.length?(Q.set(d),Q._bufId=null):m[B]=new ub(d)}else delete m[B]}}(),Qk=function(V,l,s,E,r,O,M,o){var n=l instanceof y.Shape,w=O[0],N=O.length;if(N>1){w=Sc(w);for(var R=1;N>R;R++)Im(w,w,O[R])}if(n){var X=l.p3();Yc(w,X)}Bm(M.ms,w);var P;if(M.ics&&(P=l.s("shape3d.color"))&&ak(M.ics,P,1),!M.vs.length){var u=Sc(tc);n&&Yc(u,mk(X)),fi(V,l,s,E,r,[u],M,o)}},fi=function(H,i,G,Y,F,c,z,e){if(hr(G))G.forEach(function(I){fi(H,i,I,Y,F,c,z,e)});else if(Je(G))fi(H,i,Kd(Y,G),Y,F,c,z,e);else if(Go(G)){var W,q=Aq(G.mat,i,H),D=Aq(G.s3,i,H),f=Aq(G.t3,i,H),Q=Aq(G.r3,i,H);if((D||Q||f||q)&&(W=xm(q,D,Q,Aq(G.rotationMode,i,H),f),c.push(W)),G.shape3d)fi(H,i,G.shape3d,Y,F,c,z,G);else{var a=Y.s;e=e||go;var M=c[0],K=c.length,P=a("shape3d.color",G.color,e.color);if(F||(F=a("shape3d.blend",G.blend,e.blend)),K>1){M=Sc(M);for(var T=1;K>T;T++)Im(M,M,c[T])}var t=M?ln(M):N;G.vs&&a(Ue,G.visible,e.visible)&&rm(M,z,G.vs,G.uv,G.is,G.ns,t,F,P),G.top_vs&&a(wn,G.topVisible,e.topVisible)&&rm(M,z,G.top_vs,G.top_uv,G.top_is,G.top_ns,t,F,a("shape3d.top.color",G.topColor,e.topColor)||P),G.bottom_vs&&a(Hg,G.bottomVisible,e.bottomVisible)&&rm(M,z,G.bottom_vs,G.bottom_uv,G.bottom_is,G.bottom_ns,t,F,a("shape3d.bottom.color",G.bottomColor,e.bottomColor)||P),G.from_vs&&a(ff,G.fromVisible,e.fromVisible)&&rm(M,z,G.from_vs,G.from_uv,G.from_is,G.from_ns,t,F,a("shape3d.from.color",G.fromColor,e.fromColor)||P),G.to_vs&&a(Vp,G.toVisible,e.toVisible)&&rm(M,z,G.to_vs,G.to_uv,G.to_is,G.to_ns,t,F,a("shape3d.to.color",G.toColor,e.toColor)||P)}W&&c.pop()}},rm=function(i,V,v,T,f,F,k,g,$){var c,j=V.cs,q=V.uv,x=V.bs,z=V.ns,G=V.vs;if(F&&0!==F.length||(F=Bc(v,f)),f){c=f.length;for(var B=0;c>B;B++){var M=f[B],y=3*M;gg(G,i,[v[y],v[y+1],v[y+2]]),gg(z,k,[F[y],F[y+1],F[y+2]]),q&&Bm(q,[T[2*M],T[2*M+1]])}}else c=v.length/3,gg(G,i,v),gg(z,k,F),q&&Bm(q,T);j&&ak(j,$,c),x&&(g?Id(x,g,c):Bm(x,Se,c))},mp=function(D,u,K){var b=D.data.p3();if(u=Sc(u),Yc(u,b),Bm(K.ms,u),!K.vs.length){var S=Sc(tc);Yc(S,mk(b)),Tb(D,S,K)}},Tb=function(J,l,Y){$c(J,hp,l,Y),$c(J,Il,l,Y),$c(J,Ki,l,Y),$c(J,Mj,l,Y),$c(J,nc,l,Y),$c(J,yf,l,Y),$c(J,"csg",l,Y)},Tq=function(A,T,y,e,J,o){Bm(y.ms,J);var I;y.ics&&(I=T.s("all.color"))&&ak(y.ics,I,1),y.vs.length||um(A,T,y,e,Sc(tc),o)},um=function(M,i,P,O,r,I){Wc(M,i,P,O,r,I,hp,Bf),Wc(M,i,P,O,r,I,Il,Di),Wc(M,i,P,O,r,I,nc,Oe),Wc(M,i,P,O,r,I,yf,Ap),Wc(M,i,P,O,r,I,Ki,cm),Wc(M,i,P,O,r,I,Mj,bc)},wh=function(N,d,U,p,L){p?L.instanced?N.gv.batchInstancedModel(N.data,p,N,N.getBodyColor(),[d],U):fi(N.gv,N.data,p,N,N.getBodyColor(),[d],U):L.instanced?N.gv.batchInstancedShapeFace(N,d,U):Tb(N,d,U)},$c=function(o,j,k,G){var X=o[j];if(X){var H=X.tuv;if(H){var p=X.uvScale,$=X.uvOffset,d=X.uvRotation,K=X.uvAnchor;if(p||$||d){var l,e,t,S=xe(d,$,p,K),i=S.a,A=S.b,W=S.c,E=S.d,u=S.tx,r=S.ty,R=H.length;for(t=0;R>t;t+=2)l=H[t],e=H[t+1],H[t]=i*l+W*e+u,H[t+1]=A*l+E*e+r}}rm(k,G,X.vs,H,N,N,k?ln(k):N,X.blend,X.color)}},Wc=function(G,g,X,E,f,a,M,O){var i,j=X.cs,H=X.uv,k=X.bs,u=X.vs,c=X.ns,D=Bc(O);if(G.getFaceVisible(g,M)){var b=G.getFaceMat(g,M);if(b&&(f=rg(g,b),a=ln(f)),gg(u,f,O),gg(c,a,D),j&&ak(j,G.getFaceColor(g,M),6),H){var P=G.getFaceUv(g,M)||E[M+"Uv"],S=G.getFaceUvScale(g,M)||E[M+"UvScale"],U=G.getFaceUvOffset(g,M)||E[M+"UvOffset"],A=G.getFaceUvRotation(g,M)||E[M+"UvRotation"],w=G.getFaceUvAnchor(g,M)||E[M+"UvAnchor"];P=P?[P[6],P[7],P[0],P[1],P[2],P[3],P[2],P[3],P[4],P[5],P[6],P[7]]:be;var l=P[0],F=P[1],e=P[2],B=P[3],W=P[4],J=P[5],q=P[6],C=P[7],y=P[8],d=P[9],N=P[10],p=P[11];if(S||U||A||w){var o=xe(A,U,S,w),m=o.a,Z=o.b,Q=o.c,h=o.d,v=o.tx,t=o.ty;l=m*l+Q*F+v,F=Z*l+h*F+t,e=m*e+Q*B+v,B=Z*e+h*B+t,W=m*W+Q*J+v,J=Z*W+h*J+t,q=m*q+Q*C+v,C=Z*q+h*C+t,y=m*y+Q*d+v,d=Z*y+h*d+t,N=m*N+Q*p+v,p=Z*N+h*p+t}H.push(l,F,e,B,W,J,q,C,y,d,N,p)}k&&(i=G.getBodyColor(g)||G.getFaceBlend(g,M),i?Id(k,i,6):Bm(k,Se,6))}},Ee=function(Y,A,o,w){var o=Y._picking?Y.pickColorMap:null,h=Y.getGL(),_=Y._prg,d=Y._buffer;if(!kl(A)){dc(Y,tc),sq(h);var M,u,r,p;for(var F in A){var m,K,G,P,j=A[F];if(j.batch){var f=Y.getBatchInfo(j.batch)||go;m=f.wfBloom===I?f.bloom:f.wfBloom,K=f.wfReflectable===I?f.reflectable:f.wfReflectable,G=f.wfClipboxMask===I?f.clipboxMask:f.wfClipboxMask,P=f.width}else m=j.B,K=j.reflectable,G=j.clipboxMask,P=j.W;if(!(w&&!j.T||!w&&j.T||Y.isReflecting(h)&&K===!1)){j.invalidate?(j.invalidate=!1,Md(j,"vs"),Md(j,"cs"),Md(j,"ls"),Md(j,"ps")):o&&j.ps&&j.ps._invalidateThisFrame&&(j.ps._invalidateThisFrame=!1,Md(j,"ps")),M=j.translate,u=j.clipDirection,M||u?(r=u?Sc(j.mat):[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],M&&Yc(r,M),p=Sc(Y._6O),dc(Y,r)):r=null;var a=j.vs32,J=o?j.ps32:j.cs32;Fe(h,_,P,N,d.vs,a);var C=dk.for(h),U=C.directUniforms(),e=C.directAttribs(),R=j.D,z=!Y._dashDisabled&&R;U.uAlphaTest=O.alphaTest,h._blooming&&!m&&(U.blackout=!0),u&&(U.uClipPercent=j.clipPercent,U.uClipDirection=u),yc(Y,U,G===I?kh:G),z&&(U.uDash=!0,U.uDashDistance=R,U.uDashGapDistance=j.G,U.uDiffuse=j.A||O["color.empty"],e.aLineDistance=Ch(h,d.lineDistance,j.ls32,N,1));var L=!Y._batchColorDisabled;L&&J.length?(U.uBatchColor=!0,e.aBatchColor=Ch(h,d.batchColor,J,N,4)):(U.uBatchColor=!1,e.aBatchColor=!1);var V=j.fog!==!1;V||(U.uFog=!1),Nd(h),fj(h,0,a.length/3,h.LINES),ab(h),V||(U.uFog=!0),L&&(U.uBatchColor=!1,e.aBatchColor=!1),z&&(U.uDash=!1,e.aLineDistance=!1),h._blooming&&!m&&(U.blackout=!1),r&&(u&&(U.uClipDirection=0),mn(Y,p),U.uMMatrix=Ol)}}Qp(h),mn(Y)}},cf=function(c){c.invalidate=!1,Md(c,"vs"),Md(c,"ns"),Md(c,"cs"),Md(c,"rs"),Md(c,"ps"),Md(c,"bs"),Md(c,"uv"),Md(c,"ms"),Md(c,"ics")},Zg=function(D,t,r,H,q){var Z,x,u,B,S,y,L,P,X,c,l,s,V,r=D._picking?D.pickColorMap:null,_=D.getGL(),i=D._prg,U=dk.for(_),e=U.directUniforms(),z=U.directAttribs(),A=D._buffer;if(!kl(t)){var E,a,w=D._flowObjects.length?D.flowMap:null,M=D.drawFilter;dc(D,tc);for(x in t)if(u=D.getBatchInfo(x)||go,u.visible!==!1&&!(H&&!u.transparent||!H&&u.transparent||D.isReflecting(_)&&u.reflectable===!1)){var m=u.renderLayerMask;if(m==N&&(m=Bd),q==N&&(q=Bd),cs(q,m)&&(B=t[x],r||!u.transparentMask)){if(M){if(u.highlight!==!0)continue;if(E=B.ds){a=!1;for(var h=0,k=E.length;k>h;h++)if(!M(E[h])){a=!0;break}if(!a)continue}}var g=H&&u.autoSort===!0&&(D._33Q||B.invalidate);B.invalidate?cf(B):r&&B.ps&&B.ps._invalidateThisFrame&&(B.ps._invalidateThisFrame=!1,Md(B,"ps"));var W=B.ms32,d=W&&W.length;if(y=B.vs32,L=r?B.ps32:d?B.ics32:B.cs32,c=B.uv32,P=B.bs32,X=B.rs32,s=y.length/3,g){var R=Ab(y,D.getEye(),D);R?(B.is=R.is,B.elementTypeUint=R.useUint32):(B.is=null,B.elementTypeUint=null)}if(s){V=B.translate,V&&dc(D,[1,0,0,0,0,1,0,0,0,0,1,0,V[0],V[1],V[2],1]),S=u.light,l=D.getTexture(u.image),ym(_,i,N,u.light,u.opacity,u.reverseFlip,u.reverseColor,u.reverseCull),Z=u.polygonOffset,Z&&$o(_,Z),L?D._batchColorDisabled?(e.uBatchColor=!1,z.aBatchColor=!1):(e.uBatchColor=!0,z.aBatchColor=d?Bk(_,A.instancedBatchColor,L,N,4):Ch(_,A.batchColor,L,N,4)):(e.uBatchColor=!1,e.uDiffuse=u.color||O["color.empty"]);var C=u.alphaTest;e.uAlphaTest=C===I?O.alphaTest:C,e.shadowReceive=!r&&u.shadowReceive!==!1,yc(D,e,u.clipboxMask===I?kh:u.clipboxMask),eh(D,e,u.lightMask===I?kh:u.lightMask,u.headlightAmbientIntensity),w&&w.resetFlowUniform(u.effectFlowMask===I?kh:u.effectFlowMask,e),_._blooming&&!u.bloom&&(e.blackout=!0),u.envmap!==I?(e.uUseEnvMap=!0,e.uReflectivity=u.envmap,e.roughness=u.roughness||0,D._setEnvmapByProbeId(e,u.envmapProbe||0)):(e.uUseEnvMap=!1,e.uReflectivity=0);var j=P&&!D._batchBlendDisabled;j&&(e.uBatchBlend=!0,z.aBatchBlend=Ch(_,A.batchBlend,P,N));var G=X&&!D._batchBrightnessDisabled;G&&(e.uBatchBrightness=!0,z.aBatchBrightness=Ch(_,A.batchBrightness,X,N,1)),c?Nd(_,i,l,u.discardSelectable,A.uv,c,u.uvOffset,u.uvScale,u.uvRotation,u.uvAnchor):Nd(_),z.aPosition=Ch(_,A.vs,y,N),z.aNormal=Ch(_,A.ns,B.ns32,N),d&&(e.uUseInstance=!0,z.aMatrixInstanced=Bk(_,A.ms,W,N)),B.is?($g(_,A.is,B.is),yp(_,0,s,null,B.elementTypeUint?_.UNSIGNED_INT:null,null,d?B.ms32.length/16:0)):fj(_,0,s,null,d?B.ms32.length/16:0),c?ab(_,i,l):ab(_),L&&!D._batchColorDisabled&&(e.uBatchColor=!1,z.aBatchColor=!1),j&&(e.uBatchBlend=!1,z.aBatchBlend=!1),G&&(e.uBatchBrightness=!1,z.aBatchBrightness=!1),_._blooming&&!u.bloom&&(e.blackout=!1),d&&(e.uUseInstance=!1,z.aMatrixInstanced=I),Z&&ks(_),Kh(_,i),V&&(mn(D),e.uMMatrix=Ol)}}}mn(D)}},Ab=function(Z,r,d){var v=Z.length/3,B=v>65535,m=d._glCapabilities.elementTypeUint&&B;if(!m&&B)return null;for(var o=new Array(v),y=v/3,e=new Array(y),$=0;y>$;$++)e[$]=$;e.sort(function(H,T){var c=9*H,u=[(Z[c]+Z[c+3]+2*Z[c+6])/4,(Z[c+1]+Z[c+4]+2*Z[c+7])/4,(Z[c+2]+Z[c+5]+2*Z[c+8])/4];c=9*T;var h=[(Z[c]+Z[c+3]+2*Z[c+6])/4,(Z[c+1]+Z[c+4]+2*Z[c+7])/4,(Z[c+2]+Z[c+5]+2*Z[c+8])/4],l=So(r,u)-So(r,h);return l>0?-1:0>l?1:0});for(var $=0;y>$;$++){var Y=3*$,T=3*e[$];o[Y]=T,o[Y+1]=T+1,o[Y+2]=T+2}return{useUint32:m,is:m?new Uint32Array(o):new Xq(o)}},Pk={obj:function(K,L){var O={mat:K.mat,s3:K.s3,r3:K.r3,rotationMode:K.rotationMode,t3:K.t3,cube:K.cube==N?!0:K.cube,center:K.center==N?!0:K.center,ignoreMtls:K.ignoreMtls,ignoreTransparent:K.ignoreTransparent,ignoreColor:K.ignoreColor,ignoreImage:K.ignoreImage,ignoreNormal:K.ignoreNormal,prefix:K.prefix,flipY:K.flipY,flipFace:K.flipFace,reverseFlipMtls:K.reverseFlipMtls,finishFunc:function(_,z){if(_){var z=[];for(var t in _){var x=_[t];z.rawS3=x.rawS3,x.center&&(z.center=x.center),z.push(x),K.eachModel&&K.eachModel(t,x)}z.json=K,L(z)}else L()}};F.loadObj(K.obj,K.mtl,O)},bin:function(t,L){var D={finishFunc:function(F){F?L(F):L()}};F.loadBin(t.url,D)}};F.getModelTypeHandlers=function(){return Pk},F.setModelTypeHandler=function(O,a){Pk[O]=a},F.getModelTypeHandler=function(V){return Pk[V]},F.handleModelLoaded=function(){},F.handleUnfoundModel=function(){};var Or=N,Ti=N,vk=function(O){Or&&!O._loadingModelView_&&(Ti||(Ti={}),Ti[O._loadingModelView_=Nj()]=O)},Fm=function(m,e){Or||(Or={});var T=Or[m];if(T){if(T.url===e)return;T.request.onload=rp,T.request.onerror=rp}if(e.indexOf(".bin")===e.length-4)return Sk(m,{modelType:"bin",url:e},e);if(e=F.beforeLoadURL(e),e.data){var o=F.parse(e.data);Sk(m,o,e)}else{var c=new Ge;Or[m]={request:c,url:e},c.onload=function(){if(200===this.status||0===this.status){delete Or[m];var S=F.parse(c.getResponseText());Sk(m,S,e)}else qp(m,F.handleUnfoundModel(m,e)||N)},c.onerror=function(){qp(m,F.handleUnfoundModel(m,e)||N)};var A={};A.url=encodeURI(e),A.sync=!1,c.send(A)}},Sk=function(q,y,L){var l=y.modelType;if(!l)return qp(q,y),F.handleModelLoaded(q,y),void 0;var f=F.getModelTypeHandler(l);if(f){if(Or||(Or={}),Or[q])return;Or[q]=!0;var S=function(P){P?(qp(q,P),F.handleModelLoaded(q,P)):qp(q,F.handleUnfoundModel(q,L,y)||N)};f(y,S)}else qp(q,F.handleUnfoundModel(q,L,y)||N)},qp=function(v,C){if(delete Or[v],Je(C)&&ok.test(C))return Fm(v,C),void 0;if(bf[v]=C,kl(Or)&&(Or=N,Ti)){for(var X in Ti){var T=Ti[X];T.invalidateAll&&T.invalidateAll(I,"modelLoaded",v),T.redraw&&T.redraw(),T.iv(),delete T._loadingModelView_}Ti=N}if(C&&Ti)for(var X in Ti){var T=Ti[X];T.invalidateAll&&T.invalidateAll(I,"modelLoading",v),T.redraw&&T.redraw(),T.iv()}},jd=new ub([0,0,0,1,1,1,1,0]),Eb=new ub([0,0,1,0,0,1,0,0,1,0,0,1]),lg=new Xq([0,1,2,2,3,0]),Er=new ub([-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,.5,.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,.5,.5,.5,.5,.5,-.5,-.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,.5]),Kl=new Xq([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),qs=new ub([0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0]),Bb=Bc(Er,Kl),qc=(new ub([-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,.5,-.5,-.5,.5,.5,-.5,-.5,-.5,-.5,-.5,.5,-.5]),new Xq([0,1,2,3,0,7,5,4,6,7,5,3,2,4,6,1]),[hp,Ki,Il,Mj,nc,yf]),fq=[-.5,.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,-.5,.5,.5,.5,.5,.5,.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,-.5,.5,.5,.5,.5,.5,-.5,.5,-.5,.5,.5,-.5,-.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5,-.5],Zk=[-.5,.5,.5,-.4,.5,.5,-.5,.5,.5,-.5,.4,.5,-.5,.5,.5,-.5,.5,.4,.5,.5,.5,.4,.5,.5,.5,.5,.5,.5,.4,.5,.5,.5,.5,.5,.5,.4,-.5,-.5,.5,-.4,-.5,.5,-.5,-.5,.5,-.5,-.4,.5,-.5,-.5,.5,-.5,-.5,.4,.5,-.5,.5,.4,-.5,.5,.5,-.5,.5,.5,-.4,.5,.5,-.5,.5,.5,-.5,.4,-.5,.5,-.5,-.4,.5,-.5,-.5,.5,-.5,-.5,.4,-.5,-.5,.5,-.5,-.5,.5,-.4,.5,.5,-.5,.4,.5,-.5,.5,.5,-.5,.5,.4,-.5,.5,.5,-.5,.5,.5,-.4,-.5,-.5,-.5,-.4,-.5,-.5,-.5,-.5,-.5,-.5,-.4,-.5,-.5,-.5,-.5,-.5,-.5,-.4,.5,-.5,-.5,.4,-.5,-.5,.5,-.5,-.5,.5,-.4,-.5,.5,-.5,-.5,.5,-.5,-.4],md=function(T,e,v,I,X,J,N){J=J||16,T=T||16,e=e||0,v=v||T;var q,g,t,L,Y,b,R,S,Z,u=.5,M=[],j=[],C=f/T,B=G/J;for(q=0;J>q;q++)for(b=q+1,L=q*B,Z=b*B,g=e;v>g;g++)R=g+1,t=g*C,S=R*C,M.push(u*W(L)*s(t),u*s(L),-u*W(L)*W(t),u*W(Z)*s(S),u*s(Z),-u*W(Z)*W(S),u*W(L)*s(S),u*s(L),-u*W(L)*W(S),u*W(L)*s(t),u*s(L),-u*W(L)*W(t),u*W(Z)*s(t),u*s(Z),-u*W(Z)*W(t),u*W(Z)*s(S),u*s(Z),-u*W(Z)*W(S)),j.push(g/T,q/J,R/T,b/J,R/T,q/J,g/T,q/J,g/T,b/J,R/T,b/J);if(N){var E=[];for(q=0,Y=M.length;Y>q;q+=3)E.push(2*M[q],2*M[q+1],2*M[q+2])}if(I){var h=[],D=[];for(t=e*C,q=0;J>q;q++)b=q+1,L=q*B,Z=b*B,h.push(0,0,0,u*W(Z)*s(t),u*s(Z),-u*W(Z)*W(t),u*W(L)*s(t),u*s(L),-u*W(L)*W(t)),D.push(0,.5,e/T,b/J,e/T,q/J)}if(X){var Q=[],V=[];for(t=v*C,q=0;J>q;q++)b=q+1,L=q*B,Z=b*B,Q.push(0,0,0,u*W(L)*s(t),u*s(L),-u*W(L)*W(t),u*W(Z)*s(t),u*s(Z),-u*W(Z)*W(t)),V.push(1,.5,v/T,q/J,v/T,b/J)}var r={vs:M,uv:j,from_vs:h,from_uv:D,to_vs:Q,to_uv:V};return N&&(r.ns=E),r},$b=function(d,v,H){d=d||.17,v=v||12,H=H||18,0>d?d=0:d>.25&&(d=.25);var n,t,$,e,D,I,X,E=.5,Y=[],p=[],B=[],x=f/H,b=f/v,N=E-d;for(t=0;v>=t;t++)for(e=-G+t*b,I=s(e),D=W(e),n=0;H>=n;n++)$=n*x,X=N+d*I,Y.push(s($)*X,D*d,-W($)*X),p.push(n/H,1-t/v);for(t=0;v>t;t++){var r=t*(H+1),h=(t+1)*(H+1);for(n=0;H>n;n++)B.push(r+n,h+n+1,h+n,r+n,r+n+1,h+n+1)}return{vs:Y,uv:p,is:B}},ho=function(N,Y,E,F,j,w,v,K){v=v||12,N=N||18,Y=Y||0,E=E||N,w=w||.17,0>w?w=0:w>.25&&(w=.25);var T,D,i,m,S,l,z,L,U,C,p=.5,M=[],e=[],O=f/N,A=f/v,y=p-w,b=K?[]:I;for(i=0;v>i;i++)for(m=i+1,z=-G+i*A,L=-G+m*A,T=Y;E>T;T++)D=T+1,S=T*O,l=D*O,U=y+w*s(z),C=y+w*s(L),M.push(s(S)*U,W(z)*w,-W(S)*U,s(l)*U,W(z)*w,-W(l)*U,s(l)*C,W(L)*w,-W(l)*C,s(S)*U,W(z)*w,-W(S)*U,s(l)*C,W(L)*w,-W(l)*C,s(S)*C,W(L)*w,-W(S)*C),e.push(T/N,1-i/v,D/N,1-i/v,D/N,1-m/v,T/N,1-i/v,D/N,1-m/v,T/N,1-m/v),K&&b.push(s(S)*s(z),W(z),-W(S)*s(z),s(l)*s(z),W(z),-W(l)*s(z),s(l)*s(L),W(L),-W(l)*s(L),s(S)*s(z),W(z),-W(S)*s(z),s(l)*s(L),W(L),-W(l)*s(L),s(S)*s(L),W(L),-W(S)*s(L));if(F){var J=[],$=[];for(i=0;v>i;i++)m=i+1,z=-G+i*A,L=-G+m*A,S=Y*O,U=y+w*s(z),C=y+w*s(L),J.push(s(S)*U,W(z)*w,-W(S)*U,s(S)*C,W(L)*w,-W(S)*C,s(S)*y,0,-W(S)*y),$.push(.5+.5*s(z),.5-.5*W(z),.5+.5*s(L),.5-.5*W(L),.5,.5)}if(j){var c=[],q=[];for(i=0;v>i;i++)m=i+1,z=-G+i*A,L=-G+m*A,S=E*O,U=y+w*s(z),C=y+w*s(L),c.push(s(S)*U,W(z)*w,-W(S)*U,s(S)*y,0,-W(S)*y,s(S)*C,W(L)*w,-W(S)*C),q.push(.5-.5*s(z),.5-.5*W(z),.5,.5,.5-.5*s(L),.5-.5*W(L))}var a={vs:M,uv:e,from_vs:J,from_uv:$,to_vs:c,to_uv:q};return K&&(a.ns=b),a},Uo=function(B,$){for(var a,J,r,P,x,d=.5,E=16,O=[],V=[],u=[],t=[],j=f/E,g=0;E>=g;g++)a=g*j,J=s(a),P=J*d,r=W(a),x=r*d,O.push(P,-d,x,P,d,x),u.push(J,0,r,J,0,r),V.push(1-g/E,1,1-g/E,0);for(g=0;E>g;g++)t.push(2*g,2*g+1,2*g+3,2*g,2*g+3,2*g+2);if($){var c=[],q=[],F=[];for(c.push(0,-d,0),q.push(.5,.5),g=0;E>=g;g++)a=g*j,J=s(a),r=W(a),c.push(J*d,-d,-r*d),q.push(.5+.5*J,.5+.5*r);for(g=0;E>g;g++)F.push(0,g+2,g+1)}if(B){var w=[],l=[],N=[];for(w.push(0,d,0),l.push(.5,.5),g=0;E>=g;g++)a=g*j,J=s(a),r=W(a),w.push(J*d,d,-r*d),l.push(.5+.5*J,.5-.5*r);for(g=0;E>g;g++)N.push(0,g+1,g+2)}return{vs:O,uv:V,is:t,ns:u,bottom_vs:c,bottom_uv:q,bottom_is:F,top_vs:w,top_uv:l,top_is:N}},cd=function(o,i,h,x,v,b,z,g){o=o||12,i=i||0,h=h||o;for(var t,m,n,M,c,R,F,k,H,y=.5,X=[],O=[],q=f/o,r=i;h>r;r++)t=r+1,m=r*q,n=t*q,M=s(m)*y,c=W(m)*y,R=s(n)*y,F=W(n)*y,X.push(M,-y,-c,R,-y,-F,M,y,-c,R,-y,-F,R,y,-F,M,y,-c),O.push(r/o,1,t/o,1,r/o,0,t/o,1,t/o,0,r/o,0);if(g){var I=[];for(r=0,H=X.length;H>r;r+=3)I.push(2*X[r],0,2*X[r+2])}if(z){var L=[],P=[];for(r=i;h>r;r++)m=q*r,n=q*(r+1),M=s(m),c=W(m),R=s(n),F=W(n),L.push(M*y,-y,-c*y,0,-y,0,R*y,-y,-F*y),P.push(.5+.5*M,.5+.5*c,.5,.5,.5+.5*R,.5+.5*F)}if(b){var Y=[],l=[];for(r=i;h>r;r++)m=q*r,n=q*(r+1),M=s(m),c=W(m),R=s(n),F=W(n),Y.push(M*y,y,-c*y,R*y,y,-F*y,0,y,0),l.push(.5+.5*M,.5-.5*c,.5+.5*R,.5-.5*F,.5,.5)}if(x){var V=[],u=[];m=q*i,M=s(m)*y,c=W(m)*y,k=i/o,V.push(0,y,0,0,-y,0,M,-y,-c,M,-y,-c,M,y,-c,0,y,0),u.push(0,0,0,1,k,1,k,1,k,0,0,0)}if(v){var _=[],N=[];m=q*h,M=s(m)*y,c=W(m)*y,k=h/o,_.push(0,-y,0,0,y,0,M,y,-c,M,y,-c,M,-y,-c,0,-y,0),N.push(1,1,1,0,k,0,k,0,k,1,1,1)}var p={vs:X,uv:O,bottom_vs:L,bottom_uv:P,top_vs:Y,top_uv:l,from_vs:V,from_uv:u,to_vs:_,to_uv:N};return g&&(p.ns=I),p},hg=function(q,o,P,T,M){o=o||18,P=P||0,T=T==N?f:T,M=M==N?.5:M;for(var x,j,F,K,n,O,m=[0,.5,.75,.875,.9375],i=[],$=[],U=[],Y=T/o,c=0;c<m.length;c++){var v=0===c%2?0:.5;for(x=0;o>=x;x++)j=(x+v)*Y+P,F=1-m[c],i.push(s(j)*M*F,-M+2*m[c]*M,-W(j)*M*F),$.push((x+v)/o,F)}for(c=0;c<m.length-1;c++){var R=c*(o+1),k=(c+1)*(o+1);for(x=0;o>x;x++)U.push(R+x,k+x+1,k+x,R+x,R+x+1,k+x+1)}for(O=i.length/3-(o+1),x=0;o>x;x++)i.push(0,M,0),$.push((x+.5)/o,0);for(x=0;o>x;x++)U.push(O+x,O+x+1,O+(o+1)+x);if(q){var z=[],V=[],t=[];for(z.push(0,-M,0),V.push(.5,.5),x=0;o>=x;x++)j=x*Y+P,K=s(j),n=W(j),z.push(K*M,-M,-n*M),V.push(.5+.5*K,.5+.5*n);for(x=0;o>x;x++)t.push(0,x+2,x+1)}return{vs:i,uv:$,is:U,bottom_vs:z,bottom_uv:V,bottom_is:t}},_c=function(v,b,u,V,E,G,D,C){v=v||16,b=b||0,u=u||v,D=D||1;var x,p,c,F,B,U,m,z=.5,L=[],l=[],O=f/v,i=b,k=1/D,p=new Vg,c=new Vg,$=new Vg,o=new Vg,n=new Vg,P=new Vg,h=new Vg;for(C&&(x=[],B=new Vg,U=new Vg,m=new Vg);u>i;i++){var j=i+1,N=O*i,T=O*j;for(p.set(s(N)*z,-z,-W(N)*z),c.set(s(T)*z,-z,-W(T)*z),$.set(0,z,0),C&&(B.set(s(N),.5,-W(N)).normalize(),U.set(s(T),.5,-W(T)).normalize(),m.copy(B).add(U).normalize()),o.lerpVectors($,p,k),n.lerpVectors($,c,k),L.push(o.x,o.y,o.z,n.x,n.y,n.z,$.x,$.y,$.z),l.push(i/v,k,j/v,k,(i+j)/2/v,0),C&&x.push(B.x,B.y,B.z,U.x,U.y,U.z,m.x,m.y,m.z),F=1;D>F;F++)o.lerpVectors($,p,k*(F+1)),n.lerpVectors($,c,k*(F+1)),P.lerpVectors($,p,k*F),h.lerpVectors($,c,k*F),L.push(o.x,o.y,o.z,n.x,n.y,n.z,P.x,P.y,P.z,P.x,P.y,P.z,n.x,n.y,n.z,h.x,h.y,h.z),l.push(i/v,k*(F+1),j/v,k*(F+1),i/v,k*F,i/v,k*F,j/v,k*(F+1),j/v,k*F),C&&x.push(B.x,B.y,B.z,U.x,U.y,U.z,B.x,B.y,B.z,B.x,B.y,B.z,U.x,U.y,U.z,U.x,U.y,U.z)}if(G){var y=[],t=[];for(i=b;u>i;i++){N=O*i,T=O*(i+1);var d=s(N),M=W(N),q=s(T),w=W(T);y.push(d*z,-z,-M*z,0,-z,0,q*z,-z,-w*z),t.push(.5+.5*d,.5+.5*M,.5,.5,.5+.5*q,.5+.5*w)}}if(V){var X=[],H=[];N=O*b,X.push(0,z,0,0,-z,0,s(N)*z,-z,-W(N)*z),H.push(0,0,0,1,b/v,1)}if(E){var R=[],_=[];N=O*u,R.push(0,-z,0,0,z,0,s(N)*z,-z,-W(N)*z),_.push(1,1,1,0,u/v,1)}var g={vs:L,uv:l,bottom_vs:y,bottom_uv:t,from_vs:X,from_uv:H,to_vs:R,to_uv:_};return C&&(g.ns=x),g},kq=function(t,k,F,P,Z,w,C,G){for(var L=[],n=0;n<t.length-1;n+=2)L.push({x:t[n],y:t[n+1]});return Ib(L,k,F,P,Z,w,C,G,!1)},jl={roundRect:function(q,f){return kq([.5,.4,.5,.442,.471,.471,.442,.5,.4,.5,-.4,.5,-.442,.5,-.471,.471,-.5,.442,-.5,.4,-.5,-.4,-.5,-.442,-.471,-.471,-.442,-.5,-.4,-.5,.4,-.5,.442,-.5,.471,-.471,.5,-.442,.5,-.4,.5,.4],[1,3,3,2,3,3,2,3,3,2,3,3,2],q,f,3)},star:function(z,Z){return kq([.193,.079,.333,.5,0,.233,-.333,.5,-.194,.079,-.5,-.167,-.112,-.167,0,-.5,.111,-.167,.5,-.167],[1,2,2,2,2,2,2,2,2,2,5],z,Z)},rect:function(t,y){return kq([.5,-.5,.5,.5,-.5,.5,-.5,-.5],[1,2,2,2,5],t,y)},billboard:function(){return{vs:[-.5,.5,0,-.5,-.5,0,.5,.5,0,.5,.5,0,-.5,-.5,0,.5,-.5,0],uv:[0,0,0,1,1,0,1,0,0,1,1,1],ns:[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1]}},plane:function(){return{vs:[-.5,0,-.5,-.5,0,.5,.5,0,-.5,.5,0,-.5,-.5,0,.5,.5,0,.5],uv:[0,0,0,1,1,0,1,0,0,1,1,1],ns:[0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0]}},triangle:function(w,b){return kq([0,-.5,.5,.5,-.5,.5],[1,2,2,5],w,b)},rightTriangle:function(r,W){return kq([.5,.5,-.5,.5,-.5,-.5],[1,2,2,5],r,W)},parallelogram:function(c,_){return kq([.5,-.5,.25,.5,-.5,.5,-.25,-.5],[1,2,2,2,5],c,_)},trapezoid:function(P,W){return kq([.25,-.5,.5,.5,-.5,.5,-.25,-.5],[1,2,2,2,5],P,W)}},Ke={sphere:1,cylinder:1,cone:1,torus:1},Jg={torus:1,sphere:1,cone:1},Rf=xo(iq(jl),{cylinder:1}),Vj=xo(iq(jl),{cylinder:1,cone:1}),po=function(j,z,c){var i,$=Aq(j.anchor3d,c,z),y=Aq(j.mat,c,z),k=Aq(j.s3,c,z),Y=Aq(j.t3,c,z),L=Aq(j.r3,c,z),F=k||L||Y||y;if($||F){i=Sc(z._6O);var m=F?xm(y,k,L,Aq(j.rotationMode,c,z),Y):Gj();$&&Yc(m,[.5-$[0],.5-$[1],.5-$[2]]),dc(z,m)}return i},_o=function(L,l,H,P,t,Y,D){if(hr(H))H.forEach(function(o){_o(L,l,o,P,t,Y,D)});else if(Je(H))_o(L,l,Kd(P,H),P,t,Y,D);else if(Go(H))if(H.shape3d){var g=po(H,L,l);_o(L,l,H.shape3d,P,t,Y,H),g&&mn(L,g)}else Aj(L,l,H,P.s,t,Y,D)},Aj=function(q,i,h,o,z,j,A){if(A=A||go,!j||j(o("shape3d.transparent",h.transparent,A.transparent))){var X=po(h,q,i);if(ec(h)){var b=q.getData3dUI(i);b.dispatchBoundingBoxChanged()}var G=q._26I,g=q._prg,a=q._buffer,Y=o("shape3d.color",h.color,A.color);z||(z=o("shape3d.blend",h.blend,A.blend));var L,Q=h.opacity==N?A.opacity:h.opacity,t=o("shape3d.opacity");L=t!=N&&Q!=N?Q*t:Q!=N?Q:t,ym(G,g,z,o("shape3d.light",h.light,A.light),L,o("shape3d.reverse.flip",h.reverseFlip,A.reverseFlip),o("shape3d.reverse.color",h.reverseColor,A.reverseColor),o("shape3d.reverse.cull",h.reverseCull,A.reverseCull));var y=o("polygonOffset",h.polygonOffset,A.polygonOffset);h.vs&&o(Ue,h.visible,A.visible)&&Vl(G,g,a,Y,q.getTexture(o("shape3d.image",h.image,A.image),i),o("shape3d.discard.selectable",h.discardSelectable,A.discardSelectable),h.vs,h.uv,h.ns,h.is,o("shape3d.uv.offset",h.uvOffset,A.uvOffset),o("shape3d.uv.scale",h.uvScale,A.uvScale),o("shape3d.uv.rotation",h.uvRotation,A.uvRotation),o("shape3d.uv.anchor",h.uvAnchor,A.uvAnchor),y),h.top_vs&&o(wn,h.topVisible,A.topVisible)&&Vl(G,g,a,o("shape3d.top.color",h.topColor,A.topColor)||Y,q.getTexture(o("shape3d.top.image",h.topImage,A.topImage),i,"top"),o("shape3d.top.discard.selectable",h.topDiscardSelectable,A.topDiscardSelectable),h.top_vs,h.top_uv,h.top_ns,h.top_is,o("shape3d.top.uv.offset",h.topUvOffset,A.topUvOffset),o("shape3d.top.uv.scale",h.topUvScale,A.topUvScale),o("shape3d.top.uv.rotation",h.topUvRotation,A.topUvRotation),o("shape3d.top.uv.anchor",h.topUvAnchor,A.topUvAnchor),y),h.bottom_vs&&o(Hg,h.bottomVisible,A.bottomVisible)&&Vl(G,g,a,o("shape3d.bottom.color",h.bottomColor,A.bottomColor)||Y,q.getTexture(o("shape3d.bottom.image",h.bottomImage,A.bottomImage),i,"bottom"),o("shape3d.bottom.discard.selectable",h.bottomDiscardSelectable,A.bottomDiscardSelectable),h.bottom_vs,h.bottom_uv,h.bottom_ns,h.bottom_is,o("shape3d.bottom.uv.offset",h.bottomUvOffset,A.bottomUvOffset),o("shape3d.bottom.uv.scale",h.bottomUvScale,A.bottomUvScale),o("shape3d.bottom.uv.rotation",h.bottomUvRotation,A.bottomUvRotation),o("shape3d.bottom.uv.anchor",h.bottomUvAnchor,A.bottomUvAnchor),y),h.from_vs&&o(ff,h.fromVisible,A.fromVisible)&&Vl(G,g,a,o("shape3d.from.color",h.fromColor,A.fromColor)||Y,q.getTexture(o("shape3d.from.image",h.fromImage,A.fromImage),i,"from"),o("shape3d.from.discard.selectable",h.fromDiscardSelectable,A.fromDiscardSelectable),h.from_vs,h.from_uv,h.from_ns,h.from_is,o("shape3d.from.uv.offset",h.fromUvOffset,A.fromUvOffset),o("shape3d.from.uv.scale",h.fromUvScale,A.fromUvScale),o("shape3d.from.uv.rotation",h.fromUvRotation,A.fromUvRotation),o("shape3d.from.uv.anchor",h.fromUvAnchor,A.fromUvAnchor),y),h.to_vs&&o(Vp,h.toVisible,A.toVisible)&&Vl(G,g,a,o("shape3d.to.color",h.toColor,A.toColor)||Y,q.getTexture(o("shape3d.to.image",h.toImage,A.toImage),i,"to"),o("shape3d.to.discard.selectable",h.toDiscardSelectable,A.toDiscardSelectable),h.to_vs,h.to_uv,h.to_ns,h.to_is,o("shape3d.to.uv.offset",h.toUvOffset,A.toUvOffset),o("shape3d.to.uv.scale",h.toUvScale,A.toUvScale),o("shape3d.to.uv.rotation",h.toUvRotation,A.toUvRotation),o("shape3d.to.uv.anchor",h.toUvAnchor,A.toUvAnchor),y),Kh(G,g),X&&mn(q,X)}},Vl=function(p,K,n,h,d,A,J,P,C,e,v,W,R,q,$){if(J){$&&$o(p,$);var G=dk.for(p),f=G.directUniforms(),F=G.directAttribs();f.uDiffuse=h||O["color.empty"],P?Nd(p,K,d,A,n.uv,P,v,W,R,q):Nd(p),F.aPosition=Ch(p,n.vs,J,N),F.aNormal=Ch(p,n.ns,C,N),e?(te(p,n.is,e),yp(p,0,e.length,null,e instanceof Uint32Array?p.UNSIGNED_INT:null)):fj(p,0,J.length/3),P?ab(p,K,d):ab(p),$&&ks(p)}},Kd=function(S,X){var f=S.s;if(X||(X=f(Pb)),!X)return N;var v=oi(X);if(v)return v;if("text"===X){var U={amount:f("shape3d.text.amount"),size:f("shape3d.text.size"),font:f("shape3d.text.font"),style:f("shape3d.text.style"),weight:f("shape3d.text.weight"),fill:f("shape3d.text.fill"),curveSegments:f("shape3d.text.curveSegments"),spacing:f("shape3d.text.spacing"),cube:f("shape3d.text.cube")},G=S.gv.getShape3dText(S.data),w=G;for(var i in U)w+="_"+(U[i]===I?"U":U[i]);return S._cachedTextKey===w?S._cachedTextGeometry:(S._cachedTextKey=w,S._cachedTextGeometry=F.createTextGeometry(G,U))}var i=X;if(Ke[X]){var x=f("shape3d.side"),V=f("shape3d.side.from"),T=f("shape3d.side.to"),Q=f(ff),o=f(Vp);3>x?(x=0,V=0,T=0,Q=!1,o=!1):((V==N||0>V)&&(V=0),(T==N||T>x)&&(T=x),0===V&&T===x&&(Q=!1,o=!1));var D=f("shape3d.smooth");i+="-"+x+"-"+V+"-"+T+"-"+Q+"-"+o+(D?1:0)}if(Rf[X]){var z=f(wn);i+="-"+z}if(Vj[X]){var u=f(Hg);i+="-"+u}if("torus"===X){var O=f("shape3d.torus.radius");0>O?O=0:O>.25&&(O=.25),i+="-"+O}if(Jg[X]){var W=f(pm);i+="-"+W}return v=vg[i],v||("box"===X?v=F.createBoxModel():jl[X]?v=jl[X](z,u):"sphere"===X?v=F.createSphereModel(x,V,T,Q,o,W,D):X===Cm?v=F.createCylinderModel(x,V,T,Q,o,z,u,D):"cone"===X?v=F.createConeModel(x,V,T,Q,o,u,W,D):"torus"===X&&(v=F.createTorusModel(x,V,T,Q,o,O,W,D)),vg[i]=v),v},ec=function(){var v=["vs","ns","uv","top_vs","top_ns","top_uv","bottom_vs","bottom_ns","bottom_uv","from_vs","from_ns","from_uv","to_vs","to_ns","to_uv","er","al"],R=["is","top_is","bottom_is","from_is","to_is"];return K=kg(Hk.substr(Hk.indexOf("^#")+2)),qj(F[Nr(rq+v[15]+"n"+v[16])]())&&dq()?function(r){return r&&!r._complete_?(r._complete_=!0,r.vs&&pi(r.ns)&&(r.ns=Bc(r.vs,r.is),r.boundingBox=I),r.top_vs&&pi(r.top_ns)&&(r.top_ns=Bc(r.top_vs,r.top_is),r.top_boundingBox=I),r.bottom_vs&&pi(r.bottom_ns)&&(r.bottom_ns=Bc(r.bottom_vs,r.bottom_is),r.bottom_boundingBox=I),r.from_vs&&pi(r.from_ns)&&(r.from_ns=Bc(r.from_vs,r.from_is),r.from_boundingBox=I),r.to_vs&&pi(r.to_ns)&&(r.to_ns=Bc(r.to_vs,r.to_is),r.to_boundingBox=I),v.forEach(function(u){var _=r[u];hr(_)&&(r[u]=new ub(_))}),R.forEach(function(D){var y=r[D];hr(y)&&(r[D]=y.length>65535?new fs(y):new Xq(y))}),!0):!1}:void 0}(),fe=function(E,m){var i=E[m];hr(i)&&(E[m]=new ub(i))};xo(Wn,{_25Q:function(o){var J=new Vg;o._16O=function(c,B,U,H,Q,m,i,f,k){var u=this.info;if(u){var e,o,h,K,V,z,d=Gj();qf[B]?(e=u.p3,o=u.c1,h=u.c2):Vb[B]?(o=u.s1||u.c1,h=u.s2||u.c2):(o=u.t1||u.c1,h=u.t2||u.c2);var $=this.data;if($ instanceof Li&&this.shapeModel){var r=$.getPointsMatrix3d();
e&&(e=J.copy(e).applyMatrix4(r).toArray()),o&&(o=J.copy(o).applyMatrix4(r).toArray()),h&&(h=J.copy(h).applyMatrix4(r).toArray())}var D=0;if(o&&h){var t=Zo(h,o);D=So(o,h),K=[0,-ge(t[2],t[0]),Y(t[1]/D)],V="zyx",e||(e=[(o[0]+h[0])/2,(o[1]+h[1])/2,(o[2]+h[2])/2])}return z=Vh(B,[D,0,0],U,H,f,k),qi(d,z,e,H,Q,m,i,c,K,V)}return Ol},o._80o=function(W,w,$){var K=this,t=K.shapeModel;if(t){var y=K.gv;dc(y),_o(y,K.data,t,K,K.getBodyColor(),$)}},o.createLineModel=function(f,j,M,U,b){var s=this,e=s.s,S=oe(f,j,e(pm)),x=e(U+".color");if(x){for(var l=[],V=0;V<S.length;V++){var J=S[V],P=J.length;if(P>1){var h=J[0];l.push(h.x,h.y,h.z);for(var B=1;P-1>B;B++)h=J[B],l.push(h.x,h.y,h.z),l.push(h.x,h.y,h.z);h=J[P-1],l.push(h.x,h.y,h.z)}}var W,E,y,H=e(b),I=0;H&&(E=e(b+".color"),W=e(b+".pattern"),I=e(b+".offset"),y=x),$d(s.gv,s.data,l,E||x,y?N:e(U+".gradient.color"),M,W||e(U+".pattern"),I,y)}return S},o.createTubeModel=function(s,F,H,u){for(var Y=this,d=Y.s,x=d("shape3d.side")||Xr,X=d("shape3d.start.angle"),R=d("shape3d.sweep.angle"),m=d(wn)?d("shape3d.top.cap"):N,r=d(Hg)?d("shape3d.bottom.cap"):N,i=d("3d.clip.direction"),U="flat"===m,V="flat"===r,E=U&&(u?u.uv:d("shape3d.top.image")),l=V&&(u?u.uv:d("shape3d.bottom.image")),b=u?u.uv:d("shape3d.image")||"uv.left"===i||"uv.right"===i,J=d("shape3d.smooth"),A={vs:[],uv:b?[]:N,ns:J?[]:N,top_vs:U?[]:N,top_uv:E?[]:N,bottom_vs:V?[]:N,bottom_uv:l?[]:N},Q=oe(s,F,d(pm),H),B=0,k=Q.length,S=0,f=d("shape3d.uv.union");k>B;B++)f!==!0&&(S=0),S=jk(A,Q[B],d(Gc),H,x,X,R,m,r,S);if(u){var q=Y._matWithExtraction||Y.mat;fi(Y.gv,Y.data,A,Y,Y.getBodyColor(),q?[q]:[],u),Y.gv.getWireframeGeometry(Y.data)&&(Y.wfGeometry=Vd(Y,A),Y.wfMatrix=q?Sc(q):null)}else Y.shapeModel=A;Y.lineShapeModel=A;var w=Y._vsTranslation;if(w)for(var B=0,T=Q.length;T>B;B++)for(var e=0,I=Q[B].length;I>e;e++)Q[B][e]=Q[B][e].clone().applyMatrix4(w);return Q},o.getCache=function(){var R=this.info;if(R){var O=R.list;if(O){var t=R.cache;return t||(t=R.cache=bh(O)),t}}return N}}});var kp=function(B,C){for(var H,o=0,t=B.length,K=0,n=t-1;n>=K;)if(o=g(K+(n-K)/2),H=B[o].length-C,0>H)K=o+1;else{if(!(H>0)){n=o;break}n=o-1}o=n;var x=B[o],L=x.point;return o===t-1||x.length===C||(L=(new zh).subVectors(B[o+1].point,L).normalize().multiplyScalar(C-x.length).add(L)),{point:L,tangent:x.tangent}},bh=function(q){for(var I,y,C=[],x=0,T=0;T<q.length;T++){for(var R=q[T],s=0;s<R.length;s++){I=R[s],y&&(x+=y.distanceTo(I));var U=new zh,Z=R[s+1];Z?U.subVectors(Z,I):y?U.subVectors(I,y):U.x=1,U.normalize(),C.push({point:I,length:x,tangent:U}),y=I}y=null}return C},oe=function(i,V,t,b){t=t||Ff;for(var T=[],G=0,y=i.size();y>G;G++){var g=i.get(G);T.push(new zh(g.x,g.e||0,g.y))}V&&(Np(V)&&(V=V._as),V.length||(V=null));for(var j,x,o,w,e,Z=[],O=[],R=0,D=0,P=V?V.length:y;P>D;D++){if(e=V?V[D]:0===D?1:2,1===e)Z.push(o=[]),o.push(T[R++]);else if(2===e||5===e)if(w=2===e?T[R++]:o[0],b){var I=V?V[D+1]:P>D+1?2:N;if(2===I||5===I){var k=o[o.length-1],E=2===I?T[R]:o[0],r=(new zh).subVectors(k,w),B=(new zh).subVectors(E,w),d=r.length(),p=B.length();if(d&&p)if(b>d/2&&b>p/2)o.push(w);else for(r.multiplyScalar(J(b,d/2)/d).add(w),B.multiplyScalar(J(b,p/2)/p).add(w),j=new Si(r,w,B).getPoints(t),x=0;t>=x;x++)o.push(j[x])}else o.push(w)}else o.push(w);else if(3===e)for(j=new Si(o[o.length-1],T[R++],T[R++]).getPoints(t),x=1;t>=x;x++)o.push(j[x]);else if(4===e)for(j=new pj(o[o.length-1],T[R++],T[R++],T[R++]).getPoints(t),x=1;t>=x;x++)o.push(j[x]);O.push(Z.length,o.length)}return Z.indexMark=O,Z},vq=function(M){for(var k,v,$=new zh,H=[],p=[],V=[],d=0,P=M.length;P>d;d++)k=M[d],v=M[d+1],v?$.subVectors(v,k):$.subVectors(k,M[d-1]),H.push($.normalize().clone());var u,L=new zh,a=new zh,z=new Ic,J=1e-4,t=H[0],R=p[0]=new zh,D=V[0]=new zh;for(Math.abs(Math.abs(t.y)-1)<J?L.set(1,0,0):L.set(0,1,0),a.crossVectors(t,L).normalize(),R.crossVectors(t,a),D.crossVectors(t,R),d=1;P>d;d++)p[d]=p[d-1].clone(),V[d]=V[d-1].clone(),a.crossVectors(H[d-1],H[d]),a.length()>J&&(a.normalize(),u=_(ls(H[d-1].dot(H[d]),-1,1)),p[d].applyMatrix4(z.makeRotationAxis(a,u))),V[d].crossVectors(H[d],p[d]);return{B:V,T:H,N:p}},jk=function(){var H=function(L){for(var s=1;s<arguments.length;s++){var p=arguments[s];L.push(p.x,p.y,p.z)}},r=function(v){for(var H=1;H<arguments.length;H++){var V=arguments[H].uv;v.push(V[0],V[1])}},R=function(h){for(var U=1;U<arguments.length;U++){var x=arguments[U].ns;h.push(x[0],x[1],x[2])}},G=function(R,Y,L,q,w){var D=-q*s(w),x=q*W(w);return new zh(R.x+D*L.x+x*Y.x,R.y+D*L.y+x*Y.y,R.z+D*L.z+x*Y.z)},b=function(s,h,e,X,L,l,F,I,j){F=F||f;for(var q,r=[],y=F/L,q=j?new Vg:N,k=0;L>=k;k++){var H=G(s,h,e,X,k*y+l);r.push(H),I!=N&&(H.uv=[I,1-k/L]),j&&(H.ns=q.subVectors(H,s).normalize().toArray())}return r},A=function(X,z,F,J,L,M,o,p,b){b=b||f;var Y=z?X.top_vs:X.bottom_vs;if(Y)for(var I=z?X.top_uv:X.bottom_uv,r=b/o,Z=0;o>Z;Z++){var u,Q;z?(u=Z*r+p,Q=(Z+1)*r+p):(Q=Z*r+p,u=(Z+1)*r+p),H(Y,G(F,J,L,M,u),G(F,J,L,M,Q),F),I&&I.push(.5-.5*s(u),.5-.5*W(u),.5-.5*s(Q),.5-.5*W(Q),.5,.5)}};return function(Z,G,a,g,e,V,k,E,s,u){var w=G.length;if(w>1){var T,D,K,J,P,d,O,y=vq(G),F=y.T,h=y.N,Y=y.B;"flat"===E&&A(Z,!0,G[0],Y[0],h[0],g,e,V,k),"flat"===s&&A(Z,!1,G[w-1],Y[w-1],h[w-1],g,e,V,k);var j,_,C=[],m=p(e/2),W="round"===E,$="round"===s,l=G[0],c=F[0],o=Y[0],z=h[0],i=G[w-1],X=F[w-1],M=Y[w-1],v=h[w-1];if(W){for(K=1;m>=K;K++)h.splice(0,0,z),Y.splice(0,0,o),F.splice(0,0,c),_=-K/m*g,G.splice(0,0,c.clone().multiplyScalar(_).add(l)),C[m-K]=U(g*g-_*_);w+=m}if($){for(K=1;m>=K;K++)h.push(v),Y.push(M),F.push(X),_=K/m*g,G.push(X.clone().multiplyScalar(_).add(i)),C[G.length-1]=U(g*g-_*_);w+=m}if(Z.uv){var n=0,S=u,B=[];for(a&&(n=a),P=G[0],B[0]=0,K=1;w>K;K++)J=G[K],B[K]=P.distanceTo(J),P=J,a||(n+=B[K]);for(j=[],K=0;w>K;K++)S+=B[K],j[K]=n?S/n:0;u=S,Z.internalUvScale=n?u/n:1}var x=Z.ns?!0:!1;for(K=0;w>K;K++){if(J=G[K],d=Y[K],O=h[K],T=b(J,d,O,C[K]===I?g:C[K],e,V,k,j?j[K]:N,x),D)for(var L=0;e>L;L++){var t=D[L],q=D[L+1]||D[0],Q=T[L],f=T[L+1]||T[0];H(Z.vs,q,t,Q,Q,f,q),Z.uv&&r(Z.uv,q,t,Q,Q,f,q),x&&R(Z.ns,q,t,Q,Q,f,q)}D=T}}return u}}();xo(F,{getLineLength:function(Y){return Y[Y.length-1].length},getLineOffset:function(U,m){return kp(U,m)},getLineCacheInfo:function(k,P,x,e){return bh(oe(k,P,x,e))}});var ch=y.graph3d.RenderLite={},rf=new Array(0),Ac=ch.Buffer=function(c,F,N,Z){this.gl=c,this.buffer=c.createBuffer(),this.type=F||c.ARRAY_BUFFER,this.drawType=Z||c.STATIC_DRAW,this.data=rf,N&&this.upload(N)};Ac.prototype.upload=function(Y,W,z){z||this.bind();var J=this.gl;Y=Y||this.data,W=W||0,this.data.byteLength>=Y.byteLength?J.bufferSubData(this.type,W,Y):J.bufferData(this.type,Y,this.drawType),this.data=Y},Ac.prototype.bind=function(){var h=this.gl;h.bindBuffer(this.type,this.buffer)},Ac.createVertexBuffer=function(R,F,G){return new Ac(R,R.ARRAY_BUFFER,F,G)},Ac.createIndexBuffer=function(p,I,F){return new Ac(p,p.ELEMENT_ARRAY_BUFFER,I,F)},Ac.create=function(z,M,N,u){return new Ac(z,M,u)},Ac.prototype.destroy=function(){this.gl.deleteBuffer(this.buffer)};var rh=ch.Shader=function($,l,I){this.gl=$,this.program=Hq($,l,I),this.attributes=Bh($,this.program);var P=vf($,this.program);this.uniforms=si($,P)};rh.prototype.bind=function(){this.gl.useProgram(this.program)},rh.prototype.destroy=function(){this.gl};var Hq=function(Y,u,Z){var B=yj(Y,Y.VERTEX_SHADER,u),c=yj(Y,Y.FRAGMENT_SHADER,Z),$=Y.createProgram();return Y.attachShader($,B),Y.attachShader($,c),Y.linkProgram($),Y.getProgramParameter($,Y.LINK_STATUS)||(rl("LINK","LITE",Y.getProgramParameter($,Y.VALIDATE_STATUS),Y.getError(),Y.getProgramInfoLog($)),Y.deleteProgram($),$=null),Y.deleteShader(B),Y.deleteShader(c),$},yj=function(I,v,A){var c=I.createShader(v);return I.shaderSource(c,A),I.compileShader(c),I.getShaderParameter(c,I.COMPILE_STATUS)?c:(rl("COMPILE","LITE",v,I.getError(),I.getShaderInfoLog(c)),null)},vf=function(p,F){for(var P={},R=p.getProgramParameter(F,p.ACTIVE_UNIFORMS),h=0;R>h;h++){var f=p.getActiveUniform(F,h),B=f.name.replace(/\[.*?\]/,""),m=bm(p,f.type);P[B]={type:m,size:f.size,location:p.getUniformLocation(F,B),value:Ag(m,f.size)}}return P},Bh=function(Y,w){for(var q={},v=Y.getProgramParameter(w,Y.ACTIVE_ATTRIBUTES),h=0;v>h;h++){var D=Y.getActiveAttrib(w,h),k=bm(Y,D.type);q[D.name]={type:k,size:yh(k),gl:Y,location:Y.getAttribLocation(w,D.name),pointer:Sr}}return q},Sr=function(c,g,P,r,l){var $=this.gl;$.enableVertexAttribArray(this.location),c instanceof ch.Buffer||(c=ch.Buffer.createVertexBuffer($,c)),$.bindBuffer(c.type,c.buffer),$.vertexAttribPointer(this.location,this.size,g||$.FLOAT,P||!1,r||0,l||0)},yh=function(K){return Sm[K]},Sm={"float":1,vec2:2,vec3:3,vec4:4,"int":1,ivec2:2,ivec3:3,ivec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1},bm=function(R,a){if(!Mk){var q=C.keys(mo);Mk={};for(var h=0;h<q.length;++h){var b=q[h];Mk[R[b]]=mo[b]}}return Mk[a]},Mk=null,mo={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D"},Ag=function(L,J){switch(L){case"float":return 0;case"vec2":return new Float32Array(2*J);case"vec3":return new Float32Array(3*J);case"vec4":return new Float32Array(4*J);case"int":case"sampler2D":return 0;case"ivec2":return new Int32Array(2*J);case"ivec3":return new Int32Array(3*J);case"ivec4":return new Int32Array(4*J);case"bool":return!1;case"bvec2":return nr(2*J);case"bvec3":return nr(3*J);case"bvec4":return nr(4*J);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}},nr=function(s){for(var Y=new Array(s),e=0;e<Y.length;e++)Y[e]=!1;return Y},si=function(t,J){var D={data:{}};D.gl=t;for(var c=C.keys(J),S=0;S<c.length;S++){var Z=c[S],L=Z.split("."),G=L[L.length-1],z=yn(L,D),u=J[Z];z.data[G]=u,z.gl=t,C.defineProperty(z,G,{get:Fj(G),set:eg(G,u)})}return D},Fj=function(v){var Z=Zr.replace("%%",v);return new Function(Z)},eg=function(H,N){var _,X=zn.replace(/%%/g,H);return _=1===N.size?xb[N.type]:rs[N.type],_&&(X+="\nthis.gl."+_+";"),new Function("value",X)},yn=function(R,Z){for(var p=Z,I=0;I<R.length-1;I++){var h=p[R[I]]||{data:{}};p[R[I]]=h,p=h}return p},Zr=["return this.data.%%.value;"].join("\n"),zn=["this.data.%%.value = value;","var location = this.data.%%.location;"].join("\n"),xb={"float":"uniform1f(location, value)",vec2:"uniform2f(location, value[0], value[1])",vec3:"uniform3f(location, value[0], value[1], value[2])",vec4:"uniform4f(location, value[0], value[1], value[2], value[3])","int":"uniform1i(location, value)",ivec2:"uniform2i(location, value[0], value[1])",ivec3:"uniform3i(location, value[0], value[1], value[2])",ivec4:"uniform4i(location, value[0], value[1], value[2], value[3])",bool:"uniform1i(location, value)",bvec2:"uniform2i(location, value[0], value[1])",bvec3:"uniform3i(location, value[0], value[1], value[2])",bvec4:"uniform4i(location, value[0], value[1], value[2], value[3])",mat2:"uniformMatrix2fv(location, false, value)",mat3:"uniformMatrix3fv(location, false, value)",mat4:"uniformMatrix4fv(location, false, value)",sampler2D:"uniform1i(location, value)"},rs={"float":"uniform1fv(location, value)",vec2:"uniform2fv(location, value)",vec3:"uniform3fv(location, value)",vec4:"uniform4fv(location, value)","int":"uniform1iv(location, value)",ivec2:"uniform2iv(location, value)",ivec3:"uniform3iv(location, value)",ivec4:"uniform4iv(location, value)",bool:"uniform1iv(location, value)",bvec2:"uniform2iv(location, value)",bvec3:"uniform3iv(location, value)",bvec4:"uniform4iv(location, value)",sampler2D:"uniform1iv(location, value)"},Um=function(x){function e(r){if("string"!=typeof r)return 0|r;switch(r){case"low":return 512;case"medium":return 1024;case"ultra":return 4096;default:return 2048}}function X(){M.enable=!F.graph3dViewShadowDisabled,C=F.graph3dViewShadowType,h=F.graph3dViewShadowIntensity,_=F.graph3dViewShadowBias,l=F.graph3dViewShadowQuality,K=F.graph3dViewShadowRadius,a=F.graph3dViewShadowDegreeX,z=F.graph3dViewShadowDegreeZ,v=null}var M=this;M.enable=!1;var C,h,_,l,K,a,z,v;X();var O,B,A,D,g=1,t=e(l),n=!1,S=new y.Math.Matrix4,o=new y.Math.Matrix4,P=M.pvMatrix=new y.Math.Matrix4,q=0;M.contextLost=function(){M.mapForReflector=null,M.map=null;var d=x.getGL();d&&(d._shadowShader=null)},M.render=function(){if(!x._picking&&M.enable){var P=x.getGL();if(P){if(n&&M.setupShadowCamera(),x._glCapabilities&&(t=Math.min(t,x._glCapabilities.maxTextureSize)),D=x.isReflecting(P)){if(q===P._renderInfo.frame)return;q=P._renderInfo.frame}var l=D?"mapForReflector":"map";if((O=M[l])?O.setSize(t,t):O=M[l]=new Os(x,x.getGL(),0,0,{samples:1,minFilter:sm.NEAREST,magFilter:sm.NEAREST,width:t,height:t}),!P._shadowShader){var d="#define MAX_BOX_CLIPPER "+x._boxClippers.length;x._batchInstancedDisabled||(d+="\n#define BATCHINSTANCE"),P._shadowShader=new ch.Shader(P,Um.shaderSrc.vs.replace("$DEFINE",d),Um.shaderSrc.fs.replace("$DEFINE",d))}var v=x._frameState,h=v.renderState.glState;h.blend.enabled=!1,h.depth.enabled=!0,h.depth.mask=!0;var N=h.color.clear.slice(0);Wp(P,[1,1,1,1]),v.renderState.useProgram(P._shadowShader.program),b(),Wp(P,N)}}},M.deleteShadowProgram=function(){var w=x.getGL();w&&w._shadowShader&&(w.deleteProgram(w._shadowShader.program),w._shadowShader=null)},M.getShadow=function(){var b={degreeX:a,degreeZ:z,intensity:h,quality:l,type:C,radius:K,bias:_,bounding:v};return 1!==g&&(b.boundExtend=g),b},M.setShadow=function(D,f){D=!!D;var X=M.enable!==D;M.enable=D,"object"==typeof f&&(f.intensity!==I&&(h=f.intensity),f.bias!==I&&(_=f.bias),f.radius!==I&&(K=f.radius),f.degreeX!==I&&(a=f.degreeX),f.degreeZ!==I&&(z=f.degreeZ),f.quality!==I&&(l=f.quality),f.bounding!==I&&(v=f.bounding),f.type!==I&&C!==f.type&&(C=f.type,X=!0),t=e(l),f.boundExtend!==I&&(g=f.boundExtend)),D&&M.setupShadowCamera(),X&&gk(x),x.iv()};var Q=null;M.tryInvalidateLater=function(K,P){"modelLoaded"===P&&(Q&&Vm(Q,!0),Q=hh(function(){Q=null,M.refresh()},M,I,200))},M.refresh=function(){this.enable&&(this.setupShadowCamera(),x.iv())},M.tryUpdateBounding=function(W){if(!v){var m=this.boundingSphere;if(m){var $=(new Ic).fromArray(rg(W,x.getMat(W))),n=W.getAnchor3d(),j=new Vg;m.containsPoint(j.set(0-n.x,0-n.y,0-n.z).applyMatrix4($))&&m.containsPoint(j.set(0-n.x,0-n.y,1-n.z).applyMatrix4($))&&m.containsPoint(j.set(0-n.x,1-n.y,0-n.z).applyMatrix4($))&&m.containsPoint(j.set(0-n.x,1-n.y,1-n.z).applyMatrix4($))&&m.containsPoint(j.set(1-n.x,0-n.y,0-n.z).applyMatrix4($))&&m.containsPoint(j.set(1-n.x,0-n.y,1-n.z).applyMatrix4($))&&m.containsPoint(j.set(1-n.x,1-n.y,0-n.z).applyMatrix4($))&&m.containsPoint(j.set(1-n.x,1-n.y,1-n.z).applyMatrix4($))||M.setupShadowCamera()}}},M.createShadow=function(S){if(S||(S=x._frameState.renderState.directUniforms()),S.shadowMatrix=P.toArray(),x._getFrameRenderOptions("renderShadow")===!1){var I,T=x.getGL();(I=T._emptyShadowTexture)||(I=T._emptyShadowTexture=mb(T,null,[255,255,255,255])),S.shadowMap=I}else{var L=x._getFrameRenderOptions("useReflectorSelfShadowMap")&&M.mapForReflector;S.shadowMap=L?M.mapForReflector.texture:M.map.texture}S.shadowSize=[O.width,O.height],S.shadowIntensity=h,S.shadowBias=_,S.shadowRadius=K},M.genShaderDefine=function(){var c="#define USE_SHADOWMAP\n";return"hard"===C?c+="#define SHADOWMAP_TYPE_PCF\n":"soft"===C&&(c+=x.isGLTempRegisterLimited()?"#define SHADOWMAP_TYPE_PCF\n":"#define SHADOWMAP_TYPE_PCF_SOFT\n"),c};var c;M.setupShadowCamera=function(){if(B||(B=M.boundingSphere=new y.Math.Sphere),v)B.set((new Vg).fromArray(v),v[3]);else{n=!1;var d,A,f=x.getBoundingBox(x.dm().toDatas(function(z){return z.s("shadow.cast")&&x.isVisible(z)}));f?(d=new Vg(f.min),A=new Vg(f.max)):(d=new Vg(-256,-256,-256),A=new Vg(256,256,256),n=!0),B.set(d.clone().add(A).multiplyScalar(.5),.5*d.distanceTo(A)*g)}var q=B.radius,X=2*q;c=ui(Gj(),-q,q,-q,q,X/1e3,X),P.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),P.multiply(S.fromArray(c));var p=Math.tan(-a*Math.PI/180),E=Math.tan(-z*Math.PI/180),o=q/Math.sqrt(p*p+E*E+1),m=new Vg(o*p,o,o*E);M.direction=Vg.normalizeArray(m.clone().multiplyScalar(-1)),S.lookAt(m,new Vg(0,0,0),new Vg(0,1,0)).setPosition(m.add(B.center)),S.getInverse(S),P.multiply(S)},M.getDirection=function(){return M.enable?M.direction:void 0};var b=function(){var Q=x.getGL(),J=t,N=t;O.setSize(Q,J,N),O.bind(Q),Q.clear(sm.COLOR_BUFFER_BIT|sm.DEPTH_BUFFER_BIT);var E=x._frameState,P=E.renderState,g=P.directUniforms(),$=P.directAttribs(),f=P.directState();g.uUseInstance=!1,$.aMatrixInstanced=I,g.projectionMatrix=c,(A=x._boxClippers.length>0)&&(yc(x,g,ar),g.uClipperMatrix=x._boxClipperMatrixes,g.uClipperClipInner=x._boxClipperClipInner);var a=x._viewport;x.setViewport(Q,0,0,J,N);var n,C,e,X,S=x._sortedRenderLayers;for(n=0,C=S.length;C>n;n++)if(e=S[n],!x.getRenderLayerInfo(e).ignore&&(X=x._40Q.get(e))){var s=X.batchIndexMap;M.renderItems(Q,g,$,f,X.opaque,s),M.renderItems(Q,g,$,f,X.transparent,s),M.renderBatch(Q,g,$,f,X.batchModelMap,s)}O.unbind(Q),x.setViewport(Q,a[0],a[1],a[2],a[3])};M._renderDirect=function(a,J,g,d,C){if(g&&g.length){var H=C&&C.length?C.length/16:0;J.position=Ch(a,x._buffer.vs,g,N),d?(te(a,x._buffer.is,d),yp(a,0,d.length,null,d instanceof Uint32Array?a.UNSIGNED_INT:null,null,H)):fj(a,0,g.length/3,null,H)}},M.renderShapeModel=function(r,i,C,W){var Y,a,m;if(hr(C))for(a=0,m=C.length;m>a;a++)Y=C[a],Y&&M.renderShapeModel(r,i,Y,W);else Je(C)?M.renderShapeModel(r,i,Kd(W,C),W):Go(C)&&(C.shape3d?M.renderShapeModel(r,i,C.shape3d,W):M.renderShapeModelImpl(r,i,C))},M.renderShapeModelImpl=function(r,o,t){ec(t),M._renderDirect(r,o,t.vs,t.is),M._renderDirect(r,o,t.top_vs,t.top_is),M._renderDirect(r,o,t.bottom_vs,t.bottom_is),M._renderDirect(r,o,t.from_vs,t.from_is),M._renderDirect(r,o,t.to_vs,t.to_is)},M.renderBatch=function(O,V,G,m,Q){if(!kl(Q)&&!x.drawFilter){V.modelViewMatrix=o.identity().premultiply(S).toArray();var X,L,C;for(X in Q)if(C=x.getBatchInfo(X)||go,C.visible!==!1&&C.shadowCast!==!1&&(!D||C.reflectable!==!1)){L=Q[X],L.invalidate&&cf(L),A&&(V.modelMatrix=tc,yc(x,V,C.clipboxMask===I?kh:C.clipboxMask));var g=L.ms32,e=g&&g.length;e&&(V.uUseInstance=!0,G.aMatrixInstanced=Bk(O,x._buffer.ms,g,N)),M._renderDirect(O,G,L.vs32,L.is,g),e&&(V.uUseInstance=!1,G.aMatrixInstanced=I)}}},M.renderItems=function(J,h,Z,O,r,p){var w,R,t,B,z,P,i=r.length;for(w=0;i>w;w++)if(R=r[w],B=R.ui,t=R.data,!(Lo(t)||!t.s("shadow.cast")||t instanceof Mq||t.s("effect.flow")||!x.isVisible(t)||p[t._id]||D&&t.s("3d.reflectable")===!1)){var k=B.s("3d.clip.direction");if(k){var $=B.s("3d.clip.percentage");if(0===$)continue;var G=B._formatClipUniforms(k,$,t);h.uClipPercent=G[1],h.uClipDirection=G[0]}else h.uClipDirection=0;z=B.shapeModel||Kd(B),z||(z=t instanceof y.Node&&!(t instanceof y.Shape)?{vs:Er,is:Kl}:[B.left,B.front,B.right,B.back,B.top,B.bottom]),P=B.mat?o.fromArray(B.mat):o.identity();var q=B._vsTranslation;q&&(F.extractShapeTranslation||F.extractPolylineTranslation||F.extractVerticesTranslation)&&P.multiply(q),A&&(h.modelMatrix=P.toArray(),yc(x,h,t.s("3d.clipbox")?ar:t.s("3d.clipbox.mask"))),h.modelViewMatrix=P.premultiply(S).toArray(),O.cullFace.enabled=!!t.s("shape3d.reverse.cull"),M.renderShapeModel(J,Z,z,B)}},M.resetProperties=X};Um.shaderSrc={vs:["$DEFINE","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","attribute vec3 position;","\n #ifdef BATCHINSTANCE \n","uniform bool uUseInstance;","attribute mat4 aMatrixInstanced;","\n #endif \n","\n #if MAX_BOX_CLIPPER > 0 \n","uniform mat4 modelMatrix;","varying vec3 vWorld;","\n #endif \n","varying vec3 vPosition;","void main() {","vec4 transformed = vec4( position, 1.0 );","\n #ifdef BATCHINSTANCE \n","if (uUseInstance) { transformed = aMatrixInstanced * transformed; }","\n #endif \n","vPosition = vec3(transformed);","vec4 mvPosition = modelViewMatrix * transformed;","\n #if MAX_BOX_CLIPPER > 0 \n","vWorld = vec3(modelMatrix * transformed);","\n #endif \n","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fs:["$DEFINE","precision highp float;","const float PackUpscale = 256. / 255.;","const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );","const float ShiftRight8 = 1. / 256.;","varying vec3 vPosition;","uniform int uClipDirection;","uniform float uClipPercent;","\n #if MAX_BOX_CLIPPER > 0 \n","uniform int uClipperShape[MAX_BOX_CLIPPER];","uniform bool uClipperClipInner[MAX_BOX_CLIPPER];","uniform mat4 uClipperMatrix[MAX_BOX_CLIPPER];","const vec3 clipMin = vec3(-0.5, -0.5, -0.5);","const vec3 clipMax = vec3(0.5, 0.5, 0.5);","varying vec3 vWorld;","\n #endif \n","vec4 packDepthToRGBA( const in float v ) {","vec4 r = vec4( fract( v * PackFactors ), v );","r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;","}","void main() {","if (uClipDirection > 0) {","vec3 dir = vec3(0.0, 0.0, 0.0);","if (uClipDirection < 2) { dir.x = 1.0; }","else if (uClipDirection < 3) { dir.x = -1.0; }","else if (uClipDirection < 4) { dir.y = 1.0; }","else if (uClipDirection < 5) { dir.y = -1.0; }","else if (uClipDirection < 6) { dir.z = 1.0; }","else if (uClipDirection < 7) { dir.z = -1.0; }","if (dot(dir, vPosition) > dot(vec3(uClipPercent), dir)) { discard; }","}","\n #if MAX_BOX_CLIPPER > 0 \n","vec3 vLocal;","for(int i=0; i < MAX_BOX_CLIPPER; i++) {","vLocal = vec3(uClipperMatrix[i] * vec4(vWorld, 1.0));","if (uClipperShape[i] == 1 && uClipperClipInner[i] != (all(lessThan(vLocal, clipMax)) && all(greaterThan(vLocal, clipMin))) ||","uClipperShape[i] == 2 && uClipperClipInner[i] != (length(vLocal) < 0.5)) { ","discard; return;","}","}","\n #endif \n","gl_FragColor = packDepthToRGBA( gl_FragCoord.z );","}"].join("\n")},Um.PARAMS=["quality","intensity","bias","radius","type","degree.x","degree.z","bounding"],Wn.ms_shadow=function(U){Um.PARAMS.forEach(function($){var h=$.replace(/(^|\.)[a-z]/g,function(h){return h[h.length-1].toUpperCase()}),H=h.charAt(0).toLowerCase()+h.substr(1);U["getShadow"+h]=function(){return this._getShadowParam(H)},U["setShadow"+h]=function(Y){this._setShadowParam(H,Y)}}),U.getCurrentShadowBounding=function(a){(a||!this.shadowMap.boundingSphere)&&this.shadowMap.setupShadowCamera();var X=this.shadowMap.boundingSphere;return[X.center.x,X.center.y,X.center.z,X.radius]},U.refreshShadow=function(){this.shadowMap.refresh()},U.enableShadow=function(u){this.shadowMap.setShadow(!0,u)},U.disableShadow=function(){this.shadowMap.setShadow(!1)},U._getShadowParam=function(s){return this.shadowMap.getShadow()[s]},U._setShadowParam=function(e,A){var X=this._getShadowParam(e),K={};K[e]=A;var a=this.shadowMap;a.setShadow(a.enable,K),this.firePropertyChange("shadow"+e.charAt(0).toUpperCase()+e.substr(1),X,A)}};var ob=function(Y){function f(j,v,B,g,t){var h=Y.getData3dUI(B),n=h.s("shape3d");if("billboard"===n||"plane"===n){var p;(p=M[v])||(p=M[v]=new Os(Y));var a=B.s("effect.flow.size"),x=B.s("effect.flow.uvshape"),K=B.getFinalScale3d(),A=K[0],c="billboard"===n?K[1]:K[2];A>c?(c=c/A*a,A=a):(A=A/c*a,c=a),A=Math.max(128,Math.round(A)||0),c=Math.max(128,Math.round(c)||0),p.setSize(j,A,c),p.bind(j);var Q=Y.getViewport(j);Y.setViewport(j,0,0,A,c),j.clear(j.COLOR_BUFFER_BIT|j.DEPTH_BUFFER_BIT);var l,h=Y.getData3dUI(B),k=Kd(h,n);if(!k)return!1;!k.ns&&k.length&&(k=k[0]),ec(k),l=k.vs;var R,E=B.s("effect.flow.gradient");if(E){if(R="Flow3d.Cached."+E,!y.Default.getImageMap()[R]){var m=100;y.Default.setImage(R,y.Default.toCanvas({width:m,height:m,comps:[{type:"rect",background:"rgb(0,0,0)",gradient:E,rect:[0,0,m,m]}]},m,m))}}else R=B.s("shape3d.image");g.useXZ="plane"===n,g.image=Y.getTexture(R,B),g.blend=B.s("effect.flow.blend")||S,g.uvMatrix=xe(h.s("shape3d.uv.rotation"),h.s("shape3d.uv.offset"),h.s("shape3d.uv.scale"),h.s("shape3d.uv.anchor"),V).toArray9(),g.intensity=B.s("effect.flow.intensity");var X=Z.indexOf(x);-1===X&&0===x.indexOf("polygon")&&(X=cc(1*x.substring(7),3,1024)-1),g.shape=X,t.position=Ch(j,null,l,N,3),fj(j,0,l.length/3),p.unbind(j),Y.setViewport(j,Q[0],Q[1],Q[2],Q[3]);var $=B.getMatrix4();$.getInverse($);var H=$.getElements();"plane"===n?H[1]=H[5]=H[9]=H[13]=0:H[2]=H[6]=H[10]=H[14]=0,d[v]={matrix:$,group:B.s("effect.flow.group")}}}var V,T=this,M=this.renderTargetPool=[],d=[],Z=["rect","circle","polygon"];T.render=function(){if(!Y._picking){var X=Y._flowObjects;if(X.length){var z=Y.getGL();if(z){var W;(W=z._flowShader)||(W=z._flowShader=new ch.Shader(z,ob.shaderSrc.vs,ob.shaderSrc.fs));var b=Y._frameState.renderState,m=b.glState;m.blend.enabled=!1,m.depth.enabled=!1,m.cullFace.enabled=!1;var Z=m.color.clear.slice(0);Wp(z,[0,0,0,1]),b.useProgram(W.program);var _,$,c=b.directUniforms(),A=b.directAttribs();for(_=0,$=X.length;$>_;_++)f(z,_,X[_],c,A);Wp(z,Z),M.length!==$&&M.splice($,M.length-$)}}}},T.contextLost=function(){var V=Y.getGL();V&&(V._flowShader=null,M=this.renderTargetPool=[])},T.createFlow=function(s){var i;if(i=M.length){s||(s=Y._frameState.renderState.directUniforms());for(var j=[],K=[],F=[],J=0;i>J;J++)j[J]=d[J].matrix.toArray(),K[J]=M[J].texture,F[J]=!1;s.flowMatrix=j;for(var J=0;i>J;J++)s["flowTexture"+J]=K[J];s.flowEnabled=F}},T.disableFlow=function(G){var D;if(D=M.length){G||(G=Y._frameState.renderState.directUniforms());for(var R=[],h=0;D>h;h++)R[h]=!1;G.flowEnabled=R}},T.resetDataFlowEnabld=function(f,l){return T.resetFlowUniform(f.s("effect.flow.mask"),l)},T.resetFlowUniform=function(H,S){var t=M.length,$=new Array(t);if(H)for(var T=0;t>T;T++)H&1<<d[T].group&&($[T]=!0);S.flowEnabled=$};var S="white"};ob.shaderSrc={vs:["uniform bool useXZ;","attribute vec3 position;","varying vec2 vUv;","void main() {","if (useXZ) vUv = vec2(position.x, position.z);","else vUv = vec2(position.x, position.y);","gl_Position = vec4(vUv * 2.0, 0.0, 1.0);","}"].join("\n"),fs:["precision highp float;","const float pi2 = 6.2831853;","uniform sampler2D image;","uniform mat3 uvMatrix;","uniform int shape;","uniform vec4 blend;","uniform float intensity;","varying vec2 vUv;","void main() {","vec2 uv;","float angle = atan(vUv.y, vUv.x) / pi2 + 0.5;","if (shape == 0) {","uv = vUv + 0.5;","}","else if (shape == 1) {","uv = vec2(length(vUv) * 2.0, angle);","}","else {","float step = 1.0 / float(shape + 1);","float modAngle = mod(angle, step) - step * 0.5;","uv = vec2(length(vUv) * 2.0 * cos(modAngle * pi2) , angle);","}","vec4 color = texture2D(image, vec2((uvMatrix * vec3(uv, 1.0)).xy)) * blend;","gl_FragColor = color * color.a * intensity;","}"].join("\n")};var Ds=function(I){this.gv=I,this.onMouseOver=this.onMouseOver.bind(this),this.resetProperties()};Ds.Mode={Disable:0,Selection:1,MouseOver:2,Style:3},Wn.ms_highlight=function(G){G.setHighlightMode=function(H){var $;$="selection"===H||"selected"===H?Ds.Mode.Selection:"mouseover"===H||"hover"===H?Ds.Mode.MouseOver:"style"===H?Ds.Mode.Style:Ds.Mode.Disable;var h=this.getHighlightMode();this._highlightHelper.mode=$,this.firePropertyChange("highlightMode",h,H)},G.getHighlightMode=function(){var s=this._highlightHelper.mode;return s===Ds.Mode.Selection?"selected":s===Ds.Mode.MouseOver?"hover":s===Ds.Mode.Style?"style":"disabled"},["type","color","width","glow","strength"].forEach(function(U){var s=U.replace(/(^|\.)[a-z]/g,function(M){return M[M.length-1].toUpperCase()});G["getHighlight"+s]=function(){return this._highlightHelper[U]},G["setHighlight"+s]=function(Q){var P=this._highlightHelper,N=P[U];Q!==N&&(P[U]=Q,this.firePropertyChange("highlight"+s,N,Q))}})},ri(Ds,C,{onMouseOver:function(D){F.preventDefault(D);var d=this.gv;if(!d._48Q){var s=d.getDataAt(D);s!==this.mouseOverData&&(this.mouseOverData=s,d.iv())}},setFetchTargetFunc:function(r){this.fetchTargetFunc=r},_42:function(d,Z){var $,N,Y=this,v=Y._mode,t=Y.gv;if(!d._renderInfo.reflectDepth&&v!==Ds.Mode.Disable){if(v===Ds.Mode.Selection?$=t.sm().getSelection().toArray(function($){return $.s("highlight.visible")}):v===Ds.Mode.MouseOver&&Y.mouseOverData&&Y.mouseOverData.s("highlight.visible")&&($=[Y.mouseOverData]),Y.fetchTargetFunc&&($=Y.fetchTargetFunc($)),v===Ds.Mode.Style)$=$||[],N=function(F){if($.indexOf(F)>=0)return!1;var p=t.getDataHighlightMode(F);return p===!1?!0:p===!0?!1:"selected"===p?t.isSelected(F)?!1:!0:"hover"===p?F===Y.mouseOverData?!1:!0:!0};else{if(!$||!$.length)return;N=function(C){return $.indexOf(C)<0?!0:void 0}}var w=t.isVRPresenting(),l=t.getWidth();if(w){var q=t.getWidth;l/=2,t.getWidth=function(){return l};var D=t.getViewport()}var C,G=t.getDevicePixelRatio(),L=Math.floor(l*G),g=Math.floor(t.getHeight()*G);(C=Y._renderTarget)?C.setSize(d,L,g):Y._renderTarget=C=new Lq.RenderTarget(t,d,L,g);var y="soft"===Y.type;if(C.bind(d),y){var z=d.getParameter(d.COLOR_CLEAR_VALUE);Wp(d,[1,1,1,1]),d.clear(d.COLOR_BUFFER_BIT),Wp(d,z)}else d.clear(d.COLOR_BUFFER_BIT);t.setViewport(d,0,0,L,g),t.drawFilter=function(U){var A=N(U);if(A){var z=t.getData3dUI(U);z&&U.s("batch")&&z._46Q(d,[0,0,0,0])}return A},Rk=function(Z,j,e,A,b,R){var Y;return Y=A&&A.data&&N(A.data)?[0,0,0,0]:[e?0:1,1,1,1],R||(dk.for(Z).directUniforms().uFixPickReverseColor=Y),Y};var K=d._blooming;K&&(d._blooming=!1),t.renderPickScene(),K&&(d._blooming=!0),Rk=vi,t.drawFilter=null,C.unbind(d),ts&&km(d,Z.aPosition),km(d,Z.aNormal),w&&(t.getWidth=q,t.setViewport(d,D[0],D[1],D[2],D[3]));var I=t.getHighlightColor();if(Y._lastHighlightColor!==I){var i=_f(Y._lastHighlightColor=I);Y._highlightColorData=[i[0]/255,i[1]/255,i[2]/255,i[3]/255]}return y?Y.renderSoftOutline(d,L,g):Y.renderHardOutline(d,L,g),d.useProgram(Z=t._prg),ts&&ne(d,Z.aPosition),!0}},_assureShader:function(h,G){var C=h._compiledShader[G];return C||(C=h._compiledShader[G]=new ch.Shader(h,Ds.CommonShaderVs,Ds[G].fs)),C},renderHardOutline:function(S,i,T){var B=this,k=B.gv,l=k._postProcessing,O=dk.for(S),x=O.directState();x.blend.enabled=!0,x.depth.enabled=!1,l.blitScreen(null,B._renderTarget.texture,B._assureShader(S,"HighlightHard"),{textureSize:[i,T],edgeWidth:k.getHighlightWidth(),edgeColor:B._highlightColorData},{clear:!1}),x.blend.enabled=!1,x.depth.enabled=!0},renderSoftOutline:function(v,B,F){var Q,E,N,L,k,f=this,M=f.gv,o=M._postProcessing,j=Math.floor(B/2),U=Math.floor(F/2),t=Math.floor(B/4),Y=Math.floor(F/4),G=f._downSampleRenderTarget;G?(Q=f._edgeDetectionRenderTarget,E=f._blurV2,N=f._blurH2,L=f._blurV4,k=f._blurH4,(G.width!==j||G.height!==U)&&(G.setSize(j,U),Q.setSize(j,U),E.setSize(j,U),N.setSize(j,U),L.setSize(t,Y),k.setSize(t,Y))):(G=f._downSampleRenderTarget=new Lq.RenderTarget(M,v,j,U),Q=f._edgeDetectionRenderTarget=new Lq.RenderTarget(M,v,j,U),E=f._blurV2=new Lq.RenderTarget(M,v,j,U),N=f._blurH2=new Lq.RenderTarget(M,v,j,U),L=f._blurV4=new Lq.RenderTarget(M,v,t,Y),k=f._blurH4=new Lq.RenderTarget(M,v,t,Y));var O=v.getParameter(v.COLOR_CLEAR_VALUE),T=M.getViewport(),z=f.width,S=f.strength,m=f.glow,x=dk.for(v).glState,b=x.depth,q=x.blend,g=b.enabled;Wp(v,[1,1,1,1]),b.enabled=!1,q.apply({func:[v.SRC_ALPHA,v.ONE]}),o.blitScreen(G,f._renderTarget.texture),o.blitScreen(Q,G.texture,f._assureShader(v,"EdgeDetection"),{texSize:[j,U],color:f._highlightColorData}),o.blitScreen(N,Q.texture,f._assureShader(v,"Blur"),{direction:[1,0],texSize:[j,U],radius:z}),o.blitScreen(E,N.texture,f._assureShader(v,"Blur"),{direction:[0,1],texSize:[j,U],radius:z}),o.blitScreen(k,E.texture,f._assureShader(v,"Blur"),{direction:[1,0],texSize:[t,Y],radius:z}),o.blitScreen(L,k.texture,f._assureShader(v,"Blur"),{direction:[0,1],texSize:[t,Y],radius:z}),q.apply({enabled:!0}),M.setViewport(v,T[0],T[1],T[2],T[3]),o.blitScreen(null,f._renderTarget.texture,f._assureShader(v,"BlendTogether"),{edgeTexture1:E.texture,edgeTexture2:L.texture,edgeStrength:S*z,edgeGlow:m},{clear:!1}),q.apply({func:[v.SRC_ALPHA,v.ONE_MINUS_SRC_ALPHA,v.ONE,v.ONE_MINUS_SRC_ALPHA]}),b.enabled=g,Wp(v,O)},resetProperties:function(){this.mode=Ds.Mode.Style,this.type=O["highlight.type"],this.color=O["highlight.color"],this.width=O["highlight.width"],this.glow=O["highlight.glow"],this.strength=O["highlight.strength"]},contextLost:function(){this._renderTarget=null}}),C.defineProperties(Ds.prototype,{mode:{get:function(){return this._mode},set:function(o){var w=this._mode;if(o!==w){this._mode=o;var E=w===Ds.Mode.MouseOver||w===Ds.Mode.Style,B=o===Ds.Mode.MouseOver||o===Ds.Mode.Style;
B&&E||(E&&V(this.gv.getView(),"mousemove",this.onMouseOver),B&&q(this.gv.getView(),"mousemove",this.onMouseOver))}}}}),Ds.CommonShaderVs=["attribute vec2 pos;","varying vec2 vUv;","void main(void) {","gl_Position = vec4(pos.x * 2.0 - 1.0, -pos.y * 2.0 + 1.0, 0.0, 1.0);","vUv = vec2(pos.x, 1.0 - pos.y);","}"].join("\n"),Ds.HighlightHard={fs:["precision highp float;","uniform sampler2D image;","uniform vec2 textureSize;","uniform float edgeWidth;","uniform vec4 edgeColor;","varying vec2 vUv;","float getCol(vec2 coord) {","return texture2D(image, coord).a;","}","void main() {","vec2 cc = vUv;","float center = getCol(cc);","float dx = edgeWidth / textureSize.x;","float dy = edgeWidth / textureSize.y;","vec2 coord;","float topLeft = getCol(cc+vec2(-dx, -dy));","float top = getCol(cc+vec2(0.0, -dy));","float topRight = getCol(cc+vec2(dx, -dy));","float left = getCol(cc+vec2(-dx, 0.0));","float right = getCol(cc+vec2(dx, 0.0));","float bottomLeft = getCol(cc+vec2(-dx, dy));","float bottom = getCol(cc+vec2(0.0, dy));","float bottomRight = getCol(cc+vec2(dx, dy));","float v = -topLeft-2.0*top-topRight+bottomLeft+2.0*bottom+bottomRight;","float h = -bottomLeft-2.0*left-topLeft+bottomRight+2.0*right+topRight;","float edge = sqrt(h * h + v * v);","edge = smoothstep(0.9, 1.0, edge);","if (edge < 0.5) {","discard;","}","gl_FragColor = edgeColor;","}"].join("\n")},Ds.EdgeDetection={fs:["precision highp float;","uniform sampler2D image;","varying vec2 vUv;","uniform vec2 texSize;","uniform vec4 color;","void main() {","vec2 invSize = 1.0 / texSize;","vec4 uvOffset = vec4(1.0, 0.0, 0.0, 1.0) * vec4(invSize, invSize);","vec4 c1 = texture2D( image, vUv + uvOffset.xy);","vec4 c2 = texture2D( image, vUv - uvOffset.xy);","vec4 c3 = texture2D( image, vUv + uvOffset.yw);","vec4 c4 = texture2D( image, vUv - uvOffset.yw);","float diff1 = (c1.r - c2.r)*0.5;","float diff2 = (c3.r - c4.r)*0.5;","float d = length( vec2(diff1, diff2) );","gl_FragColor = color * vec4(d);","}"].join("\n")},Ds.Blur={fs:["#define MAX_RADIUS 4","precision highp float;","varying vec2 vUv;","uniform sampler2D image;","uniform vec2 texSize;","uniform vec2 direction;","uniform float radius;","float gaussianPdf(in float x, in float sigma) {","return 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;","}","void main() {","vec2 invSize = 1.0 / texSize;","float weightSum = gaussianPdf(0.0, radius);","vec4 diffuseSum = texture2D( image, vUv) * weightSum;","vec2 delta = direction * invSize * radius/float(MAX_RADIUS);","vec2 uvOffset = delta;","for( int i = 1; i <= MAX_RADIUS; i ++ ) {","float w = gaussianPdf(uvOffset.x, radius);","vec4 sample1 = texture2D( image, vUv + uvOffset);","vec4 sample2 = texture2D( image, vUv - uvOffset);","diffuseSum += ((sample1 + sample2) * w);","weightSum += (2.0 * w);","uvOffset += delta;","}","gl_FragColor = diffuseSum/weightSum;","}"].join("\n")},Ds.BlendTogether={fs:["precision highp float;","varying vec2 vUv;","uniform sampler2D image;","uniform sampler2D edgeTexture1;","uniform sampler2D edgeTexture2;","uniform float edgeStrength;","uniform float edgeGlow;","void main() {","vec4 edgeValue1 = texture2D(edgeTexture1, vUv);","vec4 edgeValue2 = texture2D(edgeTexture2, vUv);","vec4 edgeValue = edgeValue1 + edgeValue2 * edgeGlow;","float vv = texture2D(image, vUv).r;","vec4 finalColor = edgeStrength * vv * edgeValue;","gl_FragColor = finalColor;","}"].join("\n")};var Es=y.Light=function(){Iq(Es,this),this.s(kk,O[kk]),this.s(Pb,"sphere"),this.s("shape3d.reverse.cull",!0),this.s3(20,20,20)};Db("Light",Oh,{_image:"light_icon",_icon:"light_icon",onStyleChanged:function(t,x,Y){Es.superClass.onStyleChanged.apply(this,arguments),t===kk&&this.s("shape3d.color",Y)}});var Fs=Lq.FrameState=function(N,l){this.renderState=dk.for(l),this.picking=!1,this.envmapReflectivity=.5,this.cameraPosition=I,this.projectMatrix=I,this.viewMatrix=I,this.view=N,this.defaultProgram=I,this.pickColorMap=I,this._pvStack=[],this._renderStateStack=[]};Fs.prototype.savePV=function(){var F=this.view;this._pvStack.push([Sc(this.projectMatrix),Sc(this.viewMatrix),F._18Q,Sc(F._7O)])},Fs.prototype.restorePV=function(){var s=this._pvStack.pop();if(s){var H=this.view;this.projectMatrix=H._projectMatrix=s[0],this.viewMatrix=H._viewMatrix=s[1],H._18Q=s[2],H._7O=s[3]}},Fs.prototype.setPV=function(n,R){var X=this.view,W=!1;if(n&&(this.projectMatrix=X._projectMatrix=n,W=!0),R&&(this.viewMatrix=X._viewMatrix=R,X._7O=Sc(R),W=!0),W){var G=X.getWidth(),M=X.getHeight(),f=Sc(this.projectMatrix);X._18Q=Im(f,f,R),X._18Q._wh=G/M}},Fs.prototype.syncEnv=function(Y){var S=this,L=S.view;S.envmapReflectivity=L._envmapReflectivity||.5,S.cameraPosition=L.getEye(),S.projectMatrix=L._projectMatrix,S.viewMatrix=L._viewMatrix,S.pickColorMap=Y,S.picking=L.getGL()._picking},Fs.prototype.setGLState=function(){var Z=[0,0,0,0],l=[!0,!0,!0,!0],D=[-1,1],B=[sm.FUNC_ADD,sm.FUNC_ADD],K=[sm.SRC_ALPHA,sm.ONE_MINUS_SRC_ALPHA,sm.ONE,sm.ONE_MINUS_SRC_ALPHA];return function(g,$){var z=this,F=z.renderState.gl,y=z.renderState.glState;y.dither=!1,$?y.color.mask=l:y.color.reset(),y.pixelStore.reset(),y.blend.color=Z,y.blend.equation=B,y.blend.func=K,y.cullFace.enabled=!1,y.scissor.enabled=!1,y.depth.enabled=!0,y.depth.clear=1,y.depth.func=F.LEQUAL,y.depth.range=D,y.stencil.enabled=!1,y.polygonOffset.enabled=!1,g?(y.depth.mask=!1,y.blend.enabled=!0):(y.depth.mask=!0,y.blend.enabled=!1)}}(),Fs.prototype.setUniforms=function(B){var d=this,q=d.view,h=d.renderState,a=h.gl,s=h.uniforms;s.uBrightness=1,s.uOpacity=1,s.uPartOpacity=1,s.uPick=d.picking,s.uUseInstance=!1,s.uTexture=!1,s.uBlendTexture=!1,s.uAlphaTest=O.alphaTest,s.uTransparent=!!B,s.uFix=!1,s.uBatchColor=!1,s.uBatchBlend=!1,s.uBatchBrightness=!1,s.uReflectivity=d.envmapReflectivity||.5,s.uCameraPosition=d.cameraPosition,s.uPMatrix=d.projectMatrix,s.uViewMatrix=d.viewMatrix,s.uEnvMap=null,yc(q,s,ar),s.uClipperMatrix=q._boxClipperMatrixes,s.uClipperClipInner=q._boxClipperClipInner,s.uEnvmapQuat=q._envmapExtraQuaternion,q._envmapRenderer.resetUniformCache(),d.picking||(Jm(q,a,I),q._fogDisabled||(s.uFogColor=q._fogColor,s.uFogDensity=q._fogDensity,s.uFogNear=q._fogNear,s.uFogFar=q._fogFar))},Fs.prototype.drawLayer=function(M){return this.view.renderLayers(M,!0)},Fs.prototype.drawData=function(Z,k,X){var f=this.view;if(f.isVisible(Z)){var V=this.renderState,$=V.uniforms,r=f.getData3dUI(Z);if(r){var b=V.gl,I=b._picking,N=f._picking,O=r._pickId;X&&(r._pickId=X),$.uPick=b._picking=f._picking=!!X,$.uTransparent=!!k,r._42(V.gl,V.program,k?a:e),$.uPick=b._picking=I,f._picking=N,r._pickId=O}}};var Gs=Lq.Graph3dView=function(u,d){var b=this;b.resetHeadlightProperties(),b.resetFogProperties(),b._webGLVersion=1,b._attributes=d||F.graph3dViewAttributes,b._25I={},b._view=vc(1,b);var X;b._attributes&&(X=b._attributes.canvas)||(X=Qb(b._view)),b._canvas=X,q(X,"webglcontextlost",function(k){k.preventDefault(),gk(b),b._26I&&(b._doBufferGC(b._26I,!0),Nc(b._canvas,0,0),["_highlightHelper","shadowMap","flowMap","_envmapRenderer","_postProcessing"].forEach(function(B){b[B].contextLost()}),b.dm().each(function(c){var V=b.getData3dUI(c);V.contextLost()})),b._26I=N,b._1o.onContextLost(),b._35O=!0}),q(X,"webglcontextrestored",function(){b._35O=!1,b.iv()}),b._40Q=new Ns(b),b._43Q={},b._44Q=-1,b._batchIndexMap={},b._batchModelMap={},b._wireframeIndexMap={},b._wireframeModelMap={},b._wireframeIndexMapSwap={},b._wireframeModelMapSwap={},b._polylineIndexMap={},b._polylineIndexMap={},b._polylineIndexMapSwap={},b._polylineIndexMapSwap={},b._8O=[],b._7O=Gj(),b._6O=Gj(),b._1o=new Xs(b),b._30O=new $s(b),b._31O=new Ys(b),b._32O=new Zs(b),b._raycaster=new jt(b),b._highlightHelper=new Ds(b),b._postProcessing=new tt(b),b._41Q=[],b._42Q=0,b._frameRenderOptionStack=[],Lq.VR?(b.vr=new Lq.VR(b),b.isVREnabled=function(){return this.vr.enable},b.isVRPresenting=function(){return this.vr.isPresenting()}):(b.vr={enable:!1,isPresenting:i},b.isVREnabled=i,b.isVRPresenting=i),b.shadowMap=new Um(b),b.flowMap=new ob(b),b._33Q=!0,b._eye=iq(F.graph3dViewEye),b._center=iq(F.graph3dViewCenter),b._up=iq(F.graph3dViewUp),b._lightChanged=!1,b._59O=[],b._spots=[],b._dirs=[],b._boxClippers=[],b._flowObjects=[],b._frameId=0,b._picking=!1,b._batchInfoMap={},b._renderLayerInfoMap={},b._sortedRenderLayers=C.keys(ql),b.overlappingBox=new sj(b),b.dm(u?u:new _h),b._coreInteractor=new Cl(this),b._envmapRenderer=new Lq.EnvmapRenderer(this),b.setInteractors([new Qs(b)]),b._initView(),b._genBatchInstancedArrayFunc()},Hs={fogDisabled:1,fogMode:1,dashDisabled:1,batchColorDisabled:1,batchInstancedDisabled:1,batchBlendDisabled:1,batchBrightnessDisabled:1,flowBlendMode:1,uvClipEnabled:1,ortho:1},Is={box:1,sphere:2},Js={addRGB:"FLOW_BLEND_MODE_ADD_RGB",addRGBA:"FLOW_BLEND_MODE_ADD_RGBA",overrideRGBA:"FLOW_BLEND_MODE_OVERRIDE_RGBA",overrideRGB:"FLOW_BLEND_MODE_OVERRIDE_RGB",overrideA:"FLOW_BLEND_MODE_OVERRIDE_A",multiplyRGB:"FLOW_BLEND_MODE_MULTIPLY_RGB",multiplyRGBA:"FLOW_BLEND_MODE_MULTIPLY_RGBA"},Ks=0;hd("Graph3dView",C,{ms_v:1,ms_tip:1,ms_gv:1,ms_dm:1,ms_lp:1,ms_fire:1,ms_sm:1,_51o:1,ms_shadow:1,ms_highlight:1,ms_quickVisible:1,ms_ac:["devicePixelRatio","boundaries","moveStep","rotateStep","editHelperDisabled","blockSelectable","sizeEditableFunc","rotationEditableFunc","editableFunc","rotatable","zoomable","pannable","walkable","resettable","mouseRoamable","zoomToCenter",Eh,oj,"firstPersonMode",Ef,"movableFunc","gridVisible","gridSize","gridGap","gridColor","originAxisVisible","centerAxisVisible","axisXColor","axisYColor","axisZColor","editSizeColor","rectSelectable","rectSelectBackground","headlightRange","headlightDirection","headlightColor","headlightIntensity","headlightAmbientIntensity","headlightDisabled","headlightGroup","ortho","orthoWidth","syncEyeWithOrthoWidth","fovy","near","far",_d,lo,"up","aspect","fogDisabled","fogMode","fogDensity","fogColor","fogNear","fogFar","pickerResolution","dashDisabled","uvClipEnabled","batchColorDisabled","batchInstancedDisabled","batchBlendDisabled","batchBrightnessDisabled","flowBlendMode","hoverDelay","batchInfoMap","renderLayerInfoMap","rotateMinPhi","rotateMaxPhi","sortable","sortFunc"],_editable:!1,_sortable:F.graph3dViewSortable,_editHelperDisabled:F.graph3dViewEditHelperDisabled,_blockSelectable:F.graph3dViewBlockSelectable,_devicePixelRatio:I,_boundaries:I,_moveStep:F.graph3dViewMoveStep,_rotateStep:F.graph3dViewRotateStep,_rotateMinPhi:F.graph3dViewMinPhi===I?F.graph3dViewRotateMinPhi:F.graph3dViewMinPhi,_rotateMaxPhi:F.graph3dViewMaxPhi===I?F.graph3dViewRotateMaxPhi:F.graph3dViewMaxPhi,_pannable:F.graph3dViewPannable,_rotatable:F.graph3dViewRotatable,_walkable:F.graph3dViewWalkable,_resettable:F.graph3dViewResettable,_zoomable:F.graph3dViewZoomable,_zoomToCenter:!0,_firstPersonMode:F.graph3dViewFirstPersonMode,_mouseRoamable:F.graph3dViewMouseRoamable,_gridVisible:F.graph3dViewGridVisible,_gridSize:F.graph3dViewGridSize,_gridGap:F.graph3dViewGridGap,_gridColor:F.graph3dViewGridColor,_originAxisVisible:F.graph3dViewOriginAxisVisible,_centerAxisVisible:F.graph3dViewCenterAxisVisible,_axisXColor:F.graph3dViewAxisXColor,_axisYColor:F.graph3dViewAxisYColor,_axisZColor:F.graph3dViewAxisZColor,_ortho:F.graph3dViewOrtho,_orthoWidth:F.graph3dViewOrthoWidth,_syncEyeWithOrthoWidth:F.graph3dViewSyncEyeWithOrthoWidth,_fovy:F.graph3dViewFovy,_near:F.graph3dViewNear,_far:F.graph3dViewFar,_rectSelectable:F.graph3dViewRectSelectable,_rectSelectBackground:F.graph3dViewRectSelectBackground,_editSizeColor:F.graph3dViewEditSizeColor,_autoMakeVisible:Jb,_pickerResolution:F.graph3dViewPickerResolution,_dashDisabled:F.graph3dViewDashDisabled,_uvClipEnabled:F.graph3dViewUvClipEnabled,_batchColorDisabled:F.graph3dViewBatchColorDisabled,_batchInstancedDisabled:F.graph3dViewBatchInstancedDisabled,_batchBlendDisabled:F.graph3dViewBatchBlendDisabled,_batchBrightnessDisabled:F.graph3dViewBatchBrightnessDisabled,_flowBlendMode:F.graph3dViewFlowBlendMode,addCamera:function(v){var i=this,w=C.freeze({id:i._42Q++,priority:v.priority||0,ignoreInPick:!!v.ignoreInPick,render:v.render});v.switch3DStatus&&(i._43Q[w.id]=!0),i._41Q.push(w),i._41Q.sort(function($,s){return $.priority!==s.priority?$.priority-s.priority:$.id-s.id})},setEye:function(J,m,a){1===arguments.length&&(m=J[1],a=J[2],J=J[0]);var w=this._eye;w[0]=J,w[1]=m,w[2]=a,this.fp(_d,N,w)},setCenter:function(v,k,e){1===arguments.length&&(k=v[1],e=v[2],v=v[0]);var J=this._center;J[0]=v,J[1]=k,J[2]=e,this.fp(lo,N,J)},setUp:function(B,C,F){1===arguments.length&&(C=B[1],F=B[2],B=B[0]);var r=this._up;r[0]=B,r[1]=C,r[2]=F,this.fp("up",N,r)},getDevicePixelRatio:function(){return this._picking?this._1o._resolution:this._devicePixelRatio||Ep},isTransparentMask:function(B){return B.s("transparent.mask")},getCoreInteractor:function(){return this._coreInteractor},getHighlightHelper:function(){return this._highlightHelper},getRaycaster:function(){return this._raycaster},getAspect:function(){var T=this,q=T._aspect;return q?q:(q=T.getWidth()/T.getHeight(),q||1.2)},getCanvas:function(){return this._canvas},setDataModel:function($){var A=this,F=A._dataModel,g=A._selectionModel;F!==$&&(F&&(F.ump(A.handleDataModelPropertyChange,A),F.umm(A.handleDataModelChange,A),F.umd(A.handleDataPropertyChange,A),g||F.sm().ums(A.handleSelectionChange,A)),A._dataModel=$,$.mp(A.handleDataModelPropertyChange,A),$.mm(A.handleDataModelChange,A),$.md(A.handleDataPropertyChange,A),g?g._21I($):$.sm().ms(A.handleSelectionChange,A),A._postProcessing.handleDataModleChange(F,$),A._tryInvalidateEnvmap(),A.invalidateAll(!0),A.invalidateLight(),A.invalidateboxClipper(),A.invalidateFlowObjects(),A._49Q(),A.fp(xh,F,$),A._canvas.style.background=$.getBackground()||"")},handleDataModelPropertyChange:function(m){var d=m.property;if("background"===d){var Y=this._canvas.style.background,G=m.newValue||"";this._canvas.style.background=G,this.fp("canvasBackground",Y,G)}else if("envmapType"===d)this._tryInvalidateEnvmap();else if("envmap"===d){var Y=this._shaderUseEnvmapFlag,G=!(!m.newValue||!m.newValue.length);Y!==G&&gk(this),this.iv()}},handleDataPropertyChange:function(e){var s=e.data;this.invalidateData(s);var Q=e.property;Lo(s)&&"s:light.type"===Q?this.invalidateLight():"s:3d.clipbox"===Q?this.invalidateboxClipper(s,!0):"s:effect.flow"===Q?this.invalidateFlowObjects(s,!0):"s:shadow.cast"===Q?this.shadowMap.tryUpdateBounding(s):"s:3d.visible"===Q&&this.invalidateQuickVisible(s)},invalidateboxClipper:function(v,f){var u=this._boxClippers,K=u.length;if(v){var b=!!v.s("3d.clipbox");if(f=!!f,b===f)u.indexOf(v)<0&&u.push(v);else{var c=u.indexOf(v);c>=0&&u.splice(c,1)}}else u=this._boxClippers=[],this.dm().each(function(d){d.s("3d.clipbox")&&u.push(d)});var H=u.length;K!==H&&(gk(this),this.shadowMap.deleteShadowProgram(),this._updateBoxClipperMatrix(),yc=H?Pe:rp),this.iv()},_updateBoxClipperMatrix:function(){for(var Y,L,r=this._boxClippers,d=this._boxClipperMatrixes=[],o=this._boxClipperClipInner=[],E=this._boxClipperGroups=[],Z=this._boxClipperShape=[],f=new Ic,t=0,Q=r.length;Q>t;t++)Y=r[t],Y.appendAnchorMatrix3d(L=rg(Y,this.getMat(Y))),d.push(f.getInverse(f.fromArray(L)).toArray()),o.push("inner"===Y.s("3d.clipbox")),E.push(Y.s("3d.clipbox.group")),Z.push(Is[Y.s("3d.clipbox.shape")]||1)},_49Q:function(){this._4AQ||this._48Q||this.dm().size()<F.graph3dViewDataNumWarningLine||(this._48Q=!0,console.log("Too many datas so than disable some feature to speed up.\nYou can set global Default.graph3dViewDataNumWarningLine to largeEnoughNum to avoid this, or call graph3dView.quitDataNumWarning() to quit.\n"),this.enableQuickVisibleMode(),this.getHighlightHelper().mouseOverData=null)},quitDataNumWarning:function(){this.disableQuickVisibleMode(),this._48Q=!1,this._4AQ=!0},invalidateFlowObjects:function(J,c){var i=this._flowObjects,f=i.length;if(J){var N=!!J.s("effect.flow");if(c=!!c,N===c)i.indexOf(J)<0&&i.push(J);else{var _=i.indexOf(J);_>=0&&i.splice(_,1)}}else i=this._flowObjects=[],this.dm().each(function(B){B.s("effect.flow")&&i.push(B)});f!==i.length&&gk(this),this.iv()},invalidateLight:function(){this._lightChanged||(this._lightChanged=!0,this.iv())},onPropertyChanged:function(h){var e=this,z=h.property;if(e.iv(),e._18Q=N,"eye"===z)e._33Q=!0;else if("devicePixelRatio"===z)e._42(e.getDevicePixelRatio());else if(Hs[z]&&(gk(e),"batchInstancedDisabled"===z)){e._genBatchInstancedArrayFunc(),this.shadowMap.deleteShadowProgram();var C,M=F.getBatchInfoMap();for(C in M)M[C]&&M[C].instanced&&e.invalidateBatch(C);M=e._batchInfoMap;for(C in M)M[C]&&M[C].instanced&&e.invalidateBatch(C)}},_5O:function(T){var u=T._22Q();return u?new u(this,T):N},getData3dUI:function(K){var k=this._25I[K._id];return k===I&&(k=this._5O(K),this._25I[K._id]=k),k},invalidateAll:function(H,j){var O=this;if(H){for(var I in O._25I){var X=O._25I[I];X&&X.dispose()}O._25I={},O.iv(),yr(O)}else yr(O),O.dm().each(function(V){O.invalidateData(V)});O.shadowMap.tryInvalidateLater(H,j)},invalidateSelection:function(){var O=this;O.sm().each(function(G){O.invalidateData(G)})},invalidateData:function(X){var P=this,j=P.getData3dUI(X);j&&(j.iv(),P.iv()),yr(P,X)},getShape3dText:function(u){return u.getStyle("shape3d.text")||this.getLabel(u)},invalidateBatch:function(P){var X=this,M=X._40Q;M.each(function(I){X._invalidateBatch(P,I.batchModelMap,I.batchIndexMap),X._invalidateBatch("T"+P,I.wireframeModelMap,I.wireframeIndexMap),X._invalidateBatch("O"+P,I.wireframeModelMap,I.wireframeIndexMap),I.markBatchInvalid()}),X.iv()},_invalidateBatch:function(l,p,u){var w=this,V=p[l];V&&(V.ds.forEach(function(h){var K=w.getData3dUI(h);K&&K.iv(),delete u[h._id]}),delete p[l])},handleDataModelChange:function(x){var V=this,t=x.kind,G=x.data;if("add"===t)V.invalidateData(G),lm(G)&&G.getEdgeGroup()&&G.getEdgeGroup().eachSiblingEdge(V.invalidateData,V),Lo(G)&&V.invalidateLight(),G.s("3d.clipbox")&&V.invalidateboxClipper(G,!0),G.s("effect.flow")&&V.invalidateFlowObjects(G,!0),V._49Q();else if(t===Uj){var e=G._id,f=V._25I[e];f&&(f.dispose(),delete V._25I[e],V.iv()),G===V._currentSubGraph&&V.setCurrentSubGraph(N),yr(V,G),Lo(G)&&V.invalidateLight(),G.s("3d.clipbox")&&V.invalidateboxClipper(G,!1),G.s("effect.flow")&&V.invalidateFlowObjects(G,!1)}else t===Mm&&(V.invalidateAll(!0),V.setCurrentSubGraph(N),yr(V),V.invalidateLight(),V.invalidateboxClipper(),V.invalidateFlowObjects())},toCanvas:function(u,v,J){var r=this,M=r.getGL();if(r.validate(),u){var s=M.getParameter(M.COLOR_CLEAR_VALUE);Wp(M,u)}r._42(1,{renderAxis:!1,renderEdit:!1,renderGrid:!1});var T=r.getWidth()||1,O=r.getHeight()||1,V=new Uint8Array(4*T*O),U=Qb(),m=U.getContext("2d");M.readPixels(0,0,T,O,M.RGBA,M.UNSIGNED_BYTE,V),Nc(U,T,O,1);for(var B=m.getImageData(0,0,T,O),q=B.data,w=0;w<q.length;w+=4){var Y=w/4,o=g(Y/T),h=Y-o*T;Y=4*((O-1-o)*T+h),q[Y]=V[w],q[Y+1]=V[w+1],q[Y+2]=V[w+2],q[Y+3]=V[w+3]}if(m.putImageData(B,0,0),u&&Wp(M,s),r._42(r.getDevicePixelRatio()),v&&J){var E=Qb(),W=E.getContext("2d");return Nc(E,v,J,1),F.drawImage(W,U,0,0,v,J),E}return U},toDataURL:function(W,K){var G=this,L=G.getGL();if(G.validate(),W){var d=L.getParameter(L.COLOR_CLEAR_VALUE);Wp(L,W)}G._42(1,{renderAxis:!1,renderEdit:!1,renderGrid:!1});var u=G._canvas.toDataURL(K||"image/png",1);return W&&Wp(L,d),G._42(G.getDevicePixelRatio()),u},isWebGL2:function(){return 2===this._webGLVersion},getGL:function(){var a=this._26I;if(a)return this.acquireProgram(),a;if(!this._35O){var X=this,F=X._canvas,U=X._attributes;if(!U||U.requestWebGL2!==!1)try{a=F.getContext("webgl2",U)||F.getContext("experimental-webgl2",U),a&&(X._webGLVersion=2,X._26I=a)}catch(n){}if(!a)try{a=F.getContext("webgl",U)||F.getContext("experimental-webgl",U)}catch(n){throw new Error("WebGL not supported")}if(!a)throw new Error("WebGL not supported");X._26I=a;var e=X._frameState=new Fs(this,a);X._glExtensions=new d(a),X._glCapabilities=new m(a,X._glExtensions),X._2O={},a._emptyCubeTexture=Ur(a),a._compiledShader={},a._emptyTexture=mb(a),a._emptyBlendTexture=mb(a),a._bufPool={},a._id=++Ks,a._divisorState=[],e.setGLState(),X._buffer={vs:Ck(a),ns:Ck(a),is:Ck(a),uv:Ck(a),batchColor:Ck(a),batchBlend:Ck(a),batchBrightness:Ck(a),lineDistance:Ck(a)},X._1O=_g(a);var h=X._cube={vs:Ck(a),ns:Ck(a),is:Ck(a),uv:Ck(a)};return Kn(a,h.vs,Er),Kn(a,h.ns,Bb),Kn(a,h.uv,qs),$g(a,h.is,Kl),X.acquireProgram(),X._genBatchInstancedArrayFunc(),a._renderInfo={calls:0,vertices:0,faces:0,lines:0,points:0,textureCache:{time:0,count:0,pixels:0},frame:0,cacheTimeCost:0,reflectDepth:0},a}},getGLCapabilities:function(){var q=this.getGL();return q?this._glCapabilities:void 0},getGLExtensions:function(){var L=this.getGL();return L?this._glExtensions:void 0},getEnvmap:function(){return this._glCapabilities&&this._glCapabilities.maxVertexTextures<F.graph3dEnvmapCapabilityRequire?null:this.dm().getEnvmap()},getEnvmapType:function(){var p,v=this.dm();return v&&(p=v.getEnvmapType()),p||"legacy"},setEnvmapExtraQuaternion:function(h){var z=this._envmapExtraQuaternion;this._envmapExtraQuaternion=h instanceof fl.Quaternion?h.clone().inverse().toArray():null,null==z!=(null==h)&&gk(this)},invalidateEnvmap:function($){return this._envmapRenderer.invalidateEnvmap($)},_setEnvmapByProbeId:function(h,p){return this._envmapRenderer.setEnvmapByProbeId(h,p)},_tryInvalidateEnvmap:function(){var e=this.getEnvmapType();e!==this._lastProgramEnvmapType&&(gk(this),this.iv())},acquireProgram:function(){var V=this,y=V._26I;if(y&&!V._prg){var Y=V._prg=y.createProgram();if(!Y)return N;var Q=V._dirs.length,f=V._spots.length,S=V._59O.length,n=V._boxClippers.length,R=V._flowObjects.length,u=["uPMatrix","uMVMatrix","uMMatrix","uReflectivity","uViewMatrix","uUseEnvMap","uEnvMap","uCameraPosition","uNMatrix","uViewMatrix","aNormal","aUv","uUvMatrix","uDiffuse","uBlend","uBlendColor","uBrightness","uPartOpacity","uAlphaTest","uTransparent","uClipDirection","uClipPercent","uTexture","uBlendTexture","uSampler","uBlendSampler","uDiscardSelectable","uFix","uPick","uReverseFlip","uFixPickReverseColor","uBatchBrightness","aBatchBrightness","uBatchColor","aBatchColor","uBatchBlend","aBatchBlend","uDash","aLineDistance","uDashDistance","uDashGapDistance","uLight","uHeadlightRange","uHeadlightAmbientIntensity","uHeadlightColor","uFogColor","uFogDensity","uFogNear","uFogFar"];Q&&u.push("uDirColor","uDirDirection"),f&&u.push("uSpotColor","uSpotRange","uSpotAngle","uSpotExponent","uSpotPosition","uSpotDirection"),S&&u.push("uPointColor","uPointRange","uPointPosition"),Mo||(Hk=kg(Hk.substring(0,Hk.indexOf("^#"))),np=kg(np),Mo=!0);var P=V.getEnvmap(),$=P&&P.length,B=V.getEnvmapType(),i=["#define MAX_DIR "+Q,"#define MAX_SPOT "+f,"#define MAX_POINT "+S,"#define MAX_BOX_CLIPPER "+n,"#define MAX_FLOW_OBJECT "+R,V._fogDisabled?"":"#define FOG","exp2"===V.getFogMode()?"#define FOG_EXP2":"",V._dashDisabled?"":"#define DASH",V._uvClipEnabled?"#define UV_CLIP":"",null==V._envmapExtraQuaternion?"":"#define ENVMAP_ROTATE",$?"#define USE_ENVMAP":"","legacy"!==B?"#define ENVMAP_TYPE_CUBE_UV":"",V.isOrtho()?"#define ORTHOGRAPHIC":"",V._batchColorDisabled?"":"#define BATCHCOLOR",V._batchInstancedDisabled?"":"#define BATCHINSTANCE",V._batchBlendDisabled?"":"#define BATCHBLEND",V._batchBrightnessDisabled?"":"#define BATCHBRIGHTNESS","#define "+(Js[V.getFlowBlendMode()]||Js[F.graph3dViewFlowBlendMode]),V.shadowMap.enable?V.shadowMap.genShaderDefine():"",""].join("\n"),r=bn(y,Y,y.VERTEX_SHADER,Hk.replace("#PREFIX",i));y.getShaderParameter(r,y.COMPILE_STATUS)||rl("COMPILE",y.VERTEX_SHADER,y.getError(),y.getShaderInfoLog(r));var t=bn(y,Y,y.FRAGMENT_SHADER,np.replace("#PREFIX",i));if(y.getShaderParameter(t,y.COMPILE_STATUS)||rl("COMPILE",y.FRAGMENT_SHADER,y.getError(),y.getShaderInfoLog(t)),ts?u.push("aPosition"):(Y.aPosition=0,y.bindAttribLocation(Y,0,"aPosition")),y.linkProgram(Y),!y.getProgramParameter(Y,y.LINK_STATUS)){var s=y.getProgramInfoLog(Y);return V._prg=N,s.indexOf("maximum temp register")>=0&&!V._glTempRegisterLimited?(V._glTempRegisterLimited=!0,y.deleteProgram(Y),V.acquireProgram()):(rl("LINK",y.getProgramParameter(Y,y.VALIDATE_STATUS),y.getError(),s),y.deleteProgram(Y),N)}u.forEach(function(S){Y[S]=/^u/.test(S)?y.getUniformLocation(Y,S):y.getAttribLocation(Y,S)});var x=V._frameState;x.renderState.program=x.defaultProgram=Y,V._envmapRenderer.changeEnvmapType(V._lastProgramEnvmapType=B),V._shaderUseEnvmapFlag=$,y.deleteShader(r),y.deleteShader(t)}},isGLTempRegisterLimited:function(){return this._glTempRegisterLimited},getBrightness:function(k){var E=k.s("brightness"),c=this.isSelected(k)?k.s("select.brightness"):N;return E==N?c:c==N?E:E*c},getDataHighlightMode:function(v){return v.s("highlight.mode")},getWireframe:function(M){var i=M.s("wf.visible"),t=M.s("wf.width");return i===!0||t>0&&"selected"===i&&this.isSelected(M)?{color:M.s("wf.color"),width:t,"short":M.s("wf.short"),mat:M.s("wf.mat")}:void 0},getPartPosition:function(r,i,c,D){D=D||go;var j=this.getData3dUI(r),y=j._16O(D.autoRotate,i,N,c||Ki,D.t3,D.r3,D.rotationMode);return[y[12],y[13],y[14]]},_transformPointToViewSpace:function(K){var $=[K[0],K[1],K[2]];return wq($,this._viewMatrix),$},_transformDirectionToViewSpace:function(n,y){var x=n?[n[0],n[1],n[2]]:[0,0,0];wq(x,this._viewMatrix);var M=y?[y[0],y[1],y[2]]:[0,0,0];wq(M,this._viewMatrix);var b=M[0]-x[0],C=M[1]-x[1],f=M[2]-x[2],Z=Math.sqrt(b*b+C*C+f*f);return Z?[b/Z,C/Z,f/Z]:[b,C,f]},getWireframeGeometry:function(d){return d.s("wf.geometry")?{color:d.s("wf.color"),width:d.s("wf.width"),mat:d.s("wf.mat"),geometry:!0}:void 0},getBodyColor:function(m){return m.s("body.color")},getMat:function(b){return b.getMat?b.getMat():b.s("mat")},getFaceMat:function(u,b){return u.getFaceMat?u.getFaceMat(b):u.s(b+".mat")},getFaceBlend:function(K,r){return K.s(r+".blend")||K.s("all.blend")},getFaceColor:function(m,q){return m.s(q+".color")||m.s("all.color")},getFaceImage:function(Z,M){return Z.s(M+".image")||Z.s("all.image")},getFaceBlendImage:function(J,i){return J.s(i+".blend.image")||J.s("all.blend.image")},getFaceDiscardSelectable:function(Y,z){var s=Y.s(z+".discard.selectable");return s==N?Y.s("all.discard.selectable"):s},getFaceUv:function(e,J){return e.s(J+".uv")||e.s("all.uv")},getFaceUvOffset:function(_,V){return _.s(V+".uv.offset")||_.s("all.uv.offset")},getFaceUvScale:function(Z,F){return Z.s(F+".uv.scale")||Z.s("all.uv.scale")},getFaceUvRotation:function(Q,$){return Q.s($+".uv.rotation")||Q.s("all.uv.rotation")},getFaceUvAnchor:function(L,Z){return L.s(Z+".uv.anchor")||L.s("all.uv.anchor")},getFaceLight:function(z,s){var E=z.s(s+".light");return E==N?z.s("all.light"):E},getFaceVisible:function(w,O){var v=w.s(O+".visible");return v==N?w.s("all.visible"):v},getFaceOpacity:function(C,I){var g=C.s(I+".opacity");return g==N?C.s("all.opacity"):g},getFaceTransparent:function(B,Z){var I=B.s(Z+".transparent");return I==N?B.s("all.transparent"):I},getFaceReverseColor:function(w,e){return w.s(e+".reverse.color")||w.s("all.reverse.color")},getFaceReverseFlip:function(K,Q){var O=K.s(Q+".reverse.flip");return O==N?K.s("all.reverse.flip"):O},getFaceReverseCull:function(I,w){var x=I.s(w+".reverse.cull");return x==N?I.s("all.reverse.cull"):x},getTextureMap:function(){return this._2O},_2Oi:function(A,O,I){I=I||"";var H;(H=this._2O[A])||(H=this._2O[A]={}),H[I]=O},deleteTexture:function(m){var p=this;if(p._2O){var f=p._2O[m];if(f){delete p._2O[m];var $=p.getGL();for(var S in f)$.deleteTexture(f[S])}}},renderPickScene:function(){var z=this.getGL();this.syncRenderState(),this._picking=z._picking=!0,this.renderScene(),this._picking=z._picking=!1},invalidateCachedTexture:function(O){var o=this.getData3dUI(O);o.invalidateCachedTexture(this.getGL()),this.invalidateData(O)},invalidateShape3dCachedImage:function(X){this.invalidateCachedTexture(X)},invalidateCachedGeometry:function(U){var n=this.getData3dUI(U);n.invalidateCachedGeometry(),this.invalidateData(U)},isInteractive:function(v){return v.s("interactive")},getTexture:function(c,W,l,z){if(!c)return N;var X,p,m=this,e=m.getGL(),C=m._2O[c];if(C&&(W&&(p=W.s("texture.mipmap.max")),X=C[p||""]||C.default),!X){var r=Fp(c);if(z||(z={}),!r)return e._emptyTexture;if(W){z.mipmapMaxLevel=p=W.s("texture.mipmap.max");var H=W.s("texture.wrap");z.clampToEdge="clampToEdge"===H?!0:"repeat"===H?!1:I}if(r.uuid||(r.uuid=y.Math.generateUUID()),r.tagName){if(r.dynamic)return _g(e,r,m._1O,z);X=_g(e,r,I,z),m._2Oi(c,X,p)}else{var S,K=W&&(W.s("texture.cache")||W.s("shape3d.image.cache")||r.textureCache),D=m.isVRPresenting();if(D&&(W._textureUpdateFrame===e._renderInfo.frame?K=!0:W._textureUpdateFrame=e._renderInfo.frame),K&&(S=m.getData3dUI(W),X=S.getCachedTexture(l),X&&S.interactiveInfo&&X.interactiveInfo&&(S.interactiveInfo[X.interactiveInfo.key]=X.interactiveInfo.info)),!X){var a=e._renderInfo.textureCache;if(K){if(a.time>F.graph3dMaxVectorCacheTime)return m.redraw(),e._emptyTexture;if(!Gl(r,W))return e._emptyTexture}var Z;W&&(1!==W.s("texture.scale")?Z=W.s("texture.scale"):1!==W.s("shape3d.texture.scale")&&(Z=W.s("shape3d.texture.scale"))),Z||(Z=1);var V=W&&(W.s("fixSizeOnScreen")||W.s("shape3d.fixSizeOnScreen")),M=V?e.NEAREST:e.LINEAR;V?"number"==typeof V&&(Z*=0>V?1:V):W&&(W.s("vector.dynamic")||W.s("shape3d.vector.dynamic"))&&(S||(S=m.getData3dUI(W)),V=S.getVectorDynamicSize());var h,d,t,A=W&&W.s("shape3d");"billboard"===A?t=W.getTall()/W.getWidth():"plane"===A&&(t=W.getHeight()/W.getWidth());var U=fm(r,W);if(V){var P;P=K?m._devicePixelRatio||Ep:m.getDevicePixelRatio(),h=V[0]>0?V[0]*P:Z*U*P,d=V[1]>0?V[1]*P:Z*(t?Oo(r,W,m,Math.min(4096,U*t)):Oo(r,W))*P}else h=Z*U,d=Z*(t?Oo(r,W,m,Math.min(4096,U*t)):Oo(r,W));if(h>=1&&d>=1){var v=0;(K||D)&&(v=Date.now());var x=m._glCapabilities.maxTextureSize;h=Math.min(h,x),d=Math.min(d,x);var B=tl(h,d);if(!S&&W&&(S=m.getData3dUI(W)),S&&S.interactiveInfo){var _=c;"object"==typeof _&&(_=_.uuid||(_.uuid=y.Math.generateUUID()));var w=S.interactiveInfo[_]={};B.interactiveInfo=w.bodyInfo={compInfos:[],matrix:new Xn,rect:{x:0,y:0,width:h,height:d}}}He(B,r,0,0,h,d,W,m),B.interactiveInfo&&(B.interactiveInfo=null),B.restore(),a.count++,a.pixels+=h*d,W?(z.minFilter=Hj(W.s("texture.filter.min")||W.s("texture.filter"))||M,z.magFilter=Hj(W.s("texture.filter.mag")||W.s("texture.filter"))||M):z.minFilter=z.magFilter=M,K||D?(X=_g(e,Qh,null,z),S.setCachedTexture(X,l),a.time+=Date.now()-v,w&&(X.interactiveInfo={key:_,info:w}),Qh=null):X=_g(e,Qh,m._1O,z)}}}}return X},redraw:function(){this.iv()},validateImpl:function(){var O=this;if(O._lightChanged){O._lightChanged=!1;var i=[],u=[],U=[];O.dm().each(function(R){if(Lo(R)){var l=R.s("light.type");l===wm?i.push(R):l===sd?u.push(R):l===ds&&U.push(R)}}),(i.length!==O._59O.length||u.length!==O._spots.length||U.length!==O._dirs.length)&&gk(O),O._59O=i,O._spots=u,O._dirs=U}var R=O.getAspect();R!==O.__cachedAspect__&&(O._updateSkybox({property:"asceptChanged"}),O.__cachedAspect__=R),O._42(),O._1o.iv()},getRenderInfo:function(){var o=this.getGL();return o?o._renderInfo:void 0},getDebugTip:function(){var s=this,x=s.getRenderInfo();if(x){var F=s.getGL()._validBufCount||0,Q="Draw Calls: "+x.calls+"<br/>"+"Vertices: "+x.vertices+"<br/>"+"Faces: "+x.faces+"<br/>"+"Lines: "+x.lines+"<br/>"+(x.points?"Points: "+x.points+"<br/>":"")+"Buffers: "+F+"<br/>"+"Cache Models: "+C.keys(vg).length+"<br/>"+"Shape3d Models: "+C.keys(bf).length;if(s.isVRPresenting()&&(Q+="<br/>VR fps: "+s.vr.getFps()),x.textureCache){var E=x.textureCache.count;if(Q+="<br/>2D Dynamic Textures: "+x.textureCache.count,E>0){var K,P=x.textureCache.pixels;K=P>1e6?Math.round(P/1e6)+"M":P>1e3?Math.round(P/1e3)+"K":Math.round(P),Q+="<br/>2D Dynamic pixels: "+K}}return Q}},getFrameState:function(){return this._frameState},isBoundingBoxInView:function(){var p=new y.Math.Box3,G=new y.Math.Matrix4;return function(X){var Z=X;if(Z instanceof y.Data&&(Z=this.getData3dUI(Z)),!Z.mat)return!0;var D=Z.getBoundingBox(!0);p.copy(D).applyMatrix4(G.fromArray(Z.mat));var A=this.getFrustum();return A.intersectsBox(p)}}(),updateScene:function(){var T=this;T._81O=N,T.overlappingBox.clear();var S=T._40Q;S.init();var d=T.getGL(),z=T.dm();if(z.isHierarchicalRendering())z.eachByHierarchical(function(p){var k=T.getData3dUI(p);k&&k.update(T,d,S)});else{var v,o,O,m=z.getDatas().getArray(),W=m.length;for(v=0;W>v;v++)o=m[v],O=T.getData3dUI(o),O&&O.update(T,d,S)
}this._updateBoxClipperMatrix(),S.onUpdated()},_pushFrameRenderOptions:function(i){this._frameRenderOptionStack.push(this._currentFrameRenderOptions),this._currentFrameRenderOptions=i},_popFrameRenderOptions:function(){this._currentFrameRenderOptions=this._frameRenderOptionStack.pop()},_getFrameRenderOptions:function(h){var i=this._currentFrameRenderOptions;return i&&i[h]},getRenderLists:function(){return this._40Q},renderScene:function(k){function q(e,H){G.setGLState(e,H),G.setUniforms(e),G.renderState.attribs.disable(),W=P.directUniforms(),x=P.directAttribs(),x.disable()}function Z(C){for(var H=!1;X>p;p++){var g=O[p];if(!K||!g.ignoreInPick){if(g.priority>=C)break;(!y._43Q[y._44Q=g.id]||To[Qj.length])&&(g.render(m,y,G),q(),H=!0)}}return H}var y=this;y._pushFrameRenderOptions(k),y._getFrameRenderOptions("createShadowMap")!==!1&&y.shadowMap.render(),y.flowMap.render();var m=y.getGL();y._envmapRenderer.onBeforeRender(m),y._44Q=-1;var W,x,G=y._frameState,P=G.renderState,T=P.glState,i=y._prg;y._projectMatrix=bp(y),we(y,y._7O),y._viewMatrix=Sc(y._7O),y.isReflecting(m)||Im(y._projScreenMatrix=Gj(),y._projectMatrix,y._viewMatrix),G.syncEnv(this._picking?this.pickColorMap:I),P.useProgram(i),q(!1,!0),m.clear(m.DEPTH_BUFFER_BIT);var K=y._picking,O=this._41Q,p=0,X=O.length;if(Z(F.cameraPriority.skybox),K){var z=T.color.clear.slice(0);Wp(m,[0,0,0,0])}else Wp(m,[0,0,0,0]),T.blend.enabled=!1,T.depth.enabled=!1,T.depth.mask=!1,y._camera&&y._camera.s("camera.renderSky")===!1||y.drawSky(m,i),y._getFrameRenderOptions("renderReflector")!==!1&&y.drawReflectors(m)&&(y._projectMatrix=bp(y),we(y,y._7O),y._viewMatrix=Sc(y._7O),G.syncEnv(),q()),T.blend.enabled=!1,T.depth.enabled=!0,T.depth.mask=!0,W.uTransparent=!1,y._getFrameRenderOptions("renderGrid")!==!1&&y._31O._42(m,i);if(!m.textureBatch||To[(ONE_FRAME_TIME-6)/2]){K||(y.shadowMap.enable&&y.shadowMap.createShadow(W),y.flowMap.createFlow(W));for(var B=y._sortedRenderLayers,h=0,L=B.length;L>h;h++){var C=B[h],r=y.getRenderLayerInfo(C);if(!(!y._camera&&r.ignore||y._camera&&!y._camera.isLayerVisible(r.mask))){var S=r.priority;Z(S)&&(K||(y.shadowMap.enable&&y.shadowMap.createShadow(W),y.flowMap.createFlow(W))),this.renderLayer(C)}}Z(F.cameraPriority.infinity),K||y.flowMap.disableFlow(W),eh(y,W,0,F.graph3dViewHeadlightAmbientIntensity),W.uHeadlightColor=[1,1,1,0],W.uUseEnvMap=!1,W.uHeadlightDirection=[0,0,0],W.uHeadlightRange=0,T.depth.enabled=!1,W.uTransparent=!1,W.shadowReceive=!1,yc(y,W,ar),K?y.drawFilter||y._30O._42(m,i):(y._highlightHelper._42(m,i),this._renderAxisAndEditHelper(y._getFrameRenderOptions("renderAxis")!==!1,y._getFrameRenderOptions("renderEdit")!==!1),T.blend.enabled=!1,T.depth.mask=!0),T.depth.enabled=!0,K&&Wp(m,z),Kn(m,N),$g(m,N),y._44Q=-1,y._popFrameRenderOptions(null)}},_renderAxisAndEditHelper:function(S,K){if(S||K){var U=this,f=U.getGL(),j=U._prg,I=U._frameState,o=I.renderState,H=o.glState,p=o.directUniforms();I.renderState.attribs.disable(),H.depth.enabled=!1,p.uTransparent=!1,p.shadowReceive=!1,H.blend.enabled=!1,H.depth.mask=!0,p.uPick=U._picking;var h=!U._fogDisabled;h&&(p.uFog=!1),S&&U._32O._42(f,j),K&&U._30O._42(f,j),h&&(p.uFog=!0),Kn(f,N),$g(f,N)}},renderLayers:function(U,V){V&&(U=Jk(U));for(var w=0,G=U.length;G>w;w++)this.renderLayer(U[w])},renderSky:function(){var e=this,D=e._frameState,z=D.renderState,V=z.glState,l=e.getGL(),m=e._prg;e._projectMatrix=bp(e),we(e,e._7O),e._viewMatrix=Sc(e._7O),Im(e._projScreenMatrix=Gj(),e._projectMatrix,e._viewMatrix),D.syncEnv(),z.useProgram(m),D.setGLState(!1,!0),D.setUniforms(!1),D.renderState.attribs.disable(),l.clear(l.DEPTH_BUFFER_BIT),Wp(l,[0,0,0,0]),V.blend.enabled=!1,V.depth.enabled=!1,V.depth.mask=!1,e.drawSky(l,m),V.depth.mask=!0,V.depth.enabled=!0,Kn(l,N),$g(l,N)},addRenderLayerListener:function(q,a,w){var D=this;D._renderLayerNotifier||(D._renderLayerNotifier=new vl),D._renderLayerNotifier.add(q,a,w)},removeRenderLayerListener:function(r,S){this._renderLayerNotifier&&this._renderLayerNotifier.remove(r,S)},fireRenderLayerEvent:function(S,k){var Y=this._renderLayerNotifier;Y&&Y.fire({layer:S,phase:k})},renderLayer:function(I){var q=this,$=q._picking,K=q._40Q.get(I);if(K){q.fireRenderLayerEvent(I,"prepare");var P=q.getGL(),A=q.getRenderLayerInfo(I),x=q._frameState,z=x.renderState,Q=z.glState,i=z.directUniforms();!$&&q.isSortable()&&K.sort(q._sortFunc,q._projScreenMatrix);var B,h,d,H=K.opaque,o=K.transparent,W=K.batchModelMap,c=K.polylineModelMap,M=K.wireframeModelMap,P=q.getGL(),u=q._prg;$||(Q.blend.enabled=!1,Q.depth.enabled=!0,Q.depth.mask=!0),i.uTransparent=!1,A.clearDepth!==!1&&P.clear(P.DEPTH_BUFFER_BIT);var L=this.drawFilter;if(L){for(d=H,B=0,h=d.length;h>B;B++)L(d[B].data)!==!0&&d[B].ui._42(P,u,e);if($)for(d=o,B=0,h=d.length;h>B;B++)d[B].ui._46Q(P);Zg(q,W)}else{for(d=H,B=0,h=d.length;h>B;B++)d[B].ui._42(P,u,e);if($)for(d=o,B=0,h=d.length;h>B;B++)d[B].ui._46Q(P);Zg(q,W),Ee(q,c),Ee(q,M)}if($||(Q.blend.enabled=!0,Q.depth.mask=!1),q._45Q=i.uTransparent=!0,L){for(d=o,B=0,h=d.length;h>B;B++)L(d[B].data)!==!0&&d[B].ui._42(P,u,a);Zg(q,W,null,!0)}else{for(d=o,B=0,h=d.length;h>B;B++)d[B].ui._42(P,u,a);Zg(q,W,null,!0),Ee(q,c,null,!0),Ee(q,M,null,!0)}q._45Q=null,q.fireRenderLayerEvent(I,"post")}},_42:function(U,g){var c=this;if(!c._35O&&(!Xk||To(Xk))){var V=c.getWidth(),I=c.getHeight();if(V&&I){var A=c.getGL();if(A){var N,l=c._canvas;if(U?N=!0:U=c.getDevicePixelRatio(),!c._picking&&(N||V!==l.clientWidth||I!==l.clientHeight)){Nc(l,V,I,U);var k=U;V&&Math.abs(A.drawingBufferWidth-V*U)>1&&(k=Math.min(k,A.drawingBufferWidth/V)),I&&Math.abs(A.drawingBufferHeight-I*U)>1&&(k=Math.min(k,A.drawingBufferHeight/I)),k!==U&&(c.setDevicePixelRatio(U=k),Nc(l,V,I,U)),c._18Q=null}A.clear(A.COLOR_BUFFER_BIT);var e=A._renderInfo;e.calls=0,e.vertices=0,e.faces=0,e.lines=0,e.points=0,e.textureCache={time:0,count:0,pixels:0},e.frame=++c._frameId,e.cacheTimeCost=0,e.reflectDepth=0,V*=U,I*=U,this.syncRenderState();do{if(c.isVREnabled()&&c.vr.render(A,V,I,g))break;if(c.updateScene(),c._postProcessing.render(A,V,I,g))break;c.setViewport(A,0,0,V,I),c.renderScene(g)}while(!1);c._33Q=!1,c.countFrame(),c._doBufferGC(A)}}}},syncRenderState:function(){var i,u;(i=this._frameState)&&(u=i.renderState)&&u.syncLoss()},drawReflectors:function(k){k._renderInfo.reflectDepth++;var C,W,E,w=this,D=w._dataModel.getReflectors(),P=!1;for(C in D)W=D[C],w.isVisible(W)&&(E=w.getData3dUI(W),E&&E.drawReflector&&E.drawReflector(k)&&(P=!0));return k._renderInfo.reflectDepth--,P},isReflecting:function(R){return R._renderInfo.reflectDepth},getPostProcessing:function(){return this._postProcessing},enablePostProcessing:function(o,u){return this._postProcessing.enableModule(o,u)},getPostProcessingModule:function(t){return this._postProcessing.getModule(t)},getPostProcessingValue:function(T,j){var N=this._postProcessing.getModule(T);return N?N[j]:I},setPostProcessingValue:function(w,V,M){var s=this.getPostProcessingValue(w,V),F=this._postProcessing.getModule(w);F&&s!==M&&("enable"===V?this.enablePostProcessing(w,M):F[V]=M,this.firePropertyChange("postProcessing."+w+"."+V,s,M))},setDofImageFromGraphView:function(l,z,q){return this._postProcessing.getModule("Dof").setImageFromGraphView(l,z,q)},setViewport:function(g,f,o,h,J){this._viewport=[f,o,h,J],dk.for(g).directState().viewport=this._viewport},getRenderState:function(){return dk.for(this._26I)},getViewport:function(){return this._viewport},setBufferGCInterval:function(R){this._bufferGCInterval=R},_doBufferGC:function(S,e){var Y,M,F=S._bufPool,r=0,w=0,c=S._renderInfo.frame,j=this._bufferGCInterval||10;for(Y in F)r++,M=F[Y],M&&(e||c-M._fid>j?(S.deleteBuffer(M._buf),M._buf=null,F[Y]=null):w++);if(r/2>w&&r>128){var X={};for(Y in F)F[Y]&&(X[Y]=F[Y]);S._bufPool=X}S._validBufCount=w},_swapLineMap:function(){var d=this;Lf=d._polylineModelMap,d._polylineModelMap=d._polylineModelMapSwap,d._polylineModelMapSwap=Lf,Lf=d._wireframeModelMap,d._wireframeModelMap=d._wireframeModelMapSwap,d._wireframeModelMapSwap=Lf,Lf=d._polylineIndexMap,d._polylineIndexMap=d._polylineIndexMapSwap,d._polylineIndexMapSwap=Lf,Lf=d._wireframeIndexMap,d._wireframeIndexMap=d._wireframeIndexMapSwap,d._wireframeIndexMapSwap=Lf},_updateSkybox:function(b){if(this._skybox&&b){var e=b.property,V=!1,X=this._skybox;if("eye"===e||"forceUpdate"===e){var x=this._eye;X.p3(x[0],x[1],x[2]),V=!0}if("near"===e||"far"===e||"forceUpdate"===e||"asceptChanged"===e){var j=X.__cachedS3__;j||(j=X.__cachedS3__=X.getFinalScale3d());var l=Math.sqrt(3),H=1/0,z=-1/0;j.forEach(function(Q){Q/=2,H=J(Q,H),z=n(Q,z)}),z*=l;var G=this._near,I=this._far,$=Math.tan(this.getFovy()/2)*G,v=this.getAspect()*$,f=1.1*Math.sqrt(v*v+$*$+G*G),M=1;if(f>H)M=f/H;else if(z>=I){var Z=I*I/(G+I);M=Z/z}if(1!==M){X.__updatingSkybox__=!0;var y=j.map(function(n){return M*n});X.s3(y),X.setScale3d(1,1,1),V=!0,delete X.__updatingSkybox__}}V&&this.invalidateData(X)}},getSkyBox:function(){return this.getSkybox()},setSkyBox:function(t){return this.setSkybox(t)},getSkybox:function(){return this._skybox},setSkybox:function(Z){var X=this._skybox;if(X===Z)return Z&&this._updateSkybox({property:"forceUpdate"}),void 0;if(X&&(this._skyboxStyleMap&&X.setStyleMap(this._skyboxStyleMap),this._skyboxStyleMap=null,this._skyboxAnchor3d&&X.setAnchor3d(this._skyboxAnchor3d),this._skyboxAnchor3d=null,this._skyboxP3&&X.p3(this._skyboxP3),this._skyboxP3=null,this.handleDataModelChange({kind:Uj,data:X})),this._skybox=Z,this.ump(this._updateSkybox,this),Z){Z.removeFromDataModel(),this._skyboxStyleMap=y.Default.clone(Z.getStyleMap()),this._skyboxAnchor3d=Z.getAnchor3d(),Z.setAnchor3d(.5,.5,.5),this._skyboxP3=Z.p3().slice(0),Z.s({"shape3d.reverse.flip":!0,"shape3d.reverse.cull":!1,"all.reverse.flip":!0,"all.reverse.cull":!1,"front.reverse.flip":!0,"front.reverse.cull":!1,"back.reverse.flip":!0,"back.reverse.cull":!1,"left.reverse.flip":!0,"left.reverse.cull":!1,"right.reverse.flip":!0,"right.reverse.cull":!1,"top.reverse.flip":!0,"top.reverse.cull":!1,"bottom.reverse.flip":!0,"bottom.reverse.cull":!1});var g=Z.onPropertyChanged;Z.onPropertyChanged=function(w){g.call(Z,w),!Z.__updatingSkybox__&&["width","height","tall","scale","scaleTall"].indexOf(w.property)>=0&&(Z.__cachedS3__=I)},this.mp(this._updateSkybox,this),this._updateSkybox({property:"forceUpdate"})}this.fp("skybox",X,Z)},drawSky:function(K,L){var k=this,S=k._skybox;if(S){var n=dk.for(K).directUniforms(),D=k._headlightIntensity,m=Ng(k._headlightColor),L=k._prg;1!==D&&(m=[m[0]*D,m[1]*D,m[2]*D]),n.uHeadlightColor=[m[0],m[1],m[2],1];var p=k.getData3dUI(S);if(p){var j=k.isOrtho(),d=j||this._computedProjectMatrix;if(d){var s=k._projectMatrix;j&&(k._ortho=!1),n.uPMatrix=k._projectMatrix=bp(k,!0)}var _=S.p3(),N=this.getEye();(_[0]!==N[0]||_[1]!==N[1]||_[2]!==N[2])&&(S._position.x=N[0],S._54O=N[1],S._position.y=N[2]),p.validate(),p._42(K,L,P),d&&(j&&(k._ortho=!0),n.uPMatrix=k._projectMatrix=s)}K.clear(K.DEPTH_BUFFER_BIT),n.uHeadlightColor=[m[0],m[1],m[2],k._headlightDisabled?1:0]}},getLogicalPoint:function(F){return qh(F,this._canvas)},isRectOverlapping:function(J){var f=this.getData3dUI(J);return f._rectOverlapping},getHitFaceInfo:function(V){V.target&&(V=this.lp(V));var J=this.getDataInfoAt(V);if(J){var A=this.intersectObject(V,J.data);if(A)return{data:J.data,face:A.part}}return N},unproject:function(S,P){var y=this,Q=y.getWidth(),u=y.getHeight(),E=S.target?y.lp(S):S,H=E.x-Q/2,l=E.y-u/2,T=2*(H/Q),m=2*(-1*l/u);P=P||0;var n=Gj(),b=bp(y),M=we(y);Im(n,b,M),ag(n);var I=mj([T,m,P,1],n);return[I[0]/I[3],I[1]/I[3],I[2]/I[3]]},getDataAt:function(S){var E=this.getDataInfoAt(S);return E?E.data:N},getDataInfoAt:function(j,V,P){return j.target&&(j=this.lp(j)),this._1o.get(rb(j.x,j.y,V),!0,P)},getDatasInRect:function(y,d){return this._1o.get(y,!1,d)},setEditable:function(L){var W=this,O=W._editable;W._editable=L,this.fp(Cg,O,L)},isEditable:function(s){var S=this;return s?S._editable?cl(s)?s.s("3d.editable")?S._editableFunc?S._editableFunc(s):!0:!1:!1:!1:S._editable},isSelectable:function(e){return e.s("3d.selectable")&&this.sm().isSelectable(e)},isMovable:function(Q){var V=this;return lm(Q)&&Q.getStyle(_q)!==Xf?!1:Q.s("3d.movable")?V._movableFunc?V._movableFunc(Q):!0:!1},isSizeEditable:function(z){return cl(z)?this._sizeEditableFunc?this._sizeEditableFunc(z):!0:!1},isRotationEditable:function(m){return cl(m)&&m.IRotatable!==!1?this._rotationEditableFunc?this._rotationEditableFunc(m):!0:!1},handleDelete:function(){this._editable&&this.removeSelection()},zoomIn:function(A){this.setZoom(mc,A)},zoomOut:function(_){this.setZoom(1/mc,_)},setZoom:function(){var l=new Vg,U=new Vg,a=new Vg,p=new Vg;return function(A,i){if(1!==A){var W=this;W._14o&&W._14o.stop(!0);var V,r=1/A;l.copy(W.getCenter()),U.copy(W.getEye());var s=W._ortho;if(s){if(V=W._orthoWidth,V<W._moveStep&&A>1)return}else if(l.distanceTo(U)<W._moveStep&&1>r)return;var I=!1;return W._zoomToCenter===!1&&W._lastZoomLP&&(a.copy(U).sub(l).normalize(),W._81O=null,p.copy(W.getHitPosition(W._lastZoomLP,l.toArray(),a.toArray())),I=!0,W._lastZoomHit=p),(i=Qd(i))?(i.action=function(F){W.fi({kind:W._zooming?"betweenZoom":"beginZoom"}),W._zooming=1;var f=(r-1)*F+1;s&&W.setOrthoWidth(V*f),I?(W.setEye(a.lerpVectors(p,U,f).toArray()),W.setCenter(a.lerpVectors(p,l,f).toArray())):s||W.setEye(a.lerpVectors(l,U,f).toArray())},i._37o=function(){delete W._14o,delete W._zooming,W.fi({kind:"endZoom"}),W.onZoomEnded()},W._14o=Pc(i)):(s&&W.setOrthoWidth(V*r),I?(W.setEye(a.lerpVectors(p,U,r).toArray()),W.setCenter(a.lerpVectors(p,l,r).toArray())):s||W.setEye(a.lerpVectors(l,U,r).toArray()),void 0)}}}(),setOrthoZoom:function(E,A){return this.setZoom(E,A)},getPositionInfo:function($){var i=this,k=i._eye,f=i._center,N=i.getAspect(),I=$?Cr(Zo(f,k,!0),Zo($,k)):So(k,f);if(i._ortho){var r=i._orthoWidth;return{length:I,height:r/N,width:r}}var o=2*aq(i._fovy/2)*I;return{length:I,height:o,width:o*N}},getCenterInfo:function(){var H=this;return H._81O||(H._81O=H.getPositionInfo()),iq(H._81O)},rotate:function(d,p,$,B){var f=this;if(d||p){B==N&&(B=f._firstPersonMode),f._88O&&f._88O.stop(!0);var k=f._center,Y=f._eye,o=f.getCenterInfo().length,j=B?k:Y,M=B?Y:k,b=Zo(j,M),Q=ge(b[0],b[2]),V=ge(U(b[0]*b[0]+b[2]*b[2]),b[1]),y=B?lo:_d;return B&&(p=-p),($=Qd($))?($.action=function(J){f.fi({kind:f._rotating?"betweenRotate":"beginRotate"}),f._rotating=1;var C=Q+d*J,Y=V+p*J;Y=B?G-jb(f,G-Y):jb(f,Y),b[0]=o*W(Y)*W(C),b[1]=o*s(Y),b[2]=o*W(Y)*s(C),j[0]=M[0]+b[0],j[1]=M[1]+b[1],j[2]=M[2]+b[2],f.fp(y,N,j)},$._37o=function(){delete f._88O,delete f._rotating,f.fi({kind:"endRotate"}),f.onRotateEnded()},f._88O=Pc($)):(Q+=d,V+=p,V=B?G-jb(f,G-V):jb(f,V),b[0]=o*W(V)*W(Q),b[1]=o*s(V),b[2]=o*W(V)*s(Q),j[0]=M[0]+b[0],j[1]=M[1]+b[1],j[2]=M[2]+b[2],f.fp(y,N,j),void 0)}},pan:function(V,x,Y,o){if(V||x){var Z=this;o==N&&(o=Z._firstPersonMode),Z._89O&&Z._89O.stop(!0);var n=we(Z),t=[n[0]*V,n[4]*V,n[8]*V],_=[n[1]*x,n[5]*x,n[9]*x],O=t[0]+_[0],G=t[1]+_[1],g=t[2]+_[2],A=Z._center,l=Z._eye;if(o){var d=ih(Z.getBoundaries(),l[0],l[2],l[0]+O,l[2]+g,U(O*O+g*g));O=d[0],g=d[1]}if(Y=Qd(Y)){var K=iq(l),Q=iq(A);return Y.action=function(E){Z.fi({kind:Z._panning?"betweenPan":"beginPan"}),Z._panning=1,A[0]=Q[0]+O*E,A[1]=Q[1]+G*E,A[2]=Q[2]+g*E,l[0]=K[0]+O*E,l[1]=K[1]+G*E,l[2]=K[2]+g*E,Z.fp(_d,N,l),Z.fp(lo,N,A)},Y._37o=function(){delete Z._89O,delete Z._panning,Z.fi({kind:"endPan"}),Z.onPanEnded()},Z._89O=Pc(Y)}A[0]+=O,A[1]+=G,A[2]+=g,l[0]+=O,l[1]+=G,l[2]+=g,Z.fp(_d,N,l),Z.fp(lo,N,A)}},walk:function(p,j,x){if(p){var U=this;x==N&&(x=U._firstPersonMode),U._90O&&U._90O.stop(!0);var z=U._center,M=U._eye,L=Zo(z,M,!0);if(x){var O=ih(U.getBoundaries(),M[0],M[2],M[0]+L[0]*p,M[2]+L[2]*p,u(p));if(p=So(O),!p)return;L=[O[0]/p,0,O[1]/p]}if(j=Qd(j)){var f=iq(M),g=iq(z);return j.action=function(o){U.fi({kind:U._walking?"betweenWalk":"beginWalk"}),U._walking=1;var O=p*o;M[0]=f[0]+L[0]*O,M[1]=f[1]+L[1]*O,M[2]=f[2]+L[2]*O,z[0]=g[0]+L[0]*O,z[1]=g[1]+L[1]*O,z[2]=g[2]+L[2]*O,U.fp(_d,N,M),U.fp(lo,N,z)},j._37o=function(){delete U._90O,delete U._walking,U.fi({kind:"endWalk"}),U.onWalkEnded()},U._90O=Pc(j)}M[0]+=L[0]*p,M[1]+=L[1]*p,M[2]+=L[2]*p,z[0]+=L[0]*p,z[1]+=L[1]*p,z[2]+=L[2]*p,U.fp(_d,N,M),U.fp(lo,N,z)}},handleScroll:function(B,Q){vr(B);var t=this,e=t._moveStep,p=t.getDataInfoAt(B);if(p){var b=p.data;if(b&&t.isInteractive(b)){var d=t.intersectObject(B,b);if(d){var g=d.part,X=Fp(b.s(g+".image")||b.s("shape3d."+g+".image")||b.s("all.image")||b.s("shape3d.image"));if(X&&Aq(X.scrollable,b,t))return}}}return t.isFirstPersonMode()?(t.isPannable()&&t.pan(0,Q>0?e:-e),void 0):(t.isZoomable()&&(t._lastZoomLP=t.lp(B),t.setZoom(0>Q?1/Bi:Bi),t._lastZoomLP=t._lastZoomHit=null),void 0)},handlePinch:function(b,W){if(this.isZoomable()){if(Math.abs(b-W)<F.pinchZoomThreshold)return;this.setZoom(W>b?1/zs:zs)}},reset:function(N){this.setUp(F.graph3dViewUp),this.moveCamera(F.graph3dViewEye,F.graph3dViewCenter,N)},moveSelection:function(x,U,n){var f=this;f.dm().beginTransaction(),vs(this.sm().toSelection(this.isMovable,this),x,U,n),f.dm().endTransaction()},getMoveMode:function(I,r){var d=r.s("3d.move.mode");if(d)return d;var V="88",b="89",Y="90";return oo(I)||Hf[V]&&Hf[b]&&Hf[Y]?"xyz":Hf[V]&&Hf[b]?"xy":Hf[V]&&Hf[Y]?"xz":Hf[b]&&Hf[Y]?"yz":Hf[V]?"x":Hf[b]?"y":Hf[Y]?"z":"xz"},handleTick:function(){var P=this,g=!1,m=P._moveStep,G=m,w=!1,I=!0,u=P._rotateStep*(I?-1:1);if(P.isWalkable()||(G=0),P.isPannable()||(m=0),P.isRotatable()||(u=0),P._32Q){var e=(Hd()-P._32Q)/50;G*=e,m*=e,u*=e}P._31Q&&(Vm(P._31Q),delete P._31Q,delete P._32Q),th()&&(g=!0,P.pan(-m,0,w,I)),Xh()&&(g=!0,P.pan(m,0,w,I)),Tj()&&(g=!0,oo()?P.pan(0,m,w,I):P.walk(G,w,I)),ij()&&(g=!0,oo()?P.pan(0,-m,w,I):P.walk(-G,w,I)),jr()&&(g=!0,P.rotate(-u,0,w,I)),wk()&&(g=!0,P.rotate(u,0,w,I)),cb()&&(g=!0,P.rotate(0,-u/2,w,I)),Yd()&&(g=!0,P.rotate(0,u/2,w,I)),g&&(P._32Q=Hd(),P._31Q=hh(P.handleTick,P))},handleKeyDown:function(s){var H=this;!Og(s)&&zq[s.keyCode]?H.handleTick():cr(s)?H.selectAll():Wk(s)?H.handleDelete(s):En(s)&&this.isResettable()&&H.reset()},checkDoubleClickOnNote:function(w,W,M){var h=this;if(M===ci){if(W.s("note.toggleable"))return W.s(lb,!W.s(lb)),h.fi({kind:"toggleNote",event:w,data:W,part:M}),!0}else if(M===qn&&W.s("note2.toggleable"))return W.s(Tc,!W.s(Tc)),h.fi({kind:"toggleNote2",event:w,data:W,part:M}),!0;return!1},checkDoubleClickOnRotation:function(h,H,r){return r===ct?(H.setRotationX(0),!0):r===dt?(H.setRotationY(0),!0):r===et?(H.setRotationZ(0),!0):!1},onRotateEnded:function(){},onWalkEnded:function(){},getViewRatio:function(m){var O=this;if(O.isOrtho())return O.getWidth()/O.getOrthoWidth();var k=O.getCenter(),L=O.getHeight(),f=O.getEye(),y=[k[0]-f[0],k[1]-f[1],k[2]-f[2]],Y=[m[0]-f[0],m[1]-f[1],m[2]-f[2]],F=Math.sqrt(y[0]*y[0]+y[1]*y[1]+y[2]*y[2]),q=1/Math.tan(O.getFovy()/2);return L*F*q/(Y[0]*y[0]+Y[1]*y[1]+Y[2]*y[2])},inViewSpace:function(w){var d,X=this,T=X._transformPointToViewSpace(w),u=X.getAspect(),a=X.getNear(),M=X.getFar();return-T[2]<a||-T[2]>M?!1:X.isOrtho()?(d=X.getOrthoWidth()/2,Math.abs(T[0])<=d&&Math.abs(T[1]*u)<=d):(d=Math.sqrt(T[0]*T[0]+T[1]*T[1]+T[2]*T[2])*Math.tan(X.getFovy()/2),Math.abs(T[1]<=d)&&Math.abs(T[0])<=d*u)},getPVMatrix:function(){var h,V=this;return(h=V._18Q)||(h=bp(V),V._18Q=Im(h,h,we(V)),V._18Q._wh=V.getWidth()/2/V.getHeight()),h},getFrustum:function(){var d=new Ic,h=new wr,R=new Array(16);return function(){for(var e=this.getPVMatrix(),C=!1,S=0;16>S;S++)e[S]!==R[S]&&(C=!0,R[S]=e[S]);return C&&h.setFromMatrix(d.fromArray(e)),h}}(),toViewPosition:function(m){var H=this,B=H.getWidth()/2,Y=H.getHeight()/2,z=H.getPVMatrix();return m=mj([m[0],m[1],m[2],1],z),{x:B+B*m[0]/m[3],y:Y-Y*m[1]/m[3],z:m[2]/m[3]}},getHitPosition:function(X,J,G){var B=this,c=B.getWidth(),q=B.getHeight(),f=X.target?B.lp(X):X,P=f.x-c/2,K=f.y-q/2,x=B.getCenterInfo(),H=we(B);J=J?J:[0,0,0],G=G?G:[0,1,0],P=P/c*x.width,K=-1*K/q*x.height;var Z=[H[0]*P,H[4]*P,H[8]*P],A=[H[1]*K,H[5]*K,H[9]*K],y=[Z[0]+A[0],Z[1]+A[1],Z[2]+A[2]],j=B.getCenter(),C=Rm(B,J,G,[y[0]+j[0],y[1]+j[1],y[2]+j[2]]);return C?C:[0,0,0]},intersectObject:function(q,Y){return this._raycaster.intersectObject(q,Y)},intersectObjects:function(Y,h,v){return this._raycaster.intersectObjects(Y,h,v)},getLineLength:function(n){this.validate();var w=this.getData3dUI(n);if(w&&w.getCache){var T=w.getCache();if(T)return T[T.length-1].length}return 0},getLineOffset:function(j,E){var q=this.getData3dUI(j);if(q&&q.getCache){var d=q.getCache();if(d){var h=kp(d,E);if(j.s("shape3d")!==Cm)return h;var D,g;if(j.getScale3d&&(D=j.getScale3d(),1===D[0]&&1===D[1]&&1===D[2]&&(D=null)),j.r3&&(g=j.r3(),0===g[0]&&0===g[1]&&0===g[2]&&(g=null)),!g&&!D)return h;var r=new Vg(j.p3()),V=new Vg(h.point).sub(r),Q=new Vg(h.tangent).add(V);if(D&&(D=new Vg(D),V.multiply(D),Q.multiply(D)),g){var B=(new $i).setFromEuler(new Ji(g,j.getRotationMode(),!0));V.applyQuaternion(B),Q.applyQuaternion(B)}return{point:V.clone().add(r),tangent:Q.sub(V).normalize()}}}return N},_genBatchInstancedArrayFunc:function(){var e=this._glCapabilities&&this._glCapabilities.instancedArray&&!this._batchInstancedDisabled,S=e?Qk:fi;this.batchInstancedModel=function(r,e,M,D,h,V,N){S(this,r,e,M,D,h,V,N)};var R=e?mp:Tb;this.batchInstancedShapeFace=function(O,e,b){R(O,e,b)};var B=e?Tq:um;this.batchInstancedFace=function(U,F,o,A,w){B(this,U,F,o,A,w)}},isLabelVisible:function(){return!0},isNoteVisible:function(){return!0},moveCamera:function(K,P,C){var Z=this,p=Z.getEye();p=[p[0],p[1],p[2]];var J=Z.getCenter();if(J=[J[0],J[1],J[2]],K||(K=p),P||(P=J),Z._flyAnim&&Z._flyAnim.stop(!0),C=Qd(C),!C)return Z.setEye(K[0],K[1],K[2]),Z.setCenter(P[0],P[1],P[2]),delete Z._flyAnim,!0;var j=[K[0]-p[0],K[1]-p[1],K[2]-p[2]],W=[P[0]-J[0],P[1]-J[1],P[2]-J[2]];return C.action=function(I){Z.setCenter(J[0]+W[0]*I,J[1]+W[1]*I,J[2]+W[2]*I),Z.setEye(p[0]+j[0]*I,p[1]+j[1]*I,p[2]+j[2]*I)},C._37o=function(){delete Z._flyAnim},Z._flyAnim=Pc(C)},flyTo:function(){function R(b,l,e){if(e instanceof y.Node){X.fromArray(rg(e,l.getMat(e)));var n=e.getAnchor3d();b.push((new Vg).set(0-n.x,0-n.y,0-n.z).applyMatrix4(X)),b.push((new Vg).set(0-n.x,0-n.y,1-n.z).applyMatrix4(X)),b.push((new Vg).set(0-n.x,1-n.y,0-n.z).applyMatrix4(X)),b.push((new Vg).set(0-n.x,1-n.y,1-n.z).applyMatrix4(X)),b.push((new Vg).set(1-n.x,0-n.y,0-n.z).applyMatrix4(X)),b.push((new Vg).set(1-n.x,0-n.y,1-n.z).applyMatrix4(X)),b.push((new Vg).set(1-n.x,1-n.y,0-n.z).applyMatrix4(X)),b.push((new Vg).set(1-n.x,1-n.y,1-n.z).applyMatrix4(X))}}var E=new Vg,T=new Vg,h=new Vg,j=new Vg,P=new Vg,X=new Ic,Q=new y.Math.Quaternion,v=new Ji,q=new em;return function(z,p,x){var U=this;"boolean"==typeof p&&(p={animation:p}),p=p||{};var V=p.center,O=p.distance,r=p.direction,D=p.worldDirection,G=x||p.ratio||.8,N=p.xRatio||G,A=p.yRatio||G;(x!==I||p.duration||p.frames)&&(p={animation:p});var w,d,C=[],H=O===I;if(V&&h.fromArray(V),!V||H)if(z||(z=U.dm().getDatas()),1===z.length&&(z=Np(z)?z.get(0):z[0]),z instanceof y.Node)V||h.fromArray(z.p3()),H&&(R(C,U,z),w=C.length);else{if(!z.length)return;if((H||!V)&&(C=[],z.forEach(function(h){R(C,U,h)}),w=C.length,!w))return;V||(q.setFromPoints(C),h.copy(q.min).add(q.max).multiplyScalar(.5))}if(U._flyAnim&&U._flyAnim.stop(!0),E.fromArray(U.getEye()),T.fromArray(U.getCenter()),U.setCenter(h.x,h.y,h.z),j.subVectors(E,T),r||D){!D&&z instanceof y.Node?Q.setFromEuler(v.set(z.r3(),z.getRotationMode(),!0)):Q.set(0,0,0,1);var t=j.length();j.fromArray(D||r).applyQuaternion(Q).setLength(t)}var o=new Vg(U.getUp()),e=fl.fequal(o.x,0,1e-5)&&fl.fequal(o.z,0,1e-5);if(e&&0===j.x&&0===j.z){var u=.001,K=j.y;j.y=K*(1-u),j.z=Math.sign(K)*u}var $=0;if(H){var W,Z,L,M=N,n=A;if(P.copy(j),U.isOrtho()){var X=-1/0;for(U._eye[0]=j.x+h.x,U._eye[1]=j.y+h.y,U._eye[2]=j.z+h.z,W=bp(U),Im(W,W,we(U)),d=0;w>d;d++)L=C[d],Z=mj([L.x,L.y,L.z,1],W),X=Math.max(X,Math.max(Math.abs(Z[0])/M,Math.abs(Z[1])/n));$=U.getOrthoWidth()*X}else{for(var J,B,c=U.getNear(),Y=10;Y--;){for(U._eye[0]=j.x+h.x,U._eye[1]=j.y+h.y,U._eye[2]=j.z+h.z,W=bp(U),Im(W,W,we(U)),J=!0,B=-1/0,d=0;w>d;d++){if(L=C[d],Z=mj([L.x,L.y,L.z,1],W),Z[3]<c&&Y){j.multiplyScalar(2),J=!1;break}B=Math.max(B,Math.max(Math.abs(Z[0])/M,Math.abs(Z[1])/n)-Z[3])}if(J)break}j.setLength(B+j.length())}j.manhattanLength()<1e-6&&j.copy(P)}else j.setLength(O);var l=j.add(h),f=Qd(p.animation);if(f){U.setEye(E.x,E.y,E.z),U.setCenter(T.x,T.y,T.z);var b=l.clone().sub(h),_=b.length();_&&b.multiplyScalar(1/_);var m=E.clone().sub(T),k=m.length();k&&m.multiplyScalar(1/k);var g=(new Ic).lookAtDirection(m,o),a=(new Ic).lookAtDirection(b,o),i=(new $i).setFromRotationMatrix(g),S=(new $i).setFromRotationMatrix(a),s=(new Vg).subVectors(h,T);if($)var pf=U.getOrthoWidth();var Ar=new Vg,To=new Vg,Mi=new Vg,vs=f.action,xh=f._37o,bb=T.clone();return f.action=function(Q,O){To.copy(bb).addScaledVector(s,Q);var l=i.clone().slerp(S,Q);Ar.set(0,0,1).applyQuaternion(l).setLength(k+(_-k)*Q).add(To),Mi.set(0,1,0).applyQuaternion(l),U.setCenter(To.x,To.y,To.z),U.setEye(Ar.x,Ar.y,Ar.z),U.setUp(Mi.x,Mi.y,Mi.z),$&&U.setOrthoWidth(($-pf)*Q+pf),vs&&vs(Q,O)},f._37o=function(){delete U._flyAnim;var B=U.getUp(),T=e?F.graph3dViewUp:o.toArray();(B[0]!==T[0]||B[1]!==T[1]||B[2]!==T[2])&&U.setUp(T),xh&&xh()},{lastEye:E,lastCenter:T,eye:l,center:h,orthoWidth:$,animation:U._flyAnim=Pc(f)}}return U.setEye(l.x,l.y,l.z),U.setCenter(h.x,h.y,h.z),$&&U.setOrthoWidth($),delete U._flyAnim,{lastEye:E,lastCenter:T,eye:l,center:h,orthoWidth:$}}}(),getBoundingBox:function(){function Z(K,F,_){B.fromArray(rg(_,F.getMat(_)));var z=_.getAnchor3d();K.push((new Vg).set(0-z.x,0-z.y,0-z.z).applyMatrix4(B)),K.push((new Vg).set(0-z.x,0-z.y,1-z.z).applyMatrix4(B)),K.push((new Vg).set(0-z.x,1-z.y,0-z.z).applyMatrix4(B)),K.push((new Vg).set(0-z.x,1-z.y,1-z.z).applyMatrix4(B)),K.push((new Vg).set(1-z.x,0-z.y,0-z.z).applyMatrix4(B)),K.push((new Vg).set(1-z.x,0-z.y,1-z.z).applyMatrix4(B)),K.push((new Vg).set(1-z.x,1-z.y,0-z.z).applyMatrix4(B)),K.push((new Vg).set(1-z.x,1-z.y,1-z.z).applyMatrix4(B))}var B=new Ic;return function(B){if(B=B||this.sm().getSelection(),B instanceof y.Node&&(B=[B]),0===B.length)return N;var n=[];B.forEach(function(N){cl(N)&&Z(n,this,N)},this);var g=[1/0,1/0,1/0],U=[-1/0,-1/0,-1/0];return n.forEach(function(G){g[0]=Math.min(G.x,g[0]),g[1]=Math.min(G.y,g[1]),g[2]=Math.min(G.z,g[2]),U[0]=Math.max(G.x,U[0]),U[1]=Math.max(G.y,U[1]),U[2]=Math.max(G.z,U[2])}),{min:g,max:U}}}(),setBatchInfo:function(v,r){var T=this._batchInfoMap[v];this._batchInfoMap[v]=r,this.fp("batchInfo",T,r)},getBatchInfo:function(L){return this._batchInfoMap[L]||al[L]},setOrthoWidth:function(e){var c=this._orthoWidth;if(this._orthoWidth=e,this._syncEyeWithOrthoWidth){var o=e/this.getAspect(),t=o/2/aq(this.getFovy()/2),X=(new Vg).fromArray(this.getEye()),A=(new Vg).fromArray(this.getCenter());X.sub(A).setLength(t).add(A),this.setEye(X.toArray())}this.fp("orthoWidth",c,e)},getCamera:function(B){var p=this;B||(B=p._mainCamera,B||(B=p._mainCamera=new y.Camera)),B.s({"camera.type":p.isOrtho()?"ortho":"perspective","camera.aspect":p.getAspect(),"camera.fovy":p.getFovy(),"camera.ortho.width":p.getOrthoWidth(),"camera.near":p.getNear(),"camera.far":p.getFar()});var J=p.getEye();return B.p3(J.slice()),B.lookAt(p.getCenter(),p.getUp()),B},syncFromCamera:function(G){var l=this,B=new Vg(l.getEye()),K=new Vg(l.getCenter()),C=new Vg,E=K.sub(B).length();l.setEye(G.p3());var F=G.getEuler();return C.set(0,0,-1).applyEuler(F),B.copy(C).setLength(E).add(K.copy(G.p3())),l.setCenter(B.toArray()),B.set(0,1,0).applyEuler(F),K.set(0,1,0),Math.abs(C.cross(B).dot(K))<1e-5?l.setUp(K.toArray()):l.setUp(B.toArray()),l.setOrtho("ortho"===G.s("camera.type")),l.setAspect(G.s("camera.aspect")),l.setFovy(G.s("camera.fovy")),l.setOrthoWidth(G.s("camera.ortho.width")),l.setNear(G.s("camera.near")),l.setFar(G.s("camera.far")),!0},resetHeadlightProperties:function(){this._headlightColor=F.graph3dViewHeadlightColor,this._headlightIntensity=F.graph3dViewHeadlightIntensity,this._headlightRange=F.graph3dViewHeadlightRange,this._headlightDirection=F.graph3dViewHeadlightDirection,this._headlightGroup=F.graph3dViewHeadlightGroup,this._headlightAmbientIntensity=F.graph3dViewHeadlightAmbientIntensity,this._headlightDisabled=F.graph3dViewHeadlightDisabled},resetFogProperties:function(){this._fogDisabled=F.graph3dViewFogDisabled,this._fogMode=F.graph3dViewFogMode,this._fogDensity=F.graph3dViewFogDensity,this._fogColor=F.graph3dViewFogColor,this._fogNear=F.graph3dViewFogNear,this._fogFar=F.graph3dViewFogFar},_sortRenderLayers:function(){var t=this,E=t._sortedRenderLayers=C.keys(t._renderLayerInfoMap);for(var J in ql)E.indexOf(J)>=0||E.push(J);E.sort(function(A,U){return A=t.getRenderLayerInfo(A),U=t.getRenderLayerInfo(U),A.priority-U.priority})},_appendRenderLayer:function(_,R){_=_||0;var d,H=this.getRenderLayerInfo(R);if(H)d=H.mask,!this._renderLayerInfoMap[R]&&ql[R]&&(this._renderLayerInfoMap[R]=H);else{var Q=this._sortedRenderLayers.length;if(!(32>Q))throw new Error("Only 31 render layer can be defined.");d=1<<Q,H=this.getRenderLayerInfo(uo),this._renderLayerInfoMap[R]={mask:d,priority:H.priority}}return _|=d},setRenderLayerInfo:function(Z,b){this._appendRenderLayer(0,Z);var L=this.getRenderLayerInfo(Z),W=iq(L);for(var V in b)"mask"!==V&&(L[V]=b[V]);this._sortRenderLayers(),this.fp("renderLayerInfo",W,L)},getRenderLayerInfo:function(e){return this._renderLayerInfoMap[e]||iq(ql[e])},setRenderLayerInfoMap:function(q){var B=this._renderLayerInfoMap;this._renderLayerInfoMap={};for(var g in q)this.setRenderLayerInfo(g,q[g]);this.fp("renderLayerInfoMap",B,this._renderLayerInfoMap)},getRenderLayerKeys:function(){return this._sortedRenderLayers}}),function(){function M(s,R,T){var x=s[R];x&&x.releaseTexture(),s[R]=T}function Q(){return["\n #ifdef ENVMAP_TYPE_CUBE_UV \n","#define cubeUV_maxMipLevel 8.0 \n","#define cubeUV_minMipLevel 4.0 \n","#define cubeUV_maxTileSize 256.0 \n","#define cubeUV_minTileSize 16.0 \n","float getFace(vec3 direction) {","vec3 absDirection = abs(direction);","float face = - 1.0;","if (absDirection.x > absDirection.z) {","if (absDirection.x > absDirection.y)","face = direction.x > 0.0 ? 0.0 : 3.0;"," else ","face = direction.y > 0.0 ? 1.0 : 4.0;","} else {","if (absDirection.z > absDirection.y) ","face = direction.z > 0.0 ? 2.0 : 5.0;"," else ","face = direction.y > 0.0 ? 1.0 : 4.0;","}","return face;","} ","vec2 getUV(vec3 direction, float face) {","vec2 uv;","if (face == 0.0) {","uv = vec2(direction.z, direction.y) / abs(direction.x);","} else if (face == 1.0) {","uv = vec2(- direction.x, - direction.z) / abs(direction.y);","} else if (face == 2.0) {","uv = vec2(- direction.x, direction.y) / abs(direction.z);","} else if (face == 3.0) {","uv = vec2(- direction.z, direction.y) / abs(direction.x);","} else if (face == 4.0) {","uv = vec2(- direction.x, direction.z) / abs(direction.y);","} else {","uv = vec2(direction.x, direction.y) / abs(direction.z);","}","return 0.5 * (uv + 1.0);","} ","vec3 bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {","float face = getFace(direction);","float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);","mipInt = max(mipInt, cubeUV_minMipLevel);","float faceSize = exp2(mipInt);","float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);","vec2 uv = getUV(direction, face) * (faceSize - 1.0);","vec2 f = fract(uv);","uv += 0.5 - f;","if (face > 2.0) {","uv.y += faceSize;","face -= 3.0;","}","uv.x += face * faceSize;","if (mipInt < cubeUV_maxMipLevel) {","uv.y += 2.0 * cubeUV_maxTileSize;","}","uv.y += filterInt * 2.0 * cubeUV_minTileSize;","uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);","uv *= texelSize;","vec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;","uv.x += texelSize;","vec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;","uv.y += texelSize;","vec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;","uv.x -= texelSize;","vec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;","vec3 tm = mix(tl, tr, f.x);","vec3 bm = mix(bl, br, f.x);","return mix(tm, bm, f.y);","}","\n #define r0 1.0 \n","#define v0 0.339 \n","#define m0 - 2.0 \n","#define r1 0.8 \n","#define v1 0.276 \n","#define m1 - 1.0 \n","#define r4 0.4 \n","#define v4 0.046 \n","#define m4 2.0 \n","#define r5 0.305 \n","#define v5 0.016 \n","#define m5 3.0 \n","#define r6 0.21 \n","#define v6 0.0038 \n","#define m6 4.0 \n","float roughnessToMip(float roughness) {","float mip = 0.0;","if (roughness >= r1) {","mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;","} else if (roughness >= r4) {","mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;","} else if (roughness >= r5) {","mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;","} else if (roughness >= r6) {","mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;","} else {","mip = - 2.0 * log2(1.16 * roughness);","}","return mip;","} ","vec4 textureCubeUV(sampler2D envMap, vec3 sampleDir, float roughness) {","float mip = clamp(roughnessToMip(roughness), m0, cubeUV_maxMipLevel);","float mipF = fract(mip);","float mipInt = floor(mip);","vec3 color0 = bilinearCubeUV(envMap, sampleDir, mipInt);","if (mipF == 0.0) {","return vec4(color0, 1.0);","} else {","vec3 color1 = bilinearCubeUV(envMap, sampleDir, mipInt + 1.0);","return vec4(mix(color0, color1, mipF), 1.0);","}","} ","\n #endif \n"].join("")
}function V(){return["vec4 sRGBToLinear( in vec4 value ) {","return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );","}","vec4 LinearTosRGB( in vec4 value ) {","return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );","}","vec4 inputTexelToLinear( vec4 value ) { return sRGBToLinear( value ); }","vec4 linearToOutputTexel( vec4 value ) { return LinearTosRGB( value ); }","vec4 envMapTexelToLinear( vec4 color ) { return inputTexelToLinear( color ); }"].join("")}function $(){return["precision mediump float;\n","precision mediump int;\n","attribute vec3 position;","attribute vec2 uv;","attribute float faceIndex;","varying vec3 vOutputDirection;","vec3 getDirection( vec2 uv, float face ) {","uv = 2.0 * uv - 1.0;","vec3 direction = vec3( uv, 1.0 );","if ( face == 0.0 ) { direction = direction.zyx; } ","else if ( face == 1.0 ) { direction = direction.xzy; direction.xz *= -1.0; } ","else if ( face == 2.0 ) { direction.x *= -1.0; }","else if ( face == 3.0 ) { direction = direction.zyx; direction.xz *= -1.0; } ","else if ( face == 4.0 ) { direction = direction.xzy; direction.xy *= -1.0; } ","else if ( face == 5.0 ) { direction.z *= -1.0; }","return direction;","}","void main() {","vOutputDirection = getDirection( uv, faceIndex );","gl_Position = vec4( position, 1.0 );","}"].join("")}function r(){return{vs:$(),fs:["precision mediump float;\n","precision mediump int;\n","varying vec3 vOutputDirection;","uniform samplerCube envMap;\n",V(),"\n void main() {","gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );","gl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3(- vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;","gl_FragColor = linearToOutputTexel( gl_FragColor );","}"].join("")}}function j(){return{vs:$(),fs:["precision mediump float;\n","precision mediump int;\n","varying vec3 vOutputDirection;","uniform sampler2D envMap;","uniform vec2 texelSize;\n",V(),"\n #define RECIPROCAL_PI 0.3183098861837907 \n","\n #define RECIPROCAL_PI2 0.15915494309189535 \n","vec2 equirectUv( in vec3 dir ) {","float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;","float v = 0.5 - asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI;","return vec2( u, v );","}","void main() {","gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );","vec3 outputDirection = normalize( vOutputDirection );","vec2 uv = equirectUv( outputDirection );","vec2 f = fract( uv / texelSize - 0.5 );","uv -= f * texelSize;","vec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;","uv.x += texelSize.x;","vec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;","uv.y += texelSize.y;","vec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;","uv.x -= texelSize.x;","vec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;","vec3 tm = mix( tl, tr, f.x );","vec3 bm = mix( bl, br, f.x );","gl_FragColor.rgb = mix( tm, bm, f.y );","gl_FragColor = linearToOutputTexel( gl_FragColor );","}"].join("")}}function d(o){return{vs:$(),fs:["precision mediump float;\n","precision mediump int;\n","#define n "+o+"\n","varying vec3 vOutputDirection;","uniform sampler2D envMap;","uniform int samples;","uniform float weights[ n ];","uniform bool latitudinal;","uniform float dTheta;","uniform float mipInt;","uniform vec3 poleAxis; \n",V(),"\n #define ENVMAP_TYPE_CUBE_UV \n",Q(),"\n vec3 getSample( float theta, vec3 axis ) {","float cosTheta = cos( theta );","vec3 sampleDirection = vOutputDirection * cosTheta + cross(axis, vOutputDirection) * sin(theta) + axis * dot(axis, vOutputDirection) * (1.0 - cosTheta);","return bilinearCubeUV( envMap, sampleDirection, mipInt );","}","void main() {","vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );","if ( all( equal( axis, vec3( 0.0 ) ) ) ) {","axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );","}","axis = normalize( axis );","gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );","gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );","for ( int i = 1; i < n; i++ ) {","if ( i >= samples ) { break; }","float theta = dTheta * float( i );","gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );","gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );","}","gl_FragColor = linearToOutputTexel( gl_FragColor );","}"].join("")}}var h=Lq.EnvmapRenderer=function(D){this.gv=D,this._envmaps={},this._envmapHash={},this._probeCaptureTime={},this._pingPongRenderTarget=null,this._equirectShader=null,this._cubemapShader=null,this._blurMaterial=null,this._lastCaptureFrame=0};h.prototype={},h.prototype.constructor=h,h.prototype.changeEnvmapType=function(n){"legacy"===n?(this.setEnvmapByProbeId=this.setEnvmapLegacy,this.onBeforeRender=this.onBeforeRenderLegacy):(this.setEnvmapByProbeId=this.setEnvmap,this.onBeforeRender=this.onBeforeRenderNew)},h.prototype.invalidateEnvmap=function(N){var d=this.gv;if("legacy"!==d.getEnvmapType()){var f=d.getGL();f&&(N?(delete this._envmapHash[N],delete this._probeCaptureTime[N]):(this._envmapHash={},this._probeCaptureTime={}),d.iv())}},h.prototype.contextLost=function(){var K=this;K._envmaps={},K._envmapHash={},K._pingPongRenderTarget=null,K._equirectShader=K._cubemapShader=K._blurMaterial=null,K._envmapLegacy=null,K._lastLegacyImage=null},h.prototype.onBeforeRenderLegacy=function(X){this.assureTextureLegacy(X)},h.prototype.assureTextureLegacy=function(O){var H=this,X=H.gv,t=X.getEnvmap();if(t!==H._lastLegacyImage){if(H._envmapLegacy&&(O.deleteTexture(H._envmapLegacy),H._envmapLegacy=null),!t)return H._lastLegacyImage=t,void 0;var x=F.getImage(t);if(x&&x.tagName){x=F.resizeImagePOT(x,!0);var b=H._envmapLegacy=O.createTexture();O.activeTexture(O.TEXTURE0),O.bindTexture(O.TEXTURE_CUBE_MAP,b),O.texParameteri(O.TEXTURE_CUBE_MAP,O.TEXTURE_MAG_FILTER,O.LINEAR),O.texParameteri(O.TEXTURE_CUBE_MAP,O.TEXTURE_MIN_FILTER,O.LINEAR),O.texImage2D(O.TEXTURE_CUBE_MAP_POSITIVE_X+0,0,O.RGBA,O.RGBA,O.UNSIGNED_BYTE,x),O.texImage2D(O.TEXTURE_CUBE_MAP_POSITIVE_X+1,0,O.RGBA,O.RGBA,O.UNSIGNED_BYTE,x),O.texImage2D(O.TEXTURE_CUBE_MAP_POSITIVE_X+2,0,O.RGBA,O.RGBA,O.UNSIGNED_BYTE,x),O.texImage2D(O.TEXTURE_CUBE_MAP_POSITIVE_X+3,0,O.RGBA,O.RGBA,O.UNSIGNED_BYTE,x),O.texImage2D(O.TEXTURE_CUBE_MAP_POSITIVE_X+4,0,O.RGBA,O.RGBA,O.UNSIGNED_BYTE,x),O.texImage2D(O.TEXTURE_CUBE_MAP_POSITIVE_X+5,0,O.RGBA,O.RGBA,O.UNSIGNED_BYTE,x),O.bindTexture(O.TEXTURE_CUBE_MAP,O._emptyCubeTexture),H._lastLegacyImage=t}}},h.prototype.setEnvmapLegacy=function(M){M.uEnvMap=this._envmapLegacy},h.prototype.onBeforeRenderNew=function(x){this.assureTextureNew(x),this.resetUniformCache()},h.prototype.assureTextureNew=function(N){var o=this,J=o.gv,E=J.getEnvmap(),i=o._envmapHash,X=o._envmaps,L=N._renderInfo.frame;if(!(this._lastCaptureFrame>=L||J._picking))for(var e in E){var A,Y=E[e],x=Y.type;switch(x){case"sphere":A=Y.image,A!==i[e]&&(lp=F.getImage(A),lp&&(i[e]=A,M(X,e,o.fromEquirectangular(A))));break;case"cube":var c=Y.images;if(c&&6===c.length&&(A=c.join(","),A!==i[e])){for(var k=!0,f=0;6>f;f++)if(!F.getImage(c[f])){k=!1;break}k&&(i[e]=A,M(X,e,o.fromCubemap(c)))}break;case"skybox":var j=J.getSkybox();if(j){var K=j.s("shape3d");if(A="sphere"===K?j._id+"_"+j.s("shape3d.image"):j._id+"_"+j.s("front.image"),A!==i[e]){var k;if("sphere"===K)k=F.getImage(j.s("shape3d.image"));else{k=!0;for(var t=["front","back","left","right","top","bottom"],f=0;6>f;f++)if(!F.getImage(j.s(t[f]+".image"))){k=!1;break}}k&&(i[e]=A,M(X,e,o.fromSkybox()))}}break;case"probe":var n=Y.pos,I=Y.size;if(A=n[0]+"_"+n[1]+"_"+n[2]+"_"+I,A!==i[e]){var m=this._probeCaptureTime[A],T=Date.now();m||(this._probeCaptureTime[A]=m=T),T-m>F.envmapProbeMinWaitTime&&!lq&&!Or||T-m>F.envmapProbeMaxWaitTime?(delete this._probeCaptureTime[A],i[e]=A,M(X,e,o.fromSceneProbe(n,I,Y.filter))):J.iv()}}}},h.prototype.resetUniformCache=function(){this._frameUniformCache={}},h.prototype.setEnvmap=function(W,c){var d=W.uuid,E=this._frameUniformCache,T=this._envmaps[c];T&&(T=T.texture),E[d]!==T&&(E[d]=T,W.uEnvMap=T)},h.prototype.fromEquirectangular=function(V){var _=y.Default.getImage(V);return this.rectSize=[1/_.width,1/_.height],V=this.gv.getTexture(V),this.fromTexture(V)},h.prototype.fromCubemap=function(A){var t=this.gv.getGL(),h=t.createTexture();t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_CUBE_MAP,h),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(var J=[],Q=g/3,P=0;6>P;P++)J[P]=F.resizeImage(y.Default.getImage(A[P]),Q);return t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+0,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,J[0]),t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+1,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,J[1]),t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+2,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,J[2]),t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+3,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,J[3]),t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+4,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,J[4]),t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+5,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,J[5]),t.bindTexture(t.TEXTURE_CUBE_MAP,t._emptyCubeTexture),this.fromTexture(h,!0)},h.prototype.fromTexture=function(N,u){var o=this._allocateTargets();this._pingPongRenderTarget||(this._pingPongRenderTarget=this._allocateTargets());var W=this.gv,G=W.getGL(),p=dk.for(G).directState(),y=p.depth.enabled;p.scissor.enabled=!0,p.depth.enabled=!1;var $=W.getViewport(G);return this._textureToCubeUV(N,o,u),this._applyPMREM(o),o.unbind(G),W.setViewport(G,$[0],$[1],$[2],$[3]),p.depth.enabled=y,p.scissor.enabled=!1,o},h.prototype.fromSkybox=function(){return this._fromCamera(function(g){g.s({"camera.onlySky":!0})})},h.prototype.fromScene=function(K){return this._fromCamera(function(w){w.s({"camera.onlySky":!1}),K&&K(w)})},h.prototype.fromNode=function(m){var c=this.gv.getData3dUI(m),N=c._42;c._42=rp;var e=this.gv.getSkybox(),K=m.p3();if(e){var z=e.p3();e.p3(K)}var C=this.fromScene(function(f){f.p3(K)});return c._42=N,e&&e.p3(z),C},h.prototype.fromSceneProbe=function(E,i,R){var k=this.gv,F=k.getSkybox();if(F){var X=F.p3();F.p3(E)}if(R){var Y=k.isVisible;k.isVisible=function(J){var v=R(J);return v!==I?v:Y.call(k,J)}}var H=this.fromScene(function(A){A.p3(E),A.s("camera.near",i)});return R&&(k.isVisible=Y),F&&F.p3(X),H},h.prototype._fromCamera=function(T){var f=this.gv,d=f.getCamera();T&&T(d);var Q=new Os(f,g,g,{cube:!0}),X=f.getGL(),x=f.getViewport(X),e=this.setEnvmapByProbeId,b=this.onBeforeRender;this.setEnvmapByProbeId=function(y){y.envMap=X._emptyTexture},this.onBeforeRender=rp,d.attachRenderTarget(Q),d.render(f),d.detachRenderTarget(),this.setEnvmapByProbeId=e,this.onBeforeRender=b,f.setViewport(X,x[0],x[1],x[2],x[3]);var G=this.fromTexture(Q.texture,!0);return Q.releaseTexture(),G},h.prototype._allocateTargets=function(){return new Os(this.gv,3*k,3*k,{magFilter:sm.NEAREST,minFilter:sm.NEAREST})},h.prototype._textureToCubeUV=function(S,w,b){var v,t=this.gv;b?null==(v=this._cubemapShader)&&(this._cubemapShader=v=this.createShader(r())):null==(v=this._equirectShader)&&(this._equirectShader=v=this.createShader(j()));var z=t.getGL();w.bind(z),this._setViewport(w,0,0,3*k,2*k);var $=t.getRenderState();$.useProgram(v);var p=$.directUniforms(),H=$.directAttribs();p.envMap=S,b||(p.texelSize=this.rectSize);var Q=J[0];H.position=Ch(z,null,Q.vs,N,3),H.uv=Ch(z,null,Q.uv,N,2),H.faceIndex=Ch(z,null,Q.faceIs,N,1),fj(z,0,Q.vs.length/3)},h.prototype._applyPMREM=function(x){for(var B,u,M,B=1;U>B;B++)u=Math.sqrt(H[B]*H[B]-H[B-1]*H[B-1]),M=e[(B-1)%e.length],this._blur(x,B-1,B,u,M)},h.prototype._setViewport=function(s,B,j,h,M){var P=this.gv;P.setViewport(P.getGL(),B,j,h,M),P.getRenderState().directState().scissor.box=[B,j,h,M]},h.prototype._blur=function(Z,x,I,v,g){var e=this._pingPongRenderTarget;this._halfBlur(Z,e,x,I,v,"latitudinal",g),this._halfBlur(e,Z,I,I,v,"longitudinal",g)},h.prototype.createShader=function(B){var x=this.gv;return x.getPostProcessing().createShader(x.getGL(),B).program},h.prototype._halfBlur=function(z,j,x,o,V,v,a){var S=this.gv,w=this._blurMaterial;if("latitudinal"===v||"longitudinal"===v){w||(this._blurMaterial=w=this.createShader(d(m)));var O=S.getGL();j.bind(O);var T=3,h=S.getRenderState();h.useProgram(w);var X,Q,G,C=h.directUniforms(),r=h.directAttribs(),e=E[x]-1,$=isFinite(V)?Math.PI/(2*e):2*Math.PI/(2*m-1),g=V/$,R=isFinite(V)?1+Math.floor(T*g):m,F=[],s=0;for(X=0;m>X;++X)Q=X/g,G=Math.exp(-Q*Q/2),F.push(G),0==X?s+=G:R>X&&(s+=2*G);for(X=0;X<F.length;X++)F[X]=F[X]/s;C.envMap=z.texture,C.samples=R,C.weights=F,C.latitudinal="latitudinal"===v,a&&(C.poleAxis=a),C.dTheta=$,C.mipInt=L-x;var B=E[o],Q=3*Math.max(0,k-2*B),H=(0===o?0:2*k)+2*B*(o>L-i?o-L+i:0);this._setViewport(j,Q,H,3*B,2*B);var _=J[o];r.position=Ch(O,null,_.vs,N,3),r.uv=Ch(O,null,_.uv,N,2),r.faceIndex=Ch(O,null,_.faceIs,N,1),fj(O,0,_.vs.length/3),j.unbind(O)}};var i=4,L=8,k=Math.pow(2,L),v=[.125,.215,.35,.446,.526,.582],U=L-i+1+v.length,m=20,c=(1+Math.sqrt(5))/2,D=1/c,e=[new Vg(1,1,1),new Vg(-1,1,1),new Vg(1,1,-1),new Vg(-1,1,-1),new Vg(0,c,D),new Vg(0,c,-D),new Vg(D,0,c),new Vg(-D,0,c),new Vg(c,D,0),new Vg(-c,D,0)],o=function(){for(var T=[],Z=[],p=[],u=L,k=0;U>k;k++){var c=Math.pow(2,u);Z.push(c);var Q=1/c;k>L-i?Q=v[k-L+i-1]:0==k&&(Q=0),p.push(Q);for(var M=1/(c-1),w=-M/2,B=1+M/2,q=6,C=[],N=[],m=[],J=0;q>J;J++){var K=2*(J%3)/3-1,j=J>2?0:-1;C.push(K,j,0,K+2/3,j,0,K+2/3,j+1,0,K,j,0,K+2/3,j+1,0,K,j+1,0),N.push(w,w,B,w,B,B,w,w,B,B,w,B),m.push(J,J,J,J,J,J)}T.push({vs:new ub(C),uv:new ub(N),faceIs:new ub(m)}),u>i&&u--}return{_lodPlanes:T,_sizeLods:Z,_sigmas:p}}(),J=o._lodPlanes,E=o._sizeLods,H=o._sigmas,g=F.EnvmapTextureSize}();var Ls=["left","front","right","back","top","bottom"],Ms=Lq._RenderList=function(h){function V(){l.length=0,H.length=0,o={}}function v($){var z,E,g,s,H=$.gv,w=$.data,k=$.shapeModel;if(k){var x,n,W,o=w.s("shape3d.transparent")||w.s("points.transparent");for(hr(k)||(x=Aq(k.transparent,w,H),k=[k]),g=0,s=k.length;s>g;g++)W=k[g],n=Aq(W.transparent,w,H),n===I&&(n=x),n===I&&(n=o),n?E=!0:z=!0}for(g=0,s=Ls.length;s>g;g++){var S=$[Ls[g]];S&&(S.transparent?E=!0:z=!0)}H.isLabelVisible(w)&&($.labelInfo&&(w.s(Yn+".transparent")?E=!0:z=!0),$.label2Info&&(w.s(Fl+".transparent")?E=!0:z=!0)),H.isNoteVisible(w)&&($.noteInfo&&(w.s(ci+".transparent")?E=!0:z=!0),$.note2Info&&(w.s(qn+".transparent")?E=!0:z=!0)),$._38o&&(E=z=!0),E||(z=!0),$._renderParams={opaque:z,transparent:E}}function T(P,k){k&&v(P);var u=P.data,J=u._id;if(!o[J]){o[J]=!0;var c=P._renderParams;c&&c.visible!==!1&&(P={ui:P,data:u,z:0,id:J},c.opaque&&l.push(P),c.transparent&&H.push(P))}}function N(d,u){if(H.length>1){for(var p,B,P=[0,0,0,0],C=0,s=H.length;s>C;C++)p=H[C].data,(B=p._position)?(P[0]=B.x,P[1]=p._54O,P[2]=B.y,P[3]=1,mj(P,u),H[C].z=P[2]/P[3]):H[C].z=0;H.sort(d||L)}}function A(n){n?(Dq(Y,B,n,h),Dq(i,C,n,h),Dq(y,O,n,h)):(Y=this.batchModelMap={},B=this.batchIndexMap={},i=this.polylineModelMap={},C=this.polylineIndexMap={},y=this.wireframeModelMap={},O=this.wireframeIndexMap={}),this.markBatchInvalid()}function Q(S){S?Dq(Y,B,S,h):(Y=this.batchModelMap={},B=this.batchIndexMap={}),this.markBatchInvalid()}function w(Q){Q?Dq(i,C,Q,h):(i=this.polylineModelMap={},C=this.polylineIndexMap={}),this.markBatchInvalid()}function x(v){v?Dq(y,O,v,h):(y=this.wireframeModelMap={},O=this.wireframeIndexMap={}),this.markBatchInvalid()}function s(){return this._batchInvalid}function R(){this._batchInvalid=!0}function c(){this._batchInvalid=null}var l=[],H=[],Y={},B={},i={},C={},y={},O={},o={};return{opaque:l,transparent:H,init:V,push:T,batchModelMap:Y,batchIndexMap:B,polylineModelMap:i,polylineIndexMap:C,wireframeModelMap:y,wireframeIndexMap:O,ivBatch:A,ivModelBatch:Q,ivPolylineBatch:w,ivWireframeBatch:x,markBatchInvalid:R,isBatchInvalid:s,onUpdated:c,sort:N}},Ns=Lq._RenderLists=function(h){function u(){for(var r in E)E[r].init()}function G(){for(var z in E)E[z].onUpdated()}function Y(m,P){m=m||"main";var b=E[m];return!b&&P&&(b=E[m]=new Ms(h)),b}function D(M,v){var w=M.data.getRenderLayer(),r=Y(w,!0);r.push(M,v)}function w(u){for(var Z in E)u(E[Z])}var E={};return{init:u,onUpdated:G,get:Y,push:D,each:w,lists:E}},Os=Lq.RenderTarget=function(P,N,s,q){var I,U=this;null!=N&&N.canvas?(I=N,N=s,s=q,q=arguments[4]):I=P.getGL(),q=q||{},q.cube===!!q.cube,q.samples=q.cube?0:Math.min(P._glCapabilities.maxSamples,q.samples&&q.samples>1&&2===P._webGLVersion?q.samples:0),U.options=q,U.uuid=y.Math.generateUUID(),U.gv=P,U.init(P,I,q),U.format=q.format||sm.RGBA,U.generateMipmaps=!!q.generateMipmaps,U.depthInternalFormat=q.depthFormat||I.DEPTH_COMPONENT16,q.samples&&!P._glCapabilities._maxSamplesChecked?U.setSize(I,N||1,s||1):U.setSize(I,N,s)};C.assign(Lq.RenderTarget.prototype,{bind:function($,x){var I=this.options;if(I.autoSize){var f=this.gv,q=f.getDevicePixelRatio(),b=f.getWidth()*q,e=f.getHeight()*q;this.setSize($,b,e)}I.cube?Kp($,this.frame[x]):Kp($,this.options.samples?this._MSAAFbo:this.frame)},unbind:function(I){Fk(I),this.options.samples&&(I.bindFramebuffer(I.READ_FRAMEBUFFER,this._MSAAFbo),I.bindFramebuffer(I.DRAW_FRAMEBUFFER,this.frame),I.blitFramebuffer(0,0,this.width,this.height,0,0,this.width,this.height,I.COLOR_BUFFER_BIT,I.NEAREST),I.bindFramebuffer(I.READ_FRAMEBUFFER,null),I.bindFramebuffer(I.DRAW_FRAMEBUFFER,null))},isCube:function(){return this.options.cube},init:function(W,M,i){var G=this,s=i.samples,S=i.cube,o=G.texture=M.createTexture(),m=S?sm.TEXTURE_CUBE_MAP:sm.TEXTURE_2D;M.activeTexture(M.TEXTURE0),M.bindTexture(m,o),M.texParameteri(m,M.TEXTURE_WRAP_S,i.wrapS||M.CLAMP_TO_EDGE),M.texParameteri(m,M.TEXTURE_WRAP_T,i.wrapT||M.CLAMP_TO_EDGE);var a=s?M.NEAREST:M.LINEAR;if(M.texParameteri(m,M.TEXTURE_MIN_FILTER,i.minFilter||a),M.texParameteri(m,M.TEXTURE_MAG_FILTER,i.magFilter||a),M.bindTexture(m,null),S){G.depth=[],G.frame=[];for(var c=0;6>c;c++)G.depth[c]=M.createRenderbuffer(),G.frame[c]=M.createFramebuffer()}else G.depth=M.createRenderbuffer(),G.frame=M.createFramebuffer();G.assureTexture()},assureTexture:function(){var h=this;h.gv._2Oi(h.uuid,h.texture,"default"),y.Default.setImage(h.uuid,null)},releaseTexture:function(){this.gv.deleteTexture(this.uuid)},setSize:function(Y,i,r){var x=this;if(i=Math.round(i),r=Math.round(r),i&&r&&(x.width!==i||x.height!==r)){x.width=i,x.height=r;var d=Y.RENDERBUFFER,z=Y.FRAMEBUFFER,e=x.options.samples,s=x.options.cube,j=s?sm.TEXTURE_CUBE_MAP:sm.TEXTURE_2D;if(e){var S=x.gv._glCapabilities;if(!S._maxSamplesChecked){for(Y.bindRenderbuffer(d,x.depth),Y.getError();e>1&&(Y.renderbufferStorageMultisample(d,e,x.depthInternalFormat,i,r),Y.getError());)e=Math.floor(e>>1);1>=e&&(e=0,Y.texParameteri(j,Y.TEXTURE_MIN_FILTER,x.options.minFilter||Y.LINEAR),Y.texParameteri(j,Y.TEXTURE_MAG_FILTER,x.options.magFilter||Y.LINEAR),Y.renderbufferStorage(d,x.depthInternalFormat,i,r)),S._maxSamplesChecked=!0,S.maxSamples=x.options.samples=e,Y.bindRenderbuffer(d,N)}}if(e&&(x._MSAAFbo||(x._MSAAFbo=Y.createFramebuffer(),x._MSAARbO=Y.createRenderbuffer()),Y.bindRenderbuffer(d,x._MSAARbO),Y.renderbufferStorageMultisample(Y.RENDERBUFFER,e,Y.RGBA8,i,r),Kp(Y,x._MSAAFbo),Y.framebufferRenderbuffer(z,Y.COLOR_ATTACHMENT0,d,x._MSAARbO),Y.framebufferRenderbuffer(z,Y.DEPTH_ATTACHMENT,d,x.depth),Fk(Y),Y.bindRenderbuffer(d,null)),Y.activeTexture(Y.TEXTURE0),Y.bindTexture(j,x.texture),s)for(var J=Y.TEXTURE_CUBE_MAP_POSITIVE_X,w=0;6>w;w++)x.setupFrameBufferTextureAndDepth(Y,x.frame[w],x.depth[w],J+w);else x.setupFrameBufferTextureAndDepth(Y,x.frame,x.depth,Y.TEXTURE_2D);if(x.generateMipmaps&&(2===gv._webGLVersion||fl.isPOT(i)&&fl.isPOT(r))){Y.generateMipmap(j);var n=x.options.minFilter||(e?Y.NEAREST:Y.LINEAR);Y.texParameteri(j,Y.TEXTURE_MIN_FILTER,n===Y.NEAREST?Y.NEAREST_MIPMAP_NEAREST:Y.LINEAR_MIPMAP_LINEAR)}Y.bindTexture(j,null)}},setupFrameBufferTextureAndDepth:function(r,x,$,m){var u=this,h=u.format;r.texImage2D(m,0,h,this.width,this.height,0,h,r.UNSIGNED_BYTE,null),Kp(r,x),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,m,u.texture,0),this.setupRenderBufferStorage(r,$),Fk(r)},setupRenderBufferStorage:function(C,A){var s=this,K=C.RENDERBUFFER;C.bindRenderbuffer(K,A);var E=s.options.samples;E?C.renderbufferStorageMultisample(K,E,s.depthInternalFormat,s.width,s.height):(C.renderbufferStorage(K,s.depthInternalFormat,s.width,s.height),C.framebufferRenderbuffer(C.FRAMEBUFFER,C.DEPTH_ATTACHMENT,K,A)),C.bindRenderbuffer(C.RENDERBUFFER,null)},toCanvas:function(){var a=this,C=a.gv.getGL();Kp(C,a.frame);var I=a.width,j=a.height,h=new Uint8Array(4*I*j);C.readPixels(0,0,I,j,a.format,C.UNSIGNED_BYTE,h),Fk(C);var t=H.createElement("canvas");t.width=I,t.height=j;var q=t.getContext("2d"),A=q.createImageData(I,j);return A.data.set(h),q.putImageData(A,0,0),t}});var Ps=Lq.Interactor=function(G){this.gv=this.g3d=G};hd("Interactor",C,{ms_listener:1,getView:function(){return this.gv.getView()},setUp:function(){this.addListeners()},tearDown:function(){this.removeListeners()},fi:function(v){this.gv.fi(v)},startDragging:function(Y){Gp(this,Y)}});var Qs=Lq.DefaultInteractor=function(o){Iq(Qs,this,[o])};hd("DefaultInteractor",Ps,{getState:function(){return this._62O},setState:function(N){this._62O=N},getDataInfoAt:function(g,M){var r=this.gv,Z=r.getDataInfoAt(g);if(!r.isBlockSelectable()||!Z||!Z.data)return Z;if(!M&&r.isSelected(Z.data))return Z;for(var $=Z.data;($=$.getParent())&&$ instanceof y.Block&&r.isSelectable($);){var J=r.isSelected($);if(J&&M)break;if(Z={data:$,part:Z.part},J&&!M)break}return Z},handle_contextmenu:function(m){vr(m)},handle_mousewheel:function(y){this.gv.handleScroll(y,y.wheelDelta/40)},handle_DOMMouseScroll:function(Z){2===Z.axis&&this.gv.handleScroll(Z,-Z.detail)},handle_keydown:function(c){this.gv.handleKeyDown(c)},handle_mousedown:function(y){this.handle_touchstart(y)},handle_touchstart:function(q){vr(q);var R=this,_=R.gv,f=bs(q),h=R.getDataInfoAt(q),y=h?h.data:N,G=h?h.part:N,T=_.sm(),M=Dh(q),O=hm(q);_.setFocus(q)&&(R._62O=N,R._57I=N,R.pendingClickThrough=N,R.__lastClientPoint__=oc(q),y?Og(q)?T.co(y)?T.rs(y):T.as(y):T.co(y)?y instanceof Jc&&y.isClickThroughEnabled()&&bs(q)&&(R.pendingClickThrough=oc(q)):T.ss(y):f&&(Og(q)?_.isRectSelectable()&&(R._62O=Sf):R._57I=oc(q)),R._31Q&&(Vm(R._31Q),delete R._31Q,delete R._32Q),R._62O||(_.isFirstPersonMode()&&(oo(q)||gd(q)||O>2?R._62O="pan":_.isMouseRoamable()||Qm(q)?(R._62O="roaming",R.foward=M&&bs(q),R._32Q=Hd(),R._31Q=hh(R.tick,R)):f||(R._62O="roaming")),R._62O||(f&&M&&it[G]?(R._62O=G,R.p3=y.p3()):f&&M&&cl(y)&&_.isSelected(y)?_.isMovable(y)?(R._62O="move",R.p3=y.p3(),R.movedata=y):_._39Q(y)&&(R._62O="none"):Qm(q)&&(O>2?R._62O="pan":2===O&&(R.dist=sl(q),R._62O="pinch")))),R.point=_.lp(q),Gp(R,q),Jd(q)?_.handleDoubleClick(q,y,G):_.handleClick(q,y,G))},tick:function(){var y=this,$=y.gv,X=$._moveStep;y.point&&$.isWalkable()&&(y._32Q&&(X*=(Hd()-y._32Q)/50),$.walk(y.foward?X:-X),y._32Q=Hd(),y._31Q=hh(y.tick,y))},handle_mouseup:function(n){this.handle_touchend(n)},handle_touchend:function(o){var I=this._57I;if(I&&(So(I,oc(o))<=1&&this.gv.sm().cs(),this._57I=N),I=this.pendingClickThrough){if(So(I,oc(o))<=1){var t=this.getDataInfoAt(o);t&&t.data instanceof Jc&&t.data.isClickThroughEnabled()&&(t=this.getDataInfoAt(o,!0),t&&(o.clickThrough=!0,this.gv.sm().ss(t.data)))}this.pendingClickThrough=null}},handleWindowMouseMove:function(A){this.handleWindowTouchMove(A)},handleWindowTouchMove:function(k){var e,V,O=this,X=O.gv,Y=O._62O,w=O.point,K=X.dm(),q=X.lp(k),g=q.x-w.x,L=q.y-w.y,T=X.getWidth(),a=X.getHeight();if(T&&a){var t=oc(k),l=Gq(X,t,O.__lastClientPoint__),C=So({x:0,y:0},l),s=-f*g/T,G=-f*L/a;if("roaming"===Y)O.rotate(k,s/2,G/2);else if(Y===ct||Y===dt||Y===et)X._86O||K.beginTransaction(),X.fi({kind:X._86O?"betweenEditRotation":"beginEditRotation",event:k}),X._86O=1,X.sm().each(function(j){if(cl(j)&&X.isRotationEditable(j)){var h=u(s)>u(G)?s:G;Y===ct?j.setRotationX(j.getRotationX()+h):Y===dt?j.setRotationY(j.getRotationY()+h):Y===et&&j.setRotationZ(j.getRotationZ()+h)}});else if("move"===Y||it[Y]){if(Y===ft||Y===gt||Y===ht)X._87O||K.beginTransaction(),X.fi({kind:X._87O?"betweenEditScale":"beginEditScale",event:k}),X._87O=1;else{if(!X._moving){if(C<F.touchMoveThreshold)return;K.beginTransaction()}X.fi({kind:X._moving?"betweenMove":"beginMove",event:k}),X._moving=1}var Q,D=O.p3,i=X.getPositionInfo(D),N=we(X);Q=Y===_s?"x":Y===at?"y":Y===bt?"z":Y===ft?"sx":Y===gt?"sy":Y===ht?"sz":X.getMoveMode(k,O.movedata),g=g/T*i.width,L=-1*L/a*i.height;var $,y,R=[N[0]*g,N[4]*g,N[8]*g],_=[N[1]*L,N[5]*L,N[9]*L],A=R[0]+_[0],M=R[1]+_[1],b=R[2]+_[2],J=[D[0]+A,D[1]+M,D[2]+b],E=Zo(X.getEye(),J,!0);if("xyz"===Q?($=J,X.moveSelection(A,M,b)):"xz"===Q?($=Rm(X,D,[0,1,0],J),$&&X.moveSelection($[0]-D[0],0,$[2]-D[2])):"xy"===Q?($=Rm(X,D,[0,0,1],J),$&&X.moveSelection($[0]-D[0],$[1]-D[1],0)):"yz"===Q?($=Rm(X,D,[1,0,0],J),$&&X.moveSelection(0,$[1]-D[1],$[2]-D[2])):"x"===Q||"sx"===Q?(E[0]=0,$=Rm(X,D,E,J),$&&(y=$[0]-D[0],"x"===Q?X.moveSelection(y,0,0):X.sm().each(function(P){cl(P)&&X.isSizeEditable(P)&&(e=P.getScaleX()+y/100,V=e/P.getScaleX(),P.setScaleX(e),oo(k)&&(P.setScaleY(P.getScaleY()*V),P.setScaleTall(P.getScaleTall()*V)))}))):"y"===Q||"sy"===Q?(E[1]=0,$=Rm(X,D,E,J),$&&(y=$[1]-D[1],"y"===Q?X.moveSelection(0,y,0):X.sm().each(function(q){cl(q)&&X.isSizeEditable(q)&&(e=q.getScaleTall()+y/100,V=e/q.getScaleTall(),q.setScaleTall(e),oo(k)&&(q.setScaleY(q.getScaleY()*V),q.setScaleX(q.getScaleX()*V)))}))):("z"===Q||"sz"===Q)&&(E[2]=0,$=Rm(X,D,E,J),$&&(y=$[2]-D[2],"z"===Q?X.moveSelection(0,0,y):X.sm().each(function(S){cl(S)&&X.isSizeEditable(S)&&(e=S.getScaleY()+y/100,V=e/S.getScaleY(),S.setScaleY(e),oo(k)&&(S.setScaleX(S.getScaleX()*V),S.setScaleTall(S.getScaleTall()*V)))}))),!$)return;O.p3=$}else if(Y===Sf){var p=O.div;p||(p=O.div=jg(),Em(O.getView(),p),p.op=w,p.style.background=X.getRectSelectBackground()),X.fi({kind:X._rectSelecting?"betweenRectSelect":"beginRectSelect",event:k}),X._rectSelecting=1,p.rect=Jf(p.op,q),Xd(p,p.rect)}else if("pinch"===Y&&2===hm(k)){X.fi({kind:X._pinching?"betweenPinch":"beginPinch",event:k}),X._pinching=1;var y=sl(k);X._lastZoomLP||(X._lastZoomLP=As(k)),X.handlePinch(y,O.dist),O.dist=y}else"pan"===Y||oo(k)||gd(k)?O.pan(k,g,L):"none"===Y||X.isFirstPersonMode()||O.rotate(k,s,G);O.point=q}},pan:function(i,k,Q){var N=this.gv;if(N.isPannable()){var G=N.getWidth(),r=N.getHeight();if(!G||!r)return;var W=N.getCenterInfo(),o=k/G*W.width,I=-1*Q/r*W.height;N.fi({kind:N._panning?"betweenPan":"beginPan",event:i}),N._panning=1,N.pan(-o,-I)}},rotate:function(D,e,a){var t=this.gv;t.isRotatable()&&(t.fi({kind:t._rotating?"betweenRotate":"beginRotate",event:D}),t._rotating=1,t.rotate(e,a))},handleWindowMouseUp:function(J){this.handleWindowTouchEnd(J)},handleWindowTouchEnd:function(n){var x=this,C=x.gv,u=C.dm(),e=x.div;if(e){var k=C.getDatasInRect(e.rect);if(!k.isEmpty()){var E=C.sm(),s=E.toSelection(),z=oo(n),M=n.altKey;k.each(function(U){E.co(U)?(!z||z&&M)&&s.remove(U):(!M||z&&M)&&s.add(U)}),E.ss(s)}Yf(e)}C._moving&&(delete C._moving,C.fi({kind:"endMove",event:n}),C.onMoveEnded(),u.endTransaction()),C._panning&&(delete C._panning,C.fi({kind:"endPan",event:n}),C.onPanEnded()),C._rotating&&(delete C._rotating,C.fi({kind:"endRotate",event:n}),C.onRotateEnded()),C._86O&&(delete C._86O,C.fi({kind:"endEditRotation",event:n}),u.endTransaction()),C._87O&&(delete C._87O,C.fi({kind:"endEditScale",event:n}),u.endTransaction()),C._pinching&&(delete C._pinching,C.fi({kind:"endPinch",event:n}),C.onPinchEnded()),C._rectSelecting&&(delete C._rectSelecting,C.fi({kind:"endRectSelect",event:n}),C.onRectSelectEnded()),C._walking&&(delete C._walking,C.fi({kind:"endWalk",event:n}),C.onWalkEnded()),C._lastZoomLP=C._lastZoomHit=null,x.dist=x.point=x._62O=x.p3=x.movedata=x.div=x._57I=x.pendingClickThrough=x._32Q=x._31Q=x.foward=N,x.__lastClientPoint__=N}});var Rs=Lq.MapInteractor=function(i){Iq(Rs,this,[i]),this._keepHorizon=!0,this._threshold=2,this._touchScaleThreshold=.05,this._touchRotateThreshold=.03,this._touchScaleCheckAccuracy=.01,this._panButton="right",this._minPhi=0,this._maxPhi=5*Math.PI/12};hd("MapInteractor",Ps,{setUp:function(){Rs.superClass.setUp.call(this);var k=this.gv;this.__oldMinPhi__=k.getRotateMinPhi(),this.__oldMaxPhi__=k.getRotateMaxPhi(),k.setRotateMinPhi(this._minPhi),k.setRotateMaxPhi(this._maxPhi)},tearDown:function(){Rs.superClass.tearDown.call(this);var D=this.gv;D.setRotateMinPhi(this.__oldMinPhi__),D.setRotateMaxPhi(this.__oldMaxPhi__),delete this.__oldMinPhi__,delete this.__oldMaxPhi__},handle_contextmenu:function(Q){vr(Q)},handle_mousewheel:function(R){this.gv.handleScroll(R,R.wheelDelta/40)},handle_DOMMouseScroll:function(r){2===r.axis&&this.gv.handleScroll(r,-r.detail)},handle_keydown:function(V){this.gv.handleKeyDown(V)},handle_mousedown:function(V){this.handle_touchstart(V)},handle_touchstart:function(X){vr(X);var Q=this,W=Q.gv;if(W.setFocus(X)){var k=W.getDataInfoAt(X),x=k?k.data:N,V=k?k.part:N;Q.__lastClientPoint__=oc(X);var v=Q.editing={point:W.lp(X),data:x,part:V};Qm(X)?v.touch=!0:(v.touch=!1,v.clickLeft=bs(X),v.pan=gd(X)?!0:"left"===this.panButton===v.clickLeft),x&&W._39Q(x)&&(v.preventDefault=!0),Gp(Q,X),Jd(X)?W.handleDoubleClick(X,x,V):W.handleClick(X,x,V)}},handle_mouseup:function(b){this.handle_touchend(b)},handle_touchend:function(){},handleWindowMouseMove:function(N){this.handleWindowTouchMove(N)},handleWindowTouchMove:function(X){var s=this,m=s.gv,J=s.editing;if(J){var g=m.lp(X),R=J.point,d=g.x-R.x,O=g.y-R.y;if(!J.moved){if(Math.abs(d)<s.threshold&&Math.abs(O)<s.threshold&&!(X.touches&&X.touches.length>1))return;J.moved=!0}if(!J.preventDefault){J.point=g;var q=J.part;if(it[q]){var H=J.data,I=m.dm(),L=m.getWidth(),n=m.getHeight(),A=-f*d/L,v=-f*O/n;if(q===ct||q===dt||q===et){m._86O||I.beginTransaction(),m.fi({kind:m._86O?"betweenEditRotation":"beginEditRotation",event:X}),m._86O=1;var w=u(A)>u(v)?A:v;m.sm().each(function(o){cl(o)&&m.isRotationEditable(o)&&(q===ct?o.setRotationX(o.getRotationX()+w):q===dt?o.setRotationY(o.getRotationY()+w):q===et&&o.setRotationZ(o.getRotationZ()+w))})}else{var P=H.p3(),B=m.getPositionInfo(P);d=d/L*B.width,O=-1*O/n*B.height;var U,p=we(m),Y=[p[0]*d,p[4]*d,p[8]*d],Z=[p[1]*O,p[5]*O,p[9]*O],E=Y[0]+Z[0],D=Y[1]+Z[1],t=Y[2]+Z[2],y=[P[0]+E,P[1]+D,P[2]+t],M=Zo(m.getEye(),y,!0);if(q===ft||q===gt||q===ht){if(m._87O||I.beginTransaction(),m.fi({kind:m._87O?"betweenEditScale":"beginEditScale",event:X}),m._87O=1,U=Rm(m,P,M,y)){var K,a=0,V=["X","Y","Tall"];q===ft?K="X":q===gt?(K="Tall",a=1):q===ht&&(K="Y",a=2),V.splice(V.indexOf(K),1);var W=oo(X),$=(U[a]-P[a])/100;m.sm().each(function(H){if(cl(H)&&m.isSizeEditable(H)){var Y=H["getScale"+K](),R=Y+$;if(H["setScale"+K](R),W){var o=R/Y;V.forEach(function(r){H["setScale"+r](H["getScale"+r]()*o)})}}})}}else if(q===_s||q===at||q===bt){if(!m._moving){var k=oc(X),z=Gq(m,k,s.__lastClientPoint__),c=So({x:0,y:0},z);if(c<F.touchMoveThreshold)return;I.beginTransaction()}m.fi({kind:m._moving?"betweenMove":"beginMove",event:X}),m._moving=1;var a=0;if(q===_s?a=0:q===at?a=1:q===bt&&(a=2),M[a]=0,U=Rm(m,P,M,y)){var $=U[a]-P[a],S=[0,0,0];S[a]=$,m.moveSelection.apply(m,S)}}}}else if(J.touch){var _=X.touches.length;if(2!==_)s.pan(X,d,O);else{if(1>=_)return;var l=X.touches,h={x:l[0].clientX,y:l[0].clientY},i={x:l[1].clientX,y:l[1].clientY},r={x:i.x-h.x,y:i.y-h.y},x=J.lastCenter,C=Math.atan2(r.y,r.x),Q=J.theta,j=0;Q==N?Q=J.theta=C:(j=C-Q,J.thetaStarted||Math.abs(j)>s.touchRotateThreshold?(J.thetaStarted=!0,J.theta=C):j=0);var b=G*(h.y+i.y)/2/m.getHeight(),e=J.phi,T=0;e==N?e=J.phi=b:(T=b-e,J.phiStarted||Math.abs(T)>s.touchRotateThreshold?(J.phiStarted=!0,J.phi=b):T=0);var o,Xq=Math.sqrt(r.x*r.x+r.y*r.y),Wk=J.vlen;if(Wk){var Li=h.x-x.x,Ej=h.y-x.y,ir=i.x-x.x,wl=i.y-x.y,Yh=Math.sqrt(Li*Li+Ej*Ej),oj=Math.sqrt(ir*ir+wl*wl),Ke=Wk/2,tb=s._sign2(Yh-Ke),bo=s._sign2(oj-Ke);0>tb*bo||0===tb&&0===bo?(o=1,J.vlen=Xq):(o||(o=Xq/Wk),J.scaleStarted||Math.abs(o-1)>s.touchScaleThreshold?(J.vlen=Xq,J.scaleStarted=!0):o=1)}else Wk=J.vlen=Xq,o=1;1!==o&&m.setZoom(o),(T||j)&&s.rotate(X,j,-T),J.lastCenter={x:(i.x+h.x)/2,y:(i.y+h.y)/2}}}else if(J.pan)s.pan(X,d,O);else{var L=m.getWidth(),n=m.getHeight();
if(!L||!n)return;var A=-f*d/L,v=-f*O/n;s.rotate(X,A,v)}}}},_sign2:function(e){return Math.abs(e)<this._touchScaleCheckAccuracy?0:e>0?1:-1},handleWindowMouseUp:function(b){this.handleWindowTouchEnd(b)},getDataInfoAt:function(M,v){var m=this.gv,K=m.getDataInfoAt(M);if(!m.isBlockSelectable()||!K||!K.data)return K;if(!v&&m.isSelected(K.data))return K;for(var k=K.data,j=K.part;(k=k.getParent())&&k instanceof y.Block&&m.isSelectable(k);){var f=m.isSelected(k);if(f&&v)break;if(K={data:k,part:j},f&&!v)break}return K},handleWindowTouchEnd:function(K){var i=this,P=i.editing;if(i.editing=null,P){var R=i.gv;if(P.moved||!P.clickLeft&&!P.touch)R._panning=null,R._rotating=null,R.fi({kind:P.pan?"endPan":"endRotate",event:K});else{var W=i.getDataInfoAt(K),$=W&&W.data;$ instanceof Jc&&$.isClickThroughEnabled()&&(W=i.getDataInfoAt(K,!0),W&&($=W.data)),$?R.sm().setSelection([$]):R.sm().clearSelection()}var S=R.dm();R._moving&&(delete R._moving,R.fi({kind:"endMove",event:K}),R.onMoveEnded(),S.endTransaction()),R._86O&&(delete R._86O,R.fi({kind:"endEditRotation",event:K}),S.endTransaction()),R._87O&&(delete R._87O,R.fi({kind:"endEditScale",event:K}),S.endTransaction())}},pan:function(S,d,G){var b=this,X=b.gv;if(X.isPannable()){var r=X.getWidth(),c=X.getHeight();if(r&&c){var t=X.getCenterInfo(),u=-d/r*t.width,x=1*G/c*t.height;X.fi({kind:X._panning?"betweenPan":"beginPan",event:S}),X._panning=1;var Q=b.keepHorizon,g=b.editing.touch;if((g&&S.touches&&S.touches.length>1||!g&&oo(S))&&(Q=!Q),!Q)return X.pan(u,x);if(u||x){var f=we(X),A=[f[0]*u,f[4]*u,f[8]*u],C=[f[1],0,f[9]],$=Math.sqrt(C[0]*C[0]+C[2]*C[2]);$&&(C=[C[0]/$*x,0,C[2]/$*x]);var e=A[0]+C[0],F=A[1]+C[1],V=A[2]+C[2],L=X._center,p=X._eye;L[0]+=e,L[1]+=F,L[2]+=V,p[0]+=e,p[1]+=F,p[2]+=V,X.fp(_d,N,p),X.fp(lo,N,L)}}}},rotate:function(V,E,x){var a=this,Y=a.gv;if(Y.isRotatable()){var m=Y._center,P=Y._eye,J=Zo(P,m),z=ge(U(J[0]*J[0]+J[2]*J[2]),J[1]),_=jb(Y,z+x);x=_-z,Y.fi({kind:Y._rotating?"betweenRotate":"beginRotate",event:V}),Y._rotating=1,Y.rotate(E,x)}}}),C.defineProperties(Rs.prototype,{panButton:{get:function(){return this._panButton},set:function(P){this._panButton=P}},minPhi:{get:function(){return this._minPhi},set:function(W){this.gv.setRotateMinPhi(this._minPhi=W)}},maxPhi:{get:function(){return this._maxPhi},set:function(L){this.gv.setRotateMaxPhi(this._maxPhi=L)}},keepHorizon:{get:function(){return this._keepHorizon},set:function(T){this._keepHorizon=T}},threshold:{get:function(){return this._threshold},set:function(t){this._threshold=t}},touchScaleThreshold:{get:function(){return this._touchScaleThreshold},set:function(n){this._touchScaleThreshold=n}},touchRotateThreshold:{get:function(){return this._touchRotateThreshold},set:function(Z){this._touchRotateThreshold=Z}}});var Ss,Ts="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAEyUlEQVRYR62XW0xcVRSG/58cmIG2HmstE9N4SX2xtVqBCISoFS/RmDSpKQSvTWNixUStQSqVyBQYJUGttrQVtYkPatuQPmhivMUHqbUBZ2itl1qjTzZpImNUZhDLsUeWWXgOOd2cgcGyk3mYs/de69trr70uxP8YIlJKMi0i9wIgyf0iEiM5PFdxzGeDiBQAuB7AjQBuALCN5NcGQDmANgBfeL8UyYnZ5M8KICJ3AXgAwAlfOMl/VHAQwPtveYAKuQLA2yQ/ngliRgAR2QogA2AvSdcUZAIE50VEYR4BsIDkC7kgQgFE5GIAuwDsJnkk1+aZAPw9IqLX1gjgcZK/m7KmAXjK4wBaSf4ZplxEIgCuA3Cz3gSAfgDHSf6dY/0FAJ4D0G5ChAEcAPBwmHIRqXNd90nLsiocx/k+k8n8oK/Atu2rIpHIStd1v7QsawfJd0Ouywawh6T609Q4B8C788NhZnddt29sbGxBd3f39q6urtNhJ43H48uam5u3lJSUjFiWdV8IxE0Aqki+6M9NAXjefjnJXsOZogBGBgYGttbU1Hw427PS+cHBwbVVVVUJAItJOoa8xwD8RPIT/T4J4L3zfQAeNL1dRMZra2ur+/v7/8pHub+mvr7+wr6+vs8KCgoWGABFAN4EsEHjhA9QBeA2ks8HF6vZk8nkQL4nNwGTyeTa8vLycsuy7jcg1Mk/IpnyAZoBaOQ6FHg+ddlsdqNt201zObm5NpvN7ly0aNHrJN8LyL4FwGqSr/gAOrnej3C60HXdw/F4PJ7L4fKFSiQSl7W0tLQVFRWtCQDoNRwguZ6aWABcorE9sEDf+QjJ1fkqmmmdiHwHoCToXyKiceR0rkhY5TjOq9FoVLPdeY/x8fG+SCSySe/cFKYWCFOyPJ1Or4zFYh3nrR3A8PBwe2lp6TcAfg4DmBYwAFyRTqdXxWKx9nkE+DYUIEyBiFQ6jvNaNBq9Zz4AZruCGIBlJI8ZXpolee18AORwwgoAp/xnqMmjPuilZ8+ePZRIJNo7OztD436+YB0dHZe2trY+W1hYWGsccD/JOh/gKQBHSWpanRwicnc2m91k2/bmfJWFrRsdHd29cOHCXSTfD8i+FcA1JHcEQ/HtJDVnTw3XdfcPDQ0dra6unto8F5hUKrWurKxslWVZG4L7RGQbgA9IDgWT0VsANprJaGJi4kxDQ8OagwcPjsxFeWNj49Le3l6N91qMTA2vmNnr6fovGXkmvxPAlST3hGz4LZVKbausrMzLEnryioqKNpJLzCpJRJ4AcJLkp6rHLEieBjBA8rB5Wtd1942NjS3p6el5qa2t7VSYNdThmpqaWoqLi38xze4dUku4CpLb/f1hJZnWBY+SzJpKRGSdV5LVOI5zIpPJnNQ1tm2viEQiV7uue8SyrJeDDhew8GIAO0me4w9hABdp8ahNBkktyacNr+Qu84pSndfX81VY6e6dXJV3AoiT/CMoMFcyUogeAG+Q/DyX8+VZlqvZHwKw2VQ+zQdCTL4FwBkPZFrJPUtjoildG5PC4J2bOvJpze7QWhHAj4HWbBImpDXTQsPvH5cDeMf39lxWnBXAU6TNqcZu7fn0lyB53GhOdf6ZQHN6bF6a0xxOuJTkrwbA5LdcJ831/V8SOUYQxYGhRwAAAABJRU5ErkJggg==",Us=32,Vs=Lq.GlobeInteractor=function(G,w){Iq(Vs,this,[G]);var j,o=w.radius||6378137,k=this,n=null;Ss||(Ss=jg(),Ss.style.border="",Ss.style.backgroundImage="url("+Ts+")");var R=new $i,$=new Vg,I=new Vg,z=new Vg,a=new lk,d="number"==typeof o?{x:o,y:o,z:o}:o,v={center:new Vg(0,0,0),radius:d},t=function(W){G._81O=null;var N=G.getHitPosition(W,G.getCenter(),$.copy(G.getEye()).sub(I.copy(G.getCenter())).toArray());return a.origin.copy(G.getEye()),a.direction.copy(N).sub(a.origin).normalize(),a.intersectEllipsoid(v)},B=function(Y,h){G._81O=null,a.origin.copy(G.getEye());for(var V,w,C=G.getCenter(),B=$.copy(G.getEye()).sub(I.copy(G.getCenter())).toArray(),b=1,N=16,U=0,M=1,E={x:0,y:0};N--;){if(E.x=h.x+(Y.x-h.x)*b,E.y=h.y+(Y.y-h.y)*b,V=G.getHitPosition(E,C,B),a.direction.copy(V).sub(a.origin).normalize(),w=a.intersectEllipsoid(v),w&&1===b)return{hit:w};w?U=b:M=b,b=(U+M)/2}return{hit:w,out:1>b}},Q=function(f,t){if(n){var x=Date.now();n.deltaTime=n.lastTime?x-n.lastTime:1e3,n.lastTime=x,n.lastAxis=f,n.lastAngle=t}t&&(R.setFromAxisAngle(f,t),G.setEye($.copy(G.getEye()).applyQuaternion(R).toArray()),G.setCenter($.copy(G.getCenter()).applyQuaternion(R).toArray()),G.setUp($.copy(G.getUp()).applyQuaternion(R).toArray()))};k._showCrossIcon=function(j){Em(k.getView(),Ss),Xd(Ss,{x:j.clientX-Us/2,y:j.clientY-Us/2,width:Us,height:Us})},k._hideCrossIcon=function(){Yf(Ss)},k._scrollImpl=function(r,P){n={point:G.lp(r),screen:oc(r),hit:t(r),type:"right"},n.hitNormalize=n.hit?n.hit.clone().normalize():new Vg;var H={clientX:n.screen.x,clientY:n.screen.y+10*P};k._handleMoveImpl(H),k._endMoveImpl(H)},k._startMoveImpl=function(z){j&&(j.stop(!0),j=null),n={point:G.lp(z),screen:oc(z),hit:t(z)},n.hitNormalize=n.hit?n.hit.clone().normalize():new Vg,Qm(z)?1===z.touches.length?n.hit&&(n.type="left"):2===z.touches.length&&(n.type="touch2"):(bs(z)?n.hit&&(n.type="left"):nl(z)?n.type="right":gd(z)&&n.hit&&(n.type="middle"),!n.hit||"right"!==n.type&&"middle"!==n.type||k._showCrossIcon(z)),n.type&&Gp(k,z)},k._handleMoveImpl=function(s){if(n)switch(n.type){case"left":return k._handleLeft(s);case"right":return k._handleRight(s);case"middle":return k._handleMiddle(s);case"touch2":return k._handleTouch2(s)}},k._endMoveImpl=function(){if(n){if(this._hideCrossIcon(),"left"===n.type||"middle"===n.type){var _=1e3*(n.lastAngle/(n.deltaTime||30)),z=n.lastAxis,m=n.lastTime,F=function(){var R=Date.now(),T=(R-m)/1e3;return m=R,_*=Math.pow(Math.abs(k.decelerationRate),3*T),Math.abs(_)<.01?(_=0,j&&j.stop(),void 0):(Q(z,_*T),void 0)};j=Pc({action:function(){F(arguments)},duration:5e3})}n=null}},k._handleLeft=function(q){if(!n.finished){var a=oc(q),j=B(a,n.lastScreen||n.screen);if(n.lastScreen=a,!j.hit)return n.finished=!0,k._endMoveImpl(q),void 0;var K=j.hit;K.normalize();var V=n.hitNormalize,I=Math.acos(K.dot(V)),M=K.cross(V).normalize();Q(M,I),j.out&&(n.finished=!0,k._endMoveImpl(q))}},k._handleRight=function(Y){var u=n.lastScreen||n.screen,f=u.y;u=n.lastScreen=oc(Y);var M=u.y,L=M-f;if(L){var m=Math.min(.5,L*k.scaleSpeed);$.copy(G.getEye());var y=n.hit;y||(y=$.clone().divide(d).normalize().multiply(d)),I.copy($).lerp(y,m),G.setEye(I.toArray()),$.copy(G.getUp()),I.normalize();var B=$.clone().cross(I).normalize();if(z.copy(G.getCenter()),z.sub(B.multiplyScalar(z.dot(B))),G.setCenter(z.toArray()),n.hit){var l=t(n.screen),N=n.hitNormalize;if(l){l.normalize();var v=Math.acos(l.dot(N)),S=l.cross(N).normalize();v&&Q(S,v)}}}};var g=function(P){return Math.abs(P)<.01?0:P>0?1:-1};k._handleTouch2=function(V){var d=V.touches.length;if(2===d){var U=V.touches,m={x:U[0].clientX,y:U[0].clientY},D={x:U[1].clientX,y:U[1].clientY},K={x:D.x-m.x,y:D.y-m.y},c=n.lastCenter,O=Math.atan2(K.y,K.x),T=n.theta,P=0;T==N?T=n.theta=O:(P=O-T,n.thetaStarted||Math.abs(P)>.03?(n.thetaStarted=!0,n.theta=O):P=0);var y,p=Math.sqrt(K.x*K.x+K.y*K.y),i=n.vlen;if(i){var u=m.x-c.x,R=m.y-c.y,k=D.x-c.x,s=D.y-c.y,H=Math.sqrt(u*u+R*R),M=Math.sqrt(k*k+s*s),l=i/2,w=g(H-l),C=g(M-l);0>w*C||0===w&&0===C?(y=1,n.vlen=p):(y||(y=p/i),n.scaleStarted||Math.abs(y-1)>.05?(n.vlen=p,n.scaleStarted=!0):y=1)}else i=n.vlen=p,y=1;var K=I.copy(G.getEye()).clone();1!==y&&G.setEye(K.setLength((K.length()-o)/y+o).toArray()),P&&Q(K.normalize(),P),n.lastCenter={x:(D.x+m.x)/2,y:(D.y+m.y)/2}}},k._handleMiddle=function(j){var v=oc(j),c=n.screen;n.screen=v;var h=(v.y-c.y)/180*Math.PI*k.rollSpeed;I.copy(G.getCenter()).sub($.copy(G.getEye())).normalize(),$.copy(G.getUp()).cross(I).normalize(),I.copy(G.getEye()).sub(n.hit).applyAxisAngle($,h).add(n.hit);var U=I.clone();I.copy(G.getCenter()).sub(n.hit).applyAxisAngle($,h).add(n.hit);var o=I.clone(),l=I.copy(G.getUp()).applyAxisAngle($,h).clone(),P=!1;h>0&&(z.copy(l),I.copy(o).sub(U).normalize(),$.copy(U).multiplyScalar(-1).normalize(),$.dot(z)-I.dot(z)>0&&(P=!0)),P||z.copy(n.hit).sub(U).dot(n.hitNormalize)>=0&&(P=!0),P||(G.setEye(U.toArray()),G.setCenter(o.toArray()),G.setUp(l.toArray()));var b=-(v.x-c.x)/180*Math.PI*k.rotateSpeed;Q(n.hitNormalize,b)}};hd("GlobeInteractor",Ps,{handle_contextmenu:function(s){vr(s)},handle_mousewheel:function(J){this._scrollImpl(J,J.wheelDelta/40)},handle_DOMMouseScroll:function(O){2===O.axis&&this._scrollImpl(O,-O.detail)},handle_keydown:function(n){this.gv.handleKeyDown(n)},handle_mousedown:function(Z){this.handle_touchstart(Z)},handle_touchstart:function($){vr($);var Y=this.gv;if(Y.setFocus($)){var A=Y.getDataInfoAt($),u=A?A.data:N;u&&Y.isInteractive(u)||this._startMoveImpl($);var Z=A?A.part:N;Jd($)?Y.handleDoubleClick($,u,Z):Y.handleClick($,u,Z)}},handle_mouseup:function(v){this.handle_touchend(v)},handle_touchend:function(){},handleWindowMouseMove:function(w){this.handleWindowTouchMove(w)},handleWindowTouchMove:function(J){this._handleMoveImpl(J)},handleWindowMouseUp:function(g){this.handleWindowTouchEnd(g)},handleWindowTouchEnd:function(U){this._endMoveImpl(U)}}),C.defineProperties(Vs.prototype,{rotateSpeed:{get:function(){return this._rotateSpeed||.3},set:function(C){this._rotateSpeed=C}},rollSpeed:{get:function(){return this._rollSpeed||.1},set:function(Y){this._rollSpeed=Y}},scaleSpeed:{get:function(){return this._scaleSpeed||.002},set:function(p){this._scaleSpeed=p}},decelerationRate:{get:function(){return this._decelerationRate||.04},set:function(u){this._decelerationRate=u}}});var Ws=function(f){var D=2147483648|f;return[(255&D>>16)/255,(255&D>>8)/255,(255&D)/255,(255&D>>24)/255]},Xs=function(A){this.gv=A,this.gv.pickColorMap={_pickIdUsed:2e3}};ri(Xs,C,{_iv:!0,iv:function(){this._iv=!0},get:function(w,E,O){this.validate();var l=this,r=l.gv.getGL();if(!r)return N;var Z,i,J=l._resolution,S=Math.round(w.x*J),F=Math.ceil(w.width*J),H=Math.ceil(w.height*J),W=l.height-Math.round(w.y*J)-H,p=g(F/2),I=new Uint8Array(4*F*H),a=0,K=I.length,o=E?N:new Ik,c=E?N:{};if(Kp(r,l.frame),r.readPixels(S,W,F,H,r.RGBA,r.UNSIGNED_BYTE,I),Fk(r),E){for(;p>=a;a++)for(var $=p-a,z=p+a,v=$;z>=v;v++)for(var x=$;z>=x;x++)if((v===$||v===z||x===$||x===z)&&(Z=l.info(I,4*(v*F+x)))){if(O&&O(Z)===!1)continue;return Z}}else for(;K>a;a+=4)if(Z=l.info(I,a)){if(O&&O(Z)===!1)continue;i=Z.data,c[i._id]||(o.add(i),c[i._id]=i)}return o},info:function(a,P){return this.gv.pickColorMap[(a[P]<<16)+(a[P+1]<<8)+a[P+2]+((127&a[P+3])<<24)]},getResolution:function(){return this._resolution},onContextLost:function(){this.texture=null,this.width=this.height=-1},validate:function(){var b=this,X=b.gv,w=X.getGL();if(w){var $=b._resolution=X._pickerResolution*X.getDevicePixelRatio(),k=Math.round($*X.getWidth()),e=Math.round($*X.getHeight()),I=w.RGBA,L=w.TEXTURE_2D,B=w.RENDERBUFFER,Z=w.FRAMEBUFFER;if(b.texture||(b.texture=_g(w),b.render=w.createRenderbuffer(),b.frame=w.createFramebuffer()),(b.width!==k||b.height!==e)&&(w.activeTexture(w.TEXTURE0),Qn(w,b.texture),w.texImage2D(L,0,I,k,e,0,I,w.UNSIGNED_BYTE,N),Af(w,w.TEXTURE_MIN_FILTER,w.LINEAR),w.bindRenderbuffer(B,b.render),w.renderbufferStorage(B,w.DEPTH_COMPONENT16,k,e),Kp(w,b.frame),w.framebufferTexture2D(Z,w.COLOR_ATTACHMENT0,L,b.texture,0),w.framebufferRenderbuffer(Z,w.DEPTH_ATTACHMENT,B,b.render),Qn(w,N),w.bindRenderbuffer(B,N),Fk(w),b.width=k,b.height=e),b._iv){b._iv=!1;var x=!1;X._40Q.each(function(N){!x&&N.isBatchInvalid()&&(x=!0)}),x&&X.updateScene(),Kp(w,b.frame),w.clear(w.COLOR_BUFFER_BIT),X.overlappingBox.clear(),X.setViewport(w,0,0,k,e),X.renderPickScene(),Fk(w)}}}});var Ys=function(W){this.gv=W};ri(Ys,C,{gap:0,size:0,_42:function(g,t){var D=this,E=D.gv,v=E._gridGap,K=E._gridSize;if(E._gridVisible){if(D.gap!==v||D.size!==K){for(var P=[],T=E._gridSize/2,e=v*T,q=0;2*T+1>q;q++){var W=6*q,c=6*(2*T+1)+W;P[W]=-e,P[W+1]=0,P[W+2]=-e+q*v,P[W+3]=e,P[W+4]=0,P[W+5]=-e+q*v,P[c]=-e+q*v,P[c+1]=0,P[c+2]=-e,P[c+3]=-e+q*v,P[c+4]=0,P[c+5]=e}D.vs=new ub(P),D.gap=v,D.size=K}dc(E),sq(g),Nd(g);var V=!E._fogDisabled;if(V){var R=dk.for(g).directUniforms();R.uFog=!1}Fe(g,t,1,E._gridColor,E._buffer.vs,D.vs),fj(g,0,D.vs.length/3,g.LINES),V&&(R.uFog=!0),ab(g),Qp(g)}else D.vs=D.gap=D.size=N}});var Zs=function(m){this.gv=m};ri(Zs,C,{_42:function(i,t){var d=this.gv,$=d._buffer.vs,Q=d._axisXColor,y=d._axisYColor,A=d._axisZColor,v=d._originAxisVisible,S=d._centerAxisVisible;if(v||S){var Y=ts?i.TRIANGLES:i.TRIANGLE_FAN,W=i.LINES;if(dc(d),sq(i),Nd(i),v){var c=d.getCenterInfo(),L=J(c.width,c.height)/5,T=.8*L,C=.05*L;Fe(i,t,1.5,Q,$,new ub([0,0,0,L,0,0,T,C,0,T,0,C,T,-C,0,T,0,-C,T,C,0,0,0,0,0,L,0,C,T,0,0,T,C,-C,T,0,0,T,-C,C,T,0,0,0,0,0,0,L,C,0,T,0,C,T,-C,0,T,0,-C,T,C,0,T])),fj(i,0,2,W),fj(i,1,6,Y),Fe(i,t,N,y),fj(i,7,2,W),fj(i,8,6,Y),Fe(i,t,N,A),fj(i,14,2,W),fj(i,15,6,Y)}if(S){var a=d._center,k=a[0],B=a[1],f=a[2],c=d.getPositionInfo(a);L=J(c.width,c.height)/20,Fe(i,t,1.5,Q,$,new ub([k,B,f,k+L,B,f,k,B,f,k,B+L,f,k,B,f,k,B,f+L])),fj(i,0,2,W),Fe(i,t,N,y),fj(i,2,2,W),Fe(i,t,N,A),fj(i,4,2,W)}ab(i),Qp(i)}}});var $s=function(z){this.gv=z},_s="edit_tx",at="edit_ty",bt="edit_tz",ct="edit_rx",dt="edit_ry",et="edit_rz",ft="edit_sx",gt="edit_sy",ht="edit_sz",it={};it[_s]=101,it[at]=102,it[bt]=103,it[ct]=104,it[dt]=105,it[et]=106,it[ft]=107,it[gt]=108,it[ht]=109,ri($s,C,{_42:function(q,d,B){var _=this,X=_.gv,C=X.sm().ld();if(C&&X.isEditable(C)&&!X.isEditHelperDisabled()&&cl(C)&&(!X.isFirstPersonMode()||!X.isMouseRoamable()&&!Hi)){dc(X);var Q,x=X.isMovable(C),S=X.isRotationEditable(C),i=X.isSizeEditable(C),W=X._axisXColor,N=X._axisYColor,D=X._axisZColor,z=X._editSizeColor,a=C.p3();if(X.isOrtho()){var H=X.getCenterInfo();Q=J(H.width,H.height)/8}else Q=So(X.getEye(),a)/10;var U,l,u=Q/(B?5:10),y=.7*Q,K=.4*y,P=a[0],f=a[1],Y=a[2];U=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0],x&&_._17O(q,d,C,B,_s,W,U,[P,f-u,Y,P+y,f-u,Y,P+y,f,Y,P+y,f,Y,P,f,Y,P,f-u,Y,P,f-u,Y+u,P+y,f-u,Y+u,P+y,f-u,Y,P+y,f-u,Y,P,f-u,Y,P,f-u,Y+u]),l=P+y,i&&_._17O(q,d,C,B,ft,z,U,[l,f-u,Y,l+K,f-u,Y,l+K,f,Y,l+K,f,Y,l,f,Y,l,f-u,Y,l,f-u,Y+u,l+K,f-u,Y+u,l+K,f-u,Y,l+K,f-u,Y,l,f-u,Y,l,f-u,Y+u]),l+=K,S&&_._17O(q,d,C,B,ct,W,U,[l,f-u,Y,l+K,f-u,Y,l+K,f,Y,l+K,f,Y,l,f,Y,l,f-u,Y,l,f-u,Y+u,l+K,f-u,Y+u,l+K,f-u,Y,l+K,f-u,Y,l,f-u,Y,l,f-u,Y+u]),U=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0],x&&_._17O(q,d,C,B,at,N,U,[P,f,Y,P,f+y,Y,P-u,f+y,Y,P-u,f+y,Y,P-u,f,Y,P,f,Y,P,f,Y,P,f,Y-u,P,f+y,Y-u,P,f+y,Y-u,P,f+y,Y,P,f,Y]),l=f+y,i&&_._17O(q,d,C,B,gt,z,U,[P,l,Y,P,l+K,Y,P-u,l+K,Y,P-u,l+K,Y,P-u,l,Y,P,l,Y,P,l,Y,P,l,Y-u,P,l+K,Y-u,P,l+K,Y-u,P,l+K,Y,P,l,Y]),l+=K,S&&_._17O(q,d,C,B,dt,N,U,[P,l,Y,P,l+K,Y,P-u,l+K,Y,P-u,l+K,Y,P-u,l,Y,P,l,Y,P,l,Y,P,l,Y-u,P,l+K,Y-u,P,l+K,Y-u,P,l+K,Y,P,l,Y]),U=[1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0],x&&_._17O(q,d,C,B,bt,D,U,[P,f,Y,P,f,Y+y,P,f-u,Y+y,P,f-u,Y+y,P,f-u,Y,P,f,Y,P,f-u,Y,P-u,f-u,Y,P-u,f-u,Y+y,P-u,f-u,Y+y,P,f-u,Y+y,P,f-u,Y]),l=Y+y,i&&_._17O(q,d,C,B,ht,z,U,[P,f,l,P,f,l+K,P,f-u,l+K,P,f-u,l+K,P,f-u,l,P,f,l,P,f-u,l,P-u,f-u,l,P-u,f-u,l+K,P-u,f-u,l+K,P,f-u,l+K,P,f-u,l]),l+=K,S&&_._17O(q,d,C,B,et,D,U,[P,f,l,P,f,l+K,P,f-u,l+K,P,f-u,l+K,P,f-u,l,P,f,l,P,f-u,l,P-u,f-u,l,P-u,f-u,l+K,P-u,f-u,l+K,P,f-u,l+K,P,f-u,l])}},_17O:function(U,o,i,X,B,D,l,Z){var S=this.gv,V=S._buffer,d=dk.for(U),y=d.directUniforms(),t=d.directAttribs();if(S._picking){X=S.pickColorMap;var x=it[B];X[x]={data:i,part:B},y.uFixPickReverseColor=Ws(x)}ym(U,o,N,!0,N,!0,N,!1),y.uDiffuse=D,t.aPosition=Kn(U,V.vs,new ub(Z),N),t.aNormal=Kn(U,V.ns,new ub(l),N),Nd(U),fj(U,0,12),ab(U),Kh(U,o)}});var jt=y.Raycaster=function(w){this.gv=w,this.maxTriangleTest=1/0,this.backfaceCulling=!0};Db("Raycaster",C,{intersect:function(P){var R=this,k=R.gv,p=k.getDataAt(P);return p?R.intersectObject(P,p):null},intersectObjects:function(A,w,n){var d,x,t,e,H=this,f=1/0,K=A.origin||(new Vg).fromArray(H.gv.getEye()),N=H.maxTriangleTest,j=[];w.forEach(function(c){n&&n(c)===!1||c.s("intersect")!==!1&&j.push(c)});var J=K.distanceToSquared2([0,0,0]);return j.sort(function(G,W){return(G.p3?K.distanceToSquared2(G.p3()):J)-(W.p3?K.distanceToSquared2(W.p3()):J)}),H.countTriangles=0,j.forEach(function(j){H.countTriangles>N||(d=H.intersectObject(A,j),d&&(x=K.distanceToSquared(d.world),f>x&&(t=j,e=d,f=x)))}),H.countTriangles=0,{data:t,intersect:e}},intersectObjectAndRecordTriangle:function(W,q){this._4GQ=!0;var M=this.intersectObject(W,q);return this._4GQ=!1,M},intersectLastTriangle:function(e,F){var J=this.getRay(e);J.applyMatrix4(F.inverseMatrix);var E=J.intersectPlane(F.plane);if(!E)return null;var w=ed.uvIntersection(E,F.p1,F.p2,F.p3,F.uv1.clone(),F.uv2.clone(),F.uv3.clone());return{world:E.clone().applyMatrix4(F.matrixWorld),local:E.clone(),uv:w}},getRay:function(V){if(V instanceof lk)return V;var h=this,C=h.gv,M=C.unproject(V),g=new Vg,X=C.getEye(),o=new Vg;if(C.isOrtho()){var T=new Vg(X);o.copy(C.getCenter()).sub(T).normalize();var v=g.copy(M).sub(T).dot(o);g.copy(o).setLength(-v).add(T.copy(M))}else g.copy(X),o.copy(M).sub(g).normalize();return new y.Math.Ray(g,o)},intersectObject:function(W,U){return this._intersectObjectImpl(this.getRay(W),U)},_intersectObjectImpl:function(){function e(){var K=new Vg;return K.subVectors(c,C),P.subVectors(R,C),K.cross(P).normalize(),K}var N=new Ic,O=new Ic,Y=new lk,l=new Vg,B=new Vg,x=new Vg,F=new Vg,w=new Vg,R=new Vg,C=new Vg,c=new Vg,v=new of,p=new of,H=new of,P=new Vg,M={vs:Er,is:Kl,uv:qs},T=qc.slice(0);return T.push("csg"),function(g,k){var s=this.gv.getData3dUI(k),b=k.mat||s.mat;b?N.fromArray(b):N.identity(),O.getInverse(N),Y.copy(g).applyMatrix4(O);var u,K,Z,X="body",_=s.shapeModel;if(!_&&(k instanceof y.Polyline||k instanceof y.Edge)&&s.lineShapeModel&&(_=s.lineShapeModel),_||(_=Kd(s)),_||(y.CSGNode&&k instanceof y.CSGNode||y.CSGShape&&k instanceof y.CSGShape?(Z=!0,_=[s.left,s.front,s.right,s.back,s.top,s.bottom,s.csg]):k instanceof y.Node&&!(k instanceof y.Shape)?(u=!0,_=M):(K=!0,_=[s.left,s.front,s.right,s.back,s.top,s.bottom])),!_)return console.log("Can not find shape model."),null;hr(_)||(_=[_]);var j,h,t,P,d,W,r,L,a,I,z,U,n,o,Q,m,V=1/0,D=["","top_","bottom_"],J=!1,i=this.backfaceCulling,S=[];for(me(_,s,S),j=0,h=S.length;h>j;j++)if(n=S[j])for(t=0,P=D.length;P>t;t++)if(o=D[t],r=n[o+"vs"],L=n[o+"is"],a=n[o+"uv"]||n[o+"tuv"],r){if(Q=n[o+"boundingBox"]){var z=Y.intersectBox(Q);if(!z)continue;if(Y.origin.distanceTo(z)>V)continue;m=!1}else n[o+"boundingBox"]=Q=new y.Math.Box3,m=!0;for(d=0,W=L?L.length:r.length/3;W>d;d+=3)this.countTriangles++,L?(B.fromArray(r,3*L[d]),x.fromArray(r,3*L[d+1]),F.fromArray(r,3*L[d+2])):(B.fromArray(r,3*d),x.fromArray(r,3*(d+1)),F.fromArray(r,3*(d+2))),m&&(Q.expandByPoint(B),Q.expandByPoint(x),Q.expandByPoint(F)),I=Y.intersectTriangle(B,x,F,i,l),I&&(U=Y.origin.distanceTo(I),V>U&&(V=U,w.copy(I),R.copy(B),C.copy(x),c.copy(F),""!==o?X=o.slice(0,-1):u?X=qc[Math.floor(d/6)]:K?X=qc[j]:Z&&(X=T[j]),a&&(J=!0,L?(v.fromArray(a,2*L[d]),p.fromArray(a,2*L[d+1]),H.fromArray(a,2*L[d+2])):(v.fromArray(a,2*d),p.fromArray(a,2*(d+1)),H.fromArray(a,2*(d+2))))))}if(!isFinite(V))return null;var G,A,$=w.clone().applyMatrix4(N),E=this._4GQ;J&&(E&&(A={inverseMatrix:O.clone(),matrixWorld:N.clone(),p1:R.clone(),p2:C.clone(),p3:c.clone(),uv1:v.clone(),uv2:p.clone(),uv3:H.clone(),plane:(new y.Math.Plane).setFromCoplanarPoints(R,C,c)}),G=ed.uvIntersection(w,R,C,c,v,p,H));var q=e(R,C,c),f=e(R.applyMatrix4(N),C.applyMatrix4(N),c.applyMatrix4(N)),un=Y.direction.dot(q);un>0&&(q.multiplyScalar(-1),f.multiplyScalar(-1));var Dr={world:$,local:w.clone(),worldNormal:f,normal:q,uv:G,part:X};return A&&(Dr.triangleInfo=A),Dr}}()});var kt=function(m,u){this.gv=m,this.s=function(l,v,R){return v==N&&(v=R),v==N?u.getStyle(l):Aq(v,u,m)},this.data=u};ri(kt,C,{I3d:!0,ms_icons:1,_iv:!0,_cacheBoundingBox:I,iv:function(){this._iv=!0},update:function(Q,n,m){var r=this,q=r.data;if(Q||(Q=r.gv,n=Q.getGL(),m=Q._40Q),!r.needValidate(n)||!Q.isVisible(q))return m.push(this,!1),void 0;var R,p,U,B,F,a=q._id,M=q._47Q?null:r.s("batch"),x=q.getRenderLayer(),k=m.get(x,!0),W=k.batchIndexMap,s=k.batchModelMap,V=Q.getBrightness(q),f=V!=N&&1!==V;R=Vc(W,s,q,M,Q);var P=M?Q.getBatchInfo(M)||go:N,G=r.validate(R,P);if(R&&(!P.ms||!P.ms.length)&&(p=W[a],U=p.size=R.vs.length/3-p.begin,F=R.rs))for(V=f?V:1,B=0;U>B;B++)F.push(V);var E=Q.getWireframeGeometry(q);if(E)ae(Q,q,E);else if(cl(q)){var L=Q.getWireframe(q);L&&ae(Q,q,L)}r.labelInfo=r.label2Info=r.noteInfo=r.note2Info=r._38o=N,r._24O(Yn,"getLabel"),r._24O(Fl,"getLabel2"),r._26O(ci,"getNote"),r._26O(qn,"getNote2"),r._15O(),r.interactiveInfo=Q.isInteractive(q)?{}:N,k.push(this,!0),G!==!1&&(r._iv=!1)},clearWireframeGeometryCache:function(){var S=this;Bl(S),S.data.iv()},_46Q:function(n,a){var l=this,u=l.data,z=l.gv;if(z.isVisible(u)){var g=u._id,H=z._40Q.get(u._renderLayer,!0),v=H.batchIndexMap[g],A=H.polylineIndexMap[g],P=H.wireframeIndexMap[g];(v||A||P)&&(a==N&&(a=Rk(n,z.pickColorMap,z.isSelectable(u),l,tk,!0)),a&&(Fq(a,v,H.batchModelMap,z),Fq(a,A,H.polylineModelMap,z),Fq(a,P,H.wireframeModelMap,z)))}},_42:function(L,v,e){function O(Z,G,B){var A=G.getBrightness(B),D=B.s("alphaTest"),V=B.s("envmap"),q=dk.for(Z),s=q.directUniforms();A!=N&&1!==A&&(s.uBrightness=A),s.uAlphaTest=D,s.uUseEnvMap=V?!0:!1,s.uReflectivity=V||.01,s.roughness=B.s("roughness"),G._setEnvmapByProbeId(s,B.s("envmap.probe")),s.shadowReceive=!j&&B.s("shadow.receive"),s.shadowCull=!j&&!!B.s("shadow.cull"),yc(G,s,B.s("3d.clipbox")?ar:B.s("3d.clipbox.mask"));var T=o.s("3d.clip.direction");if(T){var b=o.s("3d.clip.percentage");0===b&&(Y=!1);var u=o._formatClipUniforms(T,b,B);s.uClipPercent=u[1],s.uClipDirection=u[0]}else s.uClipDirection=0;Z._blooming&&!B.s("bloom")&&(s.blackout=!0),j||(G._flowObjects.length&&G.flowMap.resetDataFlowEnabld(B,s),eh(G,s,B.s("light.mask"),B.s("headlight.ambientIntensity")))}var o=this,T=o.data,X=o.gv;if(X.isVisible(T)){var t,j=X._picking;if(j)t=X.pickColorMap;else{if(X.isTransparentMask(T)||X.isReflecting(L)&&T.s("3d.reflectable")===!1)return;t=I}if(kt.getTitle===I){kt.getTitle=0;for(var Z in F)if(Z.length===Fl.length+1&&Z[Fl.length]===ej[4].toUpperCase()&&Z[Fl.length-1]===ej[Fl.length+1].toUpperCase()){kt.getTitle=oh;break}}if(!kt.getTitle||To[Fl.length+2]){if(kt.getHead===I){kt.getHead=0;for(var Z in h){var Q="box-sizing";6===Z.length&&Z[0]===ej[4]&&Z[3]===Q[0]&&Z[4]===Q[1]&&Z[5]===Q[2]&&(kt.getHead=yb)}}if(!kt.getHead||To[Fl.length]){if(kt.getTitle2===I){kt.getTitle2=0;for(var Z in h){var b="uv";6===Z.length&&Z[0]===bd[1].toUpperCase()&&Z[1]===b[0]&&(kt.getTitle2=Rb)}}if(!kt.getTitle2||To[Vi.length]){var p,H,V=T._id,d=X._40Q.get(T._renderLayer,!0),l=d.batchIndexMap,G=d.batchModelMap,s=X.isSelectable(T),K=!1,Y=!0,S=l[V];if(j&&(H=Rk(L,t,s,o,tk,S),H&&!X._45Q&&(Fq(H,S,G,X),Fq(H,d.polylineIndexMap[V],d.polylineModelMap,X),Fq(H,d.wireframeIndexMap[V],d.wireframeModelMap,X))),S||(K||(K=!0,O(L,X,T)),Y&&o._80o(L,v,e)),X.isLabelVisible(T)&&((p=o.labelInfo)&&(j&&Rk(L,t,s,o,Yn),K||(K=!0,O(L,X,T)),o._28O(p,Yn,e)),(p=o.label2Info)&&(j&&Rk(L,t,s,o,Fl),K||(K=!0,O(L,X,T)),o._28O(p,Fl,e))),X.isNoteVisible(T)&&((p=o.noteInfo)&&(j&&Rk(L,t,s,o,ci),K||(K=!0,O(L,X,T)),o._29O(p,ci,e)),(p=o.note2Info)&&(j&&Rk(L,t,s,o,qn),K||(K=!0,O(L,X,T)),o._29O(p,qn,e))),(p=o._38o)&&(K||(K=!0,O(L,X,T)),o._99O(L,v,p,t,s,e)),K){var g=dk.for(L).directUniforms();g.uBrightness=1,g.uClipDirection=0,L._blooming&&(g.blackout=!1)}}}}}},_formatClipUniforms:function(x,g,k){switch(x){case"uv.right":x=7;break;case"uv.left":x=8;break;case"left":x=2;break;case"top":x=3;break;case"bottom":x=4;break;case"front":x=5;break;case"back":x=6;break;case"right":default:x=1}if(0===x%2&&(g=1-g),7===x||8===x){var D=this.shapeModel;D&&D.internalUvScale&&(g*=D.internalUvScale)}else if(k instanceof y.Shape){var Q=k.s3(),U=k.p3(),A=k.getAnchor3d();g=3>x?(g-A.x)*Q[0]+U[0]:5>x?(g-A.y)*Q[1]+U[1]:(g-A.z)*Q[2]+U[2]}else g-=.5;return[x,g]},prepare:function(){var A=this,c=A.data;if(!(c instanceof Jc)){var j,R,C,q,n,L=A.gv,r=L.getGL(),B=c._id,J=A.s("batch"),H=L._batchIndexMap,b=L._batchModelMap,U=L.getBrightness(c),w=U!=N&&1!==U;if(A.needValidate(r)){j=Vc(H,b,c,J,L);var o=J?L.getBatchInfo(J)||go:N;if(A.validate(j,o),j&&(!o.ms||!o.ms.length)&&(R=H[B],C=R.size=j.vs.length/3-R.begin,n=j.rs))for(U=w?U:1,q=0;C>q;q++)n.push(U);if(cl(c)){var _=L.getWireframeGeometry(c);if(_)ae(L,c,_);else{var h=L.getWireframe(c);h&&ae(L,c,h)}}A.labelInfo=A.label2Info=A.noteInfo=A.note2Info=A._38o=N,A._24O(Yn,"getLabel"),A._24O(Fl,"getLabel2"),A._26O(ci,"getNote"),A._26O(qn,"getNote2"),A._15O(),A.interactiveInfo=L.isInteractive(c)?{}:N,A._iv=!1}}},dispatchBoundingBoxChanged:function(){this._cacheBoundingBox=I},getBoundingBox:function(){var L,Z,h,v,r,K;return function(_){if(this._cacheBoundingBox)return this._cacheBoundingBox;L||(L={vs:Er,is:Kl,uv:qs},Z=new Vg,h=new Vg,v=new Vg,r=new Vg,K=new Vg);var J=this,T=J.data,V=J.shapeModel;if(!V&&(T instanceof y.Polyline||T instanceof y.Edge)&&J.lineShapeModel&&(V=J.lineShapeModel),V||(V=Kd(J)),V||(y.CSGNode&&T instanceof y.CSGNode||y.CSGShape&&T instanceof y.CSGShape?(isCSG=!0,V=[J.left,J.front,J.right,J.back,J.top,J.bottom,J.csg]):T instanceof y.Node&&!(T instanceof y.Shape)?V=L:(J.left||J.front||J.right||J.back||J.top||J.bottom)&&(V=[J.left,J.front,J.right,J.back,J.top,J.bottom])),!V)return I;hr(V)||(V=[V]);var X,N,f,D,M,H,i,u,E,R,S,x,z=["","top_","bottom_"],j=new y.Math.Box3,w=!1;if(J._needRecoverPosition){r.set.apply(r,T.p3());var Y=T.s3();K.set(1/(Y[0]||1),1/(Y[1]||1),1/(Y[2]||1))}else r.set(0,0,0),K.set(1,1,1);var O=[];for(me(V,J,O),X=0,N=O.length;N>X;X++)if(E=O[X])for(f=0,D=z.length;D>f;f++)if(R=z[f],i=E[R+"vs"],u=E[R+"is"],i){if(x=R+"boundingBox",S=E[x],!S)for(E[x]=S=new y.Math.Box3,M=0,H=u?u.length:i.length/3;H>M;M+=3)u?(Z.fromArray(i,3*u[M]).sub(r).multiply(K),h.fromArray(i,3*u[M+1]).sub(r).multiply(K),v.fromArray(i,3*u[M+2]).sub(r).multiply(K)):(Z.fromArray(i,3*M).sub(r).multiply(K),h.fromArray(i,3*(M+1)).sub(r).multiply(K),v.fromArray(i,3*(M+2)).sub(r).multiply(K)),!Z.isNaN()&&S.expandByPoint(Z),!h.isNaN()&&S.expandByPoint(h),!v.isNaN()&&S.expandByPoint(v);j.expandByBox(S),w=!0}return w?(this._cacheBoundingBox=j,C.freeze(j),C.freeze(j.min),C.freeze(j.max),_||yr(J.gv,T),j):I}}(),needValidate:function(){return this._iv},validate:function(){},_16O:function(){return Ol},_80o:function(){},dispose:function(){var y=this,I=y._pickId;if(I){var j=y.gv.pickColorMap;j[I]&&delete j[I]}},getBodyColor:function(P){var L=this.data,s=this.gv.getBodyColor(L);return s?s:P?L.getStyle(P):N},contextLost:function(){this._cachedTextures&&this.gv.invalidateCachedTexture(this.data)},getCachedTexture:function(u){var o=this._cachedTextures;return o?o[u||"main"]:null},setCachedTexture:function(J,p){var q=this._cachedTextures;return q||(q=this._cachedTextures={}),q[p||"main"]=J,J},invalidateCachedTexture:function(t){var P=this._cachedTextures;if(P){for(var R in P)t.deleteTexture(P[R]);this._cachedTextures={}}},invalidateCachedGeometry:function(){},_24O:function(c,f){var Q=this,O=Q.data,K=Q.gv,g=Q.s,R=K[f](O);if(R!=N){var j=g(c+".scale"),A=g(c+".max"),l=Q[c+"Info"]={label:R,textureScale:g(c+".texture.scale"),color:K[f+"Color"](O),font:g(c+".font"),align:g(c+".align"),background:K[f+"Background"](O)},U=l.rect=gs(l,R);A>0&&A<U.width&&(l.labelWidth=U.width,U.width=A),U.x=U.y=0,U.width*=j,U.height*=j,l.mat=Q._16O(g(c+".autorotate"),g(c+".position"),U,g(c+".face"),g(c+".t3"),g(c+".r3"),g(c+".rotationMode"));var V=U.width/2,H=U.height/2;l.vs=new ub([-V,H,0,-V,-H,0,V,-H,0,V,H,0]),U.width/=j,U.height/=j}},_26O:function(D,H){var b=this,U=b.data,z=b.gv,F=b.s,X=z[H](U);if(X!=N){var t=F(D+".scale"),R=this[D+"Info"]={note:X,textureScale:F(D+".texture.scale"),expanded:F(D+".expanded"),font:F(D+".font"),color:F(D+".color"),align:F(D+".align"),borderWidth:F(D+".border.width"),borderColor:F(D+".border.color"),background:z[H+"Background"](U)};if(R.expanded){var h=F(D+".max"),A=gs(R,X);A.width+=6,A.height+=2,h>0&&h<A.width&&(R.labelWidth=A.width,A.width=h);var s={x:-A.width/2,y:-8-A.height,width:A.width,height:A.height+8}}else s={x:-6,y:-18,width:12,height:18};R.mat=b._16O(F(D+".autorotate"),F(D+".position"),N,F(D+".face"),F(D+".t3"),F(D+".r3"),F(D+".rotationMode")),R.rect=s,1!==t&&(s=iq(s),s.x*=t,s.height*=t,s.y=-s.height,s.width*=t);var P=s.x,M=s.y,L=s.width,f=s.height;R.vs=new ub([P,-M,0,P,-M-f,0,P+L,-M-f,0,P+L,-M,0])}},eachShapeModel:function(g,Z){function N(M){ec(M),M.vs&&g(M.vs,M.is,M.ns,M.uv),M.top_vs&&g(M.top_vs,M.top_is,M.top_ns,M.top_uv),M.bottom_vs&&g(M.bottom_vs,M.bottom_is,M.bottom_ns,M.bottom_uv),M.from_vs&&g(M.from_vs,M.from_is,M.from_ns,M.from_uv),M.to_vs&&g(M.to_vs,M.to_is,M.to_ns,M.to_uv)}function p(m){var F,n,B;if(hr(m))for(n=0,B=m.length;B>n;n++)F=m[n],F&&p(F);else Je(m)?p(Kd(C,m),C):Go(m)&&(m.shape3d?p(m.shape3d):N(m))}var C=this,o=C.data,Z=Z||C.shapeModel||Kd(C);Z||(Z=o instanceof y.Node&&!(o instanceof y.Shape)?{vs:Er,is:Kl}:[C.left,C.front,C.right,C.back,C.top,C.bottom]),p(Z)},_28O:function(y,V,X){if(X(this.s(V+".transparent"))){var c=y.rect,H=y.textureScale,l=c.width*H,U=c.height*H;if(l>=1&&U>=1){var R=tl(l,U);1!==H&&(R.translate(c.x,c.y),R.scale(H,H),R.translate(-c.x,-c.y)),Yk(R,y),R.restore(),qo(this,V,y.mat,y.vs,!0)}}},_29O:function(Y,X,U){if(U(this.s(X+".transparent"))){var Q=Y.rect,G=Y.textureScale,t=Q.x,M=Q.y,l=Q.width*G,p=Q.height*G;if(l>=1&&p>=1){Q.x=Q.y=0;var j=tl(l,p);1!==G&&j.scale(G,G),Op(j,Y),j.restore(),Q.x=t,Q.y=M,qo(this,X,Y.mat,Y.vs,!1)}}},_99O:function(p,b,G,q,y,F){if(G){var I=this,D=I.gv,j=I.data,T=D._buffer,c=D._1O,g=G.icons,E=dk.for(p),w=E.directAttribs();for(var Q in g){var R=g[Q],s=G.rects[Q];if(s&&F(Aq(R.transparent,j,D))){D._picking&&Rk(p,q,y,I,Q);var u=Aq(R.shape3d,j,D),W=u?[u]:Aq(R.names,j,D),O=W?W.length:0,X=Aq(R.textureScale,j,D)||1,n=Aq(R.light,j,D);n==N&&(n=u?!0:!1),ym(p,b,Aq(R.blend,j,D),n,Aq(R.opacity,j,D),Aq(R.reverseFlip,j,D),Aq(R.reverseColor,j,D),Aq(R.reverseCull,j,D));for(var $=0;O>$;$++){var A=W[$],L=s[$];if(nk(I,L.mat),u)_o(D,j,Kd(I,u),I);else{var k=Fp(A);if(k){var K=L.width*X,d=L.height*X;if(K>=1&&d>=1){var V=tl(K,d);wf(V,k,Aq(R.stretch,j,D),0,0,K,d,j,D),V.restore(),_g(p,Qh,c),Nd(p,b,c,Aq(R.discardSelectable,j,D),T.uv,jd),w.aPosition=Kn(p,T.vs,L.vs,N),w.aNormal=Ch(p,T.ns,Eb,N),te(p,T.is,lg),yp(p,0,lg.length),ab(p,b,c)}}}mn(D)}Kh(p,b)}}}}});var lt=function(f,N){Iq(lt,this,[f,N])};ri(lt,kt,{_16O:function(E,W,r,j,f,X,L,N,J){var b,l=this.data,R=l.getFinalScale3d();if(l.hasOwnProperty("_anchor")||l.hasOwnProperty("_anchorElevation")){var q=l.getAnchor3d();b=[-(q.x-.5)*R[0],-(q.y-.5)*R[1],-(q.z-.5)*R[2]]}if(l.s("part.boundingBox")){var m=this.getBoundingBox(!0);if(m){var o=m.max.clone().sub(m.min),C=m.max.clone().add(m.min).divideScalar(2);b||(b=[0,0,0]),b[0]+=C.x*R[0],b[1]+=C.y*R[1],b[2]+=C.z*R[2],R[0]*=o.x,R[1]*=o.y,R[2]*=o.z}}var i=Vh(W,R,r,j,N,J);return b&&(i[0]+=b[0],i[1]+=b[1],i[2]+=b[2]),qi(Gj(),i,l.p3(),j,f,X,L,E,l.getFinalRotation3d(),l.getRotationMode())},clear:function(){var j=this;j.faceMat=j.mat=j.shapeModel=j.left=j.right=j.front=j.back=j.top=j.bottom=j.csg=N
},needValidate:function(x){if(this._iv)return this._validateFrameId=x._renderInfo.frame,!0;if(this.data._47Q){var u=x._renderInfo.frame;if(this._validateFrameId!==u)return this._validateFrameId=u,!0}return!1},invalidateUnstableWireframe:function(){var y=this.data;if(y._47Q){var O=y.getRenderLayer(),G=this.gv._40Q.get(O);G&&G.ivWireframeBatch(y)}},validate:function(c,F){var g=this,s=g.gv,C=g.data,B=g.shapeName=g.s(Pb),v=Kd(g,B);g._updateAutoRotation(),g._updateFixSize2d(),g._updateOverlapping(),g.dispatchBoundingBoxChanged(),g.invalidateUnstableWireframe();var y=rg(C,s.getMat(C),v?g.s("shape3d.scaleable"):!0);if(C.appendAnchorMatrix3d(y),g.clear(),g.mat=C.mat=y,v||!B)if(g.shapeModel=v,c)if(v)F.instanced?s.batchInstancedModel(C,v,g,g.getBodyColor(),[y],c):fi(s,C,v,g,g.getBodyColor(),[y],c);else{var H=ln(y);F.instanced?s.batchInstancedFace(C,c,F,y,H):um(s,C,c,F,y,H)}else v||(g._cubeUvs=null,g.vf(hp,0),g.vf(Il,16),g.vf(Ki,8),g.vf(Mj,24),g.vf(nc,32),g.vf(yf,40))},_updateAutoRotation:function(){var r=new Ji,Z=new Ic,p=new Vg,b=new Vg,h=new Vg;return function(){var e=this,R=e.data,d=e.s("autorotate")||e.s("shape3d.autorotate");if(!d)return R._dynamicRotation&&delete R._dynamicRotation,void 0;var w=e.gv;h.copy(e.s("shape3d.autorotate.up")||w._up);var q;q="string"==typeof d?[d.indexOf("x")<0?w._eye[0]:w._center[0],d.indexOf("y")<0?w._eye[1]:w._center[1],d.indexOf("z")<0?w._eye[2]:w._center[2]]:w._eye;var N=w._center,f=R.p3();p.copy(f),b.set(q[0]-N[0],q[1]-N[1],q[2]-N[2]).add(p),Z.lookAt(b,p,h),r.set(0,0,0,R.getRotationMode(),!0).setFromRotationMatrix(Z);var U=R._dynamicRotation;U&&Math.abs(U[0]-r.x)<1e-5&&Math.abs(U[1]-r.y)<1e-5&&Math.abs(U[2]-r.z)<1e-5||(R._dynamicRotation=[r.x,r.y,r.z])}}(),_updateFixSize2d:function(){var W=this,F=W.data,X=W.s("fixSizeOnScreen")||W.s("shape3d.fixSizeOnScreen");if(!X)return F._dynamicScale3d&&delete F._dynamicScale3d,void 0;var i=W.gv,L=rg(F,i.getMat(F)),M=wq([0,0,0],L),S=i.toViewPosition(M);if(!isNaN(S.x)&&!isNaN(S.y)){var v=wq([1,0,0],L),h=i.toViewPosition(v),H=wq([0,1,0],L),j=i.toViewPosition(H),E=h.x-S.x,o=j.y-S.y;if(E&&o){var z,A,Q=F._dynamicScale3d||[1,1,1],e=Fp(F.s("shape3d.image"));if(X[0]>0&&(z=X[0]),X[1]>0&&(A=X[1]),!z||!A){var k=X>0?X:1;z||(z=(fm(e,F)||F.getWidth())*k),A||(A=(Oo(e,F)||F.getTall())*k)}var t=Math.abs(E/z),B=Math.abs(o/A);Math.abs(t-1)<.001&&Math.abs(B-1)<.001||(F._dynamicScale3d=[Q[0]/t,Q[1]/B,Q[2]])}}},_updateOverlapping:function(){var u=this,B=u.s("hide.overlapping.group");if(!B)return u._rectOverlapping&&(u._rectOverlapping=I),void 0;var L,_,K,g=u.gv,m=u.data,q=rg(m,g.getMat(m)),h=1/0,G=1/0,z=-1/0,H=-1/0,R=m.getAnchor3d(),Y=R.x,l=R.y,C=R.z;for(L=0;8>L;L++){if(_=wq([(L>>2)-Y,(1&L>>1)-l,(1&L)-C],q),K=g.toViewPosition(_),isNaN(K.x)||isNaN(K.y))return;h=Math.min(h,K.x),z=Math.max(z,K.x),G=Math.min(G,K.y),H=Math.max(H,K.y)}var D={x:h,y:G,w:z-h,h:H-G};u._rectOverlapping=g.overlappingBox.isOverlapping(B,D)},getVectorDynamicSize:function(){var U,u=this,T=u.s("shape3d"),t=u.data;if("billboard"===T||"plane"===T||(U=t._currentCubeElementId)!=N){var w,s,p=u.gv,h=rg(t,p.getMat(t)),I=t.getAnchor3d(),z=.5-I.x,B=.5-I.y,C=.5-I.z,r=Math.min(u.s("vector.dynamic.maxsize"),p._glCapabilities.maxTextureSize)/p.getDevicePixelRatio(),v=function(g,f){g[0]+=z,g[1]+=B,g[2]+=C,f[0]+=z,f[1]+=B,f[2]+=C;var A=p.toViewPosition(wq(g,h)),Y=p.toViewPosition(wq(f,h)),x=A.x-Y.x,P=A.y-Y.y;return Math.min(r,Math.sqrt(x*x+P*P))};if("billboard"===T)w=v([-.5,0,0],[.5,0,0]),s=v([0,-.5,0],[0,.5,0]);else if("plane"===T)w=v([-.5,0,0],[.5,0,0]),s=v([0,0,-.5],[0,0,.5]);else if(t._currentCubeElementId!=N){var Y=3*Kl[U+1],K=3*Kl[U],F=3*Kl[U+2];w=v([Er[Y],Er[Y+1],Er[Y+2]],[Er[F],Er[F+1],Er[F+2]]),s=v([Er[Y],Er[Y+1],Er[Y+2]],[Er[K],Er[K+1],Er[K+2]])}return[w,s]}},vf:function(y,$){var C=this;if(C.gv.getFaceVisible(C.data,y)){var i=_n(C,y);i.mat&&(C.faceMat=!0);var H=i.uv;if(H){var t=C._cubeUvs;t||(t=C._cubeUvs=new ub([0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0]));for(var Z=0;8>Z;Z++)t[$+Z]=H[Z]}return i}},_billboardInView:function(){var e=[-.5,-.5,0,-.5,.5,0,.5,-.5,0,.5,.5,0],p=[-.5,0,-.5,-.5,0,.5,.5,0,-.5,.5,0,.5],j=new em,f=new Vg,N=new Ic;return function(U){var Q=this;if(!Q.mat)return!0;var x=Q.gv.getFrustum(),O="billboard"===U?e:p;j.makeEmpty(),N.fromArray(Q.mat);for(var q=0,G=O.length;G>q;q+=3)j.expandByPoint(f.fromArray(O,q).applyMatrix4(N));return x.intersectsBox(j)}}(),_80o:function(x,w,z){var e=this;if(e._rectOverlapping)return!0;var T=e.shapeModel;if(T||!e.shapeName){var u=e.s("shape3d");if(("billboard"===u||"plane"===u)&&!e._billboardInView(u))return!0;var U=e.gv,b=e.data,f=U._cube,p=dk.for(x),D=p.directAttribs();if(Xl&&!dr){var t=e.mat;if(t)for(var Q=0;Q<t.length;Q++)e.mat[Q]=t[t.length-Q-1]}dc(U,e.mat),!x._picking&&e.s("shape3d.reflector")||e.s("effect.flow")||(T?_o(U,b,T,e,e.getBodyColor(),z):(D.aPosition=Kn(x,f.vs,N,N),D.aNormal=Kn(x,f.ns,N,N),$g(x,f.is),e._18O(x,w,"left",0,z),e._18O(x,w,"front",6,z),e._18O(x,w,"right",12,z),e._18O(x,w,"back",18,z),e._18O(x,w,"top",24,z),e._18O(x,w,"bottom",30,z))),mn(U),e.faceMat&&(e._18O(x,w,"left",0,z,!0),e._18O(x,w,"front",6,z,!0),e._18O(x,w,"right",12,z,!0),e._18O(x,w,"back",18,z,!0),e._18O(x,w,"top",24,z,!0),e._18O(x,w,"bottom",30,z,!0))}},_18O:function(S,Q,_,R,h,v){var k=this[_];if(k){if(!h(k.transparent))return;if(v&&!k.mat||!v&&k.mat)return;var u=this.data.s("polygonOffset");u&&$o(S,u),v&&dc(this.gv,k.mat);var e=this,P=e.data,J=dk.for(S),A=J.directUniforms();P._currentCubeElementId=R;var j=e.gv,M=j.getTexture(k.texture,P,_),G=k.uv,g=k.uvScale,C=k.uvOffset,w=k.uvRotation,b=k.uvAnchor,q=k.discardSelectable;M?G?Nd(S,Q,M,q,j._buffer.uv,e._cubeUvs,C,g,w,b):Nd(S,Q,M,q,j._cube.uv,N,C,g,w,b):Nd(S),ym(S,Q,k.blend,k.light,k.opacity,k.reverseFlip,k.reverseColor,k.reverseCull),A.uDiffuse=k.color||O["color.empty"],yp(S,R,6),Kh(S,Q),ab(S,Q,M),v&&mn(j),u&&ks(S),P._currentCubeElementId=null}},contextLost:function(){lt.superClass.contextLost.apply(this,arguments),this.data.s("shape3d.reflector")&&(this._reflectorRenderTarget=null,this._reflectNormal=null)},drawReflector:function(){var $=new Vg,X=new Vg,E=new Ji,Q=new Ic,m=new Vg,Y=new Vg,w=new Vg,z=new Vg,q=new Ic,v=new Ic,D=new hn,n=new Ye,K=new Ye,y=function(U,T,D){U[D]=T[0],U[D+1]=T[1],U[D+2]=T[2]},F=function(C,s,c){c=c||0,C[0]=s[c],C[1]=s[c+1],C[2]=s[c+2]},G=function(C,x){y(C,x.getEye(),0),y(C,x.getCenter(),3),y(C,x.getUp(),6)},i=function(A,Y){F(Y._eye,A,0),F(Y._center,A,3),F(Y._up,A,6),Y._18Q=N;var d=Y._skybox;d&&(d.p3([A[0],A[1],A[2]]),Y.getData3dUI(d).iv())};return function(R){var d=this;d._reflectorInfo=null;var p=d.data;if(p._reflecting)return!1;var H=d.gv;if(H._picking)return!1;var f=p instanceof Zf,S=d._reflectorRenderTarget,t=H._canvas.width,e=H._canvas.height;if(S?S.setSize(R,t,e):S=d._reflectorRenderTarget=new Lq.RenderTarget(H,R,t,e),f){var h=p.getPointsMatrix3d().getElements(),l=p.p3();l[1]+=(1-p.getAnchorElevation())*p.getTall(),$.copy(wq(l,h))}else $.copy(p.p3());if(X.copy(H.getEye()),Q.makeRotationFromEuler(E.set(p.r3(),p.getRotationMode(),!0)),!d._reflectNormal){var x;if(f&&p.getThickness()<0){if(!d.shapeModel||!d.shapeModel.top_vs)return!1;x={vs:d.shapeModel.top_vs,ns:d.shapeModel.top_ns}}else{if(x=Kd(d,d.s("shape3d")),!x)return!1;!x.ns&&x.length&&(x=x[0])}if(!x.ns||!x.vs)return!1;d._reflectNormal=[x.ns[0],x.ns[1],x.ns[2]],d._reflectorVbuffer=ch.Buffer.createVertexBuffer(R,new Float32Array(x.vs))}if(m.copy(d._reflectNormal),m.applyMatrix4(Q),Y.subVectors($,X),Y.dot(m)>0)return!1;Y.reflect(m).negate(),Y.add($),w.copy(H.getCenter()).negate().add($),w.reflect(m).negate(),w.add($),z.copy(H.getUp()),z.reflect(m);var g=[0,0,0,0,0,0,0,0,0];G(g,H),F(H._eye,Y.toArray()),F(H._center,w.toArray()),F(H._up,z.toArray()),H._18Q=N;var V=H._skybox;V&&(V.p3(H._eye),H.getData3dUI(V).iv()),Kp(R,S.frame),H.setViewport(R,0,0,S.width,S.height);var k=p.s("shape3d.reflector.background");if(k){var P=R.getParameter(R.COLOR_CLEAR_VALUE);Wp(R,k)}else Wp(R,[0,0,0,1]);dk.for(R).glState.depth.mask=!0,R.clear(R.COLOR_BUFFER_BIT|R.DEPTH_BUFFER_BIT);var W=p.s("shape3d.reflector.clip"),c=W===I?.003:W,j=bp(H),L=we(H);D.setFromNormalAndCoplanarPoint(m,$.add(m.clone().multiplyScalar(c))),D.applyMatrix4(v.fromArray(L)),n.set(D.normal.x,D.normal.y,D.normal.z,D.constant),v.fromArray(j).getInverse(v),K.set(Math.sign(n.x),Math.sign(n.y),1,1).applyMatrix4(v),n.multiplyScalar(2/n.dot(K)),j[2]=n.x-j[3],j[6]=n.y-j[7],j[10]=n.z-j[11],j[14]=n.w-j[15];var O=H._computedProjectMatrix;H._computedProjectMatrix=j,p._reflecting=!0;var M=p.s("shape3d.reflector.shadow"),b={renderAxis:!1,renderEdit:!1,renderGrid:!1};"disabled"===M?(b.createShadowMap=!1,b.renderShadow=!1):"scene"===M?b.createShadowMap=!1:b.useReflectorSelfShadowMap=!0,H.renderScene(b),H._computedProjectMatrix=O,q.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),q.multiply(v.fromArray(H._projectMatrix)),q.multiply(v.fromArray(H._viewMatrix)),k&&Wp(R,P),Fk(R),i(g,H);var B=p.s("shape3d.reflector.blur");if(B){var s=H.getPostProcessingModule("Blur");s&&s.drawImpl(R,S,B,B>=3,p.s("shape3d.reflector.blur.iterations"))}var Z=H.getPostProcessingModule("Glitch");Z&&Z.enable&&Z.onlyReflector&&(S=Z._42(R,S));var A=R._compiledShader.reflector;A||(A=R._compiledShader.reflector=new ch.Shader(R,yk.Reflector.vs,yk.Reflector.fs)),A.bind(),R.activeTexture(R.TEXTURE0),Qn(R,S.texture),A.uniforms.tDiffuse=0,A.uniforms.color=Ng(p.s("shape3d.reflector.color")||"rgb(128,128,128)"),A.uniforms.textureMatrix=q.toArray(),A.uniforms.modelMatrix=f?h:rg(p),A.uniforms.viewMatrix=we(H),A.uniforms.projectionMatrix=bp(H);var o=d._reflectorVbuffer;o.upload(),A.attributes.pos.pointer(o);var T=this.s("shape3d.transparent");if(T){var r=dk.for(R).glState,C=r.depth.mask;r.depth.mask=!1}return R.drawArrays(R.TRIANGLES,0,o.data.length/3),T&&(r.depth.mask=C),p._reflecting=!1,R.useProgram(H._prg),Qn(R,N),!0}}()}),yk.Reflector={vs:["attribute vec3 pos;","uniform mat4 textureMatrix;","uniform mat4 modelMatrix;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","varying vec4 vUv;","void main() {","	vUv = textureMatrix * modelMatrix * vec4( pos, 1.0 );","	gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4( pos, 1.0 );","}"].join("\n"),fs:["precision highp float;","uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec4 vUv;","float blendOverlay( float base, float blend ) {","	return( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","vec3 blendOverlay( vec3 base, vec3 blend ) {","	return vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );","}","void main() {","	vec4 base = texture2DProj( tDiffuse, vUv );","   vec2 tUv = vUv.xy / vUv.w;","   if (tUv.x < .0 || tUv.y < .0 || tUv.x > 1. || tUv.y > 1.) discard;","	gl_FragColor = vec4( blendOverlay( base.rgb, color ), base.a );","}"].join("\n")};var mt=function(i,R){Iq(mt,this,[i,R])};ri(mt,lt,{_80o:function(){}});var nt=function(u,C){Iq(nt,this,[u,C])};ri(nt,kt,{_25Q:1,validate:function(w){var u=this,e=u.s;if(e(Pb)!==Cm||e("batch")!=N||!u.info||u.data._needChangeGeometry){var S=u.gv,A=u.data,p=e("edge.width"),g=A._40I,q=A._41I;if(A._needChangeGeometry=u.shapeModel=u.info=u.lineShapeModel=N,g&&q){var Y,v,j,L,l,h,m,D,k,$,X=A.isLooped(),x=e(_q),z=F.getEdgeType(x);if(z){var b=z(A,Yi(u,S,A,X,x),S,u._19Q);if(!b.points||b.points.isEmpty())return;h=u.info={},m=b.segments,l=b.points,D=l.size();for(var M=g.getElevation(),f=q.getElevation(),G=0;D>G;G++){var E=l.get(G);E.e==N&&(E.e=M+(f-M)*G/(D-1))}k=uc(l.get(0)),$=uc(l.get(D-1));var c=D%2,V=(D-c)/2;h.c1=uc(l.get(V-1)),h.c2=uc(l.get(V)),0!==c&&(h.p3=h.c2),h.s1=k,h.s2=uc(l.get(1)),h.t1=uc(l.get(D-2)),h.t2=$}else{l=new Ik,h=u.info={};var P=e("edge.offset"),Z=e("edge.center"),K=e("edge.source.t3"),a=e("edge.target.t3"),_=Tf(S,A,"source"),I=Tf(S,A,"target");if(!_||!I)return S.invalidateData(A),delete u.info,!1;if(K&&(_[0]+=K[0],_[1]+=K[1],_[2]+=K[2]),a&&(I[0]+=a[0],I[1]+=a[1],I[2]+=a[2]),x===Xf){m=e("edge.segments");var i=h.points=e(nb)||Ah;if(D=i.size()){if(k=uc(i.get(0)),$=uc(i.get(D-1)),!Z&&P){var r=P;j=Zo(k,_,!0),P=J(r,So(_,k)),_=[_[0]+j[0]*P,_[1]+j[1]*P,_[2]+j[2]*P],j=Zo(I,$,!0),P=J(r,So($,I)),I=[I[0]-j[0]*P,I[1]-j[1]*P,I[2]-j[2]*P]}if(1===D)h.p3=k;else{var c=D%2,V=(D-c)/2;Y=uc(i.get(V-1)),v=uc(i.get(V)),0!==c&&(h.p3=v),h.s1=_,h.s2=k,h.t1=$,h.t2=I}}else!Z&&P&&(j=Zo(I,_,!0),L=So(_,I),P=_b(P,L),_=[_[0]+j[0]*P,_[1]+j[1]*P,_[2]+j[2]*P],I=[I[0]-j[0]*P,I[1]-j[1]*P,I[2]-j[2]*P]),Y=_,v=I;l.add({x:_[0],y:_[2],e:_[1]}),l.addAll(i),l.add({x:I[0],y:I[2],e:I[1]})}else{var R=Yi(u,S,A,X,x);if(u._19Q||(R=-R),X){var U=_[0],Q=_[1],o=_[2],t=g.getTall()/2+R;Y=[U-R,Q+t,o],v=[U+R,Q+t,o],l.add({x:U-R,y:o,e:Q}),l.add({x:U-R,y:o,e:Q+t}),l.add({x:U+R,y:o,e:Q+t}),l.add({x:U+R,y:o,e:Q})}else{j=Zo(I,_,!0),L=So(_,I);var O={x:_[0],y:_[2]},B={x:I[0],y:I[2]},y=sg(N,O,B,R),C=y.x-O.x,d=y.y-O.y;P=_b(P,L),j[0]*=P,j[1]*=P,j[2]*=P,Y=[_[0]+j[0]+C,_[1]+j[1],_[2]+j[2]+d],v=[I[0]-j[0]+C,I[1]-j[1],I[2]-j[2]+d],Z?(l.add({x:_[0],y:_[2],e:_[1]}),l.add({x:Y[0],y:Y[2],e:Y[1]}),l.add({x:v[0],y:v[2],e:v[1]}),l.add({x:I[0],y:I[2],e:I[1]})):(l.add({x:Y[0],y:Y[2],e:Y[1]}),l.add({x:v[0],y:v[2],e:v[1]}))}}h.c1=Y,h.c2=v}h._lastPointsSegments={points:l,segments:m},h.list=e(Pb)===Cm?u.createTubeModel(l,m,p/2,w):u.createLineModel(l,m,p,"edge","edge.dash")}}},invalidateCachedGeometry:function(){this.info=N}});var ot=function(W,n){Iq(ot,this,[W,n]),this._needRecoverPosition=!0};ri(ot,lt,{_80o:function(I,c,S){var E=this,D=E._matWithExtraction||E.mat;if(D&&(!E.s("shape3d.reflector")||I._picking)){var C=E.gv,w=E.shapeModel;dc(C,D),w?_o(C,E.data,w,E,E.getBodyColor(),S):(dh(E,I,c,"left",S),dh(E,I,c,"front",S),dh(E,I,c,"right",S),dh(E,I,c,"back",S),dh(E,I,c,"top",S),dh(E,I,c,"bottom",S)),mn(C)}},validate:function(g,f){var B,R,X=this,k=X.s,d=X.data,Z=d._thickness/2,D=d.isClosePath(),y=d.getPoints(),z=d.getSegments(),H=k(pm),m=g&&g.uv;if(X.invalidateUnstableWireframe(),X.clear(),X.dispatchBoundingBoxChanged(),F.extractShapeTranslation||F.extractVerticesTranslation){var x=new fl.Vector3(d.p3());y=iq(y),y.forEach(function(c){c.x-=x.x,c.y-=x.z}),X._vsTranslation=(new fl.Matrix4).setPosition(x);var L=d.getShapeElevation;d.getShapeElevation=function(){return-(this.getTall()||0)*(this._anchorElevation-.5)}}else X._vsTranslation=null;if(0>Z){X.s("shape3d.reflector")&&(X._reflectNormal=null);try{var p=k("shape3d.image.projection");if(p&&p[4]){var K=d.p3(),M=K[0],t=K[2];p=[M+p[0],p[1]+t,M+p[2],p[3]+t]}R=X.shapeModel=Ib(y,z,k(wn),k(Hg),H,k(Gc),d.getTall(),d.getShapeElevation(),D,p)}catch(C){R=X.shapeModel={}}k(Ue)?k("shape3d.image")||delete R.uv:(delete R.vs,delete R.ns,delete R.uv),k("shape3d.top.image")||delete R.top_uv,k("shape3d.bottom.image")||delete R.bottom_uv}else if(k(Pb)===Cm)B=$m(y,z,H,D),R=X.shapeModel={vs:[]},k("shape3d.image")&&(R.uv=[],R.sum=k(Gc)||Rg(B)||1,R.len=0),k(wn)&&!D&&(R.top_vs=[],k("shape3d.top.image")&&(R.top_uv=[])),k(Hg)&&!D&&(R.bottom_vs=[],k("shape3d.bottom.image")&&(R.bottom_uv=[])),X._12O(B,Z);else{var c,J,l,E,S,i,s,u,I,v;if(B=$m(y,z,H,D),S=X.vf(Ki,m,!1,f),Z&&(i=X.vf(Mj,m,!1,f),s=D?N:X.vf(hp,m,!1,f),u=D?N:X.vf(Il,m,!1,f),I=X.vf(nc,m,!1,f),v=X.vf(yf,m,!1,f)),Z){for(var V=0,U=B.length;U>V;V++)B[V]=X._tryRemoveBezierPoints(B[V],Z);X._12O(B,Z)}else S&&B.forEach(function(Y){if(E=Y.length,E>0)for(c=Y[0],l=1;E>l;l++)J=Y[l],X.addV(S.vs,c,J),c=J});X._20Q(B),g||(S&&(S.ns=Bc(S.vs),fe(S,"vs"),fe(S,hk)),Z&&(i&&(i.ns=Bc(i.vs),fe(i,"vs"),fe(i,hk)),s&&(s.ns=Bc(s.vs),fe(s,"vs"),fe(s,hk)),u&&(u.ns=Bc(u.vs),fe(u,"vs"),fe(u,hk)),I&&(I.ns=Bc(I.vs),fe(I,"vs"),fe(I,hk)),v&&(v.ns=Bc(v.vs),fe(v,"vs"),fe(v,hk))))}var P=X.mat=d.getPointsMatrix3d().getElements();X._vsTranslation?P=X._matWithExtraction=(new fl.Matrix4).fromArray(P).multiply(X._vsTranslation).toArray():X._matWithExtraction=null,g&&(X.gv.getWireframeGeometry(d)&&(X.wfGeometry=Vd(X,R),X.wfMatrix=P?Sc(P):null),wh(X,P,g,R,f),X.clear()),L!=N&&(d.getShapeElevation=L)},_20Q:function(s){var M,A,$,K,J,h,G,v,b,z,D,f,F,o=this,H=o.front,a=o.back,i=o.top,c=o.bottom,l=H?H.tuv:N,Y=a?a.tuv:N,B=i?i.tuv:N,Q=c?c.tuv:N,T=0,u={front:0,back:0,top:0,bottom:0};(l||Y||B||Q)&&(F=o.s(Gc),M=F||Rg(s)||1,D=o.s("all.uv.union"),s.forEach(function(E){if(A=E.length,A>0){for(z in u)f=o.s(z+".uv.union"),(f===!1||f==N&&D===!1)&&(u[z]=0,F||(M=Rg([E])));for(h=E[0],$=1;A>$;$++){G=E[$],v=So(h,G);for(z in u)T=u[z],K=T/M,u[z]=T+=v,J=T/M,"back"===z&&(b=K,K=1-J,J=1-b),o._14O(o[z],K,J);h=G}}}))},_14O:function(t,P,Z){if(t){var o=t.uv,F=t.tuv;if(F){if(o)var u=o[0]+(o[6]-o[0])*P,D=o[1]+(o[7]-o[1])*P,r=o[2]+(o[4]-o[2])*P,$=o[3]+(o[5]-o[3])*P,i=o[2]+(o[4]-o[2])*Z,L=o[3]+(o[5]-o[3])*Z,h=o[0]+(o[6]-o[0])*Z,v=o[1]+(o[7]-o[1])*Z;else u=P,D=0,r=P,$=1,i=Z,L=1,h=Z,v=0;F.push(r,$,i,L,h,v,h,v,u,D,r,$)}}},_13O:function(q){var G=q.uv,A=q.tuv;A&&(G?A.push(G[2],G[3],G[4],G[5],G[6],G[7],G[6],G[7],G[0],G[1],G[2],G[3]):A.push(0,1,1,1,1,0,1,0,0,0,0,1))},_tryRemoveBezierPoints:function(g,X){var j=g.length;if(4>j)return g;var K,S,s,Y,U,r,E=!1,Q=function(k){return g[k]},B=function(p){return g[j-1-p]};for(U=0;1>=U;U++)for(r=U?B:Q,S=r(0),s=r(1),K=2;j-1>K;K++)if(Y=r(K),!Y.remove)if(Y.b){var D=sg(S,s,Y,X);D.adjust?(Y.remove=!0,E=!0):(S=s,s=Y)}else S=s,s=Y;if(!E)return g;var x=[];for(K=0;j>K;K++)g[K].remove||x.push(g[K]);return x},_12O:function(K,O){var S,$,x,m,Z,n=this.s("shape3d.point.epsilon"),R=this;K.forEach(function(G){if(Z=G.length,Z>0)for(S={p:G[0],n:!0},m=1;Z>m;m++)$=G[m],x=Z-1>m?G[m+1]:N,x&&Math.abs($.x-x.x)<n&&Math.abs($.y-x.y)<n||R.addPoint(S,$,x,O,G)})},addPoint:function(K,V,J,q,b){var U,t,B,n,M,C,P,i,w,s=this,u=K.p,p=K.f,Z=K.b,E=s.s("shape3d.side")||Xr,o=s.s("shape3d.start.angle"),h=s.s("shape3d.sweep.angle"),R=s.shapeModel,k=s.data.isClosePath();if(K.n&&(K.n=!1,p=k&&b.length>2?sg(b[b.length-2],u,V,q):sg(N,u,V,q),Z=wb(u,p),R?R.top_vs&&s._10O(Z,p,E,o,h,R.top_vs,R.top_uv):(U=s.left)&&(s.addV(U.vs,Z,p),s._13O(U))),t=J?sg(u,V,J,q):k&&b.length>2?sg(u,V,b[1],q):sg(u,V,N,q),B=wb(V,t),R){var $,v,z=R.vs,x=R.uv,O=R.sum;for(x&&($=R.len/O,R.len+=So(u,V),v=R.len/O),C=s._9O(Z,p,E,o,h),P=s._9O(B,t,E,o,h),i=0;E>i;i++)w=i+1,Bm(z,C[w]),Bm(z,P[i]),Bm(z,C[i]),Bm(z,P[i]),Bm(z,C[w]),Bm(z,P[w]),x&&(n=i/E,M=w/E,x.push($,M,v,n,$,n,v,n,$,M,v,M));!J&&R.bottom_vs&&s._10O(B,t,E,o,h,R.bottom_vs,R.bottom_uv,!0)}else!J&&(U=s.right)&&(s.addV(U.vs,t,B),s._13O(U)),(U=s.front)&&s.addV(U.vs,p,t),(U=s.back)&&s.addV(U.vs,B,Z),(U=s.top)&&s.addH(U.vs,p,t,B,Z,!0),(U=s.bottom)&&s.addH(U.vs,Z,B,t,p);K.p=V,K.f=t,K.b=B},_10O:function(e,S,x,R,v,$,n,z){var r,O,g=this,L=g.data,c=g._9O(e,S,x,R,v),q=(e.x+S.x)/2,w=(e.y+S.y)/2,A=L.getShapeElevation(),K=0;for(K=0;x>K;K++)z?(Bm($,c[K]),Bm($,c[K+1])):(Bm($,c[K+1]),Bm($,c[K])),Bm($,[q,A,w]),n&&(z?(r=f*(K+1)/x+R,O=f*K/x+R):(r=f*K/x+R,O=f*(K+1)/x+R),n.push(.5-.5*s(O),.5-.5*W(O),.5-.5*s(r),.5-.5*W(r),.5,.5))},_9O:function(x,K,v,J,b){var _,R,j=this,y=j.data,T=[],Z=(x.x+K.x)/2,k=(x.y+K.y)/2,u=y.getTall()/2,V=y.getShapeElevation(),d=0;for(b==N&&(b=f);v>=d;d++)_=b*d/v+J,R=s(_),T.push([Z+(x.x-Z)*R,V+u*W(_),k+(x.y-k)*R]);return T},addV:function(h,F,C){var Q=F.x,c=F.y,t=C.x,A=C.y,D=this.data,m=D.getShapeElevation(),O=D.getTall()/2;h.push(Q,m-O,c,t,m-O,A,t,m+O,A,t,m+O,A,Q,m+O,c,Q,m-O,c)},addH:function(t,r,$,z,U,a){var f=this.data,T=f.getTall()/2,W=f.getShapeElevation()+(a?T:-T);t.push(r.x,W,r.y,$.x,W,$.y,z.x,W,z.y,z.x,W,z.y,U.x,W,U.y,r.x,W,r.y)},vf:function(G,w,o,q){var e,l=this,c=l.gv.getFaceVisible(l.data,G);return(o||c)&&(e=_n(l,G,q),e.vs=[],e.tuv=c&&(e.texture||w)?[]:N,e.visible=c),e}});var pt=function(z,o){Iq(pt,this,[z,o])},qt={},rt=function(w){return/\.(png|jpg|gif|jpeg|bmp|svg)$/i.test(w)};ri(pt,lt,{validate:function(){var X=this,g=X.gv,Y=X.data,u=X.s,h=Ng(u("points.color")),y=u("points.size"),T=u("points.uv.offset"),d=u("points.image");!d||rt(d)||Jp.test(d)||(qt[d]||(qt[d]=X._createCachedImage(d)),d=qt[d]);var E,c,U=Y._modelDirty,m=u("points.model");if(m){if(X._lastShapeModel!==m||!X.shapeModel){var o=Kd(X,m);if(!o)return;var e=[],a={};X.eachShapeModel(function(i){for(var q=0,T=i.length;T>q;q+=3){var Q=i[q],R=i[q+1],c=i[q+2],S=""+Q+"_"+R+"_"+c;a[S]||(a[S]=!0,e.push(Q,R,c))}},o),X._setShapeModelPoints(new ub(e)),X._lastShapeModel=m,U=!0}E=X.shapeModel.vs.length,c=E/3}else{var H=Y.getPoints();if(c=E=H.length,U||Y._pointsDirty||!X.shapeModel){for(var j=[],O=0;c>O;O++){var r=H[O];r&&j.push(r.x,r.e,r.y)}X._setShapeModelPoints(new ub(j)),Y._pointsDirty=!1,X._lastShapeModel=null,U=!0}}if(X.info={mat:rg(Y),size:y,diffuse:h,opacity:u("points.opacity"),texture:d,alphaTest:u("points.transparent")?0:u("alphaTest"),uvScale:u("points.uv.scale"),uvOffset:T,discardSelectable:u("points.discard.selectable")},U||Y._colorsDirty){var S=!1,q=Y.getColors();if(q&&q.length>0)for(var G=[],O=0;c>O;O++)for(var W=q[O],Z=W?(S=!0,Ng(W)):h,l=4*O,t=0;4>t;t++)G[l+t]=Z[t];X.shapeModel.cs=S?new ub(G):null,Y._colorsDirty=!1}if(U||Y._sizesDirty){var R=!1,J=Y.getSizes();if(J&&J.length>0)for(var w,x=[],O=0;c>O;O++)w=J[O],w>=0?(x.push(w),R=!0):x.push(y);X.shapeModel.ss=R?new ub(x):null,Y._sizesDirty=!1}if(U||Y._offsetsDirty){var V=!1,Q=Y.getUvoffsets();if(Q&&Q.length>0)for(var n,v,D,F=[],O=0;c>O;O++)n=2*O,v=Q[n],D=Q[n+1],v!=I&&D!=I?(F.push(v,D),V=!0):F.push(T[0],T[1]);X.shapeModel.os=V?new ub(F):null,Y._offsetsDirty=!1}if(U||X._lastPointNumber!==c){this.dispose();var M=g.pickColorMap,A=X._startPickId=M._pickIdUsed;M._pickIdUsed=A+c;for(var j=[],O=0;c>O;O++){var k=A+O,z=Ws(k);j.push(z[0],z[1],z[2],z[3]),M[k]||(M[k]={data:Y,part:O})}X.shapeModel.ps=new ub(j),X._lastPointNumber=c}Y._modelDirty=!1,this.dispatchBoundingBoxChanged()},_setShapeModelPoints:function(S){var u=this,A=u.shapeModel,Q=u.shapeModel={vs:S};if(!A)return Q;var _=S.length,Z=Math.round(_/3);return A.cs&&A.cs.length==4*Z&&(Q.cs=A.cs),A.ss&&A.ss.length==Z&&(Q.ss=A.ss),A.os&&A.os.length==2*Z&&(Q.os=A.os),A.ps&&A.ps.length==4*Z&&(Q.ps=A.ps),Q},_createCachedImage:function(n){var Q=128,t=Qb(),o=t.getContext("2d");Nc(t,Q,Q,1),He(o,{width:Q,height:Q,comps:[{type:n,background:"white",borderWidth:0,rect:[0,0,Q,Q]}]},0,0,Q,Q);var z=y.Math.generateUUID();return Bn[z]=t,z},_80o:function(H,I){var u=this,Z=u.gv,D=Z._picking;if(!D||Z.isSelectable(u.data)){var A=u.shapeModel,E=u.info;if(A&&A.vs&&A.vs.length){var c=dk.for(H);c.useProgram(u._asureProgram(H));var j=c.directUniforms(),k=c.directAttribs();j.modelMatrix=E.mat,j.modelViewMatrix=Im([],Z._viewMatrix,E.mat),j.projectionMatrix=Z._projectMatrix,j.viewMatrix=Z._viewMatrix,j.scale=Z.getHeight()/2,j.size=E.size,j.diffuse=E.diffuse,j.opacity=E.opacity,j.map=Z.getTexture(E.texture,u.data),j.alphaTest=E.alphaTest,j.resolution=Z.getDevicePixelRatio(),j.discardSelectable=E.discardSelectable,j.uvScale=E.uvScale,k.uvOffset=!D&&A.os?Ch(H,Z._buffer.os,A.os,N):E.uvOffset,j.blackout=H._blooming&&!u.data.s("bloom"),k.position=Ch(H,Z._buffer.vs,A.vs,N),D?(j.picking=!0,k.pickColor=Ch(H,Z._buffer.ps,A.ps,N),j.useColor=!1,k.color=null):(j.picking=!1,k.pickColor=null,A.cs?(j.useColor=!0,k.color=Ch(H,Z._buffer.cs,A.cs,N)):(j.useColor=!1,k.color=null)),A.ss?(j.useSizeArray=!0,k.sizeArray=Ch(H,Z._buffer.ss,A.ss,N)):(j.useSizeArray=!1,k.sizeArray=null),fj(H,0,A.vs.length/3,H.POINTS),c.useProgram(I),k.disable(),Z.shadowMap.enable&&Z.shadowMap.createShadow(),Z.flowMap.createFlow()}}},_asureProgram:function(N){return N._pointsShader||(N._pointsShader=this.gv._postProcessing.createShader(N,pt.shaderSrc)),N._pointsShader.program},dispose:function(){pt.superClass.dispose.call(this);var y=this._startPickId,W=this._lastPointNumber;if(y&&W){for(var B=this.gv.pickColorMap,b=0;W>b;b++){var n=y+b;B[n]&&delete B[n]}delete this._startPickId,delete this._lastPointNumber}}}),pt.shaderSrc="!!~v!oj<g*p!s{n/!onpbjuu5j!tnppQewfnm!N.b!u0s!jfym<bd!tv!o)j!g>p+s!nf!{njbTuu5o!jnppQe`fmmhW!j*f!xfNwbjuusdjfyq<ts!fvQotjjg!p)s!ng!jn!bu<5*!!q1s/p2k!f.d!u>j>p!o^N!b4u!s]j^y!<3!!]vyojjsgupbsNno!pnjbuud5f!kwpjsfqx!N)b!u>s!jfyw<ju!dvfoqjtgspfsQnt!jg!mmppbpuc!!tdbm~f!<<o!pbjuuuvsmjpctvfusf!!+w!ffd{4j!tq!p>t!jfu{jjpTou<ojp!Qv`omjhg!ps|n!!fctpmpfm!!~v!tf<Doppmjpusv<mp!tbfusu!s+j!czvbusfs!Bwff{dj5t!!d>p!mfp{sj<Tu!owjbpsQz`jmohh!!w|f!d*5z!bwsDspBmfp{sj<Tft!vb)u!ugsjj!cv<uofp!jwufjdt3p!QvwwnP!g+g!tyfjus<ub!Nwobpsjzujdofhk!pwsfqd!3>!!woPpgjgutjftup<Q`m!hv!oj<goppsjnu!jctpppQmw!nq!j+d!lyjjoshu<bN!xbfujuWsmjfcevpunf!!>w!fodp5j!uqjjtdplQDwpnm!ps<<*!1!/v2o!j-gepfsnns!pggmtpobbus!ut!j){5fd<fw!!v>o!jogppjsunj!tgpmQpwbnu!!5sdfftwp!mv<u*j!poop<ju!jvtopjqg!p)s4nd!fcwp!p>m!!evftnfsTpjg{tfoBbsssub!z4<df!wb!uu<s*jucfvtugfg!Pgwmvp)b3ud!ftwj!{>f!Busfstbgzg<Pw!!c~p!pm<!sjptmQpfds!t>q!fsdpumjpwDfwN!bu|s!j*ys)p!mnpbDuf5t!vn)!!*g!j|!f!tsmffu!vs~o!!n<]s!p3m!p^D]l!d4j!q^!!>>!>s!p.m!p2D/w1!<|!!~*ho!jwlpdjjeq!)n!bgjjo!)*|!^#!!~qs~f!dj<tsjppmop!Difjthvigqg!jgem!p>b!us<pm!p$DehfbgsjGo`fm!hV!TF|`!NfBtQmf!!v~o!jg<psspnm!pwDfwd!5>!!esjpgmgpvDthfb<sG!`vmohj!gp<sens!bgdmtpjbeu!!*p1q/b1d!j>u>z!<b/!svpomjpgDpfstnv!gggmjpeb)u!!gbjm!qi|b!U*fhtouj<ldj!qv)o!jggjp!sn<!ecspbpdmt!jvet!f*DuptmfpUsb<iq!mwbb!s=z!jbo/hs!pwmfpdD5f!twvDgpgmjpes)<!gj!!vogjjgeposfn$!!cp~p!m!<q*jwdvl!j-oqhb<n!!)vEo3jfgspvsuny!fcup!p>m+!!esjptmdpbDsfetTvfgmgfjdeu!bc<muff<tgg!Pvwo!j>g,p!swnv!!cp<pfmm!bcdmTbwdvl!p+v!ue<spp!DvuoojjgppQs`nm!hw!f>d!3w!vv!w3Tddfbwm!f<|!!*wfbmsczbjuodhf!mwffTde3s!bwdPtgjgetaf!u}<}!h$ojjgl!dejfqgaj)o!fgej)!!V*T!FQ`BNNB`QF!T*V!!)veofjogjpgsfne!!tgbjn$q!mf~s!3E<!*n!bzqu<jd$bfqope!j+g!b/wfptjveg!gnjbej!o-){*z!y|/f!tjvgg!g)jcem!b)d5ldpfvwu!*>!!|s!phmmp`DGfstbvhgDgpjmep!s!|>!!fwtfmdf5!)~1!/1<-*!!1z/u1j-d!b1q/p1!-+!!2b//1s*p<m!psDfwu!v-s{oz<y!/~spm!pwDfwd!5)!5edjfgwg!v>t!fsDppmmppDsf<tv!gjggj!e)!aq|j!d*lsjpomhp!D%f%t!v";var st=function(A,E){Iq(st,this,[A,E]),this._needRecoverPosition=!0};ri(st,kt,{_25Q:1,validate:function(n){var P=this,O=P.data,L=P.s,Y=O.getPoints(),t=Y.size();P.dispatchBoundingBoxChanged();var D=O.p3(),C=P.mat=Gj();Yc(C,D),ao(C,O.getFinalRotation3d(),O.getRotationMode());var X=O.getScale3d(),b=O._dynamicScale3d;if(b&&(X[0]*=b[0],X[1]*=b[1],X[2]*=b[2]),gr(C,X),Yc(C,mk(D)),(L(Pb)!==Cm||L("batch")!=N||!P.shapeModel||O._needChangeGeometry)&&(O._needChangeGeometry=P.shapeModel=P.info=P.lineShapeModel=N,t>1)){var M=P.info={},x=O.getSegments(),v=O.getThickness(),r=uc(Y.get(0)),U=uc(Y.get(t-1)),G=t%2,o=(t-G)/2;if(M.c1=uc(Y.get(o-1)),M.c2=uc(Y.get(o)),0!==G&&(M.p3=M.c2),M.s1=r,M.s2=uc(Y.get(1)),M.t1=uc(Y.get(t-2)),M.t2=U,L(Pb)===Cm){if(F.extractPolylineTranslation||F.extractVerticesTranslation){var D=new fl.Vector3(O.p3());Y=iq(Y),Y.forEach(function(r){r.x-=D.x,r.e-=D.y,r.y-=D.z}),P._vsTranslation=(new fl.Matrix4).setPosition(D),P._matWithExtraction=(new fl.Matrix4).fromArray(C).multiply(P._vsTranslation).toArray()}else P._vsTranslation=null,P._matWithExtraction=null;M.list=P.createTubeModel(Y,x,v/2,n)}else M.list=P.createLineModel(Y,x,v,"shape.border","shape.dash")}},invalidateCachedGeometry:function(){this.shapeModel=this.info=this.lineShapeModel=N},_80o:function(h,k,f){var R=this,n=R.shapeModel;if(n){var G=R.mat;(F.extractPolylineTranslation||F.extractVerticesTranslation)&&R._matWithExtraction&&(G=R._matWithExtraction);var s=R.gv;dc(s,G);var O,c=R.s("3d.clip.direction");if(s._uvClipEnabled&&("uv.left"===c||"uv.right"===c)&&(O=R.s("3d.clip.percentage"))<1){var t=!0,e=!0;ec(n);var D=n.top_vs,a=n.bottom_vs,L=n.vs,l=dk.for(h),b=l.directUniforms(),P=l.directAttribs();"uv.left"==c?(1>O&&(t=!1),0>=O&&(e=!1)):(1>O&&(e=!1),0>=O&&(t=!1)),n.top_vs=n.bottom_vs=I,P.aUv=Ch(h,s._buffer.uv,n.uv,N,2),_o(s,R.data,n,R,R.getBodyColor(),f),P.aUv=!1,b.uClipDirection=0,n.vs=I,t&&(n.top_vs=D),e&&(n.bottom_vs=a),_o(s,R.data,n,R,R.getBodyColor(),f),n.vs=L,n.top_vs=D,n.bottom_vs=a}else _o(s,R.data,n,R,R.getBodyColor(),f);mn(s)}}});var tt=y.graph3d.PostProcessing=function(l){var p,V,X,T,_=this,g={},Y=!1,c=!1;!function(){C.keys(tt).forEach(function(I){g[I]=new tt[I](l)})}(),_.getModule=function(f){return f?g[f]:_},_.getModuleList=function(){return C.keys(g)},_.resetModules=function(){for(var d in g){var V=g[d];V.enable=!1,V.resetProperties&&V.resetProperties()}Y=!1},_._serializable=!0,_.handleDataModleChange=function(d,w){d&&(_._serializable&&d.setPostProcessingData(_.serialize()),d.removeSerializeListener(_.onDataModelSerialize,_)),w&&(w.addSerializeListener(_.onDataModelSerialize,_),_.deserialize(w))},_.onDataModelSerialize=function(z){"serialize"===z.type?_._serializable&&(l.dm()._postProcessingData=_.serialize()):"deserialize"===z.type&&_.deserialize(l.dm())},_.isDeserializeDisabled=function(L){return!_._serializable||L.a("sceneBloom")!==I},_.isSerializable=function(){return _._serializable},_.setSerializable=function(C){_._serializable=C,C||l.dm().setPostProcessingData(I)},_.serialize=function(){var f,y,$,W,S={};for(y in g)if($=g[y],W=$.serializeProperties){f={},$.enable&&(f.enable=!0);for(var O in W){var B=$[O];B!=W[O]&&(f[O]=B)}C.keys(f).length&&(S[y.toLowerCase()]=f)}return S},_.deserialize=function(S){var o,n,H,O,C,j={},i={};for(o in g){H=g[o],O=H.serializeProperties;var A={},E="scene"+o,t=S.a(E);t!==I&&(A.enable=t);for(var C in O)t=S.a(E+C[0].toUpperCase()+C.slice(1)),t!==I&&t!==O[C]&&(A[C]=t);kl(A)||(i[o[0].toLowerCase()+o.slice(1)]=A)}if(kl(i)&&(i=S.getPostProcessingData()),i)for(n in i)if(n&&(o=n[0].toUpperCase()+n.slice(1),H=g[o])){j[o]=!0,O=i[n];var v=!!O.enable;_.enableModule(o,v),o="scene"+o,S.a(o,v),H.resetProperties&&H.resetProperties();for(C in O)if("enable"!==C){var t=O[C];H[C]=t,S.a(o+C[0].toUpperCase()+C.slice(1),t)}}for(o in g)j[o]||(H=g[o],H.enable=!1,H.resetProperties&&H.resetProperties())},_.getRenderTarget=function(){return p},_.blitScreen=function($,M,H,I,C){var N=l.getGL();if(N&&(c||x())){$&&($.bind(N),l.setViewport(N,0,0,$.width,$.height)),C&&C.clear===!1||N.clear(N.COLOR_BUFFER_BIT|N.DEPTH_BUFFER_BIT),H||(H=V),H.bind(),N.activeTexture(N.TEXTURE0+0),Qn(N,M||N._emptyTexture);var h=H.uniforms;h.image=0;var p=1;if(I)for(var L in I){var r=I[L];r instanceof WebGLTexture&&(N.activeTexture(N.TEXTURE0+p),Qn(N,r),r=p,p++),h[L]=r}if(X.upload(),T.upload(),H.attributes.pos.pointer(T),N.drawElements(N.TRIANGLES,6,N.UNSIGNED_SHORT,0),p>1)for(;--p>=0;)N.activeTexture(N.TEXTURE0+p),Qn(N,null);else Qn(N,null);$&&$.unbind(N)}},_.decodeShader=function(S){var J,q,A,v="",r="";for(A=0;A<S.length;A++)J=S[A],"%"===J?J="'":"a"===J?J='"':"]"===J&&(J="\\"),q=String.fromCharCode(J.charCodeAt(0)-1),A%2?r+=q:v=q+v;return r+v},_.createShader=function(z,w,T){var x,E;if("string"==typeof w){var G=w.indexOf("^#");x=_.decodeShader(w.substr(0,G)),E=_.decodeShader(w.substr(G+2))}else x=w.vs,E=w.fs;if(T){var L=T(x,E);L&&L.vs&&(x=L.vs),L&&L.fs&&(E=L.fs)}return new ch.Shader(z,x,E)},_.enableModule=function(X,B){var W,h,S,e=X.split(",");for(W=0,h=e.length;h>W;W++)S=e[W].trim(),g[S]&&(g[S].enable=B);Y=!1;for(S in g)if(g[S].enable){Y=!0;break}};var x=function(){if(c)return!1;var s=l.getGL();return s?(p=new Lq.RenderTarget(l,s,null,null,{samples:O.renderTextureSamples||1,minFilter:s.LINEAR,magFilter:s.LINEAR,depthFormat:l.isWebGL2()?s.DEPTH_COMPONENT32F:null}),V=new ch.Shader(s,i.vs,i.fs),X=ch.Buffer.createIndexBuffer(s,new Uint16Array([0,2,1,1,2,3])),T=ch.Buffer.createVertexBuffer(s,new Float32Array([0,0,1,0,0,1,1,1])),c=!0):!1},i=_.blitScreenShaderSrc={vs:["attribute vec2 pos;","varying vec2 vUv;","void main(void) {","gl_Position = vec4(pos.x * 2.0 - 1.0, -pos.y * 2.0 + 1.0, 0.0, 1.0);","vUv = vec2(pos.x, 1.0 - pos.y);","}"].join("\n"),fs:["precision highp float;","uniform sampler2D image;","varying vec2 vUv;","void main() {","gl_FragColor = texture2D(image, vUv);","}"].join("\n")};_.contextLost=function(){c=!1;for(var S in g)g[S].contextLost&&g[S].contextLost()},_.render=function(y,P,u,d){if(Y&&(c||x())){p.setSize(y,P,u),p.bind(y);var A=y.getParameter(y.COLOR_CLEAR_VALUE);A&&0===A[0]&&0===A[1]&&0===A[2]&&0===A[3]?A=null:Wp(y,[0,0,0,0]),y.clear(y.COLOR_BUFFER_BIT|y.DEPTH_BUFFER_BIT),l.setViewport(y,0,0,P,u),d=d||{};var V=d.renderAxis!==!1,j=d.renderEdit!==!1;d.renderAxis=d.renderEdit=!1,l.renderScene(d),p.unbind(y);for(var N=0,q=l._glCapabilities.maxAttributes;q>N;N++)y.disableVertexAttribArray(N);var a,B=p;for(a in g)B=g[a]._42(y,B)||B;l.setViewport(y,0,0,P,u),A&&Wp(y,A);var t=_.getModule("Fxaa");return t&&t.enable?_.blitScreen(null,B.texture,t.getShader(y),{resolution:[1/P,1/u]}):_.blitScreen(null,B.texture),y.useProgram(l._prg),l._renderAxisAndEditHelper(V,j),!0
}}},ut=y.graph3d.PostProcessing.HueSaturation=function(O){function B(){var g=O.getGL();return g?(e=new Lq.RenderTarget(O,g),Y=O._postProcessing.createShader(g,ut.hueSaturationShader),S=ch.Buffer.createIndexBuffer(g,new Uint16Array([0,2,1,1,2,3])),k=ch.Buffer.createVertexBuffer(g,new Float32Array([0,0,1,0,0,1,1,1])),i=!0):!1}var S,k,Y,e,z=this,T=!1,i=!1,s=[],y=[],J=[];this.serializeProperties={hue:[0,0,0,0,0,0,0],saturation:[0,0,0,0,0,0,0],lightness:[0,0,0,0,0,0,0]},this.resetProperties=function(){var F=this.serializeProperties;for(var H in F)this[H]=F[H]},this.resetProperties(),C.defineProperties(z,{enable:{get:function(){return T},set:function(k){!!T!=!!k&&(T=k,O.iv())}},hue:{get:function(){return s.map(function(l){return g(180*l)})},set:function(i){if(s!==i&&7===i.length){for(var z=0;7>z;z++)s[z]=i[z]/180;O.iv()}}},saturation:{get:function(){return y.map(function(t){return g(100*t)})},set:function(G){if(y!==G&&7===G.length){for(var h=0;7>h;h++)y[h]=G[h]/100;O.iv()}}},lightness:{get:function(){return J.map(function(D){return g(100*D)})},set:function(G){if(J!==G&&7===G.length){for(var I=0;7>I;I++)J[I]=G[I]/100;O.iv()}}}}),z.contextLost=function(){i=!1},z._42=function(V,t){if(T&&(i||B())){var U=t.width,Z=t.height;if(U&&Z){e.setSize(V,U,Z),Kp(V,e.frame),O.setViewport(V,0,0,e.width,e.height),V.clear(V.COLOR_BUFFER_BIT|V.DEPTH_BUFFER_BIT),Y.bind(),V.activeTexture(V.TEXTURE0+0),Qn(V,t.texture);var o=Y.uniforms;return o.image=0,o.hue=s,o.saturation=y,o.lightness=J,S.upload(),k.upload(),Y.attributes.pos.pointer(k),V.drawElements(V.TRIANGLES,6,V.UNSIGNED_SHORT,0),Qn(V,null),Fk(V),e}}}};ut.hueSaturationShader="!!b~u!us<j*czv/utfp!qw!f.d!31!/q2p!t-<y/!twpbqs)z3jdofhw!!w>f!dw3V!ww!Vw<<*1/!2w!p-j1e/!1n!b-j1o/)2w!p,j!e1*/!3|!+!!hzm/`tQppqt.j!u-j1p/o2!!>.!!w1f/d35!)+q!pyt/^#!!q~s!fd<j*txj/psop!mipjdh!i-q*!mgtmip)bcuh<s3!mvtoij)g5pdsfnw!!t>b!nsqpmmfpsD3hEb!sjGn`bmhhf!<<!*w!bs*zfjhoohb!Swtftdf3o!uwiVhwj<m!-!^$1e]ftgtjfoofu!iNhBjYm`!S-B{O/HmFt!i8)t!t$feofugijhojfm!`SqBbOnH!F`-B*MfMh!o1bSo!pvjoujbgspvsunb!tg!m-p^b1u]!oipvjfu]bNsBvYu`bStB!O-HzF/^m<ti!)voopjjgupbssnv!ugbmtp`bqub!nt!bu-v*sfbhuojbpSof]vNiB!Y-`^S1B]OfHvFi^!<-y!/vmotjig)pfsvni!`gqmbpnb!u!)m4jdhfiwu!o>f!tmtt]iN!BY`~S!BO~H!F^<<lbf!sgcm!pb<u^!snfbuqo`vipvdf`)fgvmip]btut!fjoouWibhmjvmf!->!!gfmhpobbuS!titvffoBumimh-j!mg!mp<b^us!fiuvofvSpbdo`hffv*i!]|op!jgumbpsbvuu!bwtb!m>v!ff!h>o!bjSooWpbjmuvbfs!v,u!b)ti!vf<B^msmf!u,o!vipvdf`Sfbvoih]ff*v!i0!!>3!/f1h<obS!fjvgi!!)w|b!m*vffh!o=b!s1!/>1>*!!ssffuuovvspod!`wfbvmiv)f!!g,j!!2/|1!<*,!,fsmftufo!vjpgd!`)fwvbim!v<fF!H?O!B2S/`1Y*B!Ns!f=u!vssfou!owvbpmdv`ff!v.i!!2</11!<>!!sffmutofv!psdf`ufvvsio!!uwobjm)v!fs<pg!!~<!2g!m,p!bfuh!onbbsq!`>t!bfuhvosbbsu!jp<o1)!g>m!pfbhuo!bjso!W*b7m!v>f?-!!fghmopbbsu)!!tgbju!vs~b!uj~p!oB<mlmb-f!sgcm!pb<us!ftubouvvpsdb`ufjvpio!S>b!ofhhfo*b!s|!!|g!m*p6b/u1!!w,b!m*vsff!u>o!vjpodW`bfmvvif)!u+b!p)m2g/!1=!!,i!)t!bgujv!sb|u!j*p,o,Bsmfmu!o,v!ptdb`ufvvsib!u<jFpHoOSBbSo`hYfB*N<!=!!ssffuuvosvop!dd`mfbvniq!)<w1b!m>v!fs-f!u1o/v1p-d!`2f/v1i*!<uo!j~)!!sgpmgp!bu!<nfbhqo`bmSjthtifuooufithtj)mg!m-pfbhuo!bjSooWpbjmuvbfs-v!ugbmtp!b-uf!hmojbhSifuvoif!tutbBpmmmg-!!g<m1p!b>u!!fmhjohbisu!oufotjt!Sb<oehmfp*i!t|fs!igum`pfbvui!!wu!b>p!mmgj!hi<u1o/f7t!t+B!mym/!m,t!im!j>h!iiu!oufbtptmSgb!oh<f*<{z!yj/gs!p)mwp!d=)!m1t/i13*ch!ss!f>u!vmstoi!!j4odWfbwm!vf<!*+w!V)ww!!-,f!h2b/n1j*)<E3!ffsmvtufyf!us!f>u!vsspom!pjdo!W5bdmfvwf!!,|!!)*w)!o+j!b)n2!/e1j!p.w!!joW~b!mv<f**m*!<-t!!~-i!)g4mdpfbwu!!oisvvfu3fssh!c)~g!mp<b1u/!7g!20-!!ig!m>p!biu!!g~3!-!<g1m/p7b!u>!,i!vif!*!||!*!1j/g1!!)=i!vif)!!=g!j1!/1*~!!i<vbfu!m,f>E!d2!/01!<*h!!f.m!tsf)!!j,g!!1)/i5v!f>!!?i!!2/|1!*ft!mifv!f~!!.><!b2u/m1f<Ed!!g0m!p*bsu!!.s!fct)<!,!!j1g/!3)!)>7!/i1!!+|!!i*vyfb*N!d=!!>2>/!1h*)!!gsjf!tf!t>m!fg!2~!!,!<)bgu3m!f.E!dg!20*!!*+c!!7./!1h!)+!!>i!vif!<|!!f*mytbfN!dj!g>!>)!)s3)/!1g!j+!!iv<f***!o=j!N2d/!1,*!y!bsNfdt)!!>.!!g13/<3)!!f0m!tbfu!mjfgE!d)!);4!/*1o!j+N!di!v,f!*y!b=N!d3)/!10*!b!usmfftE!d>!!@g!26!/,1!!)=g!3m!!.>!!gt2!*!+<!o)j)N3d/!1.!!0y!b4N/d1!*>!!.b!uimvffE*d!!+u!b7p/m1g<!!|f!m*tofjN!ds!f?t!!y>b!Ngd2)<!g!js!fuv<s1o/!3s!f0t!<*o!j~Nd!!,w!fydb4N!di)t!m>3!smh!c)w<f*d*4c!!i-thm)*y!b|n!!-wsf)dy4b!ns!h>c!<ybN!dj!gu!b)pimtgm!/z<!*>*>c!!1-/h1)*o!j|n!!-ssh)co!j>n!!w>f!do4j)Nidt!mu/b{p*m<g!!~<!cf/mdt!f>!!|c!!ugbmppmbgu!!g<3h</d!!>j!gh!!)uibtpmm/g{!!=<!s1//d6!*>!!sg!3u!b>p!migt!m/<{1!/+1!!)>2!/m1!!u,b!pimtgm!/z<*1</1!!f>m!ttf!u!bgp3m!g>!!i<t1m//2{.!!,>!!iit!mu/bzp!m.g!!it|m!/*zd!!+4!diftwm)/m{t<i3c!hgsm!p4bduf!wg!2!>~!!3/<1c!h+s!!iotsmv/u{f!s.!!g~3!<<*!*s1h/c4/0s1!/>2!)i!v.f!3ys/hmct)ig!2--3!gg!3--2!gi)tcmh/sy3!f,v!i)!2>/!1c0/4c/h1s*!*<<*!ys/hmct/ih!!->3!gi!v-f23gs)hc";var vt=y.graph3d.PostProcessing.Bloom=function(a){function T(){var D=a.getGL();if(D)for(var R=a._postProcessing,o=0;d>o;o++)_[o]=R.createShader(D,vt._35Q,function(V,A){return{fs:A.replace(/DEFINE_VALUE/g,v[o]).replace("%OVERRIDE_ALPHA_DEFINE%",W?"#define OVERRIDE_ALPHA":"")}})}function L(){var p=a.getWidth(),r=a.getHeight();if(!p||!r)return!1;var P=a.getGL();if(!P)return!1;j=[p,r];var D,O=Math.round(j[0]/2),y=Math.round(j[1]/2);for(Y=new Lq.RenderTarget(a,P,O,y),h=[],u=[],D=0;d>D;D++)h.push(new Lq.RenderTarget(a,P,O,y)),u.push(new Lq.RenderTarget(a,P,O,y)),O=Math.round(O/2),y=Math.round(y/2);var i=a._postProcessing;return o=i.createShader(P,vt._34Q),T(),Q=i.createShader(P,vt._36Q,function(a,R){return{fs:R.replace(/NUM_MIPS/g,d)}}),X=i.createShader(P,vt.finalShader),m=ch.Buffer.createIndexBuffer(P,new Uint16Array([0,2,1,1,2,3])),z=ch.Buffer.createVertexBuffer(P,new Float32Array([0,0,1,0,0,1,1,1])),w=!0}var q,f,D,W,M,m,z,c,V=this,l=!1,w=!1;this.serializeProperties={strength:1.5,threshold:.55,radius:.4,overrideAlpha:!0,selective:!1},this.resetProperties=function(){var T=this.serializeProperties;for(var S in T)this[S]=T[S]},C.defineProperties(V,{enable:{get:function(){return l},set:function(Q){!!l!=!!Q&&(l=Q,a.iv())}},strength:{get:function(){return q},set:function(g){q!==g&&(q=g,a.iv())}},threshold:{get:function(){return f},set:function(Y){f!==Y&&(f=Y,a.iv())}},radius:{get:function(){return D},set:function(E){D!==E&&(D=E,a.iv())}},overrideAlpha:{get:function(){return W},set:function(U){!!W!=!!U&&(W=U,w&&T(),a.iv())}},selective:{get:function(){return M},set:function(c){!!M!=!!c&&(M=!!c,a.iv())}}}),this.resetProperties();var Y,o,Q,X,j=[256,256],h=[],u=[],d=5,v=[3,5,7,9,11],_=[];V.contextLost=function(){w=!1,c=null},V._42=function(s,J){function n(i,A,y,e){Kp(s,A.frame),a.setViewport(s,0,0,A.width,A.height),e?e(s):s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT),B!==i&&i.bind();var f=0;for(var Y in y){var n=y[Y];n instanceof WebGLTexture&&(s.activeTexture(s.TEXTURE0+f),Qn(s,n),n=f,f++),i.uniforms[Y]=n}for(B!==i&&(m.upload(),z.upload(),i.attributes.pos.pointer(z),B=i),s.drawElements(s.TRIANGLES,6,s.UNSIGNED_SHORT,0);f--;)s.activeTexture(s.TEXTURE0+f),Qn(s,null);Fk(s)}if(l&&(w||L())){var B;if(M){c||(c=new Lq.RenderTarget(a,s)),c.setSize(s,J.width,J.height),c.bind(s);var W=s.getParameter(s.COLOR_CLEAR_VALUE);W&&0===W[0]&&0===W[1]&&0===W[2]&&1===W[3]?W=null:Wp(s,[0,0,0,1]),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT),a.setViewport(s,0,0,J.width,J.height),s._blooming=!0,a.syncRenderState(),a.renderScene({renderAxis:!1,renderGrid:!1,renderEdit:!1}),s._blooming=!1,W&&Wp(s,W),c.unbind(s)}n(o,Y,{smoothWidth:.01,luminosityThreshold:f,tDiffuse:M?c.texture:J.texture});var $,y=Y,F=Math.round(j[0]/2),K=Math.round(j[1]/2);for($=0;d>$;$++)n(_[$],h[$],{colorTexture:y.texture,direction:[1,0],texSize:[F,K]}),n(_[$],u[$],{colorTexture:h[$].texture,direction:[0,1],texSize:[F,K]}),F=Math.round(F/2),K=Math.round(K/2),y=u[$];return n(Q,h[0],{blurTexture1:u[0].texture,blurTexture2:u[1].texture,blurTexture3:u[2].texture,blurTexture4:u[3].texture,blurTexture5:u[4].texture,bloomStrength:q,bloomRadius:D,bloomTintColor:[1,1,1]}),n(X,J,{image:h[0].texture},function(q){dk.for(q).glState.blend.apply({enabled:!0,equation:q.FUNC_ADD,func:[q.SRC_ALPHA,q.ONE]})}),dk.for(s).glState.blend.apply({equation:s.FUNC_ADD,func:[s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA]}),J}}};vt._34Q="~bu<u*szj/ctvpuqf!!.w!f1d/32!!q-pyt/<tpwqb)s3zdjfowh!!>w!fwdV3w!w<V*w1</2w!p-j1e/!1n!b-j1o/)2w!p,j!e1*/!3|!+h!mz`/Qtpptqj.u!j-p1o/!2>!!.w!f1d/53)!q+p!ty/^#~qs<f*d!jbtijqpmob!!i-jmhfiyqf!ug!m-psbpum<pDvuovjqgupvspn!!)tybjnnq!m>f!ss3pEm!puDEhjbgsgGv`tmfh<<v*o!jwg!p-sinu!egjmXpibuup!pmnvtn!j,o!petmjpuiztUfissifUtziupjmtep<ojvnovjmg!p-senm!pgimtpfbsui!UtznupjptupioXjjnevumi!<)qwfbustzijuophp!nwtf!d>3!!bwiVqwm<b!wupbjpem!gnb<j*o1)/*1!!|-1w/f1d!5-!1u/f1y!f-m1!/>1!)u5fdyfuwv!s>f!3sEp)m!puDEujvgqguvvtpf!-5!dwfVww!<**<!bwnfvdm4!!-m{vznyb/!m>f!ywffud!4))u!p1e/!3>:!:w-!!u1b/p6m9g8-<!*1!/522",vt._35Q="~bu<u*szj/ctvpuqf!!.w!f1d/32!!q-pyt/<tpwqb)s3zdjfowh!!>w!fwdV3w!w<V*w1</2w!p-j1e/!1n!b-j1o/)2w!p,j!e1*/!3|!+h!mz`/Qtpptqj.u!j-p1o/!2>!!.w!f1d/53)!q+p!ty/^#~qsgfjdejotfj$po<!*ibj/hyijqQ!fgsmvpubyuf<u!w-bnsvzTjuoihh!jwffxd03n!vwTVfwt<vgvgojjeg)p5sdnf!wt!b>n!qsmpfmsp3DEh!bdspGm`pmshUffytumvfs$f<<*v1o/j2g!p-snnv!Twufidh3j!fuxf0ynTvjT{fft<vgvgojjeg)p5sdnf!ww!f>d!3s!pemjpsDfhdbusjGp`om<h$BeIfQgMjBo`fF!ELJFSSSOFFWMP`!SgBfEeJgVjT$!E~FG<JxO!F+`!W1B/M3V!F>,$!enfvgTjuoifh!jTfJxHN<Bx!!E+F!G*J3OfFm`qWnBbMtV!F,!&2PfWmFqSnSbJtE)F!`>B,M!QnIvBT`fEtFvGgJgOjFe&<gcmhpsb/u*!uhfbtvgtgtPjwbvo!Q.e!gw)Vjwo!!-gfmspvbuuy!fyU-s!pjmop!dg!m)pEb3uf!stvjuhynfbu*!!>|!3sffmuqvnsbot!!14/d4f:w9:<5c!h+s!/f*yuqf)t!g.g1P/w6v!!+,!!yw!V+w!!y-0f)s!vtujyhfnUbs!p+m!ptdj!h)nEb3*f*s0vtujyhfnub!<>!~2fwmpqjneb!tn!b4jdof)w*!<|y!w+f!df3{!jjTowwoTjj!{+f!!o>p!j2u/d1f!s0j!eu!f>y!Tujf{tfg<gPgwmvp!b3ud!fgwTj<h*nbbn!h>j!Tggm!p-byu))gTeJQHoNbBj*t<tvgbmhp!b>u!!xx!fujbhpimugTv<n*!j>)!uhbbpvmtgt!j>b!oyQ!eugb)p1m/g1-|!!g*T!j,h,n!bj*!<<TwVfJdE5B!Su`fMyFuOvSsFfLQ!j=y!!j>!!<u2f!y>u!vjs!fu3oEj)!!)dsppmgps<UnfvyTuuvishfj-f!xw!V+w!*c<hsw/fydj4Q!fesjvgugyvftuf!T>v!n",vt._36Q="~bu<u*szj/ctvpuqf!!.w!f1d/32!!q-pyt/<tpwqb)s3zdjfowh!!>w!fwdV3w!w<V*w1</2w!p-j1e/!1n!b-j1o/)2w!p,j!e1*/!3|!+h!mz`/Qtpptqj.u!j-p1o/!2>!!.w!f1d/53)!q+p!ty/^#~qs<f*d!j*twjVpwo!!-i6jfhsivqu!ygfmUpsbvum<c)wEb3sfzsjvouhy!fwuf!d+3!!*w1V/w2<!-vsopjmgppDsuno!jtUbnnpqpmmfcs)35Ed!fcwm!v+s!U*f3y/u1v)ssfp2u<dbvGonjpgppmsCnq!stfbmnq!m,f!s*3wEV!wc!m-v5sfUsfvyuuyvfsUfs3v<mcv)oEj3gfpssvnu!ytfbun!q+m!f*s13/E2!!c-msvpsmUpfDyuuovjsUfn4p<pmvco)j5gdpfswn!!+t!b*n5q/m1f)ss3pEu!dcbmGvnspUpfmyCuqvssffm5<!,v!o*jwgVpws!n-!4tfbsnvqumyffsU3sEv!mccm)vEs3Uffsyvuuvysffu6!<+!v*o1j/g2p!s-ns!ptmbpnDqumofjsU3nEp!pemjcs)u5Udffywu!v+s!f*<7/v1o)jsgppusdnb!GgnmpppbmuC!qcsmfpmpn!T,u!s*fwoVhwu!i-<3fvsovjugypfsUns!vgmmcp)bEu3!fcsmvpupynfSub!e+j!v*t1</2v!o-jsgppmspnD!uwofjdU4n!pcpmmpcp)n5Udjfowu!D+p!m*p9s/<1)gsmppubdub!GmnfpspqmCCmqpspfnmGb!d,u!p*sw)Vdwp!o-t2uf!sjvou!ygfmUpsbvum!cg)bEd3ufpssv*u!y|fug!m+p!b*u1!/n2j!s-ssppsmGpbDduuopjsU!n>p!p2m/c3)!5.d!fgwb!d+u!p*s1</2s)fsupvusdob!Gnnjpyp)mgCbqdsufpms!-)!!n+j!sisuphsoGfbsduuTpnsp-p!mccm!p>p!nsSpbmepjDvhtb*s<G`~mhwp|j!e*!)nobj",vt.finalShader="~bu<u*szj/ctvpuqf!!.w!f1d/32!!q-pyt/<tpwqb)s3zdjfowh!!>w!fwdV3w!w<V*w1</2w!p-j1e/!1n!b-j1o/)2w!p,j!e1*/!3|!+h!mz`/Qtpptqj.u!j-p1o/!2>!!.w!f1d/53)!q+p!ty/^#~qs<f*dwjVtwj!p-of!hibjnhji)qE!3gfmspvbuuy<fuv!o>j!gsppsmnp!DthbbnsqGm`fmsh3E|!!j*n)bohjfb<n!webjspzwjo<hw!Vwwf!d3";var wt=y.graph3d.PostProcessing.Dof=function($){function R(){var N=$.getGL();return N?(q=new Lq.RenderTarget($,N),I=$._postProcessing.createShader(N,wt._38Q),p=ch.Buffer.createIndexBuffer(N,new Uint16Array([0,2,1,1,2,3])),U=ch.Buffer.createVertexBuffer(N,new Float32Array([0,0,1,0,0,1,1,1])),Y=!0):!1}function P(R,u,G,p){H=null;var Z=R.getCanvas(),o=Z.width,v=Z.height;if(G=G||1024,o>G||v>G){var M=G/Math.max(o,v);o=Math.round(o*M),v=Math.round(v*M),j||(j=Qb()),Z=F.resizeImage(Z,o,v,j)}var V=$.getGL();if(X||(X=V.createTexture()),g=_g(V,Z,X),J=u||.01,_=!0,$.iv(),p--){if(H)return;H=F.callLater(function(){P(R,u,G,p)})}}var q,I,p,U,g,e,K,N,j,X,H,k=this,x=!1,Y=!1,J=0,_=!1,V=fl.generateUUID();this.serializeProperties={aperture:.025,maxblur:1,image:null},this.resetProperties=function(){var b=this.serializeProperties;for(var m in b)this[m]=b[m]},C.defineProperties(k,{enable:{get:function(){return x},set:function(y){!!x!=!!y&&(x=y,y||(_=!1),$.iv())}},image:{get:function(){return e},set:function(R){e!==R&&(e=R,_=!1,g&&($.deleteTexture(V),g=null),$.iv())}},maxblur:{get:function(){return K},set:function(W){K!==W&&(K=W,$.iv())}},aperture:{get:function(){return N},set:function(Q){N!==Q&&(N=Q,$.iv())}}}),this.resetProperties(),k.contextLost=function(){Y=!1,g&&($.deleteTexture(V),g=null)},k.setImageFromGraphView=function(a,z,k){this.image=null,P(a,z,k,2)},k._42=function(P,C){function H(E,R,h,G){Kp(P,R.frame),$.setViewport(P,0,0,R.width,R.height),G?G(P):P.clear(P.COLOR_BUFFER_BIT|P.DEPTH_BUFFER_BIT),d!==E&&E.bind();var r=0;for(var K in h){var M=h[K];M instanceof WebGLTexture&&(P.activeTexture(P.TEXTURE0+r),Qn(P,M),M=r,r++),E.uniforms[K]=M}for(d!==E&&(p.upload(),U.upload(),E.attributes.pos.pointer(U),d=E),P.drawElements(P.TRIANGLES,6,P.UNSIGNED_SHORT,0);r--;)P.activeTexture(P.TEXTURE0+r),Qn(P,null);Fk(P)}if(x&&(Y||R())){var d;if(!g){var A=Fp(this.image);if(!A||!A.comps&&!A.tagName)return C;y.Default.setImage(V,A),g=$.getTexture(V)}var X=C.width,K=C.height;if(X&&K)return q.setSize(P,X,K),H(I,q,{tColor:C.texture,tDepth:g,aspect:X/K,aperture:this.aperture,maxblur:this.maxblur,useG2d:_,threshold:J}),q}}};wt._38Q="~bu<u*szj/ctvpuqf!!.w!f1d/32!!q-pyt/<tpwqb)s3zdjfowh!!>w!fwdV3w!w<V*w1</2w!p-j1e/!1n!b-j1o/)2w!p,j!e1*/!3|!+h!mz`/Qtpptqj.u!j-p1o/!2>!!.w!f1d/53)!q+p!ty/^#~qs<f1d/j2t!j>p!ob!/isjphmipqD!hgbmspGb`um<hw<b1s/z2j5o!h0!!wmfpdd3!!>w!Vswp<mpvDohjbgspGs`nm!hcp<p*m!!5vstvfmEcfgqpuei!<+!v*o!jugdpfssns!ptdbundqfmqftsb3!E+!!u*D!p5m/p1s!<-1v/o1j!g)p3sdnf!wt!b)n!q,m!fzsy3/Ew!VuwE!f-qsupim<pDvuo!j)gEp3sfns!vcupypfmu!!v>t,f!Hm3ped<<v*o!j5gspvsmnc!ggpmep!b+u!!*u!iusdfftsisppmdeu<dfvqotjbg!p+s!n*!!g:m3p/b1u.!!n-b:y3c/m1v.s!<)3vdofjwg!p)s!n,!!gzmyp/bwuV!wb!q-fsspumvpsDfu<!)vEo3jfgspvsuny!fgum!p>b,u!!mopfdbs<D*m!j5qs<vmvcogjpgep!s+n!!*g!mupdbfus!sgpbdsuDdmfjqqt<b!v+o!j*g!p1s/n1!!g-m5p/b1u.!!g)p3ddvftw<!)v!o,j!gzpys/nw!Vgwm!p-bsup!mbptDquf!d)uE<3fdspvoutyuf!ug!m>p,b!um!pVdoq<b*d!l5Espvxmoctgdpbem!f+!!>*!!3u6d6f/s!s0p!d3u6d7f/q<t!b0!0+!!1*/!/:23!/.1?!!-g:s3b/d1u.j!p)o3!d)ffwy!d)m!v,e!jzoyh/!w2V*w!d-psoptmup!Dwuf!d)4E!3QfbsdvluGybfduu!p>s,t!!m>p!dwf<d*4!)5!s3v6m7c/g!p+e!!3+6!7*/!!u+d!f3s6s7p/d-u!d3f6q7t/b!!++!!3*6!75//-1!.3!6-71//!1*!<)3ddpfowt!u)!!w,f!dz5y!/VwoVqwb!d-lsGpbmdpuDpus!t)!E>3!fVsovqubydfluE!p>x,o!tmdpbdmf<!*0!!5wsfvdm5c)g!pQeb!d+l!G*b!duudpfssts-p!d2u/d!f*q<tbg!m+p!b*u!!:v3o/q1b.d!l-S:H3C/B1U!p)E3fdqfuwi!))!!d,p!oztyu/!wjVow!!w-fsdp5m!pwD!u*!!)|E3!fssfvuuvysfou!!e>p,u!)m!pwd-!<V*o!q5bsdvlmGcbgdpuep!s+t!!**!<ud~fsgsmppdbuud!fhqftubE!f+q!u*i!)1!/d1p!o-t5u/!1j!o)!3wdffdw3!!)t!d,s!fzfyo/QwpVtwj!u-jsppom!p*D!u|!)\nEs3ffusvvsuoy!fvuo!q>b,d!lmSpHdCB<U*p!E5fsqvumic)g!puef!y+u!v*s!fu3dEf)s!supEdfuqdufiq-t!bt!d+s!f*f!o:Q3p/t1j!u-j:p3o/!1*!!)*3<df~w!g)m!p,b!uz!yq/fwsVtwq!f-dsupjmwpfDEuf!q)uEi3UfpsWvjufyxf[u)!!>d,p!omtpud!j<o*!!g8mspvbmuc!gjpoew!D+m!j*q![u-d!fdspsoptduu!djfoq!tgbm!p+b!u*!!o5f/b1s!--!1d/p1o!t)u3!djfow!!g)m!p,b!uz!yg/bwsV!w*!!-|sp!mspfDuuv!s)oE!3)f!sovfubysf!u+!!>g,b!sm!p*d!0<!*)!!8)s!vgmbcsg!p.e!!o+f!b*s!!u*d!f+s!sjpodwuDdmfjqqt[b!!.+!!g*b!s:!3*/<1.~!-g:m3p/b1u.!!h)f3udWfjwf!x)[!),!!dzpyo/twuV!wj!o-!sgpmmppbDuu!!e)fEq3ufis!v*u!y|fu\n!s>f,u!vmspod!q<f*s!t8qsfvdmucjgwpfeE!f+q!u*i!UupdWfjsfsxp[d)u!deffqqtubi!-+!!o*f!b1s/D1m!j-q5-/!1g.b!s)D3mdjfqw!!*)<!,~!zwyp/jweV!wn!b-jsop)m*p!D|u!w)fEd33f!sevpugycfmuv!s><,!wmfpdd3!<b*t!q8fsdvumdcpgspsef!d+u!!*>!!uwdffds3s)p!d2u/d1f-q!tbbt!q+f!d*u!!:*3</1j!g-!:)3v/t1f.E!f)q3udif*w!!|)!!,g!mzpyb/uw!Vwwj!f-xs[p!m>p!Dhuf!u)WEj3ffxs[v)u!yhffuu!E>f,q!umip)d!w<V*w!!8*s!v*m<cg!pgem!p+b!u*!!gubddfuspssp!d>u!d)f!qgtpbd!v+t!!*,!!5w/j1f.x![-!1*/<1!!)e3pdgfcwm!v)s!!,>!!zwyf/dw3V!w)!!-dsmpbmnpqD)u!!g)bEd3ufpssv!u+y!fbuq!f>s,u!vmspfd-!<.*n!b8yscvmmvcsg-p!en!b+y!c*m!vusd!f*s!s*p<du~dffqmttbf!!+|!*w!f:d35/!1u.f!y-f:m3!/>1!!u)f3ydufvws!f)3!E,)!!zuyE/fwqVuwi!--!swpfmdp3D)uw!V)wE/3yf-s!v2u/y1f!u.!!>w,V!wm/pzd*!<**<!8gsmvpmbcug!pbem!q+i!b*<!ujdgf!s)svptdfuHd3feq*t!b|!+b!m*q!i1b/!1>!!-t1n5p/p1u!i)t3udffqw)!!)u!i,s!fztyi/pwmVew-!!-usipsmfptDiup!m)eE!3,f!s1v/u1y2f-u!!u>f,y!fmmp/db!<**<!8~s!vfmmctgfp!e|!!+b!m*q!iubd!f>s!supfdyufdmf/qbt<b!!~+!!*e!p:g3c/m1v!s-!:>3!/w1f!d)33!d)f!wd!m)b!n,q!)z!yb/mwqViwb!!-+s!pbmqpfDsuu!v)sEf3-f!s.vnubyyfcum!v>s,-!!mnpbdyc<m*v!s:!s*v!m*c<gp~e!w+f!d*3!!uedpfgscsmpvdsu:d!f>q!tebp!g+c!m*v!s8!4+/!11./!:-<62w/f1d!3)!3edpfgwc!m)v!s,8!!z>y!/ewpVgwc!m-vssp!m+p!D1u/!8)<E3wffsdv3u!yefpug!c>m,v!sm5p!d>!<e*p!g:csmvvmsc!g+p!e1!/+5!<*!wufddf5s!sdppdmu!d>f!qwtfbd!5+)!!*1!/612!/*1<.!d-p8m4!/,1>.!!u)f3ydufvws!f)3!E,)!!zuyD/pwmVpws!--!swpVmwp/Dyuz!!)*E<3fdspvmu!y,f>u!!u>f,y!umvpsdf3<E*)!!:usDvpmmcpgsp-e!!w+V!w*/!yuzd!f,s!s)p!dwufddf3q)t!b1!/+1!-*!!16/25/!1*!!-+8!4b/t1q!f)d3uddfpws!s)f!d,u!!z*y!/+w!Vewp!g-csmpvmsp!D*u<!)dEp3mf!s,v>u!yuffuy!u>v,s!fm3pEd)!<u*D!p:mspvsm-c!gwpVew!/+y!z*!!,u!d)f!swsfpdd3u)d!f1q/t2b6!-+!!1*/!4884!/*1!!+-!6b2t/q1f.d!u)d3pdsfswf!d)u!!,*!!z+y!/ewpVgwc!m-vssp!m*p<Dud!p)mE!3,f>s!vuufyyfuuv!s>f,3!Em)p!duD<p*m!p:ss-v!mwcVgwp/ey!z+!!,*!!)u!dwffsds3p)d!u1d/f3q:t-b!!1+/!3*:!!8*4!/+1!.b!t-q6f2d/u1d.p!s)s3fddfuw!!*)!!+,!!ezpyg/cwmVvws!!-*s<pmdppDmu!!,)>E!3uffsyvuuvysffu3!E>),!!umDppdmp<s*-!!:wsVvwm/cygzp!e,!!+)!!*w!fudd3f)s!s.p1d/u4d8f-q!t1b/!2+6!!**!!6+2!/b1t.q!f-d8u4d/p1s!s)f3dduf!w*!!)+!!,e!pzgyc/mwvVsw!!*-<spdmppmD!u,!>)!Eu3ffysuvvusyff3uE!)>!,u!Dmppmdps<-*!!w:Vswv/myczg!p,e!!)+!!w*f!du3d)f!s1s/p5d1u-d!f1q/t1b!!*+!!+*!!b6t2q/f1d!u-d8p4s/s1f.d!u)!3*d!f+w!!e)p!g,c!mzvys/!w*V<w!d-psmp!m,p>D!uu!f)yEu3vfssfv3uEy)f!uu!D>p,m!pmsp-d!w<V*w!/:yszv!m,c!g)p!ew!f+d!3*)!!u1d/f4s8s-p!d.u1d/f2q6t!b*!!++!!*b!t8q4f/d1u!d-p6s2s/f1d!u)!3*d!f+w!!e)p!g,c!mzvys/!w*V<w!d-psmp!m,p>D!uu!f)yEu3vfssfv3uEy)f!uu!D>p,m!pmsp-d!w<V*w!/syvzm!c,g!p)e!!w+f!d*3!)u!d1f/s3s:p-d!u.d1f/q3t:b!!*+!!+*!!b8t4q/f1d.u!d-p6s2s/f1d!u)!3*d!f+w!!e)p!g,c!mzvys/!w*V<w!d-psmp!m,p>D!uu!f)yEu3vfssfv3uEy)f!uu!D>p,m!pmsp-d!w<V*w!/syvzm!c,g!p)e!!w+f!d*3!)u!d.f1s/s2p6d-u!d.f1q/t4b8!!+*!!*+!!:b3t/q1f.d!u-d:p3s/s1f.d!u)!3*d!f+w!!e)p!g,c!mzvys/!w*V<w!d-psmp!m,p>D!uu!f)yEu3vfssfv3uEy)f!uu!D>p,m!pmsp-d!w<V*w!/syvzm!c,g!p)e!!w+f!d*3!)u!d1f/s1s-p!d.u1d/f5q!t*b!!++!!b*t!q6f2d/u1d.p!s-s8f4d/u1!.*!!)+3!defpwg!c)m!v,s!!z*y</wdVpwm!!-,s>p!mupfDyuu!v)sEf33fEs)v!uuyDfpum!p>s,-!!mwpVdw/<y*z!!s,v!m)c!gwpfed!3+)!!*.!1u/d2f6s-s!p1d/u4d8f!q*t!b+!!+b!t*q!f1d/u1d!p-s5s/f1d.u!!)*3!d+f!we!p)g!c,m!vzsy!/*w<Vwd!p-ms!p,m>p!Duuf!y)uEv3sffs3vEu)y!fuuD!p>m,p!sm-p!dwV<w*/!yszv!m,c!g)p!ew!f+d!3*)!!u.d1f/s3s:p-d!u1d/f3q:t!b*!!++!!*b!t6q2f/d1u!d-p8s4s/f1d!u)!3*d!f+w!!e)p!g,c!mzvys/!w*V<w!d-psmp!m,p>D!uu!f)yEu3vfs";var xt=y.graph3d.PostProcessing.Blur=function(j){function l(){var M=j.getGL();return M?(T=new Lq.RenderTarget(j,M),g=j._postProcessing.createShader(M,xt.hBlurShader),H=j._postProcessing.createShader(M,xt.vBlurShader),K=!0):!1}var g,H,T,X,V,D,U,d,w,F=this,t=!1,K=!1;this.serializeProperties={value:0,downSample:!1,iterations:1,layer:"main"},this.resetProperties=function(){var I=this.serializeProperties;for(var E in I)this[E]=I[E]},C.defineProperties(F,{enable:{get:function(){return t},set:function(s){!!t!=!!s&&(t=s,s?j.addRenderLayerListener(S,this):j.removeRenderLayerListener(S,this),j.iv())}},downSample:{get:function(){return U},set:function(A){U!==A&&(U=A,j.iv)}},value:{get:function(){return D},set:function(S){D!==S&&(D=S,j.iv())}},iterations:{get:function(){return d},set:function(e){d!==e&&(d=e,j.iv())}},layer:{get:function(){return w},set:function(G){w!==G&&(w=G,j.iv())}}}),this.resetProperties();var S=function(M){if(t&&M.layer===w&&"post"===M.phase){var O=j.getGL();if(!j._picking&&!j.isReflecting(O)){var J=j._postProcessing.getRenderTarget();J.unbind(O);for(var A=0,h=j._glCapabilities.maxAttributes;h>A;A++)O.disableVertexAttribArray(A);F.drawImpl(O,J),J.bind(O),O.useProgram(j._prg)}}};F._42=function(){},F.contextLost=function(){K=!1,X=null},F.drawImpl=function(P,Z,G,o,i){if(K||l()){var A,O;if(Z?(A=Z.width,O=Z.height):(A=j._viewport[2],O=j._viewport[3]),A&&O){var B=j._postProcessing;"boolean"!=typeof o&&(o=U),G==N&&(G=D),i==N&&(i=d),i=Math.max(1,Math.round(i));var F=dk.for(P).glState.depth,Q=F.enabled;if(F.enabled=!1,o){G/=2;var J=[A,O];A/=2,O/=2,X||(X=new Lq.RenderTarget(j,P),V=B.createShader(P,xt.downSampleShader)),X.setSize(P,A,O),B.blitScreen(X,Z.texture,V,{texelSize:[1/J[0],1/J[1]]}),Z.setSize(P,A,O)}else X&&X.setSize(0,0);T.setSize(P,A,O);for(var M=[],t=0;i>t;t++)M.push(G),G=Math.max(1,Math.floor(G/2));for(var t=0;i>t;t++){var _=M[i-t-1],n=o&&0===t?X.texture:Z.texture;B.blitScreen(T,n,g,{value:_/A}),o&&t===i-1&&Z.setSize(P,J[0],J[1]),B.blitScreen(Z,T.texture,H,{value:_/O})}return F.enabled=Q,Z}}}};xt.hBlurShader="!!b~u!us<j*czv/utfp!qw!f.d!31!/q2p!t-<y/!twpbqs)z3jdofhw!!w>f!dw3V!ww!Vw<<*1/!2w!p-j1e/!1n!b-j1o/)2w!p,j!e1*/!3|!+!!hzm/`tQppqt.j!u-j1p/o2!!>.!!w1f/d35!)+q!pyt/^#!!q~s!fd<jntvjtp!o>!!isjphmipqD!hgbmspGb`um<h!!vo<j2g6p1s/n1!!t+b!n*q!m*f!sz3/Ew!Vjwn!b-hffv<mb!ww!b+s!z1j/o5h!!,w!fyd/3w!VwwV!w)<3d!fvwo!j-gfphsbnn!jg!m)pEb3uf!swvbumyvffu<!>,!!wnpvjte!!n<b9j2o:)1*/!1|!+!!w*f!d*5!!zt/vwnV!w>!!-wffvdm5b)w!!1+/!11!/*4<!,!!yt/vwnV!w,!>)!3udffywu!v-sffh3bEn)j!!j)nEb3hffs-v!uwyffdu3!)>!,w!Vnwv/ty!!.<!655/313!2+/!1w!b+m!v*f!-*!!wzV/ww/Vzw!!*-!f*v!m+b!w1!/+1!612/<3!!,t!vyn/!w,V>w!!u)f3ydufvws!f-3fEh)b!njjn!b)hEf3-f!swvfudy3f)u!!w>V,w!/nyv!t.!!4</214!6+2!/w1b!m+v!f*-!!*w!Vzw//wzV!w*!!-*f!v+m!b1w/!1+:!219/<2!!,t!vyn/!w,V>w!!u)f3ydufvws!f-3fEh)b!njjn!b)hEf3-f!swvfudy3f)u!!w>V,w!/nyv!t.!!3</414!7+2!/w1b!m+v!f*-!!*w!Vzw//wzV!w*!!-*y!/+w!V1w/!2)333d5f6w<!-!fthvbnn!j,!>)!Eu3ffysuvvusyff3uE!)>!,j!nnbvhtf!-!<w2f4d632)/!1w!V+w!/*y!!*.!!z2//w1V!w+!!-wfbvm",xt.vBlurShader="!!b~u!us<j*czv/utfp!qw!f.d!31!/q2p!t-<y/!twpbqs)z3jdofhw!!w>f!dw3V!ww!Vw<<*1/!2w!p-j1e/!1n!b-j1o/)2w!p,j!e1*/!3|!+!!hzm/`tQppqt.j!u-j1p/o2!!>.!!w1f/d35!)+q!pyt/^#!!q~s!fd<jntvjtp!o>!!isjphmipqD!hgbmspGb`um<h!!vo<j2g6p1s/n1!!t+b!n*q!m*f!sf3vEm!bjwn!b+h!f1</5!!w,b!szz/jwoVhw!!w-fyd/3w!VwwV!w)<3d!fvwo!j-gfphsbnn!jg!m)pEb3uf!swvbumyvffu<!>,!!wnpvjte!!n<b9j2o:)1*/!1|!+!!w*f!d*5!!ftvvmnb!w>!!+w!f1d/54)!!,1!/z1/!w*V<w!-!yt/vwnV!w,!>)!3udffywu!v-sffh3bEn)j!!j)nEb3hffs-v!uwyffdu3!)>!,w!Vnwv/ty!-!<w6V5w3/3z2!/.1!!5+/!1*!!+*!!wfbvmmvbfw!!*+!!*1!/+3!!1,/!1z6/2w<Vw!!t-vyn/!w,V>w!!u)f3ydufvws!f-3fEh)b!njjn!b)hEf3-f!swvfudy3f)u!!w>V,w!/nyv-t!!wV<w2/4z6!2./!14!/+1!!*+!!*w!bfmvvmfb!w*!!+*!!1+/!21!/,1!:z2/9w<Vw!!t-vyn/!w,V>w!!u)f3ydufvws!f-3fEh)b!njjn!b)hEf3-f!swvfudy3f)u!!w>V,w!/nyv-t!!wV<w4/4z7!2./!13!/+1!!*+!!*w!bzm/vwfV!w*!!-*y!/+w!V1w/!2)333d5f6w<!-!fthvbnn!j,!>)!Eu3ffysuvvusyff3uE!)>!,j!nnbvhtf!-!<w2f4d632)/!1w!V+w!/*y!-*!!wfVvwm/bzw!!.+!!21/",xt.downSampleShader="!!b~u!us<j*czv/utfp!qw!f.d!31!/q2p!t-<y/!twpbqs)z3jdofhw!!w>f!dw3V!ww!Vw<<*1/!2w!p-j1e/!1n!b-j1o/)2w!p,j!e1*/!3|!+!!hzm/`tQppqt.j!u-j1p/o2!!>.!!w1f/d35!)+q!pyt/^#!!q~s!fd<j1t/j5p!o0!!i*j*h*i1q/!2g!m-p1b/u1<)3!dvfowj!g+p!sfn{!jtTbmnfqymffus!3,E!!wjVnwb!h-ff<hb!nwjb)sEz3jfoshv!uwyffdu3!!w,V!w*<*1!/v2o.j!g-p1s/n1!)w3fddf3w!!u+f!yff{mjTTjm{ffy<fu!!,w!pwjVew!!n-bfjhob)n*j)!E|3f!shvmu`yGfsub!hD,p!m*p*s1!/>1!!)-u1f/y2u.v)s3fd3fEw)!j+n!bfh{fj-T!mwfVywf!u,!!,u!fwyVfwm!T-jf{hfb!n+j!)wEf3df3s)v2u/y1f-u!!1/,1!**";var yt=y.graph3d.PostProcessing.Glitch=function(D){function V(){if(h&&q){S=Date.now(),e=0,v=1e3*a(q[0],q[1]),d=[];for(var y=1,H=h.length;H>y;y+=2)d.push((y>1?d[d.length-1]:0)+v*h[y]/I)}}function z(){D.redraw()}function t(){var g=D.getGL();if(!g)return!1;l=new Lq.RenderTarget(D,g),A=D._postProcessing.createShader(g,yt.Shader);for(var k=G*G,e=tl(G,G),b=e.getImageData(0,0,G,G),X=b.data,U=0;k>U;U++)X[3*U+0]=_(256),X[3*U+1]=_(256),X[3*U+2]=_(256),X[3*U+3]=_(256);return e.putImageData(b,0,0),M=_g(g,Qh),K=!0}var l,A,v,S,e,d,M,o,q,h,p=this,E=!1,K=!1,a=fl.randomFloat,_=fl.randomInt,I=0,G=64;this.serializeProperties={onlyReflector:!1,period:[2,3],intensity:[3,.3,1,.1,0,.4]},this.resetProperties=function(){var s=this.serializeProperties;for(var d in s)this[d]=s[d]},C.defineProperties(p,{enable:{get:function(){return E},set:function(G){!!E!=!!G&&(E=G,G&&V(),D.iv())}},onlyReflector:{get:function(){return o},set:function(t){!!o!=!!t&&(o=t,D.iv())}},period:{get:function(){return q},set:function(f){q=f,V(),D.iv()}},intensity:{get:function(){return h},set:function(M){M||(M=[1,1]),h=M,I=0;for(var y=1,j=M.length;j>y;y+=2)I+=M[y];V(),D.iv()}}}),this.resetProperties(),p.contextLost=function(){K=!1},p._42=function(W,X){if(E&&(K||t())){var w=!!D.isReflecting(W);if(w===!!o){var N=X.width,T=X.height;if(N&&T){var c=D._postProcessing,q=dk.for(W).glState.depth,R=q.enabled;q.enabled=!1,l.setSize(W,N,T);var s,Q=Date.now();Q-S>d[e]&&(e++,e>=d.length&&V()),s=h[2*e];var n={seed:Math.random(),byp:s?0:1,tDisp:M};return s&&(n.angle=a(-Math.PI,Math.PI),n.distortion_x=a(0,1),n.distortion_y=a(0,1),n.amount=Math.random()/30*s,n.seed_x=a(-1,1)*s,n.seed_y=a(-1,1)*s),c.blitScreen(l,X.texture,A,n),q.enabled=R,requestAnimationFrame(z),l}}}}};yt.Shader="!!b~u!us<j*czv/utfp!qw!f.d!31!/q2p!t-<y/!twpbqs)z3jdofhw!!w>f!dw3V!ww!Vw<<*1/!2w!p-j1e/!1n!b-j1o/)2w!p,j!e1*/!3|!+!!hzm/`tQppqt.j!u-j1p/o2!!>.!!w1f/d35!)+q!pyt/^#!!q~s!fd~j!tj<p*ow!Viwj!h-ifqh!bgnmjp)b!uE<3f!svvoujygfpus>ns!pjmopuD!hcbzsqG<`m!hv!oj|g!pfstnm!ft!bn~q!mf<sx3pEo!tj!n,bshpfm<pD!hvbosjGg`pmshn!!>t!bsnpqmmpfDsh3bEs!Gu`Emjht!q<<*3!/v1o+j*g*p/s1n6!+gemfpfbtu!!+b!ntpzv-oeuf<ft!!v+o!jtgyp)s3nd!fgwm)peboub!sb)o5hdmffw<+u!ovvopjngbp+s/n1!1g3m!p>b!ux!ptoftf!e5<df!wv!ojfgtpjspno!!gemepbb0u0!!tf<f*eb`/yb<hd!!v-ocj/gcpds!n-!hg/mbphbdu!!-tsf/fsed`)z5<df!wv!o>j!gsppsmnp!DghmbpsbGu`!mehj!tu<p*suufjtpgog`py!<.!!qv!o-jfghpbsnnj!)gEm3pfbsuv!ueyjftuu!p>s!ucjdp!o5`dzf<w!!v<o*jqg!p-sfnh!bgnmjp)bEu3!fdspvmu`ytf<u!>!!wbbhsdz!j5odhf!ww!fd<3*!uwfVtwg<gp!!,d!pqo!t-uf!hgbmnpjb)uE!3VfosqvbudylfEup!x>o!tsddb!m5fd!f>w!!36<6*/*!f0m!h3o6b7)/o<jt!!d-p*oftmuh!owbf)dt4p!dQ)b3ddlfGwb!d+u!pusotv!p>n!bw!f>d!4u)f!t3g6g7p/!!3+d!f3w6!7/s!f+e!b3i6t7!/u-g!j3i6t7!/C!H+S!!3n6p7s/g-!!f3t6b7c/0!0*!<<!*d/p6o0teuf!fwtf)d+5z!`Veofqfbtd+lmGbbndsuppos>t,!z>/!qV!oq<b*d/l6E0pexfofttd)b+myf`!e0f!fwtf+dm5b)n!sQpbod>l,Gyb/dqu!ps~t!-!~2!/!<**<y`!ogpmjpubsup!uvtojqeb!d,l!SyH/CqB)U!p.E!f/q2u!i>)!!yd/pqo!tu|!!jfot!mwff!d5~!!w!<*y!`|op!jsufsupvustoj!ee>pyu/)q!!w-|!*V/o1q?bzd`leGfbfdtu)pgsjt!!*|<!*!e~fft!+gtm`pmbpud!.szb`ooep)jwufsdp3u!tdjpe*?|y/!qs!f%u%v!sto`!mgpsdb,dzu`)otpjjou)seppuut)jdep=/yy/zq!)-gwjf!d3~)!23~/!:9<:z9`-o8p9j/u3s4p4u*t*j*e!!+>!!5z4/8q6!9/|6!5f6t4m*f<!!~~!<!*wzp`joep!jnubsjpou)t*j!e|!,!!jzg/)qc)z!q.=!2/*2!!|>!!zw/fqd!3!|q*!/>1!?wyV`we<ff!tg)mgpjb!u!|y!t*!e>f!fgtm+ptp`sm)phdm.`yG`sobphjDupsppsuet/jye!?0z!/1q/!6%*%<!t!`gmmppdb,uy!`zotp!j>u!sgpmuptpjse)=hzm/`qG)sgbjh!Dp<p*s*ee/fzf!t0+!e1f/f6t*+<q!!-gqmtpjbEuu!)o!pEs3nfbsmv!u>y!fvuo)qibudqlfSEHpCUB";var zt=y.graph3d.PostProcessing.Fxaa=function(o){var Y,d=this,U=!1;C.defineProperties(d,{enable:{get:function(){return U},set:function(G){!!U!=!!G&&(U=G,o.iv())}}}),d.contextLost=function(){Y=null},d.getShader=function(L){if(Y)return Y;var P=o.getPostProcessingModule();return Y=P.createShader(L,{vs:P.blitScreenShaderSrc.vs,fs:P.decodeShader(zt.ShaderSourceFs)})},d._42=function(){}};zt.ShaderSourceFs="~!!q<sbf/d*jwtVjwp!o-!fihjbhnijq)!Eg3mfpsbvuu<yf!uv>obj/gsppsmnp!DthbbnsqGm`fmsh3!E!<j*n!bh*f1</1!)v5odjfgwp!sn-!1w/f1d!3!-s1f/t1p!mv-u1j/p1o!<-!4w4b9s1z/j1o!h!-w7f7d23/!1w!Vw-<68/!1$!ef-g*j1o/f1!)G5YdBfBw`!RV-B*M1J/U1Z)`5Qd1f!w2!/1-*!1$/e1f)g5jdoffw!!GY-BoBp`jRuVvBmMpJtUfZs`!Q2-!f2h/b6nj!!$e-ffghjbonfj!!GY-BfBh`bRnVjB!MJ-U*Z1`/Q13)!53d/f1w!!$-ewfVgwj!of)!sGfYeBbBi`TRmVfByMjJQUbZb`yQG4>!s5p/m1pD!h$besfGg`jmohf!!G|Y!B*B)`oRjVbBnM!JeUjZp`wQ!5!~2!3/<1*N!b$nevfmg!j-o{fz!yG/y*bNbtCppqp!m-!ycfpup)mqpU!y$feUfbgbjyoGf)!5GuybbpbmGGmbpbbyuG!!gomspvbuufs!!$e<foghjjoTfi!uGhyobfbmG!m+p!byuj3q!cwvfTdu3ft!g$gePfmgfjyojfq!>G,yzb/bNGtmppqb!u*4o!bwqfTd{4sp!i$!e)fggjj!of<!oGhyjbTbiGumhpobfum5!!+w!fydj5qcv!T$uefftggjgoPfm!fGyyjbqb>T,byu/)Nyt*p!qd!m*bonbqq)Ty{-s!p1i/a1)-g!j2!/1<**I!y$jeqfcgvjto!f-!eGpypbHbuUfftyg!gtPbmnfqymjfqs)3yEbn!>$yejfqgcjvoTfu!fGtygbgbPUmffyyUjpqq!)uub-p!mqG*b!buyfGy!uv<s1f/31E!);u!-u!fqt-g!g1P/m1f*yj!q$!e@f!gojboqfT!eGpypbhb>UefpypPHgugf)tug-g!Pqm-f!ypj-q!!su*b!pumfGybubvysGf!3E<)yuj-q!cqv,T)zpu!j+m!bsv*R-b!b1y/g1!*+!!HGyyjbqbcGvmtp>bIuy!jGqycbvbtM!vunbbp)mGGybbbbyGGm!pb<u65/!1s,h*c*bq*d!S|i!ushfoufvMsoob!qsth.c)b!/+z!<u!t~e)!>GuyfbtbgGgmPpmbfuy5j!qG!yubbbpQmjGybfbmyTGi!be<fGsy)jq!cGvytb!b+G!mGpybjuq3c!vqtp>tH-yj!qGcyvbtb!GumbppbmuG5b!bgyyGb!bD<pQootbpqmTfeQpppthQ!p;t!-Oo!bGqyTbebpUpfhy!!@u!fOyo-pj!uGdyfbsbjUef>yo!bgqyTbebpDppho!tmppmpfC4b7b1yUGf!yF<y*qQCujtbet!O-fOhuPtoef)-oj!nG>yubtbeU!fuyb!pgmyGbbbbDypGo!tp<mQfu4t7e1!U=f!yOFuytqeC>jObotpOjfuhdUfxspj-e!!mGpypbCbbGbmypGb!u3<!iguyhbobfRMvobbmqjtu0z1S/d2q>GqsdbSnifu-ho!fGMyobbbqGtm!pubbup5m!GgbybbybGD!po<tppsmff[SUdMqNGbsnbvnmf!P>qau!-*1!/G1y!b=b!GQmepobFub5n!vgmy)b>bQDopboqtTpempfpShd!qmGpspbCnbfbPyqGu!3-<*!OGuytbeb,GQmuptbeu)5>!iguyhbobfDMpoobtqptm!fu4b7p1mSGdbqbGysGb!nf<Ppqsuf3[-UM!NGbynbvbmG!m>pab!u*!1g/y1b!b=R!vObemojFubznTvvmc)q>jOyo-bq!TGeypbpbhG!mmppbpuC!bgbyybGb!Rv<bzm/jNutzpFqe.hzf/UQitspfqt>iQpumtee-!*!oGbyqbTb{Gsmppibau)!ggjy!bb<Rzv/bOmtjpuqz.Fze/hNftUpiqs>fOtuitpem!e*Nojboq-T{!sGpyibab)Ggmjp!bu<!yg/yNbtbpDqp.oyt/pQmtfpFqe>hQfuTtieb!suqbopfmtGtb-by!GG!yb<byG/mOptbpuq!.gyy/bNbtDppqo>tOpumtfeF!euhbfpUmiGsbfbtyiGp!me~-!!~G!yb~b!Gm<p5bQu`!ZgUyJbMbBDVpRo`tBpBmYfGF!e+h!fzU/iQsOfgtgipp>m,ezN/jQot-pq!!G*yQbfboGpmepab)ug5j!!gy<b5bQD`pZoUtJpMmBfV4R7`1BDBpYoGt!u+E!jys/Q!O*g!g|p>!,Gyy/bQbtGpmqp!b*uQ3f!oqppetaN)<gj!!qp<t*NQ/fyo>pqepat)/!y}<}!!*qOpftoNp/eza>)q>pQtO/fzo<pe!!Gy<b5bQG`mZpUbJuM5B!VsRh`cBzBNY>GG!y+b!bzU/fQyOUgpgqp)>u.fzy/-O!tqppqt!N**O<fo!p$eeaf)ggjjo!f!<m5vQn`bZNU!JsMhBcVzRN`/BzBY!GG!y+b!byG/mQpObgug!pm>v.nyb/TO>tGpyqb!b*MOvfnobp)eGay)bgbjU!fy<Pegfgm)budfTyu-o!fqjpetbNs-h!!G>y?b!b*GQmepobFub3n)v!m1)/t1c-b!>2Q/f1o*p-e!!gy<bebfRmvbbdmTjuuozfSjdeqbGsshb!n>f?/!y*zO*e*o<Fb!nGvymb)btGcmbp>bOuf!ompven!bF<>6G/y1b!b+M!vOnObb)nGvymb.bQUefoyFPbgngv)mu>fQye-o!FqbpntvNm-!!*GQyfbobpGemap)bguj3!)!<26//11-!!+1!/O1O*b-n!vgmy.bObeRovFbbmnjvumz>SOdeqoGFsbbnnvfm/!y*zO*f*o<pe!aG)ygbjb!Gm<p*b*uz!ym/vQntbpOq>!G-yybfbuM)vqnpbU)yGfyUbbbbUyfGy)Pbgngv)Mubfbyy-G!>qQpetoNF-b!nGvymb!b*GQmfpobpue3a))!g1j/!1-<.*2*/z1y*/-O!tgpyqb!b-Ryvfbum)jqupzUSydfqUGbsbbynGf)/bynzv*M*b<by!GG>yObeboGFmbpnbvum!!m*vOnfboXp>eGay)bgbjM!vn|b!)*GQyObfboUpfey)Pggjg!)u<f4yQ-`!ZqUpJtMNB-V!RG`yBbBbYGGm!p+b!uz3/)Q.O2g/g1p->!,1z//1Q*t-p!qg!y*bQbfRovpbemaj)ugzjS!dq<G4sQb`nZfU/JyMzB*V*R<`B!BGYyGb!b+G!myp/bQuO!gngbpy>T,Ny>/nQbtyp)qm!v*nQbfTo-p!emav)ngbjN!*<<*!QGfyobpbeGam)p!b}u}!!n*jOofToNp>enaj)o>)QmOvfnobpTe-!!m<v4nQb`NZ*U<JM!BGVyRb`bBGBmYpGb!u+!!nzb/yQFOTgNg>pn>b.yz)/mOvtnpbqF!-*!OnfboypTeNa*)<gj!!Gy<b4bQG`mZpUbJuM!BnVjRo`FBTBNY>Gn!j+o!)ym/vQnObgFg-p!>n.jyo/TONt*p<q!!*GOyfbobpGemap)bguj!!nb<yeXfOm>bndbTyu)omfvjnebbOs-h!!m>v?n!b*XQ*e<oF!bGnyvbmb)Gtmcpbb>uQ!fnojpoeX!O><nejfom)bmdvTnuboOf-j!embvsnhb!X>*?<!*!OGeyobFbbGnmvpmb)ut!csbb>oOhffoNpbey!>n<b6y/)1n!b+y!XOOO-b!nnvbmy.FQTeNo*F<bn!vGmy>bQbeGomFpbbnuv!ms!b*oQhffoNpjeoa>)ngjjo!)n<j6o/X1O!-+!!nOjOobFnTvNm*.<Oe!oGFybbnbvGmm>pObeuo!Fsbbnovhmf!N*bOyfTodpbemaf)eg>js!bo<h*f*Nzbyy/!Q+t!pgqy!b-byRfvub)mqjpuUzyFfeUhbfbUyiGs)fbtnivpMmbeb<yG!>GQyebobFGbmnpvbmu!!*sQbfoohpfe>as)bgojh!fN<b*y*.zsyb/oOhtfpNqj!o-<yf!uG)yqbpbUGymfpUbbub!ysGb)obhnfvNMbbybDymGb>nOqefoeF>bnnbvym)!g*yObfboRpvebam)jgujz!Fe|h!f*UQiOsffotpiep)mgejN!jo<-3!Qs`bZoUhJfMNBbVyRT`dBbBmYfGe!*+<!z!/GQyObgbgCpp>p,mz!/fQbtspmqz!F*yQjfuo>psebao)hgfj!!=!<s3bQo`hZfUNJbMyBDVmRb`nBqBfYeG<!+!!jyg/)QfObgsgmpz>F,yyj/uQ*tp!qs!f*uQvfsoop!esah)cgzjN!<<!*GQyfbobpGemap)b!u}!}m!v*nObfOoXp>eGay)b>bQMOvfnobp)eG!yb<b3UQf`yZPUgJgM)BuVfRy`-B!BqYpGt!N+-!!zG/yQbObgGgmpp>b.uz3/)O.t2p/q1!-*.O2f/o1p*e-a!)ggyjb!bR<v3bQm`jZuUzJSMdBqVGRs`bBnBfY/Gy!z+*!*y</Q!OGgygbpb>G.myp/bOut!pmqv!n*bOTfFo>pGeyab)bgMjv!nb<)eGfymbbbdUTfuyoPfgjge)busfhy!->!?q!p*tQNe-o!FGbynbvbmG)mtpcbbu>3Q)f!o2p/e1!-!<2e/f1m*b-d!TguyobfbjRevbbsmhj!u>z?S!d*qOGesobFnbfn/vymz)*t*c<b>!OGfyobpbeG!mp<b6u/!1m!v+n!bOOOFb>nGvymb.bQMevonFbb)nGvymb>bQUefoyFPbgngv)mu!f*yQ-f!oqppetaN)-g!jG!yb<b6G/m1p!b+u!3O)O!b2n/v1m-..O2e/o1F*b-n!vgmy>bObeRovFbbmnjvumz!S*dOqfGospbenaf)/gyjz!**<<**!zGyy/bQbtGpmqp!b-uy!fmuv)nqbpTUXy>fGUybbbbyMGv)nbbn)vGMybbbbyUGf>yQPegogF)bunfvym-!!*qQpftoNp-e!aG)ygbjb!Gm<p*b*uz3y)/.O2t/p1q-!!-2y/f1u*)-q!pgUyybfbURbvbbymGj)ubznSvdMqbGbsybGn>fO/eyozF*b*n<vm!!G*yObfboGpmepab)ug!jm!vn|b!O*TQ>OmfvonpbeO),gmjv!nb<T2<Q`!ZGUyJbMbBGVmRp`bBuB!YmGv!n+b!XzF/>QmOvgngbpX>,,mzv/nQbtFp<q!!*GQyfbobpGemap)bguj!!tv<c2qQj`yZSUdJqMSBbVoRh`fB>B2Y/G1!0+s!byo/hQfO<gg!pG>y,byb/GQmtppbqu!!*tQvfcoqpjeyaO)TgXjF!>m<v*nQbfOoTp,emav)n!b}X}F!<*O!fGoypbebaG)m>pQbOuf!ofpeeh!fmIpppsC{b2b>y)G.!3/<12!Q+`!ZmUvJnMbBNV*R,`mBvBnYbGO!T+<!z!/GQyObgbgGpm>p.bzu/!Oftephqf!W*fOsfuo2p>e)a.)3g/j1!!+<!2mQv`nZbUNJ*M,BmVvRn`bBXBFY<G!!+G!yyb/bQGOmgpgbpu>!.myv/nObtOpFqT!F*>OmfvonpbeOaF),gmjv!nb<TeFf<mb!dGTyubobfGjmepbbsuh!!m>v?n!b*OQXeOoFF>bmnvvnmb)OtXc,bm>vQnfboOpFe<!m!pGpyCbbbbGymGp!bu<!effemhbfdITpuso{f3j>e)b.s3h/!1>!?+!!*mOvenobFFb*n,vmmv)ntbcObF>TOFf<op!eG!ymbpbpGCmbpbbyuG!!fe<h6f/W1f!s+u!3O>O)b.n3v/m1>!.+Q!emovFnbbnOv*m,!mv<n6b/O1X!O+F!<OO!bGnyvbmb>G.mOpebouF!bmnvvnmb!OX<T1X/>1m!v=n!bNONXb,nmvvmn>bpTsXf<[U!MGNybbnbvGmm!pmbpup!CmbvbnybGT!XT<FF>ymjvqncbvTtX!,+m!vEnybjTqFc<vt!>GGyybjbqGcmvptb!uu!bfpemhGfbIbpysG{!5><)6b/c1t!)+f!eOhOfbInpvsm{.2N*b!n+v!m3>/N1N*b,nbvcmt!)ufbephmfGIbpbsy{G3!*<<1!/G5y0b1b/G2m!p+b!uu!offejhefbWsfhs>ue5f>m)bbdcTtu)offejhefbWsfhs!uu2b*p!m+G!b3b/y1G*!,b<cTtT)bfnevhmf>WOfOsbun3v*m<!*!OGsyjbbbqGam)pgbju!!f<e*h*fQItppsq{!4->y)f.u3)/q1p!U+y!fmUvbnbbyXG*),bmnvvnMbbObXyTGX><Qe!oGFybbnbvGmm!pubbup!mfGebhbfyWGf!su<4D>y)j.q3c/v1t!!++!!mDvynjbqTc*v,tm>vFnybjTqXcTvFt<!u!bGpymbGbbGbmypGb!u!<f*e*hOftIppqs!{->ybfcut))qfpeUhyffIUpbsb{y4G*),bfnevhMfbIbpysG{>5O<eo!FGbynbvbmG!mupbbpum!GfbebhyfGW!fs<u1>/b4c,t*)DfyejhqfcWvfts+u*41*/,3f.e)h)f>WEfysjuq5c<vt!!GuybbpbmGGmbpbbyuG!!tv<c1qQj`yZOUXJTMXBOVFRT`FB>BmYvGn!b+O!XzT/XQ,Omgvgnpb,OzF/TCFt<pq!>Gzy/bQbtGpmqp!bu<!1mQf`oZhUuJiMTBjVhRo`>BgByYbGb!R+v!bym/jQuOzgSgdpq,Gys/bCntfp/qy><y/!QGtypbqb!Cp<pQmt!piqp!s3{uTbqpbmoG>bfbeyhGf!Ip<s1{Q!`?Z>U!JfMeBhVfRW`fBsBuY<G!!+G!yzb/bQGOmgpgbpu.!zt/vCctqpjqy>Bz>/tOvtcpqqj!yO<T1XQF`!Z+U!J3M/B1V,Rt`vBcBqYjGy!O+X!TyX/OQFOTgFg<p.!yj/gC)tapiqp>sy{/TOqtbpoq*!!m<vOntbpOq>!m3vunbbpXm<Gb!bjygG)!ai<p6s/{1T!q+b!oo*h!jmTvinubhTo>fmmv>n,bzF/<Ct!pjqg!)*iopbsq{TT{qsbpoi*!!)mgfjo!hu<i6T/j1h!o+>!goyhbjbTRivubhmojfumz>S,dyq/GCstbpnqf!/*zo<bq!TG{ysbpbiGam)pgbju!!t<vzc/qfjnybCs>G)qtdvSczqujjymBb!v+R!b)b2y/g1!0;2!31//11*!*@.!m*vonbbqNT<{s!pGiy!b)b>Gzm/pQbOug!ghps!be<jyf/ofunOb>smGvqndbSOz.umjvmnbbvNR<bb!yGgy!b;b!G1m/p1b!u@!!h*sobbeqjTf{osupTi>am)v>nyb/TQ.Omgvgnpb!N<<Q!OGgygbpb!G3mupbbpum!GmbvbnybGO!O><mzv/nNbtOp,qm>vzn/bCNt<pq!!Gy<byb/GNmtppbqu>!ym/vCntbpTqT!>m<vCntbpTq,!m3vunbbpNm<Gb!bGyyGb!bC<p*pfmh!oqbbSjqsdOS>ybjcqtc)vhts!b+e!j*fCoyujOq*c!v?t>)!tbccbt))uhbsTbbebjyfGo>uDTy*j<qc!vGty!bubbGpmmpGbbub!yhGs!be<jofhojuT>inubhyo)fbmc.t>)ohhsjbTeijufhooufOm*!-*!Obscjtb)qh)sgbje!jf<o*u*T",xo(F,{accordionViewExpandIcon:yb(Up),accordionViewCollapseIcon:yb(Up,!0),accordionViewLabelColor:Gb,accordionViewLabelFont:Qf,accordionViewTitleBackground:Od,accordionViewSelectBackground:Bg,accordionViewSelectWidth:3,accordionViewSeparatorColor:I,splitViewDividerSize:1,splitViewDividerBackground:Od,splitViewDragOpacity:.5,splitViewToggleIcon:{width:16,height:16,comps:[{type:Ro,rect:[2,2,12,12],background:Up}]},propertyViewLabelColor:xr,propertyViewLabelSelectColor:Gb,propertyViewLabelFont:Qf,propertyViewExpandIcon:yb(pn),propertyViewCollapseIcon:yb(pn,!0),propertyViewBackground:jo,propertyViewRowLineVisible:!0,propertyViewColumnLineVisible:!0,propertyViewRowLineColor:Pd,propertyViewColumnLineColor:Pd,propertyViewSelectBackground:Bg,listViewLabelColor:xr,listViewLabelSelectColor:Gb,listViewLabelFont:Qf,listViewRowLineVisible:!1,listViewRowLineColor:Pd,listViewSelectBackground:Bg,treeViewLabelColor:xr,treeViewLabelSelectColor:Gb,treeViewLabelFont:Qf,treeViewExpandIcon:yb(uj),treeViewCollapseIcon:yb(uj,!0),treeViewRowLineVisible:!1,treeViewRowLineColor:Pd,treeViewSelectBackground:Bg,treeViewDoubleClickToToggle:!0,tableViewLabelColor:xr,tableViewLabelSelectColor:Gb,tableViewLabelFont:Qf,tableViewRowLineVisible:!0,tableViewColumnLineVisible:!0,tableViewRowLineColor:Pd,tableViewColumnLineColor:Pd,tableViewSelectBackground:Bg,treeTableViewLabelColor:xr,treeTableViewLabelSelectColor:Gb,treeTableViewLabelFont:Qf,treeTableViewExpandIcon:yb(uj),treeTableViewCollapseIcon:yb(uj,!0),treeTableViewRowLineVisible:!0,treeTableViewColumnLineVisible:!0,treeTableViewRowLineColor:Pd,treeTableViewColumnLineColor:Pd,treeTableViewSelectBackground:Bg,tableHeaderLabelColor:xr,tableHeaderLabelFont:Qf,tableHeaderColumnLineVisible:!0,tableHeaderColumnLineColor:Be,tableHeaderBackground:jo,tableHeaderMoveBackground:Sg,tableHeaderInsertColor:Bg,tableHeaderSortDescIcon:Wl(pn,!0),tableHeaderSortAscIcon:Wl(pn),tabViewTabGap:1,tabViewLabelColor:Gb,tabViewLabelFont:Qf,tabViewTabBackground:Od,tabViewSelectWidth:3,tabViewSelectBackground:Bg,tabViewMoveBackground:Sg,tabViewInsertColor:Bg,toolbarLabelColor:xr,toolbarLabelSelectColor:Gb,toolbarLabelFont:Qf,toolbarBackground:jo,toolbarSelectBackground:Bg,toolbarItemGap:8,toolbarSeparatorColor:Eg},!0);
var At={translateX:1,sortColumn:1},Bt={sortable:1,sortOrder:1,sortFunc:1},Ct={focusData:1},Dt={dataModel:1,sortColumn:1,sortFunc:1,visibleFunc:1,rootData:1,rootVisible:1},Et={dataModel:1,sortFunc:1,visibleFunc:1,categorizable:1},Ft=function(A,S){S.add(A),A.hasChildren()&&A.eachChild(function(s){Ft(s,S)})},Gt=function(w,J,k,T,C,m,g,K,O,U,q){var M,a=k.getValueType(U),P=k.getAlign(U);if(k.getEnumValues(U)){var j=k.toEnumLabel(J,U),I=Gn||0,H=0,G=m,i=F.getTextSize(T,j).width;return M=Fp(k.toEnumIcon(J,U)),M&&(H=m+Gn/2,"center"===P?H+=(K-(I+i))/2:"right"===P&&(H=H+K-(I+i)),hl(w,M,H,g+O/2,U,q),G=H+Gn/2),j!=N&&(M?Pr(w,j,T,C,G,g,K-(G-m),O):Pr(w,j,T,C,m,g,K,O,P)),void 0}return J=k.formatValue(J),J!=N?a===uf?(no(w,m,g,K,O,J),void 0):a===Gi||!a&&xj(J)?(M=Fp(J?Ie:Lh),hl(w,M,m+K/2,g+O/2,U,q),void 0):(Pr(w,J,T,C,m,g,K,O,P),void 0):void 0},Ht=function(S,j){var Y=j.view,k=ul(S),Q=j.column||j.property;Y.getDataModel().beginTransaction(),j.editor=S,S.info=j,Y.setCurrentEditor(S),Y.getView().insertBefore(k,Y._79O),Xd(S,j.editorRect),S.setFocus?S.setFocus():Re(S),S.commitValue=function(G,H){S._17Q&&(S=S._17Q),H||Y.setValue(j.data,Q,S.getValue?S.getValue():S.value),S.close&&S.close(),Yf(k)},Q.onEditorCreated&&Q.onEditorCreated(j)},It=function(Z,K,d,U,z){var A=Yr(Z,d),v=K.value,$=K.view,s=z.getValueType(K.data);return A.onblur=A.onchange=function(){$.endEditing()},"input"===Z?(v=z.formatValue(v),v!=N&&(A.value=v),A.onkeydown=function(d){Uc(d)?$.endEditing():zi(d)&&$.endEditing(!0)},(s===rq||s===ef)&&q(A,yq,F.numberListener)):Z===Sf&&U.forEach(function(l){var $=H.createElement("option");$.innerHTML=z.toEnumLabel(l),$.value=l,z.isEnumEqual(v,l)&&($.selected=!0),Em(A,$)}),Ht(A,K),A},Jt=y.widget={},Kt=function(i,d,N){ri(D+".widget."+i,d,N)};xo(Wn,{ms_value:function(J){J.getValue=function(Q){var s=this.getItemById(Q),g=s.element;return Je(g)?g:g?g.getValue?g.getValue():g.value:s.selected},J.setValue=function(J,l){var b=this.getItemById(J);if(b){var T=b.element;T&&!Je(T)?T.setValue?T.setValue(l):T.value=l:xj(l)?(b.selected=l,this.iv()):(b.element=l,this.iv())}},J.v=function(v,Z){var C=this;if(2===arguments.length)C.setValue(v,Z);else{if(!Go(v))return C.getValue(v);for(var M in v)C.setValue(M,v[M])}return C}},_46o:function(D){D._icon=N,D._accessType=N,D._valueType=N,D._editable=!1,D._batchEditable=!0,D._align=hp,D._nullable=!0,D._emptiable=!1,D.setParent=Yj,D.formatValue=function(u){var y=this,C=y._valueType;return y.getEnumValues()?y.toEnumLabel(u):C===Gi?!!u:u!=N&&C===rq?c(u):u},D.setEnum=function(y,F,L,P,p,c,u){var g=this;y&&!hr(y)&&y.values&&(P=y.editable,L=y.icons,F=y.labels,p=y.strict,c=y.maxHeight,u=y.dropDownWidth,y=y.values),Np(y)&&(y=y._as),Np(F)&&(F=F._as),Np(L)&&(L=L._as),g._enumValues=y,g._enumLabels=F,g._enumIcons=L,g._enumEditable=P,g._enumStrict=p==N?!0:p,g._enumMaxHeight=c,g._enumDropDownWidth=u,y&&y.length&&dm(y[0])&&(g._valueType=ef),g.fp("enum",!1,!0)},D.getEnumDropDownWidth=function(){return this._enumDropDownWidth},D.getEnumMaxHeight=function(){return this._enumMaxHeight},D.isEnumEditable=function(){return this._enumEditable},D.getEnumValues=function(){return this._enumValues},D.getEnumLabels=function(){return this._enumLabels},D.getEnumIcons=function(){return this._enumIcons},D.isEnumStrict=function(){return this._enumStrict},D.isEnumEqual=function(s,L){return this._enumStrict?s===L:s==L},D.toEnumLabel=function(X,H){var f=this,M=f.getEnumValues(H),n=f.getEnumLabels(H);if(M&&n)for(var o=0;o<M.length;o++)if(f.isEnumEqual(X,M[o]))return n[o];return X},D.toEnumIcon=function(o,N){var e=this,O=e.getEnumValues(N),s=e.getEnumIcons(N);if(O&&s)for(var K=0;K<O.length;K++)if(e.isEnumEqual(o,O[K]))return s[K];return I}},_45o:function(h){h._87o=function(y,Z,u,M,S,b){if(y){var k=this,h=k._90I,R=jg(1);k._columnLineVisible&&(S-=1),k._rowLineVisible&&(b-=1),0>=S||0>=b||(k._90I||(h=k._90I={}),h[Z]||(h[Z]=new Ik),Xd(R,k.tx()+u,k.ty()+M,S,b),Em(R,y),k._view.insertBefore(R,k._79O),y.onParentAdded&&y.onParentAdded(R),h[Z].add(R))}},h._76o=function(){var D=this,Q=D._90I;if(Q){for(var g in Q)Q[g].each(function(D){Yf(D)});delete D._90I}},h._77o=function(k){var q=this;if(q._90I){var p=q._90I[k];p&&(p.each(function(Q){Yf(Q)}),delete q._90I[k])}}},_47o:function(D){D.getValue=function(L,J){return J.getValue?J.getValue(L,J,this):oh(L,J.getAccessType(),J.getName())},D.setValue=function(M,D,b){if(D.isEmptiable(M)||""!==b||(b=I),D.isNullable(M)||b!=N){var n=this,l=D.getName(M),Q=D.getAccessType(M),P=D.getValueType(M);P===rq&&Je(b)?b=Oc(b):P===ef&&Je(b)?b=parseFloat(b):P===Gi&&Je(b)&&(b="true"===b),n._batchEditable&&D._batchEditable&&n.isSelected(M)?n.sm().each(function(G){D.setValue?D.setValue(G,D,b,n):hc(G,Q,l,b)}):D.setValue?D.setValue(M,D,b,n):hc(M,Q,l,b)}},D.setCurrentEditor=function(D){this.endEditing(),this._currentEditor=D,this.redraw()},D.isEditing=function(r,B){var m=this,d=m._currentEditor;if(!d)return!1;if(B){var P=d.info;return P?(P.column||P.property)===B&&P.data===r:!1}return!0},D.endEditing=function(D){var B=this,A=B._currentEditor;A&&(delete B._currentEditor,A.commitValue&&A.commitValue(A.info,D),B.redraw(),B.getDataModel().endTransaction())},D.beginEditing=function(T){this.endEditing();var G=this,b=T.column||T.property;if(b.beginEditing)b.beginEditing(T);else{var P=T.data,M=T.value,V=G.getSelectBackground(P),j=b.getEnumValues(P),f=b.getSlider(P),h=b.getColorPicker(P);if(f){var r=Zm(Jt.Slider,f);return r.setValue(M),r.getView().onblur=function(){G.endEditing()},r.isInstant()&&(r.onValueChanged=function(){G.setValue(P,b,r.getValue())}),Ht(r,T),void 0}if(h||b.getValueType(P)===uf){var S=Zm(Jt.ColorPicker,h);S.setValue(M);var z=S.onClosed;return S.onClosed=function(){G.endEditing(),z&&z.call(this)},S.isInstant()&&(S.onValueChanged=function(h,L){G.setValue(P,b,L)}),Ht(S,T),S.open(),void 0}if(j){if(Jt.ComboBox){var t=new Jt.ComboBox;t.setValue(M),t.setValues(j),t.setLabels(b.getEnumLabels(P)),t.setIcons(b.getEnumIcons(P)),t.setEditable(b.isEnumEditable(P)),t.setStrict(b.isEnumStrict(P)),t.setMaxHeight(b.getEnumMaxHeight(P)),t.setDropDownWidth(b.getEnumDropDownWidth(P)),t.onClosed=function(){G.endEditing()},Ht(t,T),t.open()}else It(Sf,T,V,j,b);return}var e=b.getValueType(P);if(e===Gi||xj(M))return G.setValue(P,b,!M),void 0;if(b.getItemEditor(P)){var H=gb(b.getItemEditor(P)),Y=new H(P,b,G,T),C=Y.getView();return C._17Q=Y,Y.setValue(M),Xj(C),Ht(C,T),Y.editBeginning&&Y.editBeginning(),void 0}It("input",T,V,N,b)}}},_44o:function(m){m.init=function(P){var u=this,r=u.th=new Zt(P),Z=u._view=vc(1,u);u.tv=u._tableView=P,Em(Z,r.getView()),Em(Z,P.getView()),r.mp(function(E){E.property===nf&&u.iv()}),u.iv()},m.getTableView=function(){return this.tv},m.getTableHeader=function(){return this.th},m.getDataModel=function(){return this.tv.dm()},m.getColumnModel=function(){return this.tv.getColumnModel()},m.setColumns=function(H){this.tv.setColumns(H)},m.addColumns=function(K){this.tv.addColumns(K)},m.endEditing=function(){this.tv.endEditing()},m.validateImpl=function(){var O=this,b=O.th,s=Cb(b),U={x:0,y:0,width:O.getWidth(),height:s};Xd(b,U),U.y=s,U.height=n(0,O.getHeight()-s),Xd(O.tv,U)}},ms_vs:function(i){i._41o=function(){return this._29I.height<this._59I},i._43o=function(){var i=this;i._41o()&&(i._58I||(Jo(function(){i._94O()},Th),i.iv()),i._58I=new Date)},i._94O=function(){var g=this;if(g._58I){var t=new Date;t.getTime()-g._58I.getTime()>=Th?(delete g._58I,g.iv()):Jo(function(){g._94O()},Th)}},i._93I=function(){var _=this,z=_._27I;if(_._58I||!_._autoHideScrollBar){z||Em(_._79O,z=_._27I=jg());var M=_._29I,N=M.height,W=_._59I,n=_.getScrollBarSize(),g=M.width-n-2,t=N*(-_.ty()/W),c=N*(N/W),D=z.style;W>N?(Vf>c&&(t=t+c/2-Vf/2,0>t&&(t=0),t+Vf>N&&(t=N-Vf),c=Vf),D.visibility=im,D.background=_.getScrollBarColor(),D.borderRadius=n/2+ps,Xd(z,g,t,n,c)):D.visibility=xc}else z&&(z.style.visibility=xc)}},ms_hs:function(j){j._40o=function(){return this._29I.width<this._91I},j._42o=function(){var u=this;u._40o()&&(u._95O||(Jo(function(){u._94I()},Th),u.iv()),u._95O=new Date)},j._94I=function(){var U=this;if(U._95O){var j=new Date;j.getTime()-U._95O.getTime()>=Th?(delete U._95O,U.iv()):Jo(function(){U._94I()},Th)}},j._92I=function(){var u=this,N=u._28I;if(u._95O||!u._autoHideScrollBar){N||Em(u._79O,N=u._28I=jg());var A=u._29I,g=A.width,b=u._91I,B=u.getScrollBarSize(),C=A.height-B-2,w=g*(-u.tx()/b),O=g*(g/b),n=N.style;b>g?(Vf>O&&(w=w+O/2-Vf/2,0>w&&(w=0),w+Vf>g&&(w=g-Vf),O=Vf),n.visibility=im,n.background=u.getScrollBarColor(),n.borderRadius=B/2+ps,Xd(N,w,C,O,B)):n.visibility=xc}else N&&(N.style.visibility=xc)}}}),mg(Ie,jh(16,16,[{type:Yp,rect:[1,1,14,14],background:Bg},{type:$e,rect:[1,1,14,14],width:1,color:dn},{type:Kb,points:[13,3,7,12,4,8],borderWidth:2,borderColor:"#FFF"}])),mg(Lh,jh(16,16,{type:$e,rect:[1,1,14,14],width:1,color:dn})),mg(Sd,jh(16,16,[{type:Zq,rect:[2,2,12,12],borderWidth:1,borderColor:dn,background:"#FFF"},{type:Zq,rect:[4,4,8,8],background:Bg}])),mg(Nk,jh(16,16,{type:Zq,rect:[2,2,12,12],borderWidth:1,borderColor:dn})),Wn._15Q=function(i){i._29I=ro,i._59I=0,i._91I=0,i._5o=function(y){var E=this;E._30I=new Ik,E._rows=new Ik,E._rowMap={},E._31I=0,E._14I=0,E._view=vc(1,E),E._canvas=Qb(E._view),Em(E._view,E._79O=jg()),E.dm(y?y:new _h)},i.getCheckIcon=function(h){var W=this.sm(),b=W.co(h);return W.sg()?Fp(b?Sd:Nk):Fp(b?Ie:Lh)},i.checkData=function(l){var z=this.sm(),R=z.co(l);z.sg()&&R||(this._32o=1,R?z.rs(l):z.as(l),delete this._32o)},i.getDataAt=function($){$.target&&($=this.lp($));var c=g($.y/this._rowHeight),Q=this._rows;return 0>c||c>=Q.size()?N:Q.get(c)},i.onDataDoubleClicked=function(){},i.onDataClicked=function(){},i.adjustTranslateX=function(){return 0},i.adjustTranslateY=function(L){var y=this.getHeight()-this._59I;return y>L&&(L=y),L>0?0:c(L)},i.onPropertyChanged=function(D){var k=this,K=D.property;Dt[K]?k.ivm():Ct[K]||k.redraw(),K===mi?k._42o():K===fk&&k._43o()},i.getLabel=function(E){return E.toLabel()},i.getLabelFont=function(){return this._labelFont},i.getLabelColor=function(M){var z=this;if(z.isCheckMode()){if(z._focusData===M)return z._labelSelectColor}else if(z.isSelected(M))return z._labelSelectColor;return z._labelColor},i.getStartRowIndex=function(){return this._31I},i.getEndRowIndex=function(){return this._14I},i.getRowDatas=function(){return this._rows},i.getRowIndex=function(V){return this._rowMap[V._id]},i.getRowSize=function(){return this._rows.size()},i.getViewRect=function(){return iq(this._29I)},i.isVisible=function(T){return this._visibleFunc?this._visibleFunc(T):!0},i.getCurrentSortFunc=function(){return this._sortFunc},i.setDataModel=function(C){var u=this,F=u._dataModel,t=u._selectionModel;F!==C&&(F&&(F.umm(u.handleDataModelChange,u),F.umd(u.handleDataPropertyChange,u),F.umh(u.handleHierarchyChange,u),t||F.sm().ums(u.handleSelectionChange,u)),u._dataModel=C,C.mm(u.handleDataModelChange,u),C.md(u.handleDataPropertyChange,u),C.mh(u.handleHierarchyChange,u),t?t._21I(C):C.sm().ms(u.handleSelectionChange,u),u.fp("dataModel",F,C))},i.validateModel=function(){var v=this;v._rows.clear(),v._rowMap={},v.buildChildren(v._dataModel._roots);var c=v._rows=v._rows.toList(v.isVisible,v),f=0,L=v.getCurrentSortFunc(),y=c.size();for(L&&c.sort(L);y>f;f++)v._rowMap[c.get(f)._id]=f},i.buildChildren=function(F){var i=this;F.each(function(k){i._rows.add(k),i.buildChildren(k._children)})},i.handleDataModelChange=function(){this.ivm()},i.handleDataPropertyChange=function(l){"parent"===l.property?this.ivm():this.invalidateData(l.data)},i.handleHierarchyChange=function(){this.ivm()},i.handleSelectionChange=function(S){S.datas.each(this.invalidateData,this),this.onSelectionChanged(S)},i.onSelectionChanged=function(i){var j=this,M=j.sm();!j.isAutoMakeVisible()||1!==M.size()||"set"!==i.kind&&"append"!==i.kind||j._32o||j.makeVisible(M.ld())},i.handleBackgroundClick=function($){bs($)&&!this.isCheckMode()&&this.sm().cs()},i.makeVisible=function(d){d&&(this._23I=d,this.iv())},i.scrollToIndex=function(T){var W=this,$=W._29I,S=$.height,L=W._rowHeight,h=L*T;T>=0&&T<W._rows.size()&&S>0&&(h+L>$.y+S?W.ty(-h+S-L):h<$.y&&W.ty(-h))},i.autoScroll=function(N,F){var b=this,C=b._rowHeight,v=C,d=C/4,f=b._29I,D=b.lp(N),k={x:b.tx(),y:b.ty()};return C>0&&f&&(D.x-f.x<v?b.translate(d,0):f.x+f.width-D.x<v&&b.translate(-d,0),D.y-f.y<v?b.translate(0,d):f.y+f.height-D.y<v&&b.translate(0,-d)),k.x=b.tx()-k.x,k.y=b.ty()-k.y,F&&(F.x+=k.x,F.y+=k.y),k},i.getTopRowOrderSelection=function(){var $=this.sm().getTopSelection(),H={},R=new Ik;return $.each(function(x){H[x._id]=x}),this._rows.each(function(q){H[q._id]&&R.add(q)}),R},i.getRowOrderSelection=function(){var C=new Ik;return this._rows.each(function(T){this.isSelected(T)&&C.add(T)},this),C},i.ivm=function(){this.invalidateModel()},i.invalidateModel=function(){var g=this;g._96I||(g._96I=1,g._32I=1,delete g._24I),g.iv()},i.redraw=function(){var u=this;u._32I||(u._32I=1,delete u._24I,u.iv())},i.invalidateData=function(k){var v=this;xk?v.redraw():v._32I||(v._24I||(v._24I={}),v._24I[k._id]=k,v.iv())},i.getFocusData=function(){return this._focusData},i.setFocusDataById=function(I){this.setFocusData(this.dm().getDataById(I))},i.setFocusData=function(z){var k=this,I=k._focusData;I!==z&&(k._focusData=z,k.fp("focusData",I,z),I&&k.invalidateData(I),z&&(k.invalidateData(z),k.isAutoMakeVisible()&&k.makeVisible(z)))},i.drawRowBackground=function(J,p,f,F,E,M,Z){var V=this,r=V.isCheckMode();(p===V._focusData&&r||f&&!r)&&no(J,F,E,M,Z,V.getSelectBackground(p))},i.drawData=function(Q,t,F){var m=this,v=m._rowHeight,B=v*F,q=m._29I,c=q.x,I=q.width;Q.save(),Q.beginPath(),Q.rect(c,B,I,v),Q.clip(),m._87o(m.drawRow(Q,t,m.isSelected(t),c,B,I,v),F,c,B,I,v),Q.restore(),m._rowLineVisible&&no(Q,c,B+v-1,I,1,m._rowLineColor)},i._12I=function(o){var L=this,s=L._31I,Q=L._29I,r=Q.x,B=Q.y,g=Q.width,F=Q.height;for(o.beginPath(),o.rect(r,B,g,F),o.clip(),o.clearRect(r,B,g,F),L._76o(),L._93db(o);s<L._14I;s++)L.drawData(o,L._rows.get(s),s);L._92db(o)},i._13I=function(E){for(var Q,D=this,h=D._rowHeight,G=D._29I,o=G.x,a=G.width,n=D._31I,$=D._30I;n<D._14I;n++)Q=D._rows.get(n),D._24I[Q._id]&&$.add({data:Q,index:n});$.isEmpty()||(E.beginPath(),$.each(function(P){E.rect(o,P.index*h,a,h)}),E.clip(),$.each(function(V){E.clearRect(o,V.index*h,a,h)}),$.each(function($){D._77o($.index)}),D._93db(E),$.each(function(S){D.drawData(E,S.data,S.index)}),D._92db(E),$.clear())},i.preValidateModel=function(){this.endEditing&&this.endEditing()},i.validateImpl=function(){var W=this,q=W._canvas,l=W.getWidth(),d=W.getHeight(),$=W._rowHeight,h=W._32I;(l!==q.clientWidth||d!==q.clientHeight)&&(Nc(q,l,d),h=1),W._96I&&(W.preValidateModel(),W.validateModel());var c=W._29I,o={x:-W.tx(),y:-W.ty(),width:l,height:d},Z=W._rows.size(),C=tp(q),Q=W._23I;h||ic(o,c)||(h=1),W._29I=o,W._59I=Z*$,W._31I=g(o.y/$),W._14I=p((o.y+o.height)/$),W._31I<0&&(W._31I=0),W._14I>Z&&(W._14I=Z),W._99I&&h&&W._99I();var F=W.tx(),f=W.ty();(W._40o()||W._41o())&&(W._59I+=W.getScrollBarSize(),W._99I&&h&&(W._91I+=W.getScrollBarSize())),Xl&&!dr&&(C.save(),Cf(C,l/Cm.length,d/Cm.length,1)),Cf(C,F,f,1),h?W._12I(C):W._24I&&W._13I(C),W._93I(),W._92I(),C.restore(),W._32I=W._24I=W._96I=N,Q&&(W.scrollToIndex(W.getRowIndex(Q)),delete W._23I),W.tx(W.tx()),W.ty(W.ty())},i.canHandleSelectMode=function(){return!0},i.isDraggable=function(){return!0}},Wn._48o=function(t){t._rootVisible=!0,t._rootData=N,t._35o=function(){this._expandMap={},this._levelMap={}},t.validateModel=function(){var L=this,l=L._rootData;L._rows.clear(),L._levelMap={},L._rowMap={},L._currentLevel=0,l?L._rootVisible?L.isVisible(l)&&L.buildData(l):L.buildChildren(l):L.buildChildren(),delete L._currentLevel},t.buildData=function(m){var J=this,t=m._id,k=J._rows;J._rowMap[t]=k.size(),k.add(m),J._levelMap[t]=J._currentLevel,J.isExpanded(m)&&(J._currentLevel++,J.buildChildren(m),J._currentLevel--)},t.buildChildren=function(w){var W=this,t=w?w._children:W._dataModel._roots,$=W.getCurrentSortFunc();$&&W.isChildrenSortable(w)?t.toList(W.isVisible,W).sort($).each(W.buildData,W):t.each(function($){W.isVisible($)&&W.buildData($)})},t.getLevel=function(S){return this._levelMap[S._id]},t.getToggleIcon=function(E){var d=this,l=d._loader,J=d._collapseIcon;return l&&!l.isLoaded(E)?J:E.hasChildren()?d.isExpanded(E)?d._expandIcon:J:N},t.isCheckMode=function(){return this._checkMode!=N},t.isChildrenSortable=function(){return!0},t.handleDataModelChange=function(S){var z=this;S.kind===Uj?delete z._expandMap[S.data._id]:S.kind===Mm&&(z._expandMap={}),z.ivm()},t.toggle=function(u){var F=this;F.isExpanded(u)?F.collapse(u):F.expand(u)},t.isExpanded=function(e){return 1===this._expandMap[e._id]},t.expand=function(K){var a=this,r=a._loader;a.isExpanded(K)||(r&&!r.isLoaded(K)&&r.load(K),a._expandMap[K._id]=1,a.ivm(),a.onExpanded(K))},t.onExpanded=function(){},t.collapse=function(q){var R=this;R.isExpanded(q)&&(delete R._expandMap[q._id],R.ivm(),R.onCollapsed(q))},t.onCollapsed=function(){},t.expandAll=function(x){if(x)this.expand(x),x.eachChild(function($){this.expandAll($)},this);else{var w=this;w._dataModel.each(function(g){g.hasChildren()&&(w._expandMap[g._id]=1)}),w.ivm()}},t.collapseAll=function(){this._expandMap={},this.ivm()},t.makeVisible=function(z){if(z){var O=this;if(!O._rootData||z.isDescendantOf(O._rootData)){for(var Z=z._parent;Z;)O.expand(Z),Z=Z._parent;O._23I=z,O.iv()}}},t.checkData=function(J){var h,H=this,Y=H._checkMode,L=H.sm(),n=L.co(J);if(!L.sg()||!n){if(H._32o=1,Y===Ci)n?L.rs(J):L.as(J);else if(Y===de)h=new Ik(J),h.addAll(J._children);else if("descendant"===Y)h=new Ik,Ft(J,h);else if("all"===Y&&(h=new Ik,Ft(J,h),!n))for(var m=J._parent;m;)h.add(m),m=m._parent;h&&(n?L.rs(h):L.as(h)),delete H._32o}},t.drawTree=function(l,x,f,V,G,Y,g){var N=this,j=N._indent,t=N._levelMap[x._id],L=N.getIconWidth(x),D=Fp(N.getToggleIcon(x));D?(V+=j*t,hl(l,D,V+j/2,G+g/2,x,N),V+=j):V+=j*(t+1),N._checkMode&&(hl(l,N.getCheckIcon(x),V+j/2,G+g/2,x,N),V+=j),N.drawIcon(l,x,V,G,L,g),N.drawLabel(l,x,V+L,G,g)}},Wn._14Q=function(B){B.getIcon=function(z){return z.getIcon()},B.getIconWidth=function(k){return this.getIcon(k)?this._indent:0},B.drawIcon=function(C,u,h,V,f,B){if(f){var W=this,p=W.getBodyColor(u),S=Fp(W.getIcon(u),p);S&&(B-=W.isRowLineVisible()?1:0,wf(C,S,qg,h,V,f,B,u,W,p),Jq(C,W.getBorderColor(u),h,V,f,B))}},B.drawLabel=function(e,g,n,h,U){var j=this;Pr(e,j.getLabel(g),j.getLabelFont(g),j.getLabelColor(g),n,h,0,U)}},Wn._50o=function(T){T._98I=function(){var H=this,v=H._39o=new _h;H._60I=new Ik,v.mm(H._17o,H),v.md(H._18o,H),v.mh(H._19o,H)},T.setColumns=function(f){this._39o.clear(),this.addColumns(f)},T.addColumns=function(V){var v=this._39o;V.forEach(function(g){if(!(g instanceof Mt)){var j=gb(g.className);g=Zm(j?j:Mt,g)}v.add(g)})},T.onColumnClicked=function(){},T.onCheckColumnClicked=function(){},T._3Q=function(K){for(var p,b=0,X=this._60I,V=X.size();V>b;b++)if(p=X.get(b),p.column===K)return p;return N},T.getColumnAt=function(O){var A=this._4Q(O);return A?A.column:N},T._4Q=function(j){for(var H=this,F=j.target?H.lp(j).x:j.x,q=H._60I,E=0;E<q.size();E++){var D=q.get(E),v=D.startX;if(F>=v&&F<v+D.column.getWidth())return D}return N},T.getToolTip=function(X){var p=this,m=p.getDataAt(X),q=p.getColumnAt(X);return m&&q?q.getToolTip(m,p):N},T.adjustTranslateX=function(s){var i=this.getWidth()-this._91I;return i>s&&(s=i),s>0?0:c(s)},T._99I=function(){var q=this,y=q._29I,p=q._60I;p.clear(),q._91I=0,q._39o._roots.each(function(L){if(L.isVisible()){var A=q._91I+L.getWidth();q._91I<=y.x+y.width&&A>=y.x&&p.add({column:L,startX:q._91I}),q._91I=A}})},T.drawData=function(T,z,R){var b=this,V=b._rowHeight,U=V*R,w=b.isSelected(z),J=b._29I,W=J.x,P=J.width;b.drawRowBackground(T,z,w,W,U,P,V),b._60I.each(function(M){var p=M.column,j=M.startX,H=p.getWidth();H>0&&!b.isEditing(z,p)&&(T.save(),T.beginPath(),T.rect(j,U,H,V),T.clip(),b._87o(b.drawCell(T,z,w,p,j,U,H,V),R,j,U,H,V),b._columnLineVisible&&no(T,j+H-1,U,1,V,b._columnLineColor),T.restore())}),b._rowLineVisible&&no(T,W,U+V-1,P,1,b._rowLineColor)},T.drawCell=function(i,_,J,Z,r,y,V,O){var j=this;if(Z.drawCell)return Z.drawCell(i,_,J,Z,r,y,V,O,j);var F=j.getValue(_,Z);Gt(i,F,Z,j.getLabelFont(_,Z,F),j.getLabelColor(_,Z,F),r,y,V,O,_,j)},T.getColumnModel=function(){return this._39o},T._17o=function(){this.redraw()},T._18o=function(E){var x=this;E.data===x._sortColumn&&Bt[E.property]?x.ivm():(x._42o(),x.redraw())},T._19o=function(){this.redraw()},T.getCurrentSortFunc=function(){var O=this,z=O._sortColumn;if(z&&z.isSortable()){var V=z.getSortFunc(),F=Le===z.getSortOrder()?1:-1;return V||(V=tf),function(Y,J){return V.call(O,O.getValue(Y,z),O.getValue(J,z),Y,J)*F}}return O._sortFunc},T.isCellEditable=function(B,f,N){return f.isEditable()&&this.isEditable()?f.isCellEditable?f.isCellEditable(B,f,N,this):!0:!1},T._37O=function(I,m){if(bs(m))for(var C=this,J=C.lp(m),F=C._60I,K=C._rowHeight,V=C._29I,q=V.x,G=V.y,k=V.width,$=V.height,o=0;o<F.size();o++){var i=F.get(o),H=i.startX,O=i.column,n=O.getWidth();if(O!==C._31o&&O!==C._4o&&J.x>=H&&J.x<H+n&&C.isCellEditable(I,O,m)){var g={x:H,y:C.getRowIndex(I)*K,width:n,height:K},y={x:g.x+C.tx(),y:g.y+C.ty(),width:g.width,height:g.height},j=0,T=0;return g.x<q?j=g.x-q:g.x+g.width>q+k&&(j=g.x+g.width-q-k),j&&(C.tx(C.tx()-j),y.x-=j),g.y<G?T=g.y-G:g.y+K>G+$&&(T=g.y+K-G-$),T&&(C.ty(C.ty()-T),y.y-=T),C.beginEditing({data:I,column:O,value:C.getValue(I,O),event:m,rect:g,editorRect:y,view:C}),void 0}}}},Jt.BaseItemEditor=function(o,y,s,_){this._data=o,this._column=y,this._master=s,this._editInfo=_},Kt("BaseItemEditor",C,{ms_ac:["data","column","master","editInfo"],editBeginning:function(){},getView:function(){},getValue:function(){},setValue:function(){}});var Lt=y.Tab=function(){Iq(Lt,this)};Db("Tab",dd,{ms_ac:["view","closable","disabled","visible"],_icon:N,_closable:!1,_disabled:!1,_visible:!0,setParent:Yj});var Mt=y.Column=function(){Iq(Mt,this)};Db("Column",dd,{_46o:1,ms_ac:["accessType","valueType",im,Cg,Wd,Tp,"align",uf,"sortOrder",No,"sortable","clickable","nullable","emptiable","slider","colorPicker","itemEditor"],_visible:!0,_width:80,_sortOrder:Le,_sortFunc:N,_sortable:!0,_clickable:!0,setWidth:function(D){16>D&&(D=16);var d=this._width;this._width=D,this.fp(Tp,d,D)},getToolTip:function(d,R){return this.formatValue(R.getValue(d,this))}});var Nt=y.Property=function(){Iq(Nt,this)};Db("Property",dd,{_46o:1,ms_ac:["accessType","valueType",Cg,Wd,"categoryName",uf,"align","nullable","emptiable","slider","itemEditor","colorPicker"],_categoryName:N,getToolTip:function(B,N,v){var $=this;return N?$.formatValue(v.getValue(B,$)):v.getPropertyName($)}}),Jt.AccordionView=function(){var g=this;g._20o={},g._21o=new Ik,g._10o=N,g._9o=N,g._11o=N,g._view=vc(0,g),g.iv()},Kt("AccordionView",C,{ms_v:1,ms_fire:1,ms_ac:[Kf,ws,"titleHeight",Hp,Oi,"titleBackground","selectWidth",di,"orientation","separatorColor"],_expandIcon:F.accordionViewExpandIcon,_collapseIcon:F.accordionViewCollapseIcon,_titleHeight:Un,_labelColor:F.accordionViewLabelColor,_labelFont:F.accordionViewLabelFont,_titleBackground:F.accordionViewTitleBackground,_selectBackground:F.accordionViewSelectBackground,_selectWidth:F.accordionViewSelectWidth,_orientation:"v",_separatorColor:F.accordionViewSeparatorColor,onPropertyChanged:function(){this.iv()},getView:function(){return this._view},getTitles:function(){return this._21o},getCurrentTitle:function(){return this._10o},add:function(m,V,N,t){var h=this,R=jg(),X={content:V,div:R,canvas:Qb(R),icon:t};if(h._20o[m])throw m+" already exists";var k=X.downEventFunc=function(M){vr(M)},W=X.upEventFunc=function(Z){vr(Z),bs(Z)&&(h._10o===m?h.collapse():h.expand(m))};[Kc,Zp].forEach(function(z){q(R,z,k)}),[vn,lj].forEach(function(r){q(R,r,W)}),R.style.cursor=pf,Em(h._view,R),h._20o[m]=X,h._21o.add(m),N&&h.expand(m),h.iv()},remove:function(b){var $=this,O=$._20o[b];if(O){var r=O.div;Yf(r),[Kc,Zp].forEach(function(h){V(r,h,O.downEventFunc)}),[vn,lj].forEach(function(H){V(r,H,O.upEventFunc)}),delete $._20o[b],$._21o.remove(b),$.iv()}},clear:function(){var I=this;I._21o.toArray().forEach(I.remove,I),I._20o={},I._21o.clear(),I.iv()},isExpanded:function(q){return this._10o===q},expand:function(s){var G=this;G._20o[s]&&G._10o!==s&&(G._10o=s,G.onExpanded(s),G.iv())},onExpanded:function(){},collapse:function(){var _=this;_._10o&&(_.onCollapsed(_._10o),delete _._10o,_.iv())},onCollapsed:function(){},initCanvas:function(f,T,g){Nc(f,T,g);var C=tp(f);return Cf(C,0,0,1),C.clearRect(0,0,T,g),C},drawTitle:function(F,b,S,l,s){var c=this,w=Fp(s.icon),x=c.isExpanded(b),Z=c._titleHeight,$=c._titleBackground,o=c._selectWidth,I=c._separatorColor,H=Fp(x?c._expandIcon:c._collapseIcon),a=o+4;no(F,0,0,S,l,$),x&&o&&no(F,0,0,o,l,c._selectBackground),(x||c._21o.get(c._21o.size()-1)!==b)&&no(F,0,l-1,S,1,I?I:Do($)),w&&(hl(F,w,a+fm(w)/2,Z/2),a+=fm(w)+2),Pr(F,b,c.getLabelFont(b),c.getLabelColor(b),a,0,0,Z),H&&hl(F,H,S-fm(H)/2-4,Z/2)},validateImpl:function(){var d=this,h=d._view,V=0,b=0,T=d.getWidth(),s=d.getHeight(),E=d._titleHeight,H=d._21o.size()*E,g=d._11o,D=d._9o;delete d._11o,delete d._9o,d._21o.each(function(t){var P,a,L=d._20o[t],N=L.content,D=d._10o===t;If(d)?(Xd(L.div,V,0,E,s),P=d.initCanvas(L.canvas,E,s),jf(P,0,s),je(P,-Rd),d.drawTitle(P,t,s,E,L),P.restore(),D?(a=n(0,T-H),N&&(d._11o=N,d._9o=ul(N),Xd(N,V+E,0,a,s)),V+=E+a):V+=E):(Xd(L.div,0,b,T,E),P=d.initCanvas(L.canvas,T,E),d.drawTitle(P,t,T,E,L),P.restore(),D?(a=n(0,s-H),N&&(d._11o=N,d._9o=ul(N),Xd(N,0,b+E,T,a)),b+=E+a):b+=E)});var a=d._9o;g&&g!==d._11o&&g.endEditing&&g.endEditing(),a&&a!==D&&Em(h,a),D&&D!==a&&Yf(D)}}),Jt.SplitView=function(h,p,f,i){var $=this,s=$._dividerDiv=jg(),x=$._60O=Qb(),X=$._61O=Qb(),U=x.style,A=X.style;$._view=vc(1,$),Em($._view,s),U.msTouchAction=ms,U.pointerEvents=ms,U.cursor=pf,A.msTouchAction=ms,A.pointerEvents=ms,A.cursor=pf,h&&$.setLeftView(h),p&&$.setRightView(p),f&&$.setOrientation(f),i!=N&&$.setPosition(i),$.setStatus(qr),new Ot($)},Kt("SplitView",C,{ms_v:1,ms_fire:1,ms_ac:["continuousLayout","dividerSize","dividerBackground","toggleIcon","togglable","dragOpacity","orientation","draggable","status"],_continuousLayout:!1,_position:.5,_togglable:!0,_orientation:"h",_draggable:!0,_dividerSize:F.splitViewDividerSize,_dividerBackground:F.splitViewDividerBackground,_dragOpacity:F.splitViewDragOpacity,_toggleIcon:F.splitViewToggleIcon,onPropertyChanged:function(){this.iv()},getDividerDiv:function(){return this._dividerDiv},getPosition:function(){return this._position},setPosition:function(A,k){var c=this,o=c._position;isNaN(A)||(k||(c._82O=0>A?-1:A>1?1:0),c._position=A,c.fp(wl,o,A))},getLeftView:function(){return this._leftView},setLeftView:function(l){var d=this,F=d._leftView,k=d._view;if(d._leftView!==l){if(F&&F!==d._rightView){var n=ul(F);n.parentNode===k&&Yf(n)}if(d._leftView=l,l){var g=ul(l);g.parentNode!==k&&k.insertBefore(g,d._dividerDiv)}d.fp("leftView",F,l)}},getRightView:function(){return this._rightView},setRightView:function(u){var z=this,e=z._rightView,_=z._view;if(z._rightView!==u){if(e&&e!==z._leftView){var J=ul(e);J.parentNode===_&&Yf(J)}if(z._rightView=u,u){var P=ul(u);P.parentNode!==_&&_.insertBefore(P,z._dividerDiv)}z.fp("rightView",e,u)}},validateImpl:function(){var H=this,b=H._draggable,o=H._position,F=H.getWidth(),i=H.getHeight(),s=H._dividerSize,Z=H._dividerBackground,t=Hi?18:8,e=H._dividerDiv,Y=H._82O,P=H._60O,j=H._61O,R=H._toggleIcon,v=H._status,_=e.style,h=null,f=Hi?20:4,$=R.comps[0];s>=t||0===s?H._coverDiv&&(Yf(H._coverDiv),delete H._coverDiv):H._coverDiv||(H._coverDiv=jg(),ts&&(H._coverDiv.style.background=Gf),Em(e,H._coverDiv)),H._togglable?P.parentNode||(Em(e,P),Em(e,j)):(Yf(P),Yf(j));var l=H._coverDiv,B=H._leftView,V=H._rightView;if(If(H)){if(s>F&&(s=F),v===qr)if(1===Y)var u=J(o,F),q=n(0,F-s-u);else-1===Y?(q=J(-o,F),u=n(0,F-s-q)):(u=c((F-s)*o),q=n(0,F-s-u));else"cl"===v?(u=0,q=n(0,F-s)):"cr"===v&&(q=0,u=n(0,F-s));B&&Xd(B,0,0,u,i),V&&Xd(V,u+s,0,q,i),Xd(e,u,0,s,i),H._22o=u,l&&(Xd(l,s/2-t/2,0,t,i),l.style.cursor=b?Dn:""),e.style.cursor=b?Dn:"";var A=e.clientHeight/2,k=e.clientWidth;Nc(P,k,k),Xd(P,0,A-k-f,k,k),h=tp(P),Cf(h,0,0,1),$.rotation=-Rd,He(h,R,0,0,k,k),h.restore(),Nc(j,k,k),Xd(j,0,A+f,k,k),h=tp(j),Cf(h,0,0,1),$.rotation=Rd,He(h,R,0,0,k,k),h.restore()}else{if(s>i&&(s=i),v===qr)if(1===Y)var p=J(o,i),L=n(0,i-s-p);else-1===Y?(L=J(-o,i),p=n(0,i-s-L)):(p=c((i-s)*o),L=n(0,i-s-p));else"cl"===v?(p=0,L=n(0,i-s)):"cr"===v&&(L=0,p=n(0,i-s));B&&Xd(B,0,0,F,p),V&&Xd(V,0,p+s,F,L),Xd(e,0,p,F,s),H._22o=p,l&&(Xd(l,0,s/2-t/2,F,t),l.style.cursor=b?zp:""),_.cursor=b?zp:"";var E=e.clientWidth/2,k=e.clientHeight;Nc(P,k,k),Xd(P,E-k-f,0,k,k),h=tp(P),Cf(h,0,0,1),$.rotation=0,He(h,R,0,0,k,k),h.restore(),Nc(j,k,k),Xd(j,E+f,0,k,k),h=tp(j),Cf(h,0,0,1),$.rotation=G,He(h,R,0,0,k,k),h.restore()}_.background=Z}});var Ot=function(F){this.sv=F,this.addListeners()};ri(Ot,C,{ms_listener:1,getView:function(){return this.sv.getView()},handle_touchstart:function(P){var w=this,G=w.sv,f=G._dividerDiv,v=G._60O,X=G._61O,N=G._status,y=P.target;if(y===v)N===qr?G.setStatus("cl"):"cr"===N&&G.setStatus(qr);else if(y===X)N===qr?G.setStatus("cr"):"cl"===N&&G.setStatus(qr);else if(Dh(P)&&(y===f||y===G._coverDiv)&&(vr(P),G.isDraggable())){G.getLeftView(),G.getRightView();var I=w.maskDiv=jg();if(I.style.left=0,I.style.top=0,I.style.width=G.getWidth()+"px",I.style.height=G.getHeight()+"px",G.getView().appendChild(I),!G.isContinuousLayout()){var l=w.resizeDiv=jg();l.style.left=f.style.left,l.style.top=f.style.top,l.style.width=f.style.width,l.style.height=f.style.height,l.style.opacity=G.getDragOpacity(),l.style.background=G.getDividerBackground(),Em(w.getView(),l)}w._lastAbsPosition=G._22o,w._86o=If(G)?oc(P).x:oc(P).y,Gp(w,P)}},handleWindowTouchMove:function(Q){Dh(Q)&&this.update(Q,this.sv.isContinuousLayout())},handleWindowTouchEnd:function(o){var T=this;T.update(o,!0),T.sv.setStatus(qr),T.maskDiv&&Yf(T.maskDiv),T.resizeDiv&&Yf(T.resizeDiv),T.maskDiv=T.resizeDiv=N},handle_mousedown:function(C){bs(C)&&this.handle_touchstart(C)},handleWindowMouseMove:function(i){this.handleWindowTouchMove(i)},handleWindowMouseUp:function(m){this.handleWindowTouchEnd(m)},update:function(x,r){var o=this,i=o.sv,e=If(i)?i.getWidth():i.getHeight(),s=i._dividerSize,p=o._lastAbsPosition-o._86o;If(i)?(p+=oc(x).x,p>e-s&&(p=e-s),0>p&&(p=0),o.resizeDiv&&(o.resizeDiv.style.left=p+ps)):(p+=oc(x).y,p>e-s&&(p=e-s),0>p&&(p=0),o.resizeDiv&&(o.resizeDiv.style.top=p+ps)),r&&e!==s&&(1===i._82O?i.setPosition(p,1):-1===i._82O?i.setPosition(p-e+s,1):i.setPosition(p/(e-s),1))}}),Jt.TabView=function(){var O=this,L=O._view=vc(1,O),y=O._91O=jg(1),E=O._tabModel=new _h,u=E.sm(),W=O.invalidate;O._7o=new Ik,O._canvas=Qb(y),Em(L,y),Em(L,O._92O=jg(1)),u.setSelectionMode(jj),u.ms(O.handleSelectionChange,O),E.mm(W,O),E.mh(W,O),E.md(W,O),O._interactor=new Pt(O),O.iv()},Kt("TabView",C,{ms_v:1,ms_fire:1,ms_tx:1,ms_ty:1,ms_lp:1,ms_ac:["movable","tabGap","tabHeight","tabPosition",Hp,Oi,"tabHPadding","tabBackground","selectWidth",di,"moveBackground","insertColor"],_tabHPadding:0,_tabPosition:nc,_tabHeight:Un,_tabGap:F.tabViewTabGap,_labelColor:F.tabViewLabelColor,_labelFont:F.tabViewLabelFont,_tabBackground:F.tabViewTabBackground,_selectWidth:F.tabViewSelectWidth,_selectBackground:F.tabViewSelectBackground,_moveBackground:F.tabViewMoveBackground,_insertColor:F.tabViewInsertColor,_movable:!0,handleSelectionChange:function(){this._selectionChanged=!0,this.invalidate()},getContentDiv:function(){return this._92O},getTitleDiv:function(){return this._91O},getTabModel:function(){return this._tabModel},add:function(n,d,N){var H,v=this._tabModel;return n instanceof Lt?(H=n,d&&H.setView(d)):(H=new Lt,H.setName(n),H.setView(d)),v.add(H),N&&v.sm().ss(H),H},getLabel:function(l){return l.toLabel()},onPropertyChanged:function(){this.iv()},_7Q:function(T){this._23o=T,this.iv()},get:function(U){var d=this,R=d._tabModel;if(dm(U))return R._roots.get(U);if(Je(U)){var u;return R.each(function(q){U===d.getLabel(q)&&(u=q)}),u}return U instanceof Lt?U:N},select:function($){this._tabModel.sm().ss(this.get($))},remove:function(E){var $=this;if(E=$.get(E)){var t=$._tabModel,M=t._roots.indexOf(E);$._tabModel.remove(E),$.selectByIndex(--M)}},getCurrentTab:function(){return this._8o},hideTabView:function(U,Q){Q.parentNode===this._92O&&(Wh(Q)?(Q.style.display=Wr,Q._tab_=U):Yf(Q),to())
},showTabView:function(S,j){Wh(j)&&(j.style.display="block",j._tab_=S),j.parentNode!==this._92O&&(Em(this._92O,j),to())},_24o:function(){var w,y=this,n=y._8o,d=y._9o,o=y._tabModel.sm().ld();o&&(w=ul(o.getView())),w!==d&&(d&&(n.getView()&&n.getView().endEditing&&n.getView().endEditing(),y.hideTabView(n,d)),w&&y.showTabView(o,w)),y._8o=o,y._9o=w,n!==o&&y.onTabChanged(n,o)},onTabClosing:function(){return!0},onTabChanged:function(){},onTabClosed:function(n,z){this.selectByIndex(--z)},selectByIndex:function(t){var x=this,H=x._tabModel,s=H.size();if(s&&!H.sm().ld()){t==N&&(t=0),t>=s&&(t=s-1),0>t&&(t=0);for(var I=t;I>=0;I--){var B=x.get(I);if(!B.isDisabled())return x.select(B),B}for(I=t+1;s>I;I++)if(B=x.get(I),!B.isDisabled())return x.select(B),B}},getTabWidth:function(P){var y=this.getTabHPadding(),N=4+2*y,l=Fp(P.getIcon());l&&(N+=fm(l,P)+4);var U=this.getLabel(P);return U&&(N+=ce(this.getLabelFont(P),U).width+4),P.isClosable()&&(N+=10),N},drawTab:function(E,Q,y,e,u,X,i){var v,k=this,L=k._tabPosition,w=this.getTabHPadding(),I=y+4+w,S=k._selectWidth,T=Fp(Q.getIcon()),r=Q.isDisabled(),d=k.getLabelColor(Q),t=k.getLabelFont(Q),K=k.getLabel(Q),l=k._selectBackground,N=L===hp+"-vertical",j=L===Il+"-vertical";(N||j)&&(I=e+4+w),r&&(E.globalAlpha=Zj),no(E,y,e,u,X,i),Q===k._8o&&S&&(L===nc?no(E,y,e+X-S,u,S,l):L===hp?no(E,y+u-S,e,S,X,l):L===Il?no(E,y,e,S,X,l):N?no(E,y+u-S,e,S,X,l):j?no(E,y,e,S,X,l):no(E,y,e,u,S,l));var o=u/2;if(N&&(jf(E,o,e+X/2),je(E,G),jf(E,-o,-e-X/2)),T){var b=Oo(T,Q),A=fm(T,Q);if(N||j){var W=y+u/2,R=I+b/2;jf(E,W,R),je(E,Rd),jf(E,-W,-R),hl(E,T,y+u/2,I+b/2,Q,k),jf(E,W,R),je(E,-Rd),jf(E,-W,-R),I+=b+4}else hl(E,T,I+A/2,e+X/2,Q,k),I+=A+4}return N||j?(jf(E,u/2,I+u/2),je(E,Rd),jf(E,-u/2,-I-u/2),Pr(E,K,t,d,y,I,X,u),jf(E,u/2,I+u/2),je(E,-Rd),jf(E,-u/2,-I-u/2)):Pr(E,K,t,d,I,e,u,X),N&&(jf(E,o,e+X/2),je(E,-G),jf(E,-o,-e-X/2)),Q.isClosable()&&(v=j?{x:y+u-12,y:e+X-12,width:12,height:12}:{x:y+u-12,y:e+2,width:12,height:12},this.drawCloseIcon(Q,E,d,v)),r&&(E.globalAlpha=1),v},drawCloseIcon:function(h,s,v,E){var B=E.x,b=E.y;s.strokeStyle=v,s.lineWidth=1,s.beginPath(),s.moveTo(B+2,b+8),s.lineTo(B+8,b+2),s.moveTo(B+8,b+8),s.lineTo(B+2,b+2),s.stroke()},getTabAt:function(v){var z=this._interactor._8Q(v);return z?z.tab:null},validateImpl:function(){var Y=this;Y._24o();var r,k=Y._canvas,I=Y._tabPosition,F=Y._91O,T=Y._92O,Q=Y._tabModel,e=Y.getWidth(),z=Y.getHeight(),N=Y._tabHeight,R=Y._7o,E=Y._tabGap,C=I===nc,b=I===hp,A=I===Il,L=I===hp+"-vertical",h=I===Il+"-vertical",J=Y._23o,Z=0;if((b||A)&&Q._roots.each(function(W){Z=n(Y.getTabWidth(W),Z)}),C?(Xd(F,0,0,e,N),r={x:0,y:N,width:e,height:n(0,z-N)}):b?(Xd(F,0,0,Z,z),r={x:Z,y:0,width:n(0,e-Z),height:z}):A?(Xd(F,e-Z,0,Z,z),r={x:0,y:0,width:n(0,e-Z),height:z}):L?(Xd(F,0,0,N,z),r={x:N,y:0,width:n(0,e-N),height:z}):h?(Xd(F,e-N,0,N,z),r={x:0,y:0,width:n(0,e-N),height:z}):(Xd(F,0,z-N,e,N),r={x:0,y:0,width:e,height:n(0,z-N)}),Xd(T,r),L||h){Y._9o&&(r.x=0,Xd(Y._8o.getView(),r)),Nc(k,N,z);var K=tp(k),X=0;if(Cf(K,0,Y.ty(),1),K.clearRect(0,0,N,z),R.clear(),Q._roots.each(function(I){if(I.isVisible()){var g,z=Y.getTabWidth(I);if(!J||J.tab!==I){var t=Y.getTabBackground(I);g=Y.drawTab(K,I,0,X,N,z,t)}R.add({_75o:g,tab:I,startY:X,endY:X+z,height:z}),X+=z+E}}),Y._23Q=n(0,X-E),J){var G=J.position;Y.drawTab(K,J.tab,0,J.startY,N,J.height,Y._moveBackground),no(K,0,G,N,1,Y._insertColor)}if(K.restore(),Y._selectionChanged){Y._selectionChanged=!1;for(var l=Y.ty(),O=0;O<R.size();O++){var _=R.get(O);if(_.tab===Y._8o){if(_.endY+l<0){Y.ty(-_.startY);break}if(_.startY+l>z){Y.ty(z-_.endY);break}}}}Y.ty(Y.ty())}else if(b||A){Y._9o&&(r.x=0,Xd(Y._8o.getView(),r)),Nc(k,Z,z);var K=tp(k),X=0;if(Cf(K,0,Y.ty(),1),K.clearRect(0,0,Z,z),R.clear(),Q._roots.each(function(t){if(t.isVisible()){var m;if(!J||J.tab!==t){var _=Y.getTabBackground(t);m=Y.drawTab(K,t,0,X,Z,N,_)}R.add({_75o:m,tab:t,startY:X,endY:X+N,height:N}),X+=N+E}}),Y._23Q=n(0,X-E),J){var G=J.position;Y.drawTab(K,J.tab,0,J.startY,Z,J.height,Y._moveBackground),no(K,0,G,Z,1,Y._insertColor)}if(K.restore(),Y._selectionChanged){Y._selectionChanged=!1;for(var l=Y.ty(),O=0;O<R.size();O++){var _=R.get(O);if(_.tab===Y._8o){if(_.endY+l<0){Y.ty(-_.startY);break}if(_.startY+l>z){Y.ty(z-_.endY);break}}}}Y.ty(Y.ty())}else{Y._9o&&(r.y=0,Xd(Y._8o.getView(),r)),Nc(k,e,N);var K=tp(k),M=0;if(Cf(K,Y.tx(),0,1),K.clearRect(0,0,e,N),R.clear(),Q._roots.each(function(d){if(d.isVisible()){var D,C=Y.getTabWidth(d);if(!J||J.tab!==d){var k=Y.getTabBackground(d);D=Y.drawTab(K,d,M,0,C,N,k)}R.add({_75o:D,tab:d,startX:M,endX:M+C,width:C}),M+=C+E}}),Y._64I=n(0,M-E),J){var G=J.position;Y.drawTab(K,J.tab,J.startX,0,J.width,N,Y._moveBackground),Bj(K,Y._insertColor,G,0,N)}if(K.restore(),Y._selectionChanged){Y._selectionChanged=!1;for(var v=Y.tx(),O=0;O<R.size();O++){var _=R.get(O);if(_.tab===Y._8o){if(_.endX+v<0){Y.tx(-_.startX);break}if(_.startX+v>e){Y.tx(e-_.endX);break}}}}Y.tx(Y.tx())}for(var P=[],w=T.children,O=0;O<w.length;O++){var m=w[O],t=m._tab_;t&&!Q.contains(t)&&P.push(m)}P.forEach(function(u){T.removeChild(u)})}});var Pt=function(U){this.tv=U,this.addListeners()};ri(Pt,C,{ms_listener:1,getView:function(){return this.tv._91O},handle_mousewheel:function(L){this.handleScroll(L,10*(L.wheelDelta/40))},handle_DOMMouseScroll:function(Y){this.handleScroll(Y,10*-Y.detail)},handleScroll:function(B,b){vr(B);var c=this.tv,d=c._tabPosition;!c._40o()||d!==nc&&d!==yf||c.tx(this.tv.tx()+b),!c._41o()||d!==hp&&d!==Il&&d!==hp+"-vertical"&&d!==Il+"-vertical"||c.ty(this.tv.ty()+b)},_8Q:function(D){var u,m,T=this.tv,k=T._tabPosition,d=T._7o;if(k===nc||k===yf){var n=T.lp(D).x;for(u=0;u<d.size();u++)if(m=d.get(u),m.startX<=n&&n<=m.endX)return m}else if(k===hp||k===Il||k===hp+"-vertical"||k===Il+"-vertical"){var t=T.lp(D).y;for(u=0;u<d.size();u++)if(m=d.get(u),m.startY<=t&&t<=m.endY)return m}return N},isClickable:function(e){var X=this.tv,Q=X._tabPosition,b=this._73o=this._8Q(e);return!X._40o()||Q!==nc&&Q!==yf?!X._41o()||Q!==hp&&Q!==Il&&Q!==hp+"-vertical"&&Q!==Il+"-vertical"?b&&(!b.tab.isDisabled()||X.isMovable()):!0:!0},handle_mousemove:function(m){var t=this;br?t._74o=t._8Q(m):t.getView().style.cursor=t.isClickable(m)?pf:""},handle_mousedown:function(o){this.handle_mousemove(o),this.handle_touchstart(o)},handle_touchstart:function(k){var d=this,h=d.tv,F=h._tabPosition;vr(k),bs(k)&&d.isClickable(k)&&(F===nc||F===yf?(d.x=oc(k).x,d.lp=h.lp(k),d.tx=h.tx()):(d.y=oc(k).y,d.lp=h.lp(k),d.ty=h.ty()),Gp(d,k))},handle_mouseup:function(y){this.handle_touchend(y)},handle_touchend:function(m){if(gd(m)){var I=this._73o;if(!I)return;var B=this.tv,Q=B.getTabModel(),K=I.tab;if(!K.isDisabled()&&K.isClosable()){var k=function(){var s=Q._roots.indexOf(K);Q.remove(K),B.onTabClosed(K,s)};B.onTabClosing(K,k)&&k()}}},handleWindowMouseMove:function(F){this.handleWindowTouchMove(F)},handleWindowTouchMove:function(x){var i,j=this,P=j.tv,I=P._tabPosition,U=j._73o;if(I===nc||I===yf){if(i=oc(x).x-j.x,!j._25o&&!j.moving&&u(i)>2&&(P._40o()&&!Og(x)?j._25o=1:U&&P.isMovable()&&(j.moving=1)),j._25o)P.tx(j.tx+i);else if(j.moving){var $=j.lp.x+i,Z=P._tabGap/2;P._7o.each(function(T){var A=T.endX,B=$-T.startX<A-$;$>=T.startX&&A>=$&&P._7Q({tab:U.tab,startX:U.startX+i,width:U.width,front:B,insertTab:T.tab,position:B?n(0,T.startX-Z):J(P._64I,A+Z)})})}}else if(i=oc(x).y-j.y,!j._25o&&!j.moving&&u(i)>2&&(P._41o()&&!Og(x)?j._25o=1:U&&P.isMovable()&&(j.moving=1)),j._25o)P.ty(j.ty+i);else if(j.moving){var E=j.lp.y+i,Z=P._tabGap/2;P._7o.each(function(t){var x=t.endY,m=E-t.startY<x-E;E>=t.startY&&x>=E&&P._7Q({tab:U.tab,startY:U.startY+i,height:U.height,front:m,insertTab:t.tab,position:m?n(0,t.startY-Z):J(P._23Q,x+Z)})})}},handleWindowMouseUp:function(Z){this.handleWindowTouchEnd(Z)},handleWindowTouchEnd:function(){var A=this,j=A.tv,c=j._tabPosition,s=j.getTabModel(),J=s._roots,e=A._73o;if(A.moving){var L=j._23o;if(L&&L.insertTab!==L.tab){var h=L.tab,O=J.remove(h),$=J.indexOf(L.insertTab);$>=0&&(L.front||$++,$<=J.size()&&(J.add(h,$),s._38I(h,O,$)))}j._7Q(N),delete A.moving}else if(!A._25o&&e){h=e.tab;var k=A._74o;if(!k||k.tab===h)if(!h.isDisabled()&&zo(e._75o,A.lp)){var d=function(){var Y=J.indexOf(h);s.remove(h),j.onTabClosed(h,Y)};j.onTabClosing(h,d)&&d()}else h.isDisabled()||j._8o===h||s.sm().ss(h)}A._25o=A._73o=A._74o=c===nc||c===yf?A.x=A.lp=A.tx=N:A.y=A.lp=A.ty=N}}),Jt.PropertyView=function(k){var K=this;K._view=vc(1,K),K._canvas=Qb(K._view),Em(K._view,K._79O=jg()),K._rows=new Ik,K._28o=new Ik,K._26o={},K._26Q={};var D=K._propertyModel=new _h,H=K.ivm;D.mm(H,K),D.md(H,K),D.mh(H,K),K.dm(k?k:new _h),new Qt(K)},Kt("PropertyView",C,{ms_ac:[Hp,og,Oi,Cg,Wd,"categorizable",dj,No,Ef,Kf,ws,Rr,Zd,Ak,"selectRowIndex",di,"background",bk,Td,Qi,Lg,ej],ms_v:1,ms_dm:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,ms_lp:1,ms_vs:1,_45o:1,_47o:1,ms_tip:1,_29I:ro,_59I:0,_9I:0,_selectRowIndex:-1,_editable:!0,_batchEditable:!0,_categorizable:!0,_indent:Gn,_background:F.propertyViewBackground,_expandIcon:F.propertyViewExpandIcon,_collapseIcon:F.propertyViewCollapseIcon,_scrollBarColor:dg,_scrollBarSize:cj,_autoHideScrollBar:pl,_selectBackground:F.propertyViewSelectBackground,_rowHeight:nq,_rowLineVisible:F.propertyViewRowLineVisible,_rowLineColor:F.propertyViewRowLineColor,_10I:.5,_columnLineVisible:F.propertyViewColumnLineVisible,_columnLineColor:F.propertyViewColumnLineColor,_labelColor:F.propertyViewLabelColor,_labelSelectColor:F.propertyViewLabelSelectColor,_labelFont:F.propertyViewLabelFont,getRows:function(){return this._rows},getColumnPosition:function(){return this._10I},setColumnPosition:function(j){0>j&&(j=0),j>1&&(j=1);var L=this,H=L._10I;L._10I=j,L.fp("columnPosition",H,j)},getPropertyName:function(F){return F.toLabel()},getLabelFont:function(){return this._labelFont},getLabelColor:function(L,U,p){return p===this._selectRowIndex?this._labelSelectColor:this._labelColor},getPropertyFont:function(){return this._labelFont},getPropertyColor:function(Z,q){return q===this._selectRowIndex?this._labelSelectColor:Z.getColor()||this._labelColor},getCategoryFont:function(){return this._labelFont},getCategoryColor:function(){return this._labelColor},adjustTranslateX:function(){return 0},adjustTranslateY:function(_){var M=this.getHeight()-this._59I;return M>_&&(_=M),_>0?0:c(_)},isExpanded:function(r){if(!r)return!0;var q=this._26o[r];return q?q.isExpanded:!(this._26Q[r]===!1)},toggle:function(y){var I=this;I.isExpanded(y)?I.collapse(y):I.expand(y)},expandAll:function(){this.validate();for(var Z in this._26o)this.expand(Z)},expand:function(T){if(T&&T!==Wr){var b=this,f=b._26o[T];f&&!f.isExpanded&&(f.isExpanded=!0,b.onExpanded(T),b.ivm())}},onExpanded:function(){},collapseAll:function(){this.validate();for(var g in this._26o)this.collapse(g)},collapse:function(u){if(u&&u!==Wr){var G=this,S=G._26o[u];S&&S.isExpanded&&(S.isExpanded=!1,G.onCollapsed(u),G.ivm())}},onCollapsed:function(){},getCategoryName:function(J){if(!this.isCategorizable())return Wr;var M=J.getCategoryName();return M?M:Wr},getPropertyModel:function(){return this._propertyModel},handleSelectionChange:function(){this.ivm()},setDataModel:function(W){var x=this,X=x._dataModel;X!==W&&(X&&(X.umd(x.handlePropertyChange,x),x._selectionModel||X.sm().ums(x.handleSelectionChange,x)),x._dataModel=W,W.md(x.handlePropertyChange,x),x._selectionModel?x._selectionModel._21I(W):W.sm().ms(x.handleSelectionChange,x),x.fp(xh,X,W))},isVisible:function(P){return this._visibleFunc?this._visibleFunc(P):!0},onPropertyChanged:function(V){var i=this,v=V.property;Et[v]?i.ivm():i.iv(),v===fk&&i._43o()},getCurrentData:function(){return this._27o},updateCurrentData:function(){this._27o=this.sm().ld()},getRawProperties:function(){return this._27o?this._propertyModel._roots:Ah},handlePropertyChange:function(Y){this._27o===Y.data&&this.iv()},ivm:function(){this.invalidateModel()},invalidateModel:function(){var v=this;v._96I||(v.setSelectRowIndex(-1),v._96I=1,v.iv())},redraw:function(){this.iv()},validateModel:function(){var h=this,k=h._rows,D=h._28o,C={},L=new Ik,O=h._27o;h.updateCurrentData(),O!==h._27o&&h.endEditing(),k.clear(),D.clear(),h.getRawProperties().each(function(W){if(h.isVisible(W)){L.add(W);var t=h.getCategoryName(W);C[t]||(D.add(t,t===Wr?0:I),C[t]={isExpanded:h.isExpanded(t),properties:new Ik})}}),h._sortFunc&&L.sort(h._sortFunc);for(var A in h._26o)h._26Q[A]=h.isExpanded(A);h._26o=C,D.each(function(S){S!==Wr&&k.add(S);var c=C[S];c.isExpanded&&L.each(function(V){h.getCategoryName(V)===S&&(c.properties.add(V),k.add({property:V,data:h._27o}))},h)})},validateImpl:function(){var q=this;q._76o(),q._96I&&(q.validateModel(),delete q._96I);var C=q._canvas,a=q.getWidth(),x=q.getHeight(),i=-q.ty(),Z=q._rowHeight,Q=q._indent,r=a-Q,_=q._rows,X=_.size(),f=q._9I=Q+r*q._10I,J=q._59I=X*Z;Nc(C,a,x),q._29I={x:0,y:i,width:a,height:x},q._31I=g(i/Z),q._14I=p((i+x)/Z),q._31I<0&&(q._31I=0),q._14I>X&&(q._14I=X);var e,u=tp(C),B=q._background;Cf(u,0,-i,1),u.beginPath(),u.rect(0,i,a,x),u.clip(),u.clearRect(0,i,a,x),q._93db(u),B&&no(u,0,0,Q,J,B);for(var b=q._31I;b<q._14I;b++){var S=_.get(b),i=Z*b;if(Je(S))B&&no(u,Q,i,r,Z,B),e=Fp(q.isExpanded(S)?q._expandIcon:q._collapseIcon),e&&wf(u,e,qg,0,i,Q,Z),u.save(),u.beginPath(),u.rect(Q,i,r,Z),u.clip(),q.drawCategoryName(u,S,b,Q,i,r,Z),u.restore();else{var z=S.property,D=S.data,e=Fp(z.getIcon()),H=q._selectRowIndex===b?q.getSelectBackground():N;if(e&&wf(u,e,qg,0,i,Q,Z),H&&no(u,Q,i,r,Z,H),u.save(),u.beginPath(),u.rect(Q,i,f-Q,Z),u.clip(),q.drawPropertyName(u,z,b,Q,i,f-Q,Z),u.restore(),!q.isEditing(D,z)){var n=f+1,L=a-f-1;u.save(),u.beginPath(),u.rect(n,i,L,Z),u.clip(),q._87o(q.drawPropertyValue(u,z,q.getValue(D,z),b,n,i,L,Z,D),b,n,i,L,Z),u.restore()}}q._rowLineVisible&&no(u,Q,i+Z-1,r,1,q._rowLineColor)}q._columnLineVisible&&(no(u,f,0,1,J,q._columnLineColor),no(u,a-1,0,1,J)),q._92db(u),q._93I(),u.restore(),q.ty(q.ty())},drawCategoryName:function(a,t,N,r,I,J,m){Pr(a,t,this.getCategoryFont(t),this.getCategoryColor(t),r,I,J,m)},drawPropertyName:function(x,O,D,k,e,p,n){return O.drawPropertyName?(O.drawPropertyName(x,O,D,k,e,p,n,this),void 0):(Pr(x,this.getPropertyName(O),this.getPropertyFont(O,D),this.getPropertyColor(O,D),k,e,p,n),void 0)},drawPropertyValue:function(l,r,w,J,D,I,b,n,S){return r.drawPropertyValue?r.drawPropertyValue(l,r,w,J,D,I,b,n,S,this):(Gt(l,w,r,this.getLabelFont(r,w,J),this.getLabelColor(r,w,J),D,I,b,n,S,this),void 0)},isPropertyEditable:function(W){return W.isEditable()&&this.isEditable()},setProperties:function(F){this._propertyModel.clear(),this.addProperties(F)},addProperties:function(y){if(y){var B=this._propertyModel;y.forEach(function(X){if(!(X instanceof Nt)){var N=gb(X.className);X=Zm(N?N:Nt,X)}B.add(X)})}},getRowIndexAt:function(p){var s=this,U=g(s.lp(p).y/s._rowHeight);return U>=0&&U<s._rows.size()?U:-1},getPropertyAt:function(G){var P=this,Z=P.getRowIndexAt(G);return Z>=0?P._rows.get(Z).property:N},getToolTip:function(R){var w=this,c=w.getPropertyAt(R),t=w._27o;return c&&t?c.getToolTip(t,w._9I<w.lp(R).x,w):N}});var Qt=function(D){this.pv=D,this.addListeners()};ri(Qt,C,{ms_listener:1,getView:function(){return this.pv._view},setCursor:function(e){this.getView().style.cursor=e},clear:function(){var l=this;l._62O=l.cp=l.ty=l.p=N,l.setCursor(Ci)},handle_mousedown:function(P){this.handle_touchstart(P)},handle_touchstart:function(P){var L=this,M=L.pv;vr(P),M.setFocus(P)&&(bs(P)?(L.cp=oc(P),L.ty=M.ty(),L.p=M.getColumnPosition(),L.handle_touchmove(P)):M.setSelectRowIndex(M.getRowIndexAt(P)))},handleWindowMouseUp:function(){this.clear()},handleWindowTouchEnd:function(){this.clear()},handle_mouseup:function(R){this.handle_touchend(R)},handle_touchend:function(f){var g=this;if(g.cp&&!g._62O){var S=g.pv,X=S.lp(f),H=X.x,Z=X.y,m=S._indent,I=S.getRowIndexAt(f),x=S._9I;if(I>=0){var E=S._rowHeight,a=E*I,v=S._rows.get(I),T=v.property;if(Je(v))Fp(S.isExpanded(v)?S._expandIcon:S._collapseIcon)&&H>=0&&m>=H&&Z>=a&&a+E>=Z?S.toggle(v):Jd(f)&&S.toggle(v);else if(H>x&&S.isPropertyEditable(T,f)){var d={x:x+1,y:a,width:S.getWidth()-x-1,height:E},C={x:d.x+S.tx(),y:d.y+S.ty(),width:d.width,height:d.height},D=0,W=S._29I;d.y<W.y?D=d.y-W.y:d.y+E>W.y+W.height&&(D=d.y+E-W.y-W.height),D&&(S.ty(S.ty()-D),C.y-=D),S.beginEditing({data:v.data,property:T,value:S.getValue(v.data,T),event:f,rect:d,editorRect:C,view:S})}}S.setSelectRowIndex(I)}g.clear()},handleWindowMouseMove:function(O){this.handleWindowTouchMove(O)},handleWindowTouchMove:function(f){var c=this,v=c.pv,m=c.ty,I=c.cp,t=oc(f),F=c._62O;if("p"===F)v.setTranslateY(m+t.y-I.y);else if("c"===F){var S=v.getWidth()-v._indent;if(S>16){var W=c.p-(I.x-t.x)/S,o=16/S;o>W&&(W=o),W>1-o&&(W=1-o),v.setColumnPosition(W)}}else"s"===F&&v.setTranslateY(m+(I.y-t.y)*v._59I/v._29I.height)},handle_mousemove:function(Y){this.handle_touchmove(Y)},handle_touchmove:function(Z){if(!br&&bs(Z)){var K=this,h=K.pv,g=u(h.lp(Z).x-h._9I)<=(Hi?8:3);K.cp?K._62O||(g?(K._62O="c",Gp(K,Z)):u(oc(Z).y-K.cp.y)>=2&&(K._62O=K.isV(Z)?"s":"p",Gp(K,Z))):(g?K.setCursor(Dn):K.setCursor(Ci),K.isV(Z)&&h._43o())}},isV:function(M){var i=this.pv,q=i._29I;return i._41o()&&q.x+q.width-i.lp(M).x<Yb},handle_mousewheel:function(x){this.handleScroll(x,x.wheelDelta/40)},handle_DOMMouseScroll:function(F){2===F.axis&&this.handleScroll(F,-F.detail)},handleScroll:function(u,h){var T=this.pv;vr(u),T.endEditing(),T.translate(0,h*T.getRowHeight())},handle_keydown:function(N){var x=this.pv,v=x._rows.size(),h=x._selectRowIndex+(cb(N)?-1:1);(cb(N)||Yd(N))&&(0>h&&(h=0),h>=v&&(h=v-1),x.setSelectRowIndex(h))}}),Jt.ListView=function(i){this._5o(i),new Rt(this)},Kt("ListView",C,{ms_ac:[Hp,og,Oi,bk,dj,Td,Qi,No,Ef,Rr,Zd,Ak,oj,di],ms_v:1,ms_bnb:1,ms_tip:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,ms_lp:1,ms_vs:1,ms_hs:1,_15Q:1,_14Q:1,ms_dm:1,_45o:1,_checkMode:!1,_indent:Gn,_rowHeight:nq,_rowLineVisible:F.listViewRowLineVisible,_rowLineColor:F.listViewRowLineColor,_scrollBarColor:dg,_scrollBarSize:cj,_autoMakeVisible:Jb,_autoHideScrollBar:pl,_selectBackground:F.listViewSelectBackground,_labelColor:F.listViewLabelColor,_labelSelectColor:F.listViewLabelSelectColor,_labelFont:F.listViewLabelFont,isCheckMode:function(){return this._checkMode},setCheckMode:function(R){var j=this,D=j._checkMode;j._checkMode=R,j.fp(Vi,D,R)},drawRow:function(Y,Q,u,P,N,l,W){var c=this,x=0,B=c._indent,Z=c.getIconWidth(Q);c.drawRowBackground(Y,Q,u,P,N,l,W),c._checkMode&&(hl(Y,Fp(c.getCheckIcon(Q)),x+B/2,N+W/2,Q,c),x+=B),c.drawIcon(Y,Q,x,N,Z,W),c.drawLabel(Y,Q,x+Z,N,W)}});var Rt=function(g){this.list=g,this.addListeners()};ri(Rt,C,{ms_listener:1,getView:function(){return this.list._view},clear:function(O){var D=this,i=D.list;O&&"d"===D._62O&&!D.dragCancel&&i.handleDragAndDrop(O,"end"),i.draggingData&&(i.draggingData=null,i.redraw()),D.dragCancel=D._62O=D._isV=D._isH=D.cp=D.tx=D.ty=N},handle_mousedown:function(u){this.handle_touchstart(u)},handle_touchstart:function(r){var j=this,q=j.list;if(vr(r),q.setFocus(r)){var n=q.getDataAt(r);j.cp=oc(r),j.tx=q.tx(),j.ty=q.ty(),bs(r)?n&&q.handleDragAndDrop&&!j.isV(r)&&!j.isH(r)&&q.isDraggable(n)&&(q.draggingData=n,q.redraw(),q.handleDragAndDrop(r,"prepare")):(n?j._33o(r,n):this._cancelDataDoubleSelect(),j.clear(r))}},handleWindowMouseUp:function(x){this.clear(x)},handleWindowTouchEnd:function(g){this.clear(g)},handle_mouseup:function(r){this.handle_touchend(r)},handle_touchend:function(Y){var p=this,L=p.list;if(!p._isV&&!p._isH&&p.cp&&!p._62O){var T=L.getDataAt(Y);T?(L.isCheckMode()?p._34o(Y,T):p._33o(Y,T),Jd(Y)?L.onDataDoubleClicked(T,Y):L.onDataClicked(T,Y)):(p._cancelDataDoubleSelect(),L.handleBackgroundClick(Y))}p.clear(Y)},handleWindowMouseMove:function(D){this.handleWindowTouchMove(D)},handleWindowTouchMove:function(w){var q=this,g=q.list,G=q._62O,S=q.tx,U=q.ty,T=q.cp,y=oc(w),h=g._29I;"p"===G?g.setTranslate(S+y.x-T.x,U+y.y-T.y):"v"===G?g.ty(U+(T.y-y.y)*g._59I/h.height):"h"===G?g.tx(S+(T.x-y.x)*g._91I/h.width):"d"===G&&(q.dragCancel||g.handleDragAndDrop(w,"between"))},handle_mousemove:function(S){this.handle_touchmove(S)},handle_touchmove:function(b){if(!br&&bs(b)){var E=this,r=E.list;if(E._isV=E.isV(b),E._isH=E.isH(b),E.cp){if(!E._62O){if(So(oc(b),E.cp)<2)return;E._isV?E._62O="v":E._isH?E._62O="h":r.draggingData&&!this.dragCancel?(E._62O="d",r.handleDragAndDrop(b,"begin")):E._62O="p",E._62O&&"d"!==E._62O&&r.draggingData&&(r.draggingData=null,r.redraw()),Gp(E,b)}}else E._isV&&r._43o(),E._isH&&r._42o()}},isV:function(f){var u=this.list,g=u._29I;return u._41o()&&g.x+g.width-u.lp(f).x<Yb},isH:function(j){var $=this.list,Z=$._29I;return $._40o()&&Z.y+Z.height-$.lp(j).y<Yb},handle_mousewheel:function(i){this.handleScroll(i,i.wheelDelta/40,i.wheelDelta!==i.wheelDeltaX)},handle_DOMMouseScroll:function(J){this.handleScroll(J,-J.detail,1)},handleScroll:function(e,$,R){var S=this.list;vr(e),S.endEditing&&S.endEditing(),R&&S._41o()?S.translate(0,$*S.getRowHeight()):S._40o()&&S.translate(10*$,0)},handle_keydown:function($){if(!F.isInput($.target)){var t,c=this.list,o=c.sm(),I=c._rows,L=I.size();if(cr($))c.selectAll();else if(Wk($))c.handleDelete&&c.handleDelete($);else if(zi($))"d"!==this._62O||this.dragCancel||(c.handleDragAndDrop($,"cancel"),this.dragCancel=!0);else if(En($))c.isCheckMode()&&(t=c.getFocusData(),t&&c.checkData(t));else if(cb($)||Yd($)){var H=c.isCheckMode();if(t=H?c.getFocusData():o.ld()){var O=c.getRowIndex(t);O>=0&&(cb($)?0!==O&&(t=I.get(O-1),H?c.setFocusData(t):o.ss(t)):O!==L-1&&(t=I.get(O+1),H?c.setFocusData(t):o.ss(t)))}else L>0&&(t=I.get(0),H?c.setFocusData(t):o.ss(t))}}},_34o:function(X,l){var q=this.list,r=q.lp(X).x;return r>=0&&r<=q._indent?(q.checkData(l),void 0):(q.setFocusData(l),void 0)},_33o:function(e,w){var c=this.list,f=c.sm(),s=f.ld();if(!c.canHandleSelectMode(e,w))return this._cancelDataDoubleSelect(),void 0;if(Og(e))c.isSelected(w)?f.rs(w):f.as(w);else if(oo(e))if(s)for(var v=c.getRowIndex(s),C=c.getRowIndex(w);v!==C;)v+=C>v?1:-1,f.as(c._rows.get(v));else f.ss(w);else bs(e)?(f.contains(w)?c.handleDataDoubleSelect&&(this._handleDataDoubleSelect(e,w),Jd(e)&&this._cancelDataDoubleSelect()):this._cancelDataDoubleSelect(),f.ss(w)):f.contains(w)||f.ss(w)},_handleDataDoubleSelect:function(i,e){this._cancelDataDoubleSelect(),this._doubleSelectTimer=Jo(function(){this.list.handleDataDoubleSelect(i,e),this._doubleSelectTimer=I}.bind(this),F.doubleClickSpeed)},_cancelDataDoubleSelect:function(){this._doubleSelectTimer&&(wc(this._doubleSelectTimer),this._doubleSelectTimer=I)}}),Jt.TreeView=function(b){var V=this;V._35o(),V._5o(b),new St(V)},Kt("TreeView",C,{ms_ac:[Hp,og,Oi,"rootVisible",Vi,"rootData",No,Ef,Rr,Zd,Ak,dj,bk,Td,Qi,Kf,ws,oj,di,"loader","doubleClickToToggle"],ms_v:1,ms_bnb:1,ms_tip:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,ms_lp:1,ms_vs:1,ms_hs:1,_15Q:1,ms_dm:1,_48o:1,_14Q:1,_45o:1,_checkMode:N,_indent:Gn,_rowHeight:nq,_rowLineVisible:F.treeViewRowLineVisible,_rowLineColor:F.treeViewRowLineColor,_scrollBarColor:dg,_scrollBarSize:cj,_autoHideScrollBar:pl,_expandIcon:F.treeViewExpandIcon,_collapseIcon:F.treeViewCollapseIcon,_autoMakeVisible:Jb,_selectBackground:F.treeViewSelectBackground,_labelColor:F.treeViewLabelColor,_labelSelectColor:F.treeViewLabelSelectColor,_labelFont:F.treeViewLabelFont,_doubleClickToToggle:F.treeViewDoubleClickToToggle,drawRow:function(B,Y,y,b,K,u,p){var N=this;N.drawRowBackground(B,Y,y,b,K,u,p),N.drawTree(B,Y,y,0,K,u,p)},isOnToggleIcon:function(W){var i=this.getDataAt(W);if(i){var P=this.getIndent(),B=this.lp(W).x;if(Fp(this.getToggleIcon(i))){var G=P*this.getLevel(i);if(B>=G&&G+P>=B)return!0}}return!1}});var St=function(s){Iq(St,this,[s])};ri(St,Rt,{toggle:function(a,Q,$,t){var G=this.list,f=G.lp(a).x;if(Fp(G.getToggleIcon(Q))){var z=$*t;if(f>=z&&z+$>=f)return G.toggle(Q),!0}return G.isDoubleClickToToggle()&&Jd(a)?(G.toggle(Q),!0):!1},_34o:function(v,_){var p=this.list,P=p.lp(v).x,S=p._levelMap[_._id],k=p._indent,Q=k*(S+1);return P>=Q&&Q+k>=P?(p.checkData(_),void 0):(this.toggle(v,_,k,S)||p.setFocusData(_),void 0)},_33o:function(o,N){var I=this,y=I.list;if(!I.toggle(o,N,y._indent,y.getLevel(N)))if(oo(o)){var $=y.sm();if($.size()>0){for(var Z=y._rows,O=null,Y=0,K=Z.size();K>Y;Y++)if(y.isSelected(Z.get(Y))){O=Y;break}for(var r=null,Y=Z.size()-1;Y>=0;Y--)if(y.isSelected(Z.get(Y))){r=Y;break}var M,g,L=y.getRowIndex(N);for(O>L?(M=L-1,g=O):L>r?(M=r,g=L):(M=O,g=r);M!==g;)M++,$.as(y._rows.get(M))}else $.ss(N)}else St.superClass._33o.call(I,o,N)},handle_keydown:function(H){if(jr(H)||wk(H)){var M=this.list,Z=M._rows,m=M.isCheckMode(),d=M.sm(),h=m?M.getFocusData():d.ld();h?h.hasChildren()&&(jr(H)?M.collapse(h):M.expand(h)):Z.size()>0&&(h=Z.get(0),m?M.setFocusData(h):d.ss(h))}else St.superClass.handle_keydown.call(this,H)}});var Tt=Jt.TableView=function(h){this._98I(),this._5o(h),new Ut(this)};Kt("TableView",C,{ms_ac:[Hp,og,Oi,"sortMode",Cg,Wd,bk,Td,Qi,Lg,ej,"sortColumn",No,Ef,Rr,Zd,Ak,oj,di],ms_v:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,ms_lp:1,ms_vs:1,ms_hs:1,_15Q:1,ms_dm:1,ms_tip:1,_50o:1,_45o:1,_47o:1,_sortMode:Ve,_editable:!0,_batchEditable:!1,_rowHeight:nq,_rowLineVisible:F.tableViewRowLineVisible,_rowLineColor:F.tableViewRowLineColor,_columnLineVisible:F.tableViewColumnLineVisible,_columnLineColor:F.tableViewColumnLineColor,_scrollBarColor:dg,_scrollBarSize:cj,_autoHideScrollBar:pl,_autoMakeVisible:Jb,_selectBackground:F.tableViewSelectBackground,_labelColor:F.tableViewLabelColor,_labelSelectColor:F.tableViewLabelSelectColor,_labelFont:F.tableViewLabelFont,getCheckColumn:function(){var H=this;if(!H._31o){var B=H._31o=new Mt;B.setEditable(!0),B.setWidth(40),B.getValue=H.getCheckColumValue,B.drawCell=H.drawCheckColumnCell}return H._31o},isCheckMode:function(){return this._39o.contains(this._31o)},setCheckMode:function(K){var Y=this,J=Y._39o,b=Y.getCheckColumn();K!==Y.isCheckMode()&&(K?J.add(b,0):J.remove(b),Y.fp(Vi,!K,K))},getCheckColumValue:function(H,j,T){return T.isSelected(H)},drawCheckColumnCell:function(p,g,G,O,E,v,F,K,q){hl(p,q.getCheckIcon(g),E+F/2,v+K/2,g,q)}});var Ut=function(N){Iq(Ut,this,[N])};ri(Ut,Rt,{_34o:function(T,I){var D=this.list,S=D._31o;if(D.isCellEditable(I,S,T)){var F=D._3Q(S),j=D.lp(T).x;if(F&&j>=F.startX&&j<F.startX+S.getWidth())return D.checkData(I),void 0}D._37O(I,T),D.setFocusData(I)},_33o:function(p,C){this.list._37O(C,p),Ut.superClass._33o.apply(this,arguments)}});var Vt=Jt.TreeTableView=function(U){var S=this,R=S._4o=new Mt;S._35o(),S._98I(),S._5o(U),R.setDisplayName("Name"),R.setEditable(!0),R.setWidth(180),R.drawCell=Wt,R.getValue=Xt,S._39o.add(R),new Yt(S)},Wt=function(A,Y,v,F,T,k,E,p,L){L.drawTree(A,Y,v,T,k,E,p)},Xt=function(n,r,R){return R.getLabel(n)};Kt("TreeTableView",C,{ms_ac:[Hp,og,Oi,"sortMode",Cg,Wd,dj,Vi,"rootData","rootVisible",No,Ef,"sortColumn",Kf,ws,Rr,Zd,Ak,oj,Qi,bk,Td,Lg,ej,di,"loader"],ms_v:1,ms_bnb:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,ms_lp:1,ms_vs:1,ms_hs:1,_15Q:1,ms_dm:1,ms_tip:1,_50o:1,_48o:1,_14Q:1,_45o:1,_47o:1,_sortMode:Ve,_checkMode:N,_editable:!0,_batchEditable:!1,_indent:Gn,_rowHeight:nq,_rowLineVisible:F.treeTableViewRowLineVisible,_rowLineColor:F.treeTableViewRowLineColor,_columnLineVisible:F.treeTableViewColumnLineVisible,_columnLineColor:F.treeTableViewColumnLineColor,_expandIcon:F.treeTableViewExpandIcon,_collapseIcon:F.treeTableViewCollapseIcon,_scrollBarColor:dg,_scrollBarSize:cj,_autoHideScrollBar:pl,_autoMakeVisible:Jb,_selectBackground:F.treeTableViewSelectBackground,_labelColor:F.treeTableViewLabelColor,_labelSelectColor:F.treeTableViewLabelSelectColor,_labelFont:F.treeTableViewLabelFont,getTreeColumn:function(){return this._4o}});var Yt=function(j){Iq(Yt,this,[j])};ri(Yt,Rt,{_34o:function(j,p){var c=this.list,D=c._4o,o=c._3Q(D),q=c.lp(j).x;if(o){var m=c._indent,z=o.startX+m*c.getLevel(p);if(Fp(c.getToggleIcon(p))&&q>=z&&z+m>=q)return c.toggle(p),void 0;if(c.isCellEditable(p,D)&&(z+=m,q>=z&&z+m>=q))return c.checkData(p),void 0}c._37O(p,j),c.setFocusData(p)},_33o:function(m,Y){var z=this.list,J=z.lp(m).x;if(Fp(z.getToggleIcon(Y))){var f=z._3Q(z._4o);if(f){var p=z._indent,w=f.startX+p*z.getLevel(Y);if(J>=w&&w+p>=J)return z.toggle(Y),void 0}}z._37O(Y,m),Yt.superClass._33o.apply(this,arguments)}});var Zt=Jt.TableHeader=function(B){var l=this,N=l._view=vc(1,l),v=l._39o=B.getColumnModel(),C=l.iv;l.tv=l._tableView=B,l._60I=new Ik,l._canvas=Qb(N),N.style.background=F.tableHeaderBackground||"",N.style.height=sf+ps,v.mm(C,l),v.md(C,l),v.mh(C,l),B.mp(function(p){At[p.property]&&l.iv()},l),new $t(l),l.iv()};Kt("TableHeader",C,{ms_v:1,ms_lp:1,ms_fire:1,ms_ac:["checkIcon","sortDescIcon","sortAscIcon",Hp,Oi,dj,"moveBackground","insertColor",Lg,ej,"resizable","movable"],_checkIcon:Lh,_movable:!0,_resizable:!0,_labelColor:F.tableHeaderLabelColor,_labelFont:F.tableHeaderLabelFont,_columnLineColor:F.tableHeaderColumnLineColor,_columnLineVisible:F.tableHeaderColumnLineVisible,_sortDescIcon:F.tableHeaderSortDescIcon,_sortAscIcon:F.tableHeaderSortAscIcon,_moveBackground:F.tableHeaderMoveBackground,_insertColor:F.tableHeaderInsertColor,_indent:Gn,getCheckIcon:function(){return this._checkIcon},getTableView:function(){return this.tv},getLabel:function(z){return z.toLabel()},getLabelFont:function(){return this._labelFont},getLabelColor:function(E){return E.getColor()||this._labelColor},getLabelAlign:function(i){return i._align},onPropertyChanged:function(){this.iv()},_5Q:function(S){this._61I=S,this.iv()},getLogicalPoint:function(H){return qh(H,this._canvas,this.tv.tx())},validateImpl:function(){var I=this,e=I._canvas,r=I.getWidth(),L=I.getHeight(),j=I.tv,u=I._60I,p=I._61I,f=-j.tx(),w=0;(r!==e.clientWidth||L!==e.clientHeight)&&Nc(e,r,L),u.clear(),I._39o._roots.each(function(_){if(_.isVisible()){var v=w+_.getWidth();f+r>=w&&v>=f&&u.add({column:_,startX:w}),w=v}});var q=tp(e);if(Cf(q,-f,0,1),q.beginPath(),q.rect(f,0,r,L),q.clip(),q.clearRect(f,0,r,L),u.each(function(P){var _=P.column,b=P.startX,n=_.getWidth();n>0&&(q.save(),q.beginPath(),q.rect(b,0,n,L),q.clip(),p&&p.column===_||I.drawColumn(q,_,b,0,n,L),I._columnLineVisible&&no(q,b+n-1,0,1,L,I._columnLineColor),q.restore())}),p){var W=p.column,w=p.startX,B=p.position,g=W.getWidth();q.save(),q.beginPath(),q.rect(w,0,g,L),q.clip(),q.fillStyle=I._moveBackground,q.fill(),I.drawColumn(q,W,w,0,g,L),q.restore(),Bj(q,I._insertColor,B,0,L)}q.restore()},_6Q:function(u){var Z=this.tv;return Z._31o===u&&Z.sm().getSelectionMode()===xf},drawColumn:function(f,n,G,H,i,P){var m=this,c=m.tv,F=Fp(n.getIcon()),A=m.getLabelAlign(n);if(m._6Q(n)){var _=Fp(m._checkIcon);hl(f,_,G+i/2,H+P/2,n,m)}else{var O=m.getLabel(n),t=m.getLabelFont(n),u=m.getLabelColor(n),r=ce(t,O).width,q=F?m._indent:0;A===hp?(F&&wf(f,F,qg,G,H,q,P),Pr(f,O,t,u,G+q,H,i,P,hp)):A===Il?(F&&wf(f,F,qg,G+i-r-q,H,q,P),Pr(f,O,t,u,G,H,i,P,Il)):(F&&wf(f,F,qg,G+(i-r-q)/2,H,q,P),Pr(f,O,t,u,G+(i-r+q)/2,H,0,P,hp))}if(n.isSortable()&&c.getSortColumn()===n&&(F=Fp(n.getSortOrder()===Le?m._sortAscIcon:m._sortDescIcon))){var Q=fm(F,n)/2+2;hl(f,F,A===Il?G+Q:G+i-Q,H+P/2,n,c)}}});var $t=function(i){var w=this;w.th=i,w.tv=i._tableView,w.addListeners()};ri($t,C,{ms_listener:1,getView:function(){return this.th.getView()},setCursor:function(K){this.getView().style.cursor=K},handle_mousemove:function(v){if(!br){var k=this;delete k._29o,k.setCursor(Ci);for(var m=k.th,I=m._60I,C=m.lp(v).x,T=I.size()-1;T>=0;T--){var s=I.get(T),P=s.column,G=s.startX+P.getWidth();if(m.isResizable()&&u(G-C)<=(Hi?10:3))return k._29o=s,k.setCursor(Dn),void 0;C>s.startX&&G>C&&(k._29o=s),(P.isClickable()||P.isSortable()||m.isMovable()||k.tv.getCheckColumn&&P===k.tv.getCheckColumn())&&C>s.startX&&G>C&&k.setCursor(pf)}}},handle_mousedown:function(x){this.handle_touchstart(x)},handle_touchstart:function($){var m=this;vr($),m.tv.endEditing(),m.handle_mousemove($),m._29o&&(m.x=oc($).x,m.lx=m.th.lp($).x,m.w=m._29o.column.getWidth(),Gp(m,$))},handleWindowMouseMove:function(I){this.handleWindowTouchMove(I)},handleWindowTouchMove:function(F){var p=this,C=p.th,W=p.getView().style.cursor,m=p._29o,d=oc(F).x-p.x;if(p.resizing||p.moving||(W===Dn?p.resizing=1:C.isMovable()&&W===pf&&u(d)>2&&(p.moving=1)),p.resizing)m.column.setWidth(p.w+d);else if(p.moving){var Y=p.lx+d;C._60I.each(function(N){var H=N.startX,J=H+N.column.getWidth();if(Y>=H&&J>=Y){var P={column:m.column,startX:m.startX+d,front:J-Y>Y-H,insertColumn:N.column};P.position=P.front?H:J,C._5Q(P)
}})}},_16Q:function(s,V){var W=this,I=W.tv,X=W.th,y=X._checkIcon;if(X._6Q(s)){var E=Fp(y),l=W.lx,K=s.getWidth(),j=fm(E,s);if(l>=V+K/2-j&&V+K/2+j>=l){X.setCheckIcon(y===Ie?Lh:Ie);var w=I.sm(),Z=I._rows;return y===Ie?w.rs(Z):w.ss(Z),I.onCheckColumnClicked(s),!0}}return!1},handleWindowMouseUp:function(o){this.handleWindowTouchEnd(o)},handleWindowTouchEnd:function(W){var p=this,e=p.tv,g=p.th,d=p._29o;if(p.moving){var Y=g._61I;if(Y&&Y.insertColumn!==Y.column){var s=Y.column,S=e.getColumnModel()._roots,r=S.remove(s),C=S.indexOf(Y.insertColumn);C>=0&&(Y.front||C++,C<=S.size()&&(S.add(s,C),e.getColumnModel()._38I(s,r,C)))}g._5Q(N),delete p.moving}else if(!p.resizing&&d){s=d.column;var x=g.lp(W).x,_=d.startX,O=!0;if(g.onColumnClicked){var A=g.onColumnClicked(s,W,_);A===!1&&(O=!1)}if(O&&x>=_&&x<=_+s.getWidth()&&!p._16Q(s,_)){if(s.isSortable()){var Q=e.getSortMode(),M=s.getSortOrder();Q===Ve?e.getSortColumn()===s?(M===Zh&&e.setSortColumn(N),s.setSortOrder(M===Le?Zh:Le)):e.setSortColumn(s):"bistate"===Q&&(e.getSortColumn()===s?s.setSortOrder(M===Le?Zh:Le):e.setSortColumn(s))}e.onColumnClicked(s,W,_)}}p._29o=p.resizing=p.x=p.lx=p.w=N}}),Jt.TablePane=function(d){this.init(new Tt(d))},Kt("TablePane",C,{ms_v:1,_44o:1}),Jt.TreeTablePane=function(b){this.init(new Vt(b))},Kt("TreeTablePane",C,{ms_v:1,_44o:1}),Jt.Toolbar=function(J){var O=this,b=O._view=vc(1,O),I=b.style;I.background=F.toolbarBackground||"",I.height=Un+ps,O._canvas=Qb(b),O._30o=new Ik,O._90I=new Ik,O.setItems(J||[]),b.handleGroupSelectedChanged=function(m){if(m.isSelected()){var a=m.getGroupId();null!=a&&O._items.forEach(function(P){var b=P.element;b&&b!==m&&b.setSelected&&b.getGroupId&&b.getGroupId()===a&&b.setSelected(!1)})}},new _t(O)},Kt("Toolbar",C,{ms_v:1,ms_fire:1,ms_tx:1,ms_lp:1,ms_tip:1,ms_value:1,ms_ac:[tj,Hp,Oi,og,di,"itemGap","separatorColor","currentItem","stickToRight"],_labelColor:F.toolbarLabelColor,_labelSelectColor:F.toolbarLabelSelectColor,_labelFont:F.toolbarLabelFont,_selectBackground:F.toolbarSelectBackground,_itemGap:F.toolbarItemGap,_separatorColor:F.toolbarSeparatorColor,_stickToRight:!1,getSumWidth:function(){return this._64I},getToolTip:function(Z){var S=this.getItemInfoAt(Z);return S?S.item.toolTip:N},getLabelColor:function(c){return c&&c.selected&&c.type!==Ie&&c.type!==ud?this._labelSelectColor:this._labelColor},onPropertyChanged:function(z){this.iv(),z.property===tj&&this._items.forEach(function(x){wp(x)})},redraw:function(){this.iv()},addItem:function(s,f){var u=this._items;f==N?u.push(s):u.splice(f,0,s),this.fp(tj,N,u)},removeItem:function(M){if(M)for(var F=this._items,C=0;C<F.length;C++)M===F[C]&&(F.splice(C,1),this.fp(tj,N,F))},removeItemById:function(t){if(t!=N)for(var P=this._items,A=0;A<P.length;A++)if(t===P[A].id){var B=P.splice(A,1)[0];return this.fp(tj,N,P),B}},getItemById:function(C){if(C!=N)for(var M=this._items,K=0;K<M.length;K++){var j=M[K];if(C===j.id)return j}},setItemVisible:function(K,D){var l=this.getItemById(K);l&&(l.visible=D)},getItemInfos:function(){return this._30o},getItemInfoAt:function(g){var E=this,J=0,l=E._30o,$=E.lp(g),n=$.x,o=$.y;if(o>=0&&o<=E.getHeight())for(;J<l.size();J++){var G=l.get(J);if(G.startX<=n&&n<=G.endX)return G}return N},drawItem:function(H,$,j,x,s){if($.visible===!1)return 0;if(Cc($.visible)&&!$.visible())return 0;var i=this,M=$.disabled;M&&(H.globalAlpha=Zj);var q=i.drawItemImpl(H,$,j,x,s),R=i._itemGap;return M&&(H.globalAlpha=1),this._currentItem!==$||"separator"===$||$.separator===!0||$.unfocusable||Jq(H,i._separatorColor,j-R/2,0,q+R,x),q},drawItemImpl:function(e,D,l,U,$){var b=this,u=b._view,g=b._itemGap,s=U/2,r=D.type,I=D.element,L=D.label;Je(I)&&(L=I,I=N);var w,Q=b.getLabelFont(D),k=b.getLabelColor(D),B=D.selected,S=Fp(D.icon),x=fm(S,D),R=0,p=x+(L?ce(Q,L).width:0);if("separator"===D||D.separator===!0)return Bj(e,b._separatorColor,l,U/4,s),1;if(I){S&&hl(e,S,l+x/2,s,D,b),Pr(e,L,Q,k,l+x,0,0,U);var G=ul(I);$||b._90I.add(G),G.parentNode!==u&&Em(u,G),I.iv&&I.iv(),I.validate&&I.validate();var j=G.getBoundingClientRect(),o=j.width,Y=G.style;return Xj(G),Y.left=b.tx()+l+p+ps,Y.top=(U-j.height)/2+ps,p+o}return r===ud?w=Fp(B?Sd:Nk):r===Ie&&(w=Fp(B?Ie:Lh)),w?(R=fm(w,D),hl(e,w,l+R/2,s,D,b),l+=R,p+=R):B&&no(e,l-g/2,0,p+g,U,b.getSelectBackground(D)),S&&hl(e,S,l+x/2,s,D,b),Pr(e,L,Q,k,l+x,0,0,U),p},validateImpl:function(){var r=this,H=r._canvas,g=r.getWidth(),M=r.getHeight(),h=r._30o,m=r._items;Nc(H,g,M);var u=tp(H),k=r._itemGap,L=k/2;Cf(u,r.tx(),0,1),u.clearRect(0,0,g,M);var X=r._90I;r._90I=new Ik,h.clear(),m.forEach(function(E){var l=r.drawItem(u,E,L,M);h.add({item:E,startX:L,endX:L+l,width:l}),l&&(L+=l+k)}),X.each(function(y){r._90I.contains(y)||Yf(y)});var x=r._64I;r._64I=n(0,L-k/2),u.restore(),r._stickToRight?(r._65O=0,u=tp(H),L=g-r._64I+k/2,Cf(u,0,0,1),u.clearRect(0,0,g,M),h.clear(),m.forEach(function($){var a=r.drawItem(u,$,L,M,!0);h.add({item:$,startX:L,endX:L+a,width:a}),a&&(L+=a+k)}),u.restore()):r.tx(r.tx()),x!==r._64I&&r.onSumWidthChanged(x,r._64I)},onSumWidthChanged:function(){},handleClick:function(W,j){var J=this,Z=W.type,o=W.action,p=W.groupId,d=W.selected;W.disabled||(p!=N?d||(W.selected=!0,this._items.forEach(function(Y){Y.groupId===p&&W!==Y&&(Y.selected=!1)}),o&&W.action(W,J,j)):Z===Ie||"toggle"===Z?(W.selected=!d,o&&W.action(W,J,j)):o&&W.action(W,J,j)),to(),J.iv()}});var _t=function(z){this.tb=z,this.addListeners()};ri(_t,C,{ms_listener:1,getView:function(){return this.tb._view},handle_mousewheel:function(O){this.handleScroll(O,10*(O.wheelDelta/40))},handle_DOMMouseScroll:function(r){this.handleScroll(r,10*-r.detail)},handleScroll:function(S,b){vr(S);var I=this.tb;I.isScrollable()&&!I._stickToRight&&(I.tx(I.tx()+b),Pn())},handle_mousemove:function(u){var I=this;br||I.setItem(u)},handle_mouseout:function(A){var g=this;A.target===g.getView()?g.tb.setCurrentItem(N):g.handle_mousemove(A)},handle_mousedown:function(S){this.handle_mousemove(S),this.handle_touchstart(S)},handle_touchstart:function(k){var s=this,n=s.tb,i=k.target;bs(k)&&(i===s.getView()||i===n._canvas)&&(vr(k),n.setFocus(k)&&(this.setItem(k,!0),(n.isScrollable()||s.info&&!s.info.item.disabled)&&(s.x=oc(k).x,s.tx=n.tx(),Gp(s,k))))},handleWindowMouseMove:function(R){this.handleWindowTouchMove(R)},handleWindowTouchMove:function(U){var k=this,a=k.tb;if(!a._stickToRight){var _=oc(U).x-k.x;!k._25o&&u(_)>2&&a.isScrollable()&&(k._25o=1),k._25o&&a.tx(k.tx+_)}},handleWindowMouseUp:function(V){this.handleWindowTouchEnd(V)},handleWindowTouchEnd:function(I){var q=this,U=q.tb,r=q.info,O=q.tb.getItemInfoAt(I);if(!q._25o&&r){var u=r.item;O&&O.item===u&&U.handleClick(u,I)}q._25o=q.x=q.tx=N,q.setItem()},setItem:function(D,A){var F=this,x=F.tb,H=F.info=D?x.getItemInfoAt(D):N,Q=H?H.item:N;x.setCurrentItem(Q),A&&Q&&Cc(Q.onDown)&&Q.onDown(D)}}),Jt.BorderPane=function(){this._view=vc(1,this),this.iv()},Kt("BorderPane",C,{ms_v:1,ms_ac:["topHeight","bottomHeight","leftWidth","rightWidth"],ms_fire:1,getLeftView:function(){return this._leftView},setLeftView:function(S,e){this._12o("leftView",S),e!=N&&this.setLeftWidth(e)},getRightView:function(){return this._rightView},setRightView:function(c,C){this._12o("rightView",c),C!=N&&this.setRightWidth(C)},getTopView:function(){return this._topView},setTopView:function(T,Z){this._12o("topView",T),Z!=N&&this.setTopHeight(Z)},getBottomView:function(){return this._bottomView},setBottomView:function(f,K){this._12o("bottomView",f),K!=N&&this.setBottomHeight(K)},getCenterView:function(){return this._centerView},setCenterView:function(M){this._12o("centerView",M)},_12o:function(G,r){var R=this,x="_"+G,O=R._view,h=R[x];h!==r&&(h&&(h.getView?Yf(h.getView()):Yf(h)),R[x]=r,r&&(r.getView?Em(O,r.getView(),1):Em(O,r,1)),R.fp(G,h,r))},onPropertyChanged:function(){this.iv()},validateImpl:function(){var c=this,$=c._topView,R=c._bottomView,x=c._leftView,p=c._rightView,E=c._centerView,G=c.getWidth(),e=c.getHeight(),b=0,a=0,S=G,Y=e,B=0,g=0,P=0,k=0;$&&(B=c._topHeight==N?Cb($):c._topHeight,a=B),R&&(g=c._bottomHeight==N?Cb(R):c._bottomHeight,Y=e-g),x&&(P=c._leftWidth==N?Oq(x):c._leftWidth,b=P),p&&(k=c._rightWidth==N?Oq(p):c._rightWidth,S=G-k);var l=n(0,S-b),D=n(0,Y-a);$&&Xd($,0,0,G,B),R&&Xd(R,0,Y,G,g),x&&Xd(x,0,a,P,D),p&&Xd(p,S,a,k,D),E&&Xd(E,b,a,l,D)}})}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);