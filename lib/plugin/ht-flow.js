!function(B){"use strict";var C=B.ht,W=C.Default,G=W.getInternal(),h=G.ui(),D=null,R="__segmentLengths",c="__lineTotalLength",L="__linePoints",r="__distance0",y="flow.count",p="flow.step",M="flow.element.max",F="flow.element.count",l="flow.element.min",t="flow.element.space",u="flow.element.autorotate",V="flow.element.background",$="flow.element.shadow.max",e="flow.element.shadow.min",P="flow.element.shadow.begincolor",s="flow.element.shadow.endcolor",N="flow.element.shadow.visible",X="flow.element.image",I="flow",Q=C.Math.Vector2,H=new Q;new Q,new Q,C.List;var j=C.Default._edgeProtectMethod,g=j.getStraightLinePoints,Z=function(H,V){for(var $=[],i=H.length,E=0;i>E;E++){var N=H[E];N._as&&(N=N._as);for(var o=N[0],l=1;l<N.length;l++)$.push([o,N[l]]),o=N[l]}for(var Q=[],E=0;E<$.length;E++){var A=b($[E][0],$[E][1],V);Q.push(A)}return{distance:Q,segments:$}},q=function(A,M,V){if(A){for(var y,_=Z(A,M),u=_.distance,x=_.segments,f=1/0,e=null,q=0,g=u.length;g>q;q++){var d=u[q];d.z<f&&(y=q,f=d.z,e=d)}if(null==V&&(V=.1),e.z<V){for(var m=0,H=0;y>=H;H++)m+=W.getDistance(x[H][0],y>H?x[H][1]:e);return m}}},b=function(R,m,v){var M=R.x,b=R.y,B=m.x,s=m.y,f=v.x,F=v.y,l=B-M,X=s-b,Q=Math.sqrt(l*l+X*X),P=l/Q,n=X/Q,G=(-M+f)*P+(-b+F)*n,Y={x:M+G*P,y:b+G*n};return Y.x>=Math.min(R.x,m.x)&&Y.x<=Math.max(R.x,m.x)&&Y.y>=Math.min(R.y,m.y)&&Y.y<=Math.max(R.y,m.y)||(Y.x=Math.abs(Y.x-R.x)<Math.abs(Y.x-m.x)?R.x:m.x,Y.y=Math.abs(Y.y-R.y)<Math.abs(Y.y-m.y)?R.y:m.y),l=f-Y.x,X=F-Y.y,Y.z=Math.sqrt(l*l+X*X),Y},v=function(M,G){if(M){var c=Z(M,G).distance,a=1/0,D=null;return c.forEach(function(_){_.z<a&&(a=_.z,D=_)}),D}},A=j.calculateLineLength,m=j.calcSegmentIndexByDistance,n=j.calculatePointAlongLine,z=function(S,x,D){if(!S)return D;if(0===x){var $=S[0][0],y=S[0][1];return D+Math.atan2(y.y-$.y,y.x-$.x)}if(100===x){S=S[S.length-1];var $=S[S.length-2],y=S[S.length-1];return D+Math.atan2(y.y-$.y,y.x-$.x)}for(var l=0,v=[],E=S.length,T=0;E>T;T++){var h=S[T],J=A(h);l+=J,v.push(J)}for(var H=l*x/100,L=m(H,v),V=0,W=0;L>W;W++)V+=v[W];H-=V;for(var e=n(S[L],H),z=S[L],M=0,c=0,I=0;I<z.length-1;I++){var Y=z[I],K=z[I+1],B=K.x-Y.x,t=K.y-Y.y,b=Math.sqrt(B*B+t*t);if(M+=b,M>H){c=I;break}}var j=z[c];return D+Math.atan2(e.y-j.y,e.x-j.x)},U=function(I){var p=0;if(I)if(Array.isArray(I[0]))for(var a=I.length,H=0;a>H;H++){var F=I[H],l=A(F);p+=l}else p=A(I);return p},_=function(j,l,u,U){return H.set(l,u).rotateAround(null,U),j?{x:j.x+H.x,y:j.y+H.y}:{x:H.x,y:H.y}},x=function(T){var S=T._data,w=g(T);if(w){S.s("flow.reverse")&&(w.reverse(),w.forEach(function(x){x.reverse()}));for(var u=0,z=[],h=w.length,M=0;h>M;M++){var J=w[M],v=A(J);u+=v,z.push(v)}if(S[R]=z,S[c]=u,S[L]=w,S instanceof C.Edge){var p=W.unionPoint(w),r=p.x+p.width/2,E=p.y+p.height/2;S.$10e={x:r,y:E}}o(T,!0)}},O=j.getPercentPosition,o=function(h,u){var j=h._data,g=j[c],b=j.s(y),V=j.s(p),P=0,f=j[R],L=j.s(M),o=j.s(l),Y=j.s(F),n=(L-o)/(Y-1),t=[];if(f){if(1===Y)t.push(L);else if(2===Y)t.push(L),t.push(o);else{if(!(Y>2))return;t.push(L);for(var Z=Y-2;Z>0;Z--)t.push(o+n*Z);t.push(o)}var Q=0,x=0;t.forEach(function(l){Y-1>Q&&(x+=j.getFlowElementSpace(l)),Q++}),x+=(L+o)/2,P=(g-b*x+x)/b;var E=h[r];for(null==E&&(E=0),u||(E+=V);E>g+x;){var I=h._overCount;I?I++:I=1,I>=b&&(I=null),h._overCount=I,j.s("flow.autoreverse")?I?E-=P+x:(E=0,j.s("flow.reverse",!j.s("flow.reverse"))):E-=P+x}h[r]=E}},k="prototype",J=C.graph.GraphView[k],d=C.Data[k],w=h.DataUI[k],Y=h.ShapeUI[k],f=h.EdgeUI[k],K=C.DataModel[k],T=C.Style;T[M]==D&&(T[M]=7),T[l]==D&&(T[l]=0),T[y]==D&&(T[y]=1),T[p]==D&&(T[p]=3),T[F]==D&&(T[F]=10),T[t]==D&&(T[t]=3.5),T[u]==D&&(T[u]=!1),T[V]==D&&(T[V]="rgba(255, 255, 114, 0.4)"),T[P]==D&&(T[P]="rgba(255, 255, 0, 0.3)"),T[s]==D&&(T[s]="rgba(255, 255, 0, 0)"),T[N]==D&&(T[N]=1),T[$]==D&&(T[$]=22),T[e]==D&&(T[e]=4),J.calculatePointLength=function(l,$,P){var A=this.getDataUI(l),c=g(A);return q(c,$,P)},W.calculatePointLength=function(r,x,X,O){var $=g(D,r,x);return q($,X,O)},W.calculateClosestPointOnLine=b,J.calculateClosestPoint=function(d,s){var S=this.getDataUI(d),E=g(S);return v(E,s)},W.calculateClosestPoint=function(W,K,J){var N=g(D,W,K);return v(N,J)},J.getPercentAngle=function(U,s){var C=this.getDataUI(U),Q=g(C);return U.getRotation?U.getRotation():0,z(Q,s,U.getRotation?U.getRotation():0)},W.getPercentAngle=function(I,r,w){var Z=g(D,I,r);return z(Z,w,0)},J.calculateLength=function(r){var i=this.getDataUI(r),v=g(i);return U(v)},W.calculateLength=function(M,d){var w=g(D,M,d);return U(w)},J.getPercentPosition=function(I,z){var L=this.getDataUI(I),n=g(L);return O(n,z)},W.getPercentPositionOnPoints=function(S,s,w){var J=g(D,S,s);return O(J,w)};var a=function(L){var N=L.data,x=this.dm();if(N&&"add"===L.kind){var W=x.$3e;W&&N.s(I)&&W.indexOf(N)<0&&W.push(N)}"clear"===L.kind&&(x.$3e=[])},i=function(D){var y=D.property,d=D.data,j=D.newValue,n=this.dm().$3e;if(n&&"s:flow"===y)if(j)n.indexOf(d)<0&&n.push(d);else for(var Y=n.length,P=0;Y>P;P++)if(n[P]===d){n.splice(P,1);break}},E=J.setDataModel;J.setDataModel=function(g){var k=this,U=k._dataModel;if(U!==g){U&&(U.umm(a,k),U.umd(i,k),U.$3e=[]),g.mm(a,k),g.md(i,k);var s=g.$3e=[];g.each(function(W){W.s(I)&&s.indexOf(W)<0&&s.push(W)}),E.call(k,g)}},d.getFlowElementSpace=function(){return this.s(t)};var S=function(B){var b=this,v=b._data,f=v[c],O=v[R],A=v[L],h=v.s(y),T=0,J=b[r],V=v.s(M),E=v.s(l),X=v.s(F),q=v.s(e),j=v.s($),k=v.s(u),i=(j-q)/(X-1),K=(V-E)/(X-1),w=v.getRotation?v.getRotation():0,C=v.getPosition?v.p():v.$10e,d=[],Q=[];if(J!=D){if(1===X)d.push(V);else if(2===X)d.push(V),d.push(E);else{if(!(X>2))return;d.push(V);for(var g=X-2;g>0;g--)d.push(E+K*g);d.push(E)}if(1===X)Q.push(j);else if(2===X)Q.push(j),Q.push(q);else{if(!(X>2))return;Q.push(j);for(var g=X-2;g>0;g--)Q.push(q+i*g);Q.push(q)}var P=0,o=0;d.forEach(function(J){X-1>P&&(o+=v.getFlowElementSpace(J)),P++}),o+=(V+E)/2,T=(f-h*o+o)/h,B.save();for(var g=0;h>g;g++){var I=J,p=0,S=b._overCount,z=0;v.s("flow.autoreverse")&&S&&S>h-(g+1)||(I-=g*(T+o),P=0,d.forEach(function(F){var K=I-p;if(K>=0&&f>K){var j=!0,E=m(K,O);z=0;for(var T=0;E>T;T++)z+=O[T];if(K-=z,j){var D=n(A[E],K),Z=w;if(k){for(var e=A[E],r=0,N=0,x=0;x<e.length-1;x++){var U=e[x],t=e[x+1],g=t.x-U.x,o=t.y-U.y,G=Math.sqrt(g*g+o*o);if(r+=G,r>K){N=x;break}}var X=e[N];Z+=Math.atan2(D.y-X.y,D.x-X.x)}w&&(D=_(C,D.x-C.x,D.y-C.y,w)),b.$5e(B,D,F,Q[P],Z)}}p+=v.getFlowElementSpace(d[P]),P++}))}B.restore()}},eg=f._80o;f._80o=function(j){eg.call(this,j);var r=this,Y=r._data,i=r.gv;Y.s(I)&&i.$7e!=D&&S.call(r,j)};var Nm=Y._80o;Y._80o=function(j){Nm.call(this,j);var F=this,h=F._data,H=F.gv;h.s(I)&&H.$7e!=D&&S.call(F,j)};var Ak=f._79o,Hk=Y._79o,zk=function(){var a=this,w=a._data,v=w.s(M),g=!1,E=D;if(a._6I||(g=!0),E=w instanceof C.Edge?Ak.call(a):Hk.call(a),w.s(I)&&g){var m=w.s($),b=w.s(N);b&&m>v&&(v=m),v>0&&W.grow(E,Math.ceil(v/2)),x(a)}return!w.s(I)&&g&&(w[R]=w[c]=w[L]=a[r]=D),E};Y._79o=zk,f._79o=zk,w.$5e=function(y,M,O,n,x){var F=this,m=F._data,p=F.gv,c=m.s(V),L=m.s(P),_=m.s(s),T=m.s(N),g=p.$8e,$=m.s(X);if(g==D&&(g=p.$8e={}),y.beginPath(),$!=D){var U=W.getImage($),B=O/2;y.translate(M.x,M.y),y.rotate(x),y.translate(-M.x,-M.y),W.drawImage(y,U,M.x-B,M.y-B,O,O,m),y.translate(M.x,M.y),y.rotate(-x),y.translate(-M.x,-M.y)}else if(p.__flowBatch){var k=p.__flowBatchGroup;k||(k=p.__flowBatchGroup={});var u=[M.x,M.y,O/2];k[c]?k[c].push(u):k[c]=[u]}else y.fillStyle=c,y.arc(M.x,M.y,O/2,0,2*Math.PI,!0),y.fill();if(T){var C=22,t=C+"_"+L+"_"+_,i=g[t];if(i==D){var r=document.createElement("canvas");G.setCanvas(r,C,C);var E=r.getContext("2d"),I=C/2,J=I,z=I;G.translateAndScale(E,0,0,1),E.beginPath();var a=E.createRadialGradient(J,z,0,J,J,I);a.addColorStop(0,L),a.addColorStop(1,_),E.fillStyle=a,E.arc(J,z,I,0,2*Math.PI,!0),E.fill(),i=g[t]=r}var B=n/2;W.drawImage(y,i,M.x-B,M.y-B,n,n,m)}},J.$9e=function(){var d=this,V=d.dm().$3e;d._24I,V.forEach(function(W){d._24I[W._id]=W}),d.iv()};var El=K.prepareRemove;K.prepareRemove=function(y){El.call(this,y);var v=y._dataModel,I=v.$3e;if(I)for(var R=I.length,b=0;R>b;b++)if(I[b]===y){I.splice(b,1);break}},J.setFlowInterval=function(Z){var O=this,T=O.$11e;O.$11e=Z,O.fp("flowInterval",T,Z),O.$7e!=D&&(clearInterval(O.$7e),delete O.$7e,O.enableFlow(Z))},J.getFlowInterval=function(){return this.$11e},J.enableFlow=function(U){var B=this,V=B.dm(),J=V.$3e;B.$7e==D&&(J.forEach(function(c){var C=B.getDataUI(c);x(C)}),B.$7e=setInterval(function(){V.$3e.forEach(function(C){o(B.getDataUI(C))}),B.$9e()},U||B.$11e||50))},J.disableFlow=function(){var H=this;clearInterval(H.$7e),delete H.$7e;var s=H.dm().$3e;s&&H.$9e()};var kn=function(){this.__flowBatchGroup={}},ef=function(X){var A=this.__flowBatchGroup;if(A){X.save();for(var m in A){X.fillStyle=m,X.beginPath();var e=A[m];e.forEach(function(G){X.moveTo(G[0],G[1]),X.arc(G[0],G[1],G[2],0,2*Math.PI,!0)}),X.fill()}X.restore()}};J.setFlowBatch=function(g){var r=this;!!r.__flowBatch!=!!g&&(r.__flowBatch=g,g?(r.addBottomPainter(kn),r.addTopPainter(ef)):(r.removeBottomPainter(kn),r.removeTopPainter(ef)))}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);