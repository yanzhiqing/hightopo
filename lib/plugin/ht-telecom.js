!function(z,f){"use strict";var P=ht.AlarmSeverity=function(S,A,K,n,s){this.value=S,this.name=A,this.nickName=K,this.color=n,this.displayName=s};ht.Default.def("ht.AlarmSeverity",f,{toString:function(){return this.displayName||this.name}}),function(){P.severities=new ht.List,P._vm={},P._nm={},P._cp=function(o,h){if(o&&h){var R=o.value-h.value;return R>0?1:0>R?-1:0}return o&&!h?1:!o&&h?-1:0},P.each=function(V,$){P.severities.each(V,$)},P.getSortFunction=function(){return P._cp},P.setSortFunction=function($){P._cp=$,P.severities.sort($)},P.add=function(V,U,c,H,B){var M=new P(V,U,c,H,B);return P._vm[V]=M,P._nm[U]=M,P.severities.add(M),P.severities.sort(P._cp),M},P.remove=function(e){var t=P._nm[e];return t&&(delete P._nm[e],delete P._vm[t.value],P.severities.remove(t)),t},P.CRITICAL=P.add(500,"Critical","C","#FF0000"),P.MAJOR=P.add(400,"Major","M","#FFA000"),P.MINOR=P.add(300,"Minor","m","#FFFF00"),P.WARNING=P.add(200,"Warning","W","#00FFFF"),P.INDETERMINATE=P.add(100,"Indeterminate","N","#C800FF"),P.CLEARED=P.add(0,"Cleared","R","#00FF00"),P.isClearedAlarmSeverity=function(o){return o?0===o.value:!1},P.getByName=function(T){return P._nm[T]},P.getByValue=function(S){return P._vm[S]},P.clear=function(){P.severities.clear(),P._vm={},P._nm={}},P.compare=function(n,v){return P._cp(n,v)}}();var V=ht.AlarmState=function(n){this._d=n,this._nm={},this._am={},this._ps=null,this._haa=null,this._hna=null,this._hoa=null,this._hta=null,this._hls=!1,this._aac=0,this._nac=0};ht.Default.def("ht.AlarmState",f,{_ep:!0,_f:function(){this._c1(),this._c2(),this._c3(),this._c4(),this._c5(),this._c6(),this._c7(),this._d.fp("alarmState",null,this)},getHighestAcknowledgedAlarmSeverity:function(){return this._haa},getHighestNewAlarmSeverity:function(){return this._hna},getHighestOverallAlarmSeverity:function(){return this._hoa},getHighestNativeAlarmSeverity:function(){return this._hta},hasLessSevereNewAlarms:function(){return this._hls},_c1:function(){var d=null;for(var N in this._am)N=P.getByName(N),P.isClearedAlarmSeverity(N)||0!==this.getAcknowledgedAlarmCount(N)&&(d=d?P.compare(d,N)>0?d:N:N);this._haa=d},_c2:function(){var F=null;for(var R in this._nm)R=P.getByName(R),P.isClearedAlarmSeverity(R)||0!==this.getNewAlarmCount(R)&&(F=F?P.compare(F,R)>0?F:R:R);this._hna=F},_c3:function(){if(!this._hna)return this._hls=!1,void 0;for(var u in this._nm)if(u=P.getByName(u),!P.isClearedAlarmSeverity(u)&&0!==this.getNewAlarmCount(u)&&P.compare(this._hna,u)>0)return this._hls=!0,void 0;this._hls=!1},_c4:function(){var F=this._haa,Y=this._hna,W=this._ps;this._hoa=F,P.compare(Y,this._hoa)>0&&(this._hoa=Y),P.compare(W,this._hoa)>0&&(this._hoa=W)},_c5:function(){var S=this._haa,E=this._hna;this._hta=S,P.compare(E,this._hta)>0&&(this._hta=E)},increaseAcknowledgedAlarm:function(v,u){if(0!==u){u=u||1;var B=this._am[v.name]||0;B+=u,this._am[v.name]=B,this._f()}},increaseNewAlarm:function(N,I){if(0!==I){I=I||1;var J=this._nm[N.name]||0;J+=I,this._nm[N.name]=J,this._f()}},decreaseAcknowledgedAlarm:function(S,P){if(0!==P){P||(P=1);var z=this._am[S.name]||0;if(z-=P,0>z)throw"Alarm count can not be negative";this._am[S.name]=z,this._f()}},decreaseNewAlarm:function(S,D){if(0!==D){D||(D=1);var C=this._nm[S.name]||0;if(C-=D,0>C)throw"Alarm count can not be negative";this._nm[S.name]=C,this._f()}},acknowledgeAlarm:function(w){this.decreaseNewAlarm(w,1),this.increaseAcknowledgedAlarm(w,1)},acknowledgeAllAlarms:function(r){if(r){var J=this.getNewAlarmCount(r);this.decreaseNewAlarm(r,J),this.increaseAcknowledgedAlarm(r,J)}else for(var p in this._nm)this.acknowledgeAllAlarms(P.getByName(p))},_c6:function(){this._aac=0;for(var V in this._am)V=P.getByName(V),this._aac+=this.getAcknowledgedAlarmCount(V)},getAcknowledgedAlarmCount:function(l){return l?this._am[l.name]||0:this._aac},getAlarmCount:function(Q){return this.getAcknowledgedAlarmCount(Q)+this.getNewAlarmCount(Q)},_c7:function(){this._nac=0;for(var R in this._nm)this._nac+=this.getNewAlarmCount(P.getByName(R))},getNewAlarmCount:function(F){return F?this._nm[F.name]||0:this._nac},setNewAlarmCount:function(p,Y){this._nm[p.name]=Y,this._f()},removeAllNewAlarms:function(O){O?delete this._nm[O]:this._nm={},this._f()},setAcknowledgedAlarmCount:function(z,l){this._am[z.name]=l,this._f()},removeAllAcknowledgedAlarms:function(Z){Z?delete this._am[Z.name]:this._am={},this._f()},isEmpty:function(){return!this._hoa},clear:function(){this._am={},this._nm={},this._f()},getPropagateSeverity:function(){return this._ps},setPropagateSeverity:function(l){if(this._ep||(l=null),this._ps!==l){var N=this._ps;this._ps=l,this._f(),this._d.fp("propagateSeverity",N,l)}},isEnablePropagation:function(){return this._ep},setEnablePropagation:function(G){var n=this._ep;this._ep=G,this._d.fp("enablePropagation",n,G)&&(G||this.setPropagateSeverity(null))}});var F=ht.AlarmStatePropagator=function(c){this._dataModel=c,this._enable=!1,this._isPropagating=!1};ht.Default.def("ht.AlarmStatePropagator",f,{getDataModel:function(){return this._dataModel},isEnable:function(){return this._enable},setEnable:function(d){this._enable!==d&&(this._enable=d,this._enable?(this._dataModel.mm(this.handleDataModelChange,this),this._dataModel.md(this.handleDataPropertyChange,this),this._dataModel.each(function(S){this.propagate(S)},this)):(this._dataModel.umm(this.handleDataModelChange,this),this._dataModel.umd(this.handleDataPropertyChange,this)))},handleDataModelChange:function(c){c.data&&this.propagate(c.data)},handleDataPropertyChange:function(M){if("alarmState"===M.property||"enablePropagation"===M.property)this.propagate(M.data);else if("parent"===M.property){var R=M.oldValue;R&&this.propagate(R),this.propagate(M.data)}},propagate:function(K){K&&!this._isPropagating&&(this._isPropagating=!0,this.propagateToTop(K),this._isPropagating=!1)},propagateToTop:function(m){for(this.propagateToParent(null,m);m&&m.getParent();)this.propagateToParent(m,m.getParent()),m=m.getParent()},propagateToParent:function(e,g){var t=null;g.getChildren().each(function(m){var V=m.getAlarmState().getHighestOverallAlarmSeverity();P.compare(V,t)>0&&(t=V)}),g.getAlarmState().setPropagateSeverity(t)}}),ht.AlarmStateStatistics=function(b){this.sumNew=0,this.sumAcked=0,this.sumTotal=0,this.severtiyMap={},this.dataMap={},this.setDataModel(b)},ht.Default.def("ht.AlarmStateStatistics",f,{ms_fire:1,getDataModel:function(){return this._dataModel},setDataModel:function(D){var T=this._dataModel;T!==D&&(T&&(T.umd(this.handleDataPropertyChange,this),T.umm(this.handleDataModelChange,this),this.severtiyMap={},this.dataMap={}),this._dataModel=D,this.reset(),D.md(this.handleDataPropertyChange,this),D.mm(this.handleDataModelChange,this),this.fp("dataModel",T,D))},dispose:function(){this._dataModel.umd(this.handleDataPropertyChange,this),this._dataModel.umm(this.handleDataModelChange,this),delete this._dataModel},handleDataPropertyChange:function(n){"alarmState"===n.property&&(this.increase(n.data),this.fireAlarmStateChange())},handleDataModelChange:function(i){"add"===i.kind?(this.increase(i.data),this.fireAlarmStateChange()):"remove"===i.kind?(this.decrease(i.data),this.fireAlarmStateChange()):"clear"===i.kind&&(this.severtiyMap={},this.dataMap={},this.fireAlarmStateChange())},fireAlarmStateChange:function(){this.sumAcked=0,this.sumNew=0,this.sumTotal=0,P.each(function(g){var t=this.getSumInfo(g);this.sumAcked+=t.ackedCount,this.sumNew+=t.newCount,this.sumTotal+=t.totalCount},this),this.fp("alarmState",!1,!0)},getNewAlarmCount:function(O){if(!O)return this.sumNew;var g=this.getSumInfo(O);return g.newCount},getAcknowledgedAlarmCount:function(j){if(!j)return this.sumAcked;var Q=this.getSumInfo(j);return Q.ackedCount},getTotalAlarmCount:function(v){if(!v)return this.sumTotal;var x=this.getSumInfo(v);return x.totalCount},getSumInfo:function(F){var g=this.severtiyMap[F.name];return g||(g={},g.newCount=0,g.ackedCount=0,g.totalCount=0,this.severtiyMap[F.name]=g),g},decrease:function(E){var w=this.dataMap[E.getId()];w&&(delete this.dataMap[E.getId()],P.each(function(Q){var g=w[Q.name],y=this.getSumInfo(Q);y.newCount=y.newCount-g.newCount,y.ackedCount=y.ackedCount-g.ackedCount,y.totalCount=y.totalCount-g.totalCount},this))},increase:function(u){if(this.decrease(u),!this._filterFunc||this._filterFunc(u)){var V={},A=u.getAlarmState();this.dataMap[u.getId()]=V,P.each(function(C){var o={};o.newCount=A.getNewAlarmCount(C),o.ackedCount=A.getAcknowledgedAlarmCount(C),o.totalCount=A.getAlarmCount(C),V[C.name]=o;var c=this.getSumInfo(C);c.newCount=c.newCount+o.newCount,c.ackedCount=c.ackedCount+o.ackedCount,c.totalCount=c.totalCount+o.totalCount},this)}},reset:function(){this.severtiyMap={},this.dataMap={},this._dataModel.each(this.increase,this),this.fireAlarmStateChange()},setFilterFunc:function(J){var U=this._filterFunc;this._filterFunc=J,this.reset(),this.fp("filterFunc",U,J)},getFilterFunc:function(){return this._filterFunc}});var D=ht.Data.prototype;D.getAlarmState=function(){return this._alarmState||(this._alarmState=new V(this))},D=ht.DataModel.prototype,D.isEnableAlarmStatePropagator=function(){return!!this._alarmStatePropagator&&this._alarmStatePropagator.isEnable()},D.setEnableAlarmStatePropagator=function(m){m!=this.isEnableAlarmStatePropagator()&&(m?(this._alarmStatePropagator=new F(this)).setEnable(!0):this._alarmStatePropagator.setEnable(!1))},D=ht.graph.GraphView.prototype,D.getNote2=function(T){var p=T.getAlarmState().getHighestNewAlarmSeverity();if(p){var w=T.getAlarmState().getNewAlarmCount(p)+p.nickName;return T.getAlarmState().hasLessSevereNewAlarms()&&(w+="+"),w}return T.s("note2")},D.getNote2Background=function(c){var y=c.getAlarmState().getHighestNewAlarmSeverity();return y?y.color:c.s("note2.background")},D.getBodyColor=function(F){var G=F.getAlarmState().getHighestNativeAlarmSeverity();return G?G.color:F.s("body.color")},D.getBorderColor=function(K){var P=K.getAlarmState().getPropagateSeverity();return P?P.color:K.s("border.color")},D=ht.widget.TreeView.prototype,D.getBorderColor=function(V){var j=V.getAlarmState().getPropagateSeverity();return j?j.color:V.s("border.color")},D.getIcon=function(n){return n.getIcon()?"__alarmIcon__":null},D=ht.widget.TreeTableView.prototype,D.getBorderColor=function(H){var t=H.getAlarmState().getPropagateSeverity();return t?t.color:H.s("border.color")},D.getIcon=function(U){return U.getIcon()?"__alarmIcon__":null},ht.Default.setImage("__alarmIcon__",{width:16,height:16,comps:[{type:"image",name:{func:function(F){return F.getIcon()}},color:{func:function(x){var V=x.getAlarmState().getHighestNativeAlarmSeverity();return V?V.color:x.s("body.color")}},rect:[0,0,16,16]}]});var l=ht.Style;l["note2.expanded"]=!0,l["note2.color"]="#000"}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);