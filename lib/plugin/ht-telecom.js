!function(V,u){"use strict";var m=ht.AlarmSeverity=function(C,d,S,g,y){this.value=C,this.name=d,this.nickName=S,this.color=g,this.displayName=y};ht.Default.def("ht.AlarmSeverity",u,{toString:function(){return this.displayName||this.name}}),function(){m.severities=new ht.List,m._vm={},m._nm={},m._cp=function(u,z){if(u&&z){var S=u.value-z.value;return S>0?1:0>S?-1:0}return u&&!z?1:!u&&z?-1:0},m.each=function(T,A){m.severities.each(T,A)},m.getSortFunction=function(){return m._cp},m.setSortFunction=function(N){m._cp=N,m.severities.sort(N)},m.add=function(L,V,o,A,n){var d=new m(L,V,o,A,n);return m._vm[L]=d,m._nm[V]=d,m.severities.add(d),m.severities.sort(m._cp),d},m.remove=function(z){var G=m._nm[z];return G&&(delete m._nm[z],delete m._vm[G.value],m.severities.remove(G)),G},m.CRITICAL=m.add(500,"Critical","C","#FF0000"),m.MAJOR=m.add(400,"Major","M","#FFA000"),m.MINOR=m.add(300,"Minor","m","#FFFF00"),m.WARNING=m.add(200,"Warning","W","#00FFFF"),m.INDETERMINATE=m.add(100,"Indeterminate","N","#C800FF"),m.CLEARED=m.add(0,"Cleared","R","#00FF00"),m.isClearedAlarmSeverity=function(U){return U?0===U.value:!1},m.getByName=function(p){return m._nm[p]},m.getByValue=function(v){return m._vm[v]},m.clear=function(){m.severities.clear(),m._vm={},m._nm={}},m.compare=function(E,v){return m._cp(E,v)}}();var F=ht.AlarmState=function(b){this._d=b,this._nm={},this._am={},this._ps=null,this._haa=null,this._hna=null,this._hoa=null,this._hta=null,this._hls=!1,this._aac=0,this._nac=0};ht.Default.def("ht.AlarmState",u,{_ep:!0,_f:function(){this._c1(),this._c2(),this._c3(),this._c4(),this._c5(),this._c6(),this._c7(),this._d.fp("alarmState",null,this)},getHighestAcknowledgedAlarmSeverity:function(){return this._haa},getHighestNewAlarmSeverity:function(){return this._hna},getHighestOverallAlarmSeverity:function(){return this._hoa},getHighestNativeAlarmSeverity:function(){return this._hta},hasLessSevereNewAlarms:function(){return this._hls},_c1:function(){var B=null;for(var C in this._am)C=m.getByName(C),m.isClearedAlarmSeverity(C)||0!==this.getAcknowledgedAlarmCount(C)&&(B=B?m.compare(B,C)>0?B:C:C);this._haa=B},_c2:function(){var G=null;for(var S in this._nm)S=m.getByName(S),m.isClearedAlarmSeverity(S)||0!==this.getNewAlarmCount(S)&&(G=G?m.compare(G,S)>0?G:S:S);this._hna=G},_c3:function(){if(!this._hna)return this._hls=!1,void 0;for(var u in this._nm)if(u=m.getByName(u),!m.isClearedAlarmSeverity(u)&&0!==this.getNewAlarmCount(u)&&m.compare(this._hna,u)>0)return this._hls=!0,void 0;this._hls=!1},_c4:function(){var j=this._haa,V=this._hna,t=this._ps;this._hoa=j,m.compare(V,this._hoa)>0&&(this._hoa=V),m.compare(t,this._hoa)>0&&(this._hoa=t)},_c5:function(){var c=this._haa,S=this._hna;this._hta=c,m.compare(S,this._hta)>0&&(this._hta=S)},increaseAcknowledgedAlarm:function(E,a){if(0!==a){a=a||1;var Y=this._am[E.name]||0;Y+=a,this._am[E.name]=Y,this._f()}},increaseNewAlarm:function(C,n){if(0!==n){n=n||1;var G=this._nm[C.name]||0;G+=n,this._nm[C.name]=G,this._f()}},decreaseAcknowledgedAlarm:function(X,d){if(0!==d){d||(d=1);var f=this._am[X.name]||0;if(f-=d,0>f)throw"Alarm count can not be negative";this._am[X.name]=f,this._f()}},decreaseNewAlarm:function(r,P){if(0!==P){P||(P=1);var h=this._nm[r.name]||0;if(h-=P,0>h)throw"Alarm count can not be negative";this._nm[r.name]=h,this._f()}},acknowledgeAlarm:function(n){this.decreaseNewAlarm(n,1),this.increaseAcknowledgedAlarm(n,1)},acknowledgeAllAlarms:function(V){if(V){var c=this.getNewAlarmCount(V);this.decreaseNewAlarm(V,c),this.increaseAcknowledgedAlarm(V,c)}else for(var f in this._nm)this.acknowledgeAllAlarms(m.getByName(f))},_c6:function(){this._aac=0;for(var H in this._am)H=m.getByName(H),this._aac+=this.getAcknowledgedAlarmCount(H)},getAcknowledgedAlarmCount:function(j){return j?this._am[j.name]||0:this._aac},getAlarmCount:function(A){return this.getAcknowledgedAlarmCount(A)+this.getNewAlarmCount(A)},_c7:function(){this._nac=0;for(var j in this._nm)this._nac+=this.getNewAlarmCount(m.getByName(j))},getNewAlarmCount:function(L){return L?this._nm[L.name]||0:this._nac},setNewAlarmCount:function(S,E){this._nm[S.name]=E,this._f()},removeAllNewAlarms:function(i){i?delete this._nm[i]:this._nm={},this._f()},setAcknowledgedAlarmCount:function(h,B){this._am[h.name]=B,this._f()},removeAllAcknowledgedAlarms:function(Q){Q?delete this._am[Q.name]:this._am={},this._f()},isEmpty:function(){return!this._hoa},clear:function(){this._am={},this._nm={},this._f()},getPropagateSeverity:function(){return this._ps},setPropagateSeverity:function(h){if(this._ep||(h=null),this._ps!==h){var W=this._ps;this._ps=h,this._f(),this._d.fp("propagateSeverity",W,h)}},isEnablePropagation:function(){return this._ep},setEnablePropagation:function(O){var q=this._ep;this._ep=O,this._d.fp("enablePropagation",q,O)&&(O||this.setPropagateSeverity(null))}});var G=ht.AlarmStatePropagator=function(n){this._dataModel=n,this._enable=!1,this._isPropagating=!1};ht.Default.def("ht.AlarmStatePropagator",u,{getDataModel:function(){return this._dataModel},isEnable:function(){return this._enable},setEnable:function(G){this._enable!==G&&(this._enable=G,this._enable?(this._dataModel.mm(this.handleDataModelChange,this),this._dataModel.md(this.handleDataPropertyChange,this),this._dataModel.each(function(T){this.propagate(T)},this)):(this._dataModel.umm(this.handleDataModelChange,this),this._dataModel.umd(this.handleDataPropertyChange,this)))},handleDataModelChange:function(c){c.data&&this.propagate(c.data)},handleDataPropertyChange:function(Q){if("alarmState"===Q.property||"enablePropagation"===Q.property)this.propagate(Q.data);else if("parent"===Q.property){var d=Q.oldValue;d&&this.propagate(d),this.propagate(Q.data)}},propagate:function(n){n&&!this._isPropagating&&(this._isPropagating=!0,this.propagateToTop(n),this._isPropagating=!1)},propagateToTop:function(z){for(this.propagateToParent(null,z);z&&z.getParent();)this.propagateToParent(z,z.getParent()),z=z.getParent()},propagateToParent:function(E,n){var D=null;n.getChildren().each(function(w){var T=w.getAlarmState().getHighestOverallAlarmSeverity();m.compare(T,D)>0&&(D=T)}),n.getAlarmState().setPropagateSeverity(D)}}),ht.AlarmStateStatistics=function(x){this.sumNew=0,this.sumAcked=0,this.sumTotal=0,this.severtiyMap={},this.dataMap={},this.setDataModel(x)},ht.Default.def("ht.AlarmStateStatistics",u,{ms_fire:1,getDataModel:function(){return this._dataModel},setDataModel:function(n){var e=this._dataModel;e!==n&&(e&&(e.umd(this.handleDataPropertyChange,this),e.umm(this.handleDataModelChange,this),this.severtiyMap={},this.dataMap={}),this._dataModel=n,this.reset(),n.md(this.handleDataPropertyChange,this),n.mm(this.handleDataModelChange,this),this.fp("dataModel",e,n))},dispose:function(){this._dataModel.umd(this.handleDataPropertyChange,this),this._dataModel.umm(this.handleDataModelChange,this),delete this._dataModel},handleDataPropertyChange:function(I){"alarmState"===I.property&&(this.increase(I.data),this.fireAlarmStateChange())},handleDataModelChange:function(l){"add"===l.kind?(this.increase(l.data),this.fireAlarmStateChange()):"remove"===l.kind?(this.decrease(l.data),this.fireAlarmStateChange()):"clear"===l.kind&&(this.severtiyMap={},this.dataMap={},this.fireAlarmStateChange())},fireAlarmStateChange:function(){this.sumAcked=0,this.sumNew=0,this.sumTotal=0,m.each(function(z){var S=this.getSumInfo(z);this.sumAcked+=S.ackedCount,this.sumNew+=S.newCount,this.sumTotal+=S.totalCount},this),this.fp("alarmState",!1,!0)},getNewAlarmCount:function(F){if(!F)return this.sumNew;var D=this.getSumInfo(F);return D.newCount},getAcknowledgedAlarmCount:function(w){if(!w)return this.sumAcked;var c=this.getSumInfo(w);return c.ackedCount},getTotalAlarmCount:function(m){if(!m)return this.sumTotal;var W=this.getSumInfo(m);return W.totalCount},getSumInfo:function(c){var V=this.severtiyMap[c.name];return V||(V={},V.newCount=0,V.ackedCount=0,V.totalCount=0,this.severtiyMap[c.name]=V),V},decrease:function(v){var J=this.dataMap[v.getId()];J&&(delete this.dataMap[v.getId()],m.each(function(i){var e=J[i.name],L=this.getSumInfo(i);L.newCount=L.newCount-e.newCount,L.ackedCount=L.ackedCount-e.ackedCount,L.totalCount=L.totalCount-e.totalCount},this))},increase:function(O){if(this.decrease(O),!this._filterFunc||this._filterFunc(O)){var d={},k=O.getAlarmState();this.dataMap[O.getId()]=d,m.each(function(r){var G={};G.newCount=k.getNewAlarmCount(r),G.ackedCount=k.getAcknowledgedAlarmCount(r),G.totalCount=k.getAlarmCount(r),d[r.name]=G;var W=this.getSumInfo(r);W.newCount=W.newCount+G.newCount,W.ackedCount=W.ackedCount+G.ackedCount,W.totalCount=W.totalCount+G.totalCount},this)}},reset:function(){this.severtiyMap={},this.dataMap={},this._dataModel.each(this.increase,this),this.fireAlarmStateChange()},setFilterFunc:function(p){var J=this._filterFunc;this._filterFunc=p,this.reset(),this.fp("filterFunc",J,p)},getFilterFunc:function(){return this._filterFunc}});var X=ht.Data.prototype;X.getAlarmState=function(){return this._alarmState||(this._alarmState=new F(this))},X=ht.DataModel.prototype,X.isEnableAlarmStatePropagator=function(){return!!this._alarmStatePropagator&&this._alarmStatePropagator.isEnable()},X.setEnableAlarmStatePropagator=function(R){R!=this.isEnableAlarmStatePropagator()&&(R?(this._alarmStatePropagator=new G(this)).setEnable(!0):this._alarmStatePropagator.setEnable(!1))},X=ht.graph.GraphView.prototype,X.getNote2=function(b){var P=b.getAlarmState().getHighestNewAlarmSeverity();if(P){var v=b.getAlarmState().getNewAlarmCount(P)+P.nickName;return b.getAlarmState().hasLessSevereNewAlarms()&&(v+="+"),v}return b.s("note2")},X.getNote2Background=function(t){var M=t.getAlarmState().getHighestNewAlarmSeverity();return M?M.color:t.s("note2.background")},X.getBodyColor=function(t){var M=t.getAlarmState().getHighestNativeAlarmSeverity();return M?M.color:t.s("body.color")},X.getBorderColor=function($){var q=$.getAlarmState().getPropagateSeverity();return q?q.color:$.s("border.color")},X=ht.widget.TreeView.prototype,X.getBorderColor=function(C){var X=C.getAlarmState().getPropagateSeverity();return X?X.color:C.s("border.color")},X.getIcon=function(e){return e.getIcon()?"__alarmIcon__":null},X=ht.widget.TreeTableView.prototype,X.getBorderColor=function(D){var j=D.getAlarmState().getPropagateSeverity();return j?j.color:D.s("border.color")},X.getIcon=function(l){return l.getIcon()?"__alarmIcon__":null},ht.Default.setImage("__alarmIcon__",{width:16,height:16,comps:[{type:"image",name:{func:function(o){return o.getIcon()}},color:{func:function($){var J=$.getAlarmState().getHighestNativeAlarmSeverity();return J?J.color:$.s("body.color")}},rect:[0,0,16,16]}]});var L=ht.Style;L["note2.expanded"]=!0,L["note2.color"]="#000"}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);