!function(J,Q){"use strict";var B="ht",C=B+".layout.",h=J[B]||module.parent.exports.ht,P=h.List,E=h.DataModel,e=h.Node,q=h.Edge,i=h.Group,H=Math,K=H.sqrt,O=H.random,S=H.max,I=H.min,u=function(Y){return Y*Y};h.Default.getInternal().addMSMap({ms_force:function(n){n._interval=50,n._stepCount=10,n._motionLimit=.01,n._edgeRepulsion=.65,n._nodeRepulsion=.65,n._damper=1,n._maxMotion=0,n._motionRatio=0,n.init=function(j){var k=this;j instanceof E?k.dm=j:k.gv=j,k._nodeMap={},k._nodes=new P,k._edges=new P},n.start=function(){var H=this,g=H.gv;if(!H._timer){var Q=H.cdm=g?g.dm():H.dm;Q.mm(H.handleDataModelChange,H),Q.md(H.handleDataPropertyChange,H),g&&g.mp(H.handleGV,H),Q.each(function(p){if(H.isVisible(p)&&H.isLayoutable(p)&&p instanceof e)if(H instanceof r){var i=p.p3();p.p3([i[0]+O(),i[1]+O(),i[2]+O()])}else i=p.p(),p.p(i.x+O(),i.y+O())}),H._timer=setInterval(function(){H.relax()},H._interval),H._damper=1}},n.stop=function(){var b=this;b._timer&&(b.cdm.umm(b.handleDataModelChange,b),b.cdm.umd(b.handleDataPropertyChange,b),b.gv&&b.gv.ump(b.handleGV,b),clearInterval(b._timer),delete b._timer,delete b.cdm)},n.handleGV=function(a){var K=this;if("dataModel"===a.property){var D=a.oldValue,E=a.newValue;D&&(D.umm(K.handleDataModelChange,K),D.umd(K.handleDataPropertyChange,K)),this.cdm=E,E.mm(K.handleDataModelChange,K),E.md(K.handleDataPropertyChange,K)}},n.relax=function(){var $=this;if(!($._damper<.1&&$._maxMotion<$._motionLimit)){this.cdm.each(function(Q){$.isVisible(Q)&&(Q instanceof q?$.addEdge(Q):Q instanceof e&&$.addNode(Q))});for(var N,f,A=0,S=$._edges,t=$._nodes,G=t.size();A<$._stepCount;A++){for(S.each($.relaxEdge,$),N=0;G>N;N++)for(f=0;G>f;f++)$.relaxNode(t.get(N),t.get(f));$.moveNode()}$._isAdjusting=1,t.each(function(U){U.fix||(U.p?U.v.p3(U.p):U.v.p(U.x,U.y))}),delete $._isAdjusting,$._nodeMap={},t.clear(),S.clear(),$.onRelaxed()}},n.onRelaxed=function(){},n.isRunning=function(){return!!this._timer},n.isVisible=function(p){return p.s("layoutable")===!1?!1:this.gv?this.gv.isVisible(p):!0},n.isLayoutable=function(g){if(g.s("layoutable")===!1)return!1;if(g instanceof i)return!1;var n=this;return n.gv?n.gv.isMovable(g)&&!n.gv.isSelected(g):!(n.cdm||n.dm).sm().co(g)},n.getNodeRepulsion=function(){return this._nodeRepulsion},n.setNodeRepulsion=function(L){this._nodeRepulsion=L,this._damper=1},n.getEdgeRepulsion=function(){return this._edgeRepulsion},n.setEdgeRepulsion=function(B){this._edgeRepulsion=B,this._damper=1},n.getStepCount=function(){return this._stepCount},n.setStepCount=function(g){this._stepCount=g,this._damper=1},n.getInterval=function(){return this._interval},n.setInterval=function(z){var w=this;w._interval!==z&&(w._interval=z,w._timer&&(clearInterval(w._timer),w._timer=setInterval(function(){w.relax()},z)))},n.handleDataPropertyChange=function(O){!this._isAdjusting&&this.isVisible(O.data)&&(this._damper=1)},n.handleDataModelChange=function(){this._damper=1},n.damp=function(){var c=this._maxMotion,y=this._damper;this._motionRatio<=.001&&((.2>c||c>1&&.9>y)&&y>.01?this._damper-=.01:.4>c&&y>.003?this._damper-=.003:y>1e-4&&(this._damper-=1e-4)),c<this._motionLimit&&(this._damper=0)}}}),h.layout.ForceLayout=function(v){this.init(v)},h.Default.def(C+"ForceLayout",Q,{ms_force:1,getLimitBounds:function(){return this._limitBounds},setLimitBounds:function(P){this._limitBounds=P,this._damper=1},getNodeSize:function(F){var t=this.gv;return t&&t.getDataUIBounds?t.getDataUIBounds(F):F.getRect()},addNode:function(N){var t=this,D=t._nodeMap[N._id];if(D)return D;var k=N.p();D={v:N,x:k.x,y:k.y,dx:0,dy:0,fix:!t.isLayoutable(N),s:t.getNodeSize(N)};var c=D.s,Q=K(u(c.width)+u(c.height))*t._nodeRepulsion;return D.r=1>Q?100:Q,t._nodeMap[N._id]=D,t._nodes.add(D),D},addEdge:function(q){if(q._40I&&q._41I){var c=this,R=c.addNode(q._40I),w=c.addNode(q._41I),O={s:R,t:w};w=w.s,R=R.s;var g=w.width+R.width,D=w.height+R.height;O.length=K(g*g+D*D)*c._edgeRepulsion,O.length<=0&&(O.length=100),c._edges.add(O)}},relaxEdge:function(N){var V=N.t,X=N.s,E=V.x-X.x,j=V.y-X.y,Z=K(E*E+j*j),Y=100*N.length,M=.25*E/Y*Z,e=.25*j/Y*Z;V.dx=V.dx-M,V.dy=V.dy-e,X.dx=X.dx+M,X.dy=X.dy+e},relaxNode:function(w,t){if(w!==t){var H=0,x=0,f=w.x-t.x,E=w.y-t.y,F=f*f+E*E;0===F?(H=O(),x=O()):36e4>F&&(H=f/F,x=E/F);var W=w.r*t.r/400;H*=W,x*=W,w.dx+=H,w.dy+=x,t.dx-=H,t.dy-=x}},moveNode:function(){var y=this,d=y._limitBounds,w=y._maxMotion,E=0,P=y._damper;y._nodes.each(function(J){if(!J.fix){var Q=J.dx*P,T=J.dy*P;if(J.dx=Q/2,J.dy=T/2,E=S(K(Q*Q+T*T),E),J.x+=S(-40,I(40,Q)),J.y+=S(-40,I(40,T)),d){J.x<d.x&&(J.x=d.x,y.adjust(1,0)),J.y<d.y&&(J.y=d.y,y.adjust(0,1));var q=J.s;J.x+q.width>d.x+d.width&&(J.x=d.x+d.width-q.width,y.adjust(-1,0)),J.y+q.height>d.y+d.height&&(J.y=d.y+d.height-q.height,y.adjust(0,-1))}}}),y._maxMotion=E,y._motionRatio=E>0?w/E-1:0,y.damp()},adjust:function(z,H){var Z=this._limitBounds;this._nodes.each(function(b){z>0?(!Z||b.x+b.s.width+z<Z.x+Z.width)&&(b.x+=z):(!Z||b.x+z>Z.x)&&(b.x+=z),H>0?(!Z||b.y+b.s.height+H<Z.y+Z.height)&&(b.y+=H):(!Z||b.y+H>Z.y)&&(b.y+=H)})}});var r=h.layout.Force3dLayout=function(Z){this.init(Z)};h.Default.def(C+"Force3dLayout",Q,{ms_force:1,getNodeSize3d:function(H){return H.s3()},addNode:function(O){var n=this,x=n._nodeMap[O._id];if(x)return x;x={v:O,p:O.p3(),d:[0,0,0],fix:!n.isLayoutable(O),s:n.getNodeSize3d(O)};var E=x.s,z=h.Default.getDistance(E)*n._nodeRepulsion;return x.r=1>z?100:z,n._nodeMap[O._id]=x,n._nodes.add(x),x},addEdge:function(W){if(W._40I&&W._41I){var N=this,V=N.addNode(W._40I),O=N.addNode(W._41I),n={s:V,t:O};O=O.s,V=V.s,n.length=K(u(O[0]+V[0])+u(O[1]+V[1])+u(O[2]+V[2]))*N._edgeRepulsion,n.length<=0&&(n.length=100),N._edges.add(n)}},relaxEdge:function(G){var u=G.t.p,q=G.s.p,y=G.t.d,o=G.s.d,S=u[0]-q[0],j=u[1]-q[1],t=u[2]-q[2],O=K(S*S+j*j+t*t),J=100*G.length,I=.25*S/J*O,Z=.25*j/J*O,H=.25*t/J*O;y[0]-=I,y[1]-=Z,y[2]-=H,o[0]+=I,o[1]+=Z,o[2]+=H},relaxNode:function(r,l){if(r!==l){var i=r.p,k=l.p,t=0,P=0,h=0,e=i[0]-k[0],p=i[1]-k[1],f=i[2]-k[2],q=e*e+p*p+f*f;0===q?(t=O(),P=O(),h=O()):216e6>q&&(t=e/q,P=p/q,h=f/q);var a=r.r*l.r/400,I=r.d,U=l.d;t*=a,P*=a,h*=a,I[0]+=t,I[1]+=P,I[2]+=h,U[0]-=t,U[1]-=P,U[2]-=h}},moveNode:function(){var r=this,m=r._maxMotion,X=0,v=r._damper;r._nodes.each(function(N){if(!N.fix){var t=N.p,A=N.d,e=A[0]*v,p=A[1]*v,Q=A[2]*v;A[0]=e/2,A[1]=p/2,A[2]=Q/2,X=S(K(e*e+p*p+Q*Q),X),t[0]+=S(-40,I(40,e)),t[1]+=S(-40,I(40,p)),t[2]+=S(-40,I(40,Q))}}),r._maxMotion=X,r._motionRatio=X>0?m/X-1:0,r.damp()}})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);