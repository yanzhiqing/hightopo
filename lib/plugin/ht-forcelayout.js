!function(o,Y){"use strict";var C="ht",D=C+".layout.",n=o[C]||module.parent.exports.ht,N=n.List,h=n.DataModel,L=n.Node,c=n.Edge,e=n.Group,i=Math,E=i.sqrt,u=i.random,z=i.max,V=i.min,l=function(T){return T*T};n.Default.getInternal().addMSMap({ms_force:function(C){C._interval=50,C._stepCount=10,C._motionLimit=.01,C._edgeRepulsion=.65,C._nodeRepulsion=.65,C._damper=1,C._maxMotion=0,C._motionRatio=0,C.init=function(T){var d=this;T instanceof h?d.dm=T:d.gv=T,d._nodeMap={},d._nodes=new N,d._edges=new N},C.start=function(){var K=this,a=K.gv;if(!K._timer){var Y=K.cdm=a?a.dm():K.dm;Y.mm(K.handleDataModelChange,K),Y.md(K.handleDataPropertyChange,K),a&&a.mp(K.handleGV,K),Y.each(function(d){if(K.isVisible(d)&&K.isLayoutable(d)&&d instanceof L)if(K instanceof p){var R=d.p3();d.p3([R[0]+u(),R[1]+u(),R[2]+u()])}else R=d.p(),d.p(R.x+u(),R.y+u())}),K._timer=setInterval(function(){K.relax()},K._interval),K._damper=1}},C.stop=function(){var y=this;y._timer&&(y.cdm.umm(y.handleDataModelChange,y),y.cdm.umd(y.handleDataPropertyChange,y),y.gv&&y.gv.ump(y.handleGV,y),clearInterval(y._timer),delete y._timer,delete y.cdm)},C.handleGV=function(T){var $=this;if("dataModel"===T.property){var L=T.oldValue,x=T.newValue;L&&(L.umm($.handleDataModelChange,$),L.umd($.handleDataPropertyChange,$)),this.cdm=x,x.mm($.handleDataModelChange,$),x.md($.handleDataPropertyChange,$)}},C.relax=function(){var t=this;if(!(t._damper<.1&&t._maxMotion<t._motionLimit)){this.cdm.each(function(A){t.isVisible(A)&&(A instanceof c?t.addEdge(A):A instanceof L&&t.addNode(A))});for(var B,d,r=0,e=t._edges,w=t._nodes,S=w.size();r<t._stepCount;r++){for(e.each(t.relaxEdge,t),B=0;S>B;B++)for(d=0;S>d;d++)t.relaxNode(w.get(B),w.get(d));t.moveNode()}t._isAdjusting=1,w.each(function(I){I.fix||(I.p?I.v.p3(I.p):I.v.p(I.x,I.y))}),delete t._isAdjusting,t._nodeMap={},w.clear(),e.clear(),t.onRelaxed()}},C.onRelaxed=function(){},C.isRunning=function(){return!!this._timer},C.isVisible=function(F){return F.s("layoutable")===!1?!1:this.gv?this.gv.isVisible(F):!0},C.isLayoutable=function(F){if(F.s("layoutable")===!1)return!1;if(F instanceof e)return!1;var j=this;return j.gv?j.gv.isMovable(F)&&!j.gv.isSelected(F):!(j.cdm||j.dm).sm().co(F)},C.getNodeRepulsion=function(){return this._nodeRepulsion},C.setNodeRepulsion=function(v){this._nodeRepulsion=v,this._damper=1},C.getEdgeRepulsion=function(){return this._edgeRepulsion},C.setEdgeRepulsion=function(m){this._edgeRepulsion=m,this._damper=1},C.getStepCount=function(){return this._stepCount},C.setStepCount=function(y){this._stepCount=y,this._damper=1},C.getInterval=function(){return this._interval},C.setInterval=function(Y){var o=this;o._interval!==Y&&(o._interval=Y,o._timer&&(clearInterval(o._timer),o._timer=setInterval(function(){o.relax()},Y)))},C.handleDataPropertyChange=function(x){!this._isAdjusting&&this.isVisible(x.data)&&(this._damper=1)},C.handleDataModelChange=function(){this._damper=1},C.damp=function(){var c=this._maxMotion,l=this._damper;this._motionRatio<=.001&&((.2>c||c>1&&.9>l)&&l>.01?this._damper-=.01:.4>c&&l>.003?this._damper-=.003:l>1e-4&&(this._damper-=1e-4)),c<this._motionLimit&&(this._damper=0)}}}),n.layout.ForceLayout=function(j){this.init(j)},n.Default.def(D+"ForceLayout",Y,{ms_force:1,getLimitBounds:function(){return this._limitBounds},setLimitBounds:function($){this._limitBounds=$,this._damper=1},getNodeSize:function(t){var y=this.gv;return y&&y.getDataUIBounds?y.getDataUIBounds(t):t.getRect()},addNode:function(v){var t=this,q=t._nodeMap[v._id];if(q)return q;var h=v.p();q={v:v,x:h.x,y:h.y,dx:0,dy:0,fix:!t.isLayoutable(v),s:t.getNodeSize(v)};var M=q.s,n=E(l(M.width)+l(M.height))*t._nodeRepulsion;return q.r=1>n?100:n,t._nodeMap[v._id]=q,t._nodes.add(q),q},addEdge:function(z){if(z._40I&&z._41I){var Y=this,T=Y.addNode(z._40I),o=Y.addNode(z._41I),V={s:T,t:o};o=o.s,T=T.s;var p=o.width+T.width,X=o.height+T.height;V.length=E(p*p+X*X)*Y._edgeRepulsion,V.length<=0&&(V.length=100),Y._edges.add(V)}},relaxEdge:function(M){var W=M.t,h=M.s,q=W.x-h.x,C=W.y-h.y,n=E(q*q+C*C),o=100*M.length,Y=.25*q/o*n,_=.25*C/o*n;W.dx=W.dx-Y,W.dy=W.dy-_,h.dx=h.dx+Y,h.dy=h.dy+_},relaxNode:function(q,C){if(q!==C){var h=0,k=0,L=q.x-C.x,d=q.y-C.y,w=L*L+d*d;0===w?(h=u(),k=u()):36e4>w&&(h=L/w,k=d/w);var i=q.r*C.r/400;h*=i,k*=i,q.dx+=h,q.dy+=k,C.dx-=h,C.dy-=k}},moveNode:function(){var u=this,D=u._limitBounds,g=u._maxMotion,o=0,q=u._damper;u._nodes.each(function(f){if(!f.fix){var A=f.dx*q,U=f.dy*q;if(f.dx=A/2,f.dy=U/2,o=z(E(A*A+U*U),o),f.x+=z(-40,V(40,A)),f.y+=z(-40,V(40,U)),D){f.x<D.x&&(f.x=D.x,u.adjust(1,0)),f.y<D.y&&(f.y=D.y,u.adjust(0,1));var Z=f.s;f.x+Z.width>D.x+D.width&&(f.x=D.x+D.width-Z.width,u.adjust(-1,0)),f.y+Z.height>D.y+D.height&&(f.y=D.y+D.height-Z.height,u.adjust(0,-1))}}}),u._maxMotion=o,u._motionRatio=o>0?g/o-1:0,u.damp()},adjust:function(Y,x){var c=this._limitBounds;this._nodes.each(function(W){Y>0?(!c||W.x+W.s.width+Y<c.x+c.width)&&(W.x+=Y):(!c||W.x+Y>c.x)&&(W.x+=Y),x>0?(!c||W.y+W.s.height+x<c.y+c.height)&&(W.y+=x):(!c||W.y+x>c.y)&&(W.y+=x)})}});var p=n.layout.Force3dLayout=function(G){this.init(G)};n.Default.def(D+"Force3dLayout",Y,{ms_force:1,getNodeSize3d:function(A){return A.s3()},addNode:function(i){var F=this,X=F._nodeMap[i._id];if(X)return X;X={v:i,p:i.p3(),d:[0,0,0],fix:!F.isLayoutable(i),s:F.getNodeSize3d(i)};var A=X.s,S=n.Default.getDistance(A)*F._nodeRepulsion;return X.r=1>S?100:S,F._nodeMap[i._id]=X,F._nodes.add(X),X},addEdge:function(r){if(r._40I&&r._41I){var u=this,R=u.addNode(r._40I),q=u.addNode(r._41I),o={s:R,t:q};q=q.s,R=R.s,o.length=E(l(q[0]+R[0])+l(q[1]+R[1])+l(q[2]+R[2]))*u._edgeRepulsion,o.length<=0&&(o.length=100),u._edges.add(o)}},relaxEdge:function(N){var m=N.t.p,a=N.s.p,B=N.t.d,T=N.s.d,Y=m[0]-a[0],t=m[1]-a[1],C=m[2]-a[2],J=E(Y*Y+t*t+C*C),Q=100*N.length,c=.25*Y/Q*J,$=.25*t/Q*J,A=.25*C/Q*J;B[0]-=c,B[1]-=$,B[2]-=A,T[0]+=c,T[1]+=$,T[2]+=A},relaxNode:function(g,W){if(g!==W){var N=g.p,G=W.p,e=0,L=0,w=0,T=N[0]-G[0],D=N[1]-G[1],H=N[2]-G[2],a=T*T+D*D+H*H;0===a?(e=u(),L=u(),w=u()):216e6>a&&(e=T/a,L=D/a,w=H/a);var k=g.r*W.r/400,z=g.d,V=W.d;e*=k,L*=k,w*=k,z[0]+=e,z[1]+=L,z[2]+=w,V[0]-=e,V[1]-=L,V[2]-=w}},moveNode:function(){var I=this,a=I._maxMotion,d=0,U=I._damper;I._nodes.each(function(T){if(!T.fix){var c=T.p,r=T.d,X=r[0]*U,j=r[1]*U,Z=r[2]*U;r[0]=X/2,r[1]=j/2,r[2]=Z/2,d=z(E(X*X+j*j+Z*Z),d),c[0]+=z(-40,V(40,X)),c[1]+=z(-40,V(40,j)),c[2]+=z(-40,V(40,Z))}}),I._maxMotion=d,I._motionRatio=d>0?a/d-1:0,I.damp()}})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);