!function(x,F,p){"use strict";function N(A,$){this.position=A,this.$22n=$}var l="ht",r=x[l],J=null,D=Math,q=D.PI,B=D.cos,A=D.sin,b=D.abs,M=D.max,U=D.sqrt,j=1e-5,V=r.Default,w=V.def,E=V.startAnim,K=V.createMatrix,t=V.transformVec,Z=V.getInternal(),u=Z.addMethod,R=Z.superCall,n=Z.toPointsArray,$=Z.createNormals,G=Z.toFloatArray,k=Z.glMV,T=(Z.glPop,r.graph3d.Graph3dView,r.Math),W=T.Vector3,P=T.Matrix4,z=T.Euler,h=(T.Quaternion,Z.batchShape),Y=Z.createNodeMatrix,i=Z.getFaceInfo,c=Z.transformAppend,o=Z.drawFaceInfo,m=Z.createAnim,_=Z.cube(),S=_.is,d=_.vs,C=_.uv,s=Z.ui(),I=r.Node,e=r.Shape,H="h",X="v",v="front",Q="back",L="left",g="right",O="top",f="bottom",y="dw.expanded",a=".expanded",Oq="dw.angle",wh=".angle",pf=function(Q,s,h){w(l+"."+Q,s,h)},Pi=function(C,w,$){$?C.push(w.x,w.y):C.push(w.x,w.y,w.z)},tg=function(){var x=new r.Math.Vector3,M=new r.Math.Vector3,k=new r.Math.Vector3;return function(p,w,U,X,i){if(x.copy(w.$24n),M.copy(U.$24n),k.copy(X.$24n),!(k.equals(x)||M.equals(x)||M.equals(k))){if(!w.$22n||!U.$22n||!X.$22n){var n=M.sub(x).cross(k.sub(x)).normalize().multiplyScalar(1).toArray();w.$22n||(w.$22n=new Vh(n)),U.$22n||(U.$22n=new Vh(n)),X.$22n||(X.$22n=new Vh(n))}p.push(new ps([w,U,X],i))}}}(),yd=function(j,r,g,A){var k,t,X,l,I=0,v=[];if(A)for(k=A.length;k>I;I+=3)t=A[I],X=A[I+1],l=A[I+2],tg(v,new _n([r[3*t],r[3*t+1],r[3*t+2]],null,g?[g[2*t],g[2*t+1],0]:J),new _n([r[3*X],r[3*X+1],r[3*X+2]],null,g?[g[2*X],g[2*X+1],0]:J),new _n([r[3*l],r[3*l+1],r[3*l+2]],null,g?[g[2*l],g[2*l+1],0]:J),j);else for(k=r.length/3;k>I;I+=3)t=I,X=I+1,l=I+2,tg(v,new _n([r[3*t],r[3*t+1],r[3*t+2]],null,g?[g[2*t],g[2*t+1],0]:J),new _n([r[3*X],r[3*X+1],r[3*X+2]],null,g?[g[2*X],g[2*X+1],0]:J),new _n([r[3*l],r[3*l+1],r[3*l+2]],null,g?[g[2*l],g[2*l+1],0]:J),j);return v},pi=[L,v,g,Q,O,f],Ip=["",O,f],me=pi.concat("csg"),Zh=[0,6,12,18,24,30],pb=function(H,L,e){var x=Y(H),p=[];H.appendAnchorMatrix3d(x);var c,i=L?L.getData3dUI(H):null;if(i&&i.s("shape3d")&&!i.s("csg.cull.box")&&(c=i.shapeModel,i.shapeModel||(c=Z.getShapeModel(i,i.s("shape3d"))),c))for(var T=Z.createNormalMatrix(x),P=0,V=Ip.length;V>P;P++){var z=Ip[P],O=z.length?z+"_":z,I=c[O+"vs"],y=c[O+"uv"],F=c[O+"is"],B=c[O+"ns"];if(I&&I.length)for(var $,A,Q,q=0,w=F?F.length:I.length/3;w>q;q+=3)F?($=F[q],A=F[q+1],Q=F[q+2]):($=q,A=q+1,Q=q+2),tg(p,new _n(t([I[3*$],I[3*$+1],I[3*$+2]],x),B?t([B[3*$],B[3*$+1],B[3*$+2]],T):null,[y[2*$],y[2*$+1],0]),new _n(t([I[3*A],I[3*A+1],I[3*A+2]],x),B?t([B[3*A],B[3*A+1],B[3*A+2]],T):null,[y[2*A],y[2*A+1],0]),new _n(t([I[3*Q],I[3*Q+1],I[3*Q+2]],x),B?t([B[3*Q],B[3*Q+1],B[3*Q+2]],T):null,[y[2*Q],y[2*Q+1],0]),H)}if(!c)for(var P=0;6>P;P++)for(var z=pi[P],r=Zh[P],y=e?L.getFaceUv(H,z):J,N=e?L.getFaceUvScale(H,z):J,M=e?L.getFaceUvOffset(H,z):J,R=0;2>R;R++){var U,s,E,n=S[r+3*R],a=S[r+3*R+1],l=S[r+3*R+2];if(e){if(y){var b=8*P;U=[y[2*n-b],y[2*n+1-b],0],s=[y[2*a-b],y[2*a+1-b],0],E=[y[2*l-b],y[2*l+1-b],0]}else U=[C[2*n],C[2*n+1],0],s=[C[2*a],C[2*a+1],0],E=[C[2*l],C[2*l+1],0];N&&(U[0]*=N[0],U[1]*=N[1],s[0]*=N[0],s[1]*=N[1],E[0]*=N[0],E[1]*=N[1]),M&&(U[0]+=M[0],U[1]+=M[1],s[0]+=M[0],s[1]+=M[1],E[0]+=M[0],E[1]+=M[1])}tg(p,new _n(t([d[3*n],d[3*n+1],d[3*n+2]],x),null,U),new _n(t([d[3*a],d[3*a+1],d[3*a+2]],x),null,s),new _n(t([d[3*l],d[3*l+1],d[3*l+2]],x),null,E),H)}return pj.$15n(p)},Re=function(T,M,E){var K,_=T.data.getAttaches();if(_&&_.each(function(V){V instanceof Ap&&V.s("attach.operation")&&(K||(K=[]),K.push(V))}),K){var r;pi.forEach(function(e){var u=yd(e,T[e].vs,T[e].tuv);r=r?r.concat(u):u}),r=pj.$15n(r),K.forEach(function(Q){var s=Q.s("attach.operation");r[s]&&(r=r[s](pb(Q,T.gv,T.csg.tuv)))}),pi.forEach(function(s){s=T[s],s.vs=[],s.ns=[],s.tuv&&(s.tuv=[])}),T.csg&&!T.csg.ns&&(T.csg.ns=[]);var y=[];if(r.$19n().forEach(function(i){var N,W=i.$10n;if(W instanceof Ap){if(W.s("attach.cull"))return;N=W.s("csg.cull.color"),N&&(N=Z.toColorArray(N)),W="csg"}for(var s=T[W],V=s.vs,u=s.ns,K=s.tuv,t=i.$9n,C=2;C<t.length;C++)if(Pi(V,t[0].$24n),Pi(V,t[C-1].$24n),Pi(V,t[C].$24n),u&&(Pi(u,t[0].$22n),Pi(u,t[C-1].$22n),Pi(u,t[C].$22n)),K&&(Pi(K,t[0].uv,!0),Pi(K,t[C-1].uv,!0),Pi(K,t[C].uv,!0)),N)for(var E=4*(V.length/3),J=0;3>J;J++)y[--E]=N[3],y[--E]=N[2],y[--E]=N[1],y[--E]=N[0]}),y.length){for(var k=Z.toColorArray(T.csg.color),f=0,m=4*(T.csg.vs.length/3);m>f;f+=4)y[f]==p&&(y[f]=k[0],y[f+1]=k[1],y[f+2]=k[2],y[f+3]=k[3]);T.csg.cs=y}}me.forEach(function(o){var Z=T[o];Z.visible&&Z.vs.length?(Z.ns&&Z.ns.length?G(Z,"ns"):Z.ns=$(Z.vs),G(Z,"vs"),G(Z,"tuv"),Z.cs&&G(Z,"cs")):delete T[o]}),M&&(h(T,J,M,J,E),T.clear())};u(V,{createFrameModel:function(P,Y,T,n){P=P==J?.07:P,Y=Y==J?P:Y,T=T==J?P:T,n=n?n:{};var j=n.top,V=n.bottom,E=n.left,M=n.right,X=n.front,b=n.back,Z=[],N=[];return X===!0?(Z.push(-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,-.5,.5,.5,.5,.5,-.5,.5,.5),N.push(0,0,0,1,1,1,1,1,1,0,0,0)):X===!1||(Z.push(-.5,.5,.5,-.5,-.5,.5,-.5+P,-.5,.5,-.5+P,-.5,.5,-.5+P,.5,.5,-.5,.5,.5,.5-P,.5,.5,.5-P,-.5,.5,.5,-.5,.5,.5,-.5,.5,.5,.5,.5,.5-P,.5,.5,-.5+P,.5,.5,-.5+P,.5-Y,.5,.5-P,.5-Y,.5,.5-P,.5-Y,.5,.5-P,.5,.5,-.5+P,.5,.5,-.5+P,-.5+Y,.5,-.5+P,-.5,.5,.5-P,-.5,.5,.5-P,-.5,.5,.5-P,-.5+Y,.5,-.5+P,-.5+Y,.5),N.push(0,0,0,1,P,1,P,1,P,0,0,0,1-P,0,1-P,1,1,1,1,1,1,0,1-P,0,P,0,P,Y,1-P,Y,1-P,Y,1-P,0,P,0,P,1-Y,P,1,1-P,1,1-P,1,1-P,1-Y,P,1-Y)),b===!0?(Z.push(-.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5),N.push(1,0,0,1,1,1,0,1,1,0,0,0)):b===!1||(Z.push(-.5,.5,-.5,-.5+P,-.5,-.5,-.5,-.5,-.5,-.5+P,-.5,-.5,-.5,.5,-.5,-.5+P,.5,-.5,.5-P,.5,-.5,.5,-.5,-.5,.5-P,-.5,-.5,.5,-.5,-.5,.5-P,.5,-.5,.5,.5,-.5,-.5+P,.5,-.5,.5-P,.5-Y,-.5,-.5+P,.5-Y,-.5,.5-P,.5-Y,-.5,-.5+P,.5,-.5,.5-P,.5,-.5,-.5+P,-.5+Y,-.5,.5-P,-.5,-.5,-.5+P,-.5,-.5,.5-P,-.5,-.5,-.5+P,-.5+Y,-.5,.5-P,-.5+Y,-.5),N.push(1,0,1-P,1,1,1,1-P,1,1,0,1-P,0,P,0,0,1,P,1,0,1,P,0,0,0,1-P,0,P,Y,1-P,Y,P,Y,1-P,0,P,0,1-P,1-Y,P,1,1-P,1,P,1,1-P,1-Y,P,1-Y)),E===!0?(Z.push(-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,.5,.5,-.5,.5,-.5),N.push(0,0,0,1,1,1,1,1,1,0,0,0)):E===!1||(Z.push(-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5+T,-.5,-.5,-.5+T,-.5,.5,-.5+T,-.5,.5,-.5,-.5,.5,.5-T,-.5,-.5,.5-T,-.5,-.5,.5,-.5,-.5,.5,-.5,.5,.5,-.5,.5,.5-T,-.5,.5,-.5+T,-.5,.5-Y,-.5+T,-.5,.5-Y,.5-T,-.5,.5-Y,.5-T,-.5,.5,.5-T,-.5,.5,-.5+T,-.5,-.5+Y,-.5+T,-.5,-.5,-.5+T,-.5,-.5,.5-T,-.5,-.5,.5-T,-.5,-.5+Y,.5-T,-.5,-.5+Y,-.5+T),N.push(0,0,0,1,T,1,T,1,T,0,0,0,1-T,0,1-T,1,1,1,1,1,1,0,1-T,0,T,0,T,Y,1-T,Y,1-T,Y,1-T,0,T,0,T,1-Y,T,1,1-T,1,1-T,1,1-T,1-Y,T,1-Y)),M===!0?(Z.push(.5,.5,-.5,.5,-.5,.5,.5,-.5,-.5,.5,-.5,.5,.5,.5,-.5,.5,.5,.5),N.push(1,0,0,1,1,1,0,1,1,0,0,0)):M===!1||(Z.push(.5,.5,-.5,.5,-.5,-.5+T,.5,-.5,-.5,.5,-.5,-.5+T,.5,.5,-.5,.5,.5,-.5+T,.5,.5,.5-T,.5,-.5,.5,.5,-.5,.5-T,.5,-.5,.5,.5,.5,.5-T,.5,.5,.5,.5,.5,-.5+T,.5,.5-Y,.5-T,.5,.5-Y,-.5+T,.5,.5-Y,.5-T,.5,.5,-.5+T,.5,.5,.5-T,.5,-.5+Y,-.5+T,.5,-.5,.5-T,.5,-.5,-.5+T,.5,-.5,.5-T,.5,-.5+Y,-.5+T,.5,-.5+Y,.5-T),N.push(1,0,1-T,1,1,1,1-T,1,1,0,1-T,0,T,0,0,1,T,1,0,1,T,0,0,0,1-T,0,T,Y,1-T,Y,T,Y,1-T,0,T,0,1-T,1-Y,T,1,1-T,1,T,1,1-T,1-Y,T,1-Y)),j===!0?(Z.push(.5,.5,.5,.5,.5,-.5,-.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,.5,.5,.5),N.push(1,1,1,0,0,0,0,0,0,1,1,1)):j===!1||(Z.push(.5,.5,.5,.5,.5,-.5,.5-P,.5,-.5,.5-P,.5,-.5,.5-P,.5,.5,.5,.5,.5,-.5+P,.5,.5,-.5+P,.5,-.5,-.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5+P,.5,.5,.5-P,.5,.5,.5-P,.5,.5-T,-.5+P,.5,.5-T,-.5+P,.5,.5-T,-.5+P,.5,.5,.5-P,.5,.5,.5-P,.5,-.5+T,.5-P,.5,-.5,-.5+P,.5,-.5,-.5+P,.5,-.5,-.5+P,.5,-.5+T,.5-P,.5,-.5+T),N.push(1,1,1,0,1-P,0,1-P,0,1-P,1,1,1,P,1,P,0,0,0,0,0,0,1,P,1,1-P,1,1-P,1-T,P,1-T,P,1-T,P,1,1-P,1,1-P,T,1-P,0,P,0,P,0,P,T,1-P,T)),V===!0?(Z.push(.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,.5),N.push(1,0,0,1,1,1,0,1,1,0,0,0)):V===!1||(Z.push(.5,-.5,.5,.5-P,-.5,-.5,.5,-.5,-.5,.5-P,-.5,-.5,.5,-.5,.5,.5-P,-.5,.5,-.5+P,-.5,.5,-.5,-.5,-.5,-.5+P,-.5,-.5,-.5,-.5,-.5,-.5+P,-.5,.5,-.5,-.5,.5,.5-P,-.5,.5,-.5+P,-.5,.5-T,.5-P,-.5,.5-T,-.5+P,-.5,.5-T,.5-P,-.5,.5,-.5+P,-.5,.5,.5-P,-.5,-.5+T,-.5+P,-.5,-.5,.5-P,-.5,-.5,-.5+P,-.5,-.5,.5-P,-.5,-.5+T,-.5+P,-.5,-.5+T),N.push(1,0,1-P,1,1,1,1-P,1,1,0,1-P,0,P,0,0,1,P,1,0,1,P,0,0,0,1-P,0,P,T,1-P,T,P,T,1-P,0,P,0,1-P,1-T,P,1,1-P,1,P,1,1-P,1-T,P,1-T)),{vs:Z,uv:N}}}),u(r.Style,{"csg.cull.color":p,"csg.cull.box":!0,"dw.flip":!1,"dw.s3":[.999,.999,.5],"dw.t3":p,"dw.expanded":!1,"dw.toggleable":!0,"dw.axis":"left","dw.start":0,"dw.end":q/2,"dw.angle":0,"attach.cull":!1,"attach.operation":"subtract"},!0),pi.forEach(function(J){var b={};b[J+a]=!1,b[J+".toggleable"]=!1,b[J+".axis"]=L,b[J+".start"]=0,b[J+".end"]=q/2,b[J+wh]=0,u(r.Style,b,!0)});var pj=function(){this.$4n=[]};pj.$15n=function(u){var x=new pj;return x.$4n=u,x},pj.prototype={clone:function(){var Z=new pj;return Z.$4n=this.$4n.map(function(s){return s.clone()}),Z},$19n:function(){return this.$4n},union:function(W){var B=new tb(this.clone().$4n),z=new tb(W.clone().$4n);return B.$3n(z),z.$3n(B),z.$6n(),z.$3n(B),z.$6n(),B.$7n(z.$2n()),pj.$15n(B.$2n())},subtract:function(G){var H=new tb(this.clone().$4n),B=new tb(G.clone().$4n);return H.$6n(),H.$3n(B),B.$3n(H),B.$6n(),B.$3n(H),B.$6n(),H.$7n(B.$2n()),H.$6n(),pj.$15n(H.$2n())},intersect:function(k){var h=new tb(this.clone().$4n),S=new tb(k.clone().$4n);return h.$6n(),S.$3n(h),S.$6n(),h.$3n(S),S.$3n(h),h.$7n(S.$2n()),h.$6n(),pj.$15n(h.$2n())},inverse:function(){var B=this.clone();return B.$4n.map(function(S){S.flip()}),B}},pj.cube=function(A){A=A||{};var l=new Vh(A.center||[0,0,0]),C=A.radius?A.radius.length?A.radius:[A.radius,A.radius,A.radius]:[1,1,1];return pj.$15n([[[0,4,6,2],[-1,0,0]],[[1,3,7,5],[1,0,0]],[[0,1,5,4],[0,-1,0]],[[2,6,7,3],[0,1,0]],[[0,2,3,1],[0,0,-1]],[[4,5,7,6],[0,0,1]]].map(function(d){return new ps(d[0].map(function(o){var N=new Vh(l.x+C[0]*(2*!!(1&o)-1),l.y+C[1]*(2*!!(2&o)-1),l.z+C[2]*(2*!!(4&o)-1));return new _n(N,new Vh(d[1]))}))}))},pj.sphere=function(Q){function m(u,r){u*=2*q,r*=q;var E=new Vh(B(u)*A(r),B(r),A(u)*A(r));W.push(new _n(L.$20n(E.$21n(K)),E))}Q=Q||{};for(var W,L=new Vh(Q.center||[0,0,0]),K=Q.radius||1,G=Q.slices||16,S=Q.stacks||8,M=[],D=0;G>D;D++)for(var o=0;S>o;o++)W=[],m(D/G,o/S),o>0&&m((D+1)/G,o/S),S-1>o&&m((D+1)/G,(o+1)/S),m(D/G,(o+1)/S),M.push(new ps(W));return pj.$15n(M)},pj.cylinder=function(e){function I(O,m,S){var x=2*m*q,P=z.$21n(B(x)).$20n(H.$21n(A(x))),c=X.$20n(o.$21n(O)).$20n(P.$21n(J)),k=P.$21n(1-b(S)).$20n(U.$21n(S));return new _n(c,k)}e=e||{};for(var X=new Vh(e.start||[0,-1,0]),P=new Vh(e.end||[0,1,0]),o=P.$13n(X),J=e.radius||1,T=e.slices||16,U=o.$14n(),N=b(U.y)>.5,z=new Vh(N,!N,0).cross(U).$14n(),H=z.cross(U).$14n(),Q=new _n(X,U.$11n()),S=new _n(P,U.$14n()),M=[],D=0;T>D;D++){var i=D/T,$=(D+1)/T;M.push(new ps([Q,I(0,i,-1),I(0,$,-1)])),M.push(new ps([I(0,$,0),I(0,i,0),I(1,i,0),I(1,$,0)])),M.push(new ps([S,I(1,$,1),I(1,i,1)]))}return pj.$15n(M)};var Vh=function(d,b,k){var p=this;3==arguments.length?(p.x=d,p.y=b,p.z=k):"x"in d?(p.x=d.x,p.y=d.y,p.z=d.z):(p.x=d[0],p.y=d[1],p.z=d[2])};Vh.prototype={clone:function(){return new Vh(this.x,this.y,this.z)},$11n:function(){return new Vh(-this.x,-this.y,-this.z)},$20n:function(m){return new Vh(this.x+m.x,this.y+m.y,this.z+m.z)},$13n:function(n){return new Vh(this.x-n.x,this.y-n.y,this.z-n.z)},$21n:function(o){return new Vh(this.x*o,this.y*o,this.z*o)},$16n:function(Z){return new Vh(this.x/Z,this.y/Z,this.z/Z)},dot:function(P){return this.x*P.x+this.y*P.y+this.z*P.z},lerp:function(K,z){return this.$20n(K.$13n(this).$21n(z))},length:function(){return U(this.dot(this))},$14n:function(){return this.$16n(this.length())},cross:function(Z){var E=this;return new Vh(E.y*Z.z-E.z*Z.y,E.z*Z.x-E.x*Z.z,E.x*Z.y-E.y*Z.x)}};var _n=function(k,b,C){var w=this;w.$24n=new Vh(k),w.$22n=b?new Vh(b):null,w.uv=C?new Vh(C):null};_n.prototype={clone:function(){var c=this;return new _n(c.$24n.clone(),c.$22n.clone(),c.uv?c.uv.clone():null)},flip:function(){this.$22n=this.$22n.$11n()},$18n:function(s,c){var e=this;return new _n(e.$24n.lerp(s.$24n,c),e.$22n.lerp(s.$22n,c),e.uv?e.uv.lerp(s.uv,c):null)}};var bs=function(q,S){this.$22n=q,this.w=S};bs.$17n=function(a,S,M){var G=S.$13n(a).cross(M.$13n(a)).$14n();return new bs(G,G.dot(a))},bs.prototype={clone:function(){return new bs(this.$22n.clone(),this.w)},flip:function(){var w=this;w.$22n=w.$22n.$11n(),w.w=-w.w},$5n:function(D,v,P,s,L){for(var V=this,i=0,B=1,u=2,h=3,Y=0,k=[],r=0;r<D.$9n.length;r++){var N=V.$22n.dot(D.$9n[r].$24n)-V.w,F=-j>N?u:N>j?B:i;Y|=F,k.push(F)}switch(Y){case i:(V.$22n.dot(D.$8n.$22n)>0?v:P).push(D);break;case B:s.push(D);break;case u:L.push(D);break;case h:for(var p=[],o=[],r=0;r<D.$9n.length;r++){var n=(r+1)%D.$9n.length,W=k[r],t=k[n],z=D.$9n[r],J=D.$9n[n];if(W!=u&&p.push(z),W!=B&&o.push(W!=u?z.clone():z),(W|t)==h){var N=(V.w-this.$22n.dot(z.$24n))/V.$22n.dot(J.$24n.$13n(z.$24n)),b=z.$18n(J,N);p.push(b),o.push(b.clone())}}p.length>=3&&s.push(new ps(p,D.$10n)),o.length>=3&&L.push(new ps(o,D.$10n))}}};var ps=function(p,X){var J=this;J.$9n=p,J.$10n=X,J.$8n=bs.$17n(p[0].$24n,p[1].$24n,p[2].$24n)};ps.prototype={clone:function(){var X=this.$9n.map(function(u){return u.clone()});return new ps(X,this.$10n)},flip:function(){this.$9n.reverse().map(function(C){C.flip()}),this.$8n.flip()}};var tb=function(s){var M=this;M.$8n=null,M.front=null,M.back=null,M.$4n=[],s&&M.$7n(s)};tb.prototype={clone:function(){var z=this,K=new tb;return K.$8n=z.$8n&&z.$8n.clone(),K.front=z.front&&z.front.clone(),K.back=z.back&&z.back.clone(),K.$4n=z.$4n.map(function(_){return _.clone()}),K},$6n:function(){for(var I=this,o=0;o<I.$4n.length;o++)I.$4n[o].flip();I.$8n&&I.$8n.flip(),I.front&&I.front.$6n(),I.back&&I.back.$6n();var y=I.front;I.front=I.back,I.back=y},$1n:function(c){var S=this;if(!S.$8n)return c.slice();for(var j=[],W=[],s=0;s<c.length;s++)S.$8n.$5n(c[s],j,W,j,W);return S.front&&(j=S.front.$1n(j)),W=S.back?S.back.$1n(W):[],j.concat(W)},$3n:function(n){var z=this;z.$4n=n.$1n(z.$4n),z.front&&z.front.$3n(n),z.back&&z.back.$3n(n)},$2n:function(){var h=this,$=h.$4n.slice();return h.front&&($=$.concat(h.front.$2n())),h.back&&($=$.concat(h.back.$2n())),$},$7n:function(l){var A=this;if(l.length){A.$8n||(A.$8n=l[0].$8n.clone());for(var t=[],B=[],g=0;g<l.length;g++)this.$8n.$5n(l[g],A.$4n,A.$4n,t,B);t.length&&(A.front||(A.front=new tb),this.front.$7n(t)),B.length&&(A.back||(A.back=new tb),A.back.$7n(B))}}};var eb="symbol",sj=r.Symbol=function(p,w,C){var D=this;R(sj,D),D.s3(20,20,20),D.s({"all.visible":!1,shape:"rect"}),D.setIcon(p,w,C)};pf("Symbol",I,{setIcon:function(q,U,i){var e,Y=this;return sj.superClass.setIcon.call(Y,q),q?(e={for3d:!0,face:"center",position:44,names:[q]},i&&(e.transaprent=!0),U&&(e.autorotate=U),Y.addStyleIcon(eb,e)):Y.removeStyleIcon(eb),Y.setWidth(Z.getImageWidth(V.getImage(q),Y)||20),e}});var Ap=r.CSGNode=function(){R(Ap,this),this.s({shape:"rect","attach.thickness":1.001,"2d.attachable":!0})},Tm={position:1,width:1,height:1,rotation:1,rotationX:1,rotationZ:1,rotationMode:1,tall:1,elevation:1,anchor:1,anchorElevation:1,"s:attach.cull":1,"s:attach.operation":1};pf("CSGNode",I,{_22Q:function(){return te},onPropertyChanged:function(I){var H=this,$=H.getHost();Ap.superClass.onPropertyChanged.call(H,I),Tm[I.property]&&($ instanceof Bo||$ instanceof Ap)&&$.fp("csgNodeChange",!0,!1)}});var te=function(t,f){R(te,this,[t,f])};w(te,s.Node3dUI,{_80o:function(q,X,d){var p=this;p._shape3d?te.superClass._80o.call(p,q,X,d):(k(p.gv),me.forEach(function(J){o(p,q,X,J,d)}))},validate:function(B,P){var H=this,I=H.gv,n=H.data;if(n.s("shape3d"))return te.superClass.validate.call(H,B,P),H._shape3d=!0,void 0;H._shape3d=!1;var M=Y(n,I.getMat(n));n.appendAnchorMatrix3d(M);var q=B&&B.uv;H.vf2("csg",q);for(var W=0;6>W;W++)for(var e=pi[W],f=Zh[W],R=H.vf2(e,q,P),T=R.mat||M,y=R.vs,t=R.uv,D=R.tuv,J=0;2>J;J++){var o=S[f+3*J],X=S[f+3*J+1],A=S[f+3*J+2];if(c(y,T,[d[3*o],d[3*o+1],d[3*o+2]]),c(y,T,[d[3*X],d[3*X+1],d[3*X+2]]),c(y,T,[d[3*A],d[3*A+1],d[3*A+2]]),D)if(t){var E=8*W;D.push(t[2*o-E],t[2*o+1-E],t[2*X-E],t[2*X+1-E],t[2*A-E],t[2*A+1-E])}else D.push(C[2*o],C[2*o+1],C[2*X],C[2*X+1],C[2*A],C[2*A+1])}Re(H,B,P)},vf2:function(P,g,L){var d,x=this,p=x.gv.getFaceVisible(x.data,P);return d=i(x,P,L),d.vs=[],d.tuv=p&&(d.texture||g)?[]:J,d.visible=p,d}});var Bo=r.CSGShape=function(){var K=this;R(Bo,K),K.s({"shape.background":J,"2d.hostable":!0,"shape.border.width":8}),K.setTall(240),K.setElevation(120),K.setThickness(14)};pf("CSGShape",e,{IRotatable:!1,_22Q:function(){return Gd},setRotationX:function(){},setRotation:function(){},setRotationZ:function(){},setSegments:function(){}});var Gd=function(F,L){R(Gd,this,[F,L])};w(Gd,s.Shape3dUI,{_80o:function(X,u,f){var t=this;t.undrawable||(k(t.gv),me.forEach(function(U){o(t,X,u,U,f)}))},validate:function(m,s){var V=this,D=V.data,I=D.getPoints();if(V.undrawable=I.size()<2)return V.clear(),void 0;var B=D.isClosePath(),v=M(D._thickness/2,j),L=n(I,J,J,B);me.forEach(function(A){V.vf(A,m&&m.uv,!0,s)}),B&&(V.left.visible=!1,V.right.visible=!1),V._12O(L,v),V._20Q(L);var i=D.getPointsMatrix3d(),R=r.Math.requestVector3();pi.forEach(function(g){if(V[g])for(var S=V[g].vs,H=0,A=S.length;A>H;H+=3)R.set(S[H],S[H+1],S[H+2]).applyMatrix4(i),S[H]=R.x,S[H+1]=R.y,S[H+2]=R.z}),r.Math.releaseVector3(R),Re(V,m,s)}});var Rj=r.DoorWindow=function(){var H=this;R(Rj,H),H.setElevation(100),H.s3(100,200,14)};pf("DoorWindow",Ap,{IDoorWindow:!0,toggle:function(j){this.setExpanded(!this.s(y),j)},isExpanded:function(){return this.s(y)},setExpanded:function(K,l){var k=this,r=k.$25n,u=k.s(y);if(r&&(r.stop(!0),delete k.$25n),u!==K){k.beginTransaction();var M=K?k.s("dw.end"):k.s("dw.start");k.s(y,K),l=m(l),l?(u=k.s(Oq),l.action=function(j){k.s(Oq,u+(M-u)*j)},l.finishFunc=function(){k.endTransaction()},k.$25n=E(l)):(k.s(Oq,M),k.endTransaction())}},getMat:function(){var h=this,y=h.s("dw.s3"),w=h.s("dw.t3"),G=h.s("dw.flip"),d=h.s(Oq);if(y||d||w||G){var S=[];if(G&&S.push({r3:[0,q,0]}),y&&S.push({s3:y}),d){y=h.getFinalScale3d();var T=h.s("dw.axis"),I=y[0]/2,U=y[1]/2;y[2]/2,T===L?S.push({t3:[I,0,0]},{r3:[0,-d,0]},{t3:[-I,0,0]}):T===g?S.push({t3:[-I,0,0]},{r3:[0,d,0]},{t3:[I,0,0]}):T===O?S.push({t3:[0,-U,0]},{r3:[-d,0,0]},{t3:[0,U,0]}):T===f?S.push({t3:[0,U,0]},{r3:[d,0,0]},{t3:[0,-U,0]}):T===X?S.push({r3:[0,d,0]}):T===H&&S.push({r3:[d,0,0]})}return w&&S.push({t3:w}),K(S)}return J}});var Jj=r.CSGBox=function(){var h=this;R(Jj,h),h.setElevation(100),h.s3(100,200,100)};pf("CSGBox",Ap,{ICSGBox:!0,toggleFace:function(d,G){this.setFaceExpanded(d,!this.s(d+a),G)},isFaceExpanded:function(M){return this.s(M+a)},setFaceExpanded:function(S,U,A){var g=this,o=g.$25n,_=g.s(S+a);if(o&&(o.stop(!0),delete g.$25n),_!==U){var F=U?g.s(S+".end"):g.s(S+".start");g.s(S+a,U),A=m(A),A?(_=g.s(S+wh),A.action=function(M){g.s(S+wh,_+(F-_)*M)},g.$25n=E(A)):g.s(S+wh,F)}},getFaceMat:function(S){var A=this,P=A.s(S+wh);if(!P)return J;var e,N,V,L,l,q,m=A.s(S+".axis"),U=A.getFinalScale3d(),h=A.getAnchor3d(),I=U[0]*h.x,j=U[1]*h.y,k=U[2]*h.z,w=U[0]-I,$=U[1]-j,T=U[2]-k,p=S+"_"+m;switch(p){case"front_left":e=-I,N=0,V=T,L=0,l=-P,q=0;break;case"front_right":e=w,N=0,V=T,L=0,l=P,q=0;break;case"front_top":e=0,N=$,V=T,L=-P,l=0,q=0;break;case"front_bottom":e=0,N=-j,V=T,L=P,l=0,q=0;break;case"front_h":e=0,N=0,V=T,L=P,l=0,q=0;break;case"front_v":e=0,N=0,V=T,L=0,l=P,q=0;break;case"back_left":e=w,N=0,V=-k,L=0,l=-P,q=0;break;case"back_right":e=-I,N=0,V=-k,L=0,l=P,q=0;break;case"back_top":e=0,N=$,V=-k,L=P,l=0,q=0;break;case"back_bottom":e=0,N=-j,V=-k,L=-P,l=0,q=0;break;case"back_h":e=0,N=0,V=-k,L=P,l=0,q=0;break;case"back_v":e=0,N=0,V=-k,L=0,l=P,q=0;break;case"left_left":e=-I,N=0,V=-k,L=0,l=-P,q=0;break;case"left_right":e=-I,N=0,V=T,L=0,l=P,q=0;break;case"left_top":e=-I,N=$,V=0,L=0,l=0,q=-P;break;case"left_bottom":e=-I,N=-j,V=0,L=0,l=0,q=P;break;case"left_h":e=-I,N=0,V=0,L=0,l=0,q=P;break;case"left_v":e=-I,N=0,V=0,L=0,l=P,q=0;break;case"right_left":e=w,N=0,V=T,L=0,l=-P,q=0;break;case"right_right":e=w,N=0,V=-k,L=0,l=P,q=0;break;case"right_top":e=w,N=$,V=0,L=0,l=0,q=P;break;case"right_bottom":e=w,N=-j,V=0,L=0,l=0,q=-P;break;case"right_h":e=w,N=0,V=0,L=0,l=0,q=P;break;case"right_v":e=w,N=0,V=0,L=0,l=P,q=0;break;case"top_left":e=-I,N=$,V=0,L=0,l=0,q=P;break;case"top_right":e=w,N=$,V=0,L=0,l=0,q=-P;break;case"top_top":e=0,N=$,V=-k,L=-P,l=0,q=0;break;case"top_bottom":e=0,N=$,V=T,L=P,l=0,q=0;break;case"top_h":e=0,N=$,V=0,L=P,l=0,q=0;break;case"top_v":e=0,N=$,V=0,L=0,l=0,q=P;break;case"bottom_left":e=-I,N=-j,V=0,L=0,l=0,q=-P;break;case"bottom_right":e=w,N=-j,V=0,L=0,l=0,q=P;break;case"bottom_top":e=0,N=-j,V=T,L=-P,l=0,q=0;break;case"bottom_bottom":e=0,N=-j,V=-k,L=P,l=0,q=0;break;case"bottom_h":e=0,N=-j,V=0,L=P,l=0,q=0;break;case"bottom_v":e=0,N=-j,V=0,L=0,l=0,q=P}return K([{t3:[-e,-N,-V]},{r3:[L,l,q]},{t3:[e,N,V]}])}});var Ji=function(H,e,o,n,L){function T(){var K,U=[],D=new W,c=new W;for(b.eachShapeModel(function(f,a,P){for(var X=0,$=a?a.length:f.length/3;$>X;X++)a?(D.fromArray(f,3*a[X]),c.fromArray(P,3*a[X])):(D.fromArray(f,3*X),c.fromArray(P,3*X)),V(U,D,c)}),U=w(U,k.set(1,0,0)),U=w(U,k.set(-1,0,0)),U=w(U,k.set(0,1,0)),U=w(U,k.set(0,-1,0)),U=w(U,k.set(0,0,1)),U=w(U,k.set(0,0,-1)),K=0;K<U.length;K++){var C=U[K];y.push(.5+C.position.x/L.x,.5-C.position.y/L.y),C.position.applyMatrix4(i),$.push(C.position.x,C.position.y,C.position.z),B.push(C.$22n.x,C.$22n.y,C.$22n.z)}}function V(e,O,I){O.applyMatrix4(m),O.applyMatrix4(S),I.transformDirection(m),I.transformDirection(S),e.push(new N(O.clone(),I.clone()))}function w(t,$){for(var N=[],r=.5*Math.abs(L.dot($)),i=0;i<t.length;i+=3){var U,j,E,m,y,u,s,J=0,F=t[i+0].position.dot($)-r,G=t[i+1].position.dot($)-r,c=t[i+2].position.dot($)-r;switch(U=F>0,j=G>0,E=c>0,J=(U?1:0)+(j?1:0)+(E?1:0)){case 0:N.push(t[i]),N.push(t[i+1]),N.push(t[i+2]);break;case 1:if(U&&(m=t[i+1],y=t[i+2],u=R(t[i],m,$,r),s=R(t[i],y,$,r)),j){m=t[i],y=t[i+2],u=R(t[i+1],m,$,r),s=R(t[i+1],y,$,r),N.push(u),N.push(y.clone()),N.push(m.clone()),N.push(y.clone()),N.push(u.clone()),N.push(s);break}E&&(m=t[i],y=t[i+1],u=R(t[i+2],m,$,r),s=R(t[i+2],y,$,r)),N.push(m.clone()),N.push(y.clone()),N.push(u),N.push(s),N.push(u.clone()),N.push(y.clone());break;case 2:U||(m=t[i].clone(),y=R(m,t[i+1],$,r),u=R(m,t[i+2],$,r),N.push(m),N.push(y),N.push(u)),j||(m=t[i+1].clone(),y=R(m,t[i+2],$,r),u=R(m,t[i],$,r),N.push(m),N.push(y),N.push(u)),E||(m=t[i+2].clone(),y=R(m,t[i],$,r),u=R(m,t[i+1],$,r),N.push(m),N.push(y),N.push(u));break;case 3:}}return N}function R(a,K,R,G){var n=a.position.dot(R)-G,i=K.position.dot(R)-G,V=n/(n-i),z=new N(new W(a.position.x+V*(K.position.x-a.position.x),a.position.y+V*(K.position.y-a.position.y),a.position.z+V*(K.position.z-a.position.z)),new W(a.$22n.x+V*(K.$22n.x-a.$22n.x),a.$22n.y+V*(K.$22n.y-a.$22n.y),a.$22n.z+V*(K.$22n.z-a.$22n.z)));return z}var $=[],B=[],y=[],k=new W,b=H.getData3dUI(e);if(b.mat){var m=(new P).fromArray(b.mat),s=new P;s.makeRotationFromEuler(n),s.setPosition(o);var S=(new P).getInverse(s),i=(new P).scale({x:1/L.x,y:1/L.y,z:1/L.z});return T(),{vs:$,ns:B,uv:y}}};N.prototype.clone=function(){return new N(this.position.clone(),this.$22n.clone())};var Zc=function(T,t,h,d){var E=this,F=E.getDataAt(T);if(F){var G=E.intersectObject(T,F);if(G){"object"==typeof t?t=t.x?new W(t.x,t.y,t.z):new W(t[0],t[1],t[2]):(t=t||20,t=new W(t,t,t)),h=h===p?.1:h;var j=new W(E.getUp()),q=new W(E.getCenter()).sub(new W(E.getEye())).normalize(),M="cross",Q=q.clone()[M](j).normalize();j.copy(Q)[M](q).normalize(),d&&j.applyAxisAngle(G.worldNormal,-d);var D=new r.Node,I=G.worldNormal.clone().setLength(h).add(G.world),n=(new P).lookAt(G.worldNormal.clone(),new W(0,0,0),j),l=(new z).setFromRotationMatrix(n),i=Ji(E,F,G.world.clone(),l,t);return D.p3(I.x,I.y,I.z),D.setEuler(l),D.s3(t.x,t.y,t.z),D.s({shape3d:i,"shape3d.reverse.flip":!0}),D}}};u(r.graph3d.Graph3dView,{createDecal:Zc})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);