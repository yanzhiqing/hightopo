!function(J,c,R){"use strict";function h(J,w){this.position=J,this.$22n=w}var p="ht",Y=J[p],f=null,U=Math,X=U.PI,d=U.cos,Q=U.sin,n=U.abs,K=U.max,V=U.sqrt,A=1e-5,g=Y.Default,y=g.def,D=g.startAnim,I=g.createMatrix,s=g.transformVec,o=g.getInternal(),L=o.addMethod,k=o.superCall,G=o.toPointsArray,m=o.createNormals,E=o.toFloatArray,M=o.glMV,$=(o.glPop,Y.graph3d.Graph3dView,Y.Math),x=$.Vector3,H=$.Matrix4,q=$.Euler,e=($.Quaternion,o.batchShape),j=o.createNodeMatrix,T=o.getFaceInfo,v=o.transformAppend,u=o.drawFaceInfo,_=o.createAnim,N=o.cube(),B=N.is,F=N.vs,l=N.uv,i=o.ui(),z=Y.Node,S=Y.Shape,W="h",P="v",b="front",t="back",C="left",O="right",Z="top",a="bottom",r="dw.expanded",w=".expanded",Nn="dw.angle",bh=".angle",jo=function(i,H,n){y(p+"."+i,H,n)},To=function(y,V,B){B?y.push(V.x,V.y):y.push(V.x,V.y,V.z)},ho=function(){var W=new Y.Math.Vector3,H=new Y.Math.Vector3,M=new Y.Math.Vector3;return function(L,C,T,B,k){if(W.copy(C.$24n),H.copy(T.$24n),M.copy(B.$24n),!(M.equals(W)||H.equals(W)||H.equals(M))){if(!C.$22n||!T.$22n||!B.$22n){var u=H.sub(W).cross(M.sub(W)).normalize().multiplyScalar(1).toArray();C.$22n||(C.$22n=new Rg(u)),T.$22n||(T.$22n=new Rg(u)),B.$22n||(B.$22n=new Rg(u))}L.push(new Bl([C,T,B],k))}}}(),ib=function(F,s,Z,l){var V,T,o,e,q=0,$=[];if(l)for(V=l.length;V>q;q+=3)T=l[q],o=l[q+1],e=l[q+2],ho($,new $e([s[3*T],s[3*T+1],s[3*T+2]],null,Z?[Z[2*T],Z[2*T+1],0]:f),new $e([s[3*o],s[3*o+1],s[3*o+2]],null,Z?[Z[2*o],Z[2*o+1],0]:f),new $e([s[3*e],s[3*e+1],s[3*e+2]],null,Z?[Z[2*e],Z[2*e+1],0]:f),F);else for(V=s.length/3;V>q;q+=3)T=q,o=q+1,e=q+2,ho($,new $e([s[3*T],s[3*T+1],s[3*T+2]],null,Z?[Z[2*T],Z[2*T+1],0]:f),new $e([s[3*o],s[3*o+1],s[3*o+2]],null,Z?[Z[2*o],Z[2*o+1],0]:f),new $e([s[3*e],s[3*e+1],s[3*e+2]],null,Z?[Z[2*e],Z[2*e+1],0]:f),F);return $},sm=[C,b,O,t,Z,a],cp=["",Z,a],Hf=sm.concat("csg"),Jp=[0,6,12,18,24,30],lp=function(Q,J,q){var O=j(Q),T=[];Q.appendAnchorMatrix3d(O);var v,G=J?J.getData3dUI(Q):null;if(G&&G.s("shape3d")&&!G.s("csg.cull.box")&&(v=G.shapeModel,G.shapeModel||(v=o.getShapeModel(G,G.s("shape3d"))),v))for(var N=o.createNormalMatrix(O),L=0,x=cp.length;x>L;L++){var D=cp[L],n=D.length?D+"_":D,w=v[n+"vs"],E=v[n+"uv"],K=v[n+"is"],V=v[n+"ns"];if(w&&w.length)for(var P,Z,$,U=0,z=K?K.length:w.length/3;z>U;U+=3)K?(P=K[U],Z=K[U+1],$=K[U+2]):(P=U,Z=U+1,$=U+2),ho(T,new $e(s([w[3*P],w[3*P+1],w[3*P+2]],O),V?s([V[3*P],V[3*P+1],V[3*P+2]],N):null,[E[2*P],E[2*P+1],0]),new $e(s([w[3*Z],w[3*Z+1],w[3*Z+2]],O),V?s([V[3*Z],V[3*Z+1],V[3*Z+2]],N):null,[E[2*Z],E[2*Z+1],0]),new $e(s([w[3*$],w[3*$+1],w[3*$+2]],O),V?s([V[3*$],V[3*$+1],V[3*$+2]],N):null,[E[2*$],E[2*$+1],0]),Q)}if(!v)for(var L=0;6>L;L++)for(var D=sm[L],m=Jp[L],E=q?J.getFaceUv(Q,D):f,c=q?J.getFaceUvScale(Q,D):f,A=q?J.getFaceUvOffset(Q,D):f,H=0;2>H;H++){var p,R,e,M=B[m+3*H],h=B[m+3*H+1],i=B[m+3*H+2];if(q){if(E){var g=8*L;p=[E[2*M-g],E[2*M+1-g],0],R=[E[2*h-g],E[2*h+1-g],0],e=[E[2*i-g],E[2*i+1-g],0]}else p=[l[2*M],l[2*M+1],0],R=[l[2*h],l[2*h+1],0],e=[l[2*i],l[2*i+1],0];c&&(p[0]*=c[0],p[1]*=c[1],R[0]*=c[0],R[1]*=c[1],e[0]*=c[0],e[1]*=c[1]),A&&(p[0]+=A[0],p[1]+=A[1],R[0]+=A[0],R[1]+=A[1],e[0]+=A[0],e[1]+=A[1])}ho(T,new $e(s([F[3*M],F[3*M+1],F[3*M+2]],O),null,p),new $e(s([F[3*h],F[3*h+1],F[3*h+2]],O),null,R),new $e(s([F[3*i],F[3*i+1],F[3*i+2]],O),null,e),Q)}return Of.$15n(T)},qi=function(J,s,y){var C,x=J.data.getAttaches();if(x&&x.each(function(Q){Q instanceof Ke&&Q.s("attach.operation")&&(C||(C=[]),C.push(Q))}),C){var Q;sm.forEach(function(L){var E=ib(L,J[L].vs,J[L].tuv);Q=Q?Q.concat(E):E}),Q=Of.$15n(Q),C.forEach(function(U){var h=U.s("attach.operation");Q[h]&&(Q=Q[h](lp(U,J.gv,J.csg.tuv)))}),sm.forEach(function(m){m=J[m],m.vs=[],m.ns=[],m.tuv&&(m.tuv=[])}),J.csg&&!J.csg.ns&&(J.csg.ns=[]);var _=[];if(Q.$19n().forEach(function(L){var S,p=L.$10n;if(p instanceof Ke){if(p.s("attach.cull"))return;S=p.s("csg.cull.color"),S&&(S=o.toColorArray(S)),p="csg"}for(var F=J[p],X=F.vs,B=F.ns,n=F.tuv,G=L.$9n,g=2;g<G.length;g++)if(To(X,G[0].$24n),To(X,G[g-1].$24n),To(X,G[g].$24n),B&&(To(B,G[0].$22n),To(B,G[g-1].$22n),To(B,G[g].$22n)),n&&(To(n,G[0].uv,!0),To(n,G[g-1].uv,!0),To(n,G[g].uv,!0)),S)for(var N=4*(X.length/3),q=0;3>q;q++)_[--N]=S[3],_[--N]=S[2],_[--N]=S[1],_[--N]=S[0]}),_.length){for(var u=o.toColorArray(J.csg.color),Z=0,N=4*(J.csg.vs.length/3);N>Z;Z+=4)_[Z]==R&&(_[Z]=u[0],_[Z+1]=u[1],_[Z+2]=u[2],_[Z+3]=u[3]);J.csg.cs=_}}Hf.forEach(function(f){var H=J[f];H.visible&&H.vs.length?(H.ns&&H.ns.length?E(H,"ns"):H.ns=m(H.vs),E(H,"vs"),E(H,"tuv"),H.cs&&E(H,"cs")):delete J[f]}),s&&(e(J,f,s,f,y),J.clear())};L(g,{createFrameModel:function(G,S,L,d){G=G==f?.07:G,S=S==f?G:S,L=L==f?G:L,d=d?d:{};var n=d.top,y=d.bottom,$=d.left,u=d.right,R=d.front,s=d.back,m=[],T=[];return R===!0?(m.push(-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,-.5,.5,.5,.5,.5,-.5,.5,.5),T.push(0,0,0,1,1,1,1,1,1,0,0,0)):R===!1||(m.push(-.5,.5,.5,-.5,-.5,.5,-.5+G,-.5,.5,-.5+G,-.5,.5,-.5+G,.5,.5,-.5,.5,.5,.5-G,.5,.5,.5-G,-.5,.5,.5,-.5,.5,.5,-.5,.5,.5,.5,.5,.5-G,.5,.5,-.5+G,.5,.5,-.5+G,.5-S,.5,.5-G,.5-S,.5,.5-G,.5-S,.5,.5-G,.5,.5,-.5+G,.5,.5,-.5+G,-.5+S,.5,-.5+G,-.5,.5,.5-G,-.5,.5,.5-G,-.5,.5,.5-G,-.5+S,.5,-.5+G,-.5+S,.5),T.push(0,0,0,1,G,1,G,1,G,0,0,0,1-G,0,1-G,1,1,1,1,1,1,0,1-G,0,G,0,G,S,1-G,S,1-G,S,1-G,0,G,0,G,1-S,G,1,1-G,1,1-G,1,1-G,1-S,G,1-S)),s===!0?(m.push(-.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5),T.push(1,0,0,1,1,1,0,1,1,0,0,0)):s===!1||(m.push(-.5,.5,-.5,-.5+G,-.5,-.5,-.5,-.5,-.5,-.5+G,-.5,-.5,-.5,.5,-.5,-.5+G,.5,-.5,.5-G,.5,-.5,.5,-.5,-.5,.5-G,-.5,-.5,.5,-.5,-.5,.5-G,.5,-.5,.5,.5,-.5,-.5+G,.5,-.5,.5-G,.5-S,-.5,-.5+G,.5-S,-.5,.5-G,.5-S,-.5,-.5+G,.5,-.5,.5-G,.5,-.5,-.5+G,-.5+S,-.5,.5-G,-.5,-.5,-.5+G,-.5,-.5,.5-G,-.5,-.5,-.5+G,-.5+S,-.5,.5-G,-.5+S,-.5),T.push(1,0,1-G,1,1,1,1-G,1,1,0,1-G,0,G,0,0,1,G,1,0,1,G,0,0,0,1-G,0,G,S,1-G,S,G,S,1-G,0,G,0,1-G,1-S,G,1,1-G,1,G,1,1-G,1-S,G,1-S)),$===!0?(m.push(-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,.5,.5,-.5,.5,-.5),T.push(0,0,0,1,1,1,1,1,1,0,0,0)):$===!1||(m.push(-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5+L,-.5,-.5,-.5+L,-.5,.5,-.5+L,-.5,.5,-.5,-.5,.5,.5-L,-.5,-.5,.5-L,-.5,-.5,.5,-.5,-.5,.5,-.5,.5,.5,-.5,.5,.5-L,-.5,.5,-.5+L,-.5,.5-S,-.5+L,-.5,.5-S,.5-L,-.5,.5-S,.5-L,-.5,.5,.5-L,-.5,.5,-.5+L,-.5,-.5+S,-.5+L,-.5,-.5,-.5+L,-.5,-.5,.5-L,-.5,-.5,.5-L,-.5,-.5+S,.5-L,-.5,-.5+S,-.5+L),T.push(0,0,0,1,L,1,L,1,L,0,0,0,1-L,0,1-L,1,1,1,1,1,1,0,1-L,0,L,0,L,S,1-L,S,1-L,S,1-L,0,L,0,L,1-S,L,1,1-L,1,1-L,1,1-L,1-S,L,1-S)),u===!0?(m.push(.5,.5,-.5,.5,-.5,.5,.5,-.5,-.5,.5,-.5,.5,.5,.5,-.5,.5,.5,.5),T.push(1,0,0,1,1,1,0,1,1,0,0,0)):u===!1||(m.push(.5,.5,-.5,.5,-.5,-.5+L,.5,-.5,-.5,.5,-.5,-.5+L,.5,.5,-.5,.5,.5,-.5+L,.5,.5,.5-L,.5,-.5,.5,.5,-.5,.5-L,.5,-.5,.5,.5,.5,.5-L,.5,.5,.5,.5,.5,-.5+L,.5,.5-S,.5-L,.5,.5-S,-.5+L,.5,.5-S,.5-L,.5,.5,-.5+L,.5,.5,.5-L,.5,-.5+S,-.5+L,.5,-.5,.5-L,.5,-.5,-.5+L,.5,-.5,.5-L,.5,-.5+S,-.5+L,.5,-.5+S,.5-L),T.push(1,0,1-L,1,1,1,1-L,1,1,0,1-L,0,L,0,0,1,L,1,0,1,L,0,0,0,1-L,0,L,S,1-L,S,L,S,1-L,0,L,0,1-L,1-S,L,1,1-L,1,L,1,1-L,1-S,L,1-S)),n===!0?(m.push(.5,.5,.5,.5,.5,-.5,-.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,.5,.5,.5),T.push(1,1,1,0,0,0,0,0,0,1,1,1)):n===!1||(m.push(.5,.5,.5,.5,.5,-.5,.5-G,.5,-.5,.5-G,.5,-.5,.5-G,.5,.5,.5,.5,.5,-.5+G,.5,.5,-.5+G,.5,-.5,-.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5+G,.5,.5,.5-G,.5,.5,.5-G,.5,.5-L,-.5+G,.5,.5-L,-.5+G,.5,.5-L,-.5+G,.5,.5,.5-G,.5,.5,.5-G,.5,-.5+L,.5-G,.5,-.5,-.5+G,.5,-.5,-.5+G,.5,-.5,-.5+G,.5,-.5+L,.5-G,.5,-.5+L),T.push(1,1,1,0,1-G,0,1-G,0,1-G,1,1,1,G,1,G,0,0,0,0,0,0,1,G,1,1-G,1,1-G,1-L,G,1-L,G,1-L,G,1,1-G,1,1-G,L,1-G,0,G,0,G,0,G,L,1-G,L)),y===!0?(m.push(.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,.5),T.push(1,0,0,1,1,1,0,1,1,0,0,0)):y===!1||(m.push(.5,-.5,.5,.5-G,-.5,-.5,.5,-.5,-.5,.5-G,-.5,-.5,.5,-.5,.5,.5-G,-.5,.5,-.5+G,-.5,.5,-.5,-.5,-.5,-.5+G,-.5,-.5,-.5,-.5,-.5,-.5+G,-.5,.5,-.5,-.5,.5,.5-G,-.5,.5,-.5+G,-.5,.5-L,.5-G,-.5,.5-L,-.5+G,-.5,.5-L,.5-G,-.5,.5,-.5+G,-.5,.5,.5-G,-.5,-.5+L,-.5+G,-.5,-.5,.5-G,-.5,-.5,-.5+G,-.5,-.5,.5-G,-.5,-.5+L,-.5+G,-.5,-.5+L),T.push(1,0,1-G,1,1,1,1-G,1,1,0,1-G,0,G,0,0,1,G,1,0,1,G,0,0,0,1-G,0,G,L,1-G,L,G,L,1-G,0,G,0,1-G,1-L,G,1,1-G,1,G,1,1-G,1-L,G,1-L)),{vs:m,uv:T}}}),L(Y.Style,{"csg.cull.color":R,"csg.cull.box":!0,"dw.flip":!1,"dw.s3":[.999,.999,.5],"dw.t3":R,"dw.expanded":!1,"dw.toggleable":!0,"dw.axis":"left","dw.start":0,"dw.end":X/2,"dw.angle":0,"attach.cull":!1,"attach.operation":"subtract"},!0),sm.forEach(function(u){var b={};b[u+w]=!1,b[u+".toggleable"]=!1,b[u+".axis"]=C,b[u+".start"]=0,b[u+".end"]=X/2,b[u+bh]=0,L(Y.Style,b,!0)});var Of=function(){this.$4n=[]};Of.$15n=function(Z){var b=new Of;return b.$4n=Z,b},Of.prototype={clone:function(){var c=new Of;return c.$4n=this.$4n.map(function(F){return F.clone()}),c},$19n:function(){return this.$4n},union:function(p){var m=new ns(this.clone().$4n),s=new ns(p.clone().$4n);return m.$3n(s),s.$3n(m),s.$6n(),s.$3n(m),s.$6n(),m.$7n(s.$2n()),Of.$15n(m.$2n())},subtract:function(F){var $=new ns(this.clone().$4n),U=new ns(F.clone().$4n);return $.$6n(),$.$3n(U),U.$3n($),U.$6n(),U.$3n($),U.$6n(),$.$7n(U.$2n()),$.$6n(),Of.$15n($.$2n())},intersect:function(M){var y=new ns(this.clone().$4n),B=new ns(M.clone().$4n);return y.$6n(),B.$3n(y),B.$6n(),y.$3n(B),B.$3n(y),y.$7n(B.$2n()),y.$6n(),Of.$15n(y.$2n())},inverse:function(){var z=this.clone();return z.$4n.map(function(b){b.flip()}),z}},Of.cube=function(l){l=l||{};var V=new Rg(l.center||[0,0,0]),b=l.radius?l.radius.length?l.radius:[l.radius,l.radius,l.radius]:[1,1,1];return Of.$15n([[[0,4,6,2],[-1,0,0]],[[1,3,7,5],[1,0,0]],[[0,1,5,4],[0,-1,0]],[[2,6,7,3],[0,1,0]],[[0,2,3,1],[0,0,-1]],[[4,5,7,6],[0,0,1]]].map(function(D){return new Bl(D[0].map(function(T){var k=new Rg(V.x+b[0]*(2*!!(1&T)-1),V.y+b[1]*(2*!!(2&T)-1),V.z+b[2]*(2*!!(4&T)-1));return new $e(k,new Rg(D[1]))}))}))},Of.sphere=function(k){function N(s,J){s*=2*X,J*=X;var L=new Rg(d(s)*Q(J),d(J),Q(s)*Q(J));u.push(new $e(U.$20n(L.$21n(g)),L))}k=k||{};for(var u,U=new Rg(k.center||[0,0,0]),g=k.radius||1,r=k.slices||16,O=k.stacks||8,x=[],W=0;r>W;W++)for(var n=0;O>n;n++)u=[],N(W/r,n/O),n>0&&N((W+1)/r,n/O),O-1>n&&N((W+1)/r,(n+1)/O),N(W/r,(n+1)/O),x.push(new Bl(u));return Of.$15n(x)},Of.cylinder=function(S){function U(I,x,m){var y=2*x*X,r=c.$21n(d(y)).$20n(h.$21n(Q(y))),j=k.$20n(b.$21n(I)).$20n(r.$21n(L)),K=r.$21n(1-n(m)).$20n(A.$21n(m));return new $e(j,K)}S=S||{};for(var k=new Rg(S.start||[0,-1,0]),j=new Rg(S.end||[0,1,0]),b=j.$13n(k),L=S.radius||1,i=S.slices||16,A=b.$14n(),r=n(A.y)>.5,c=new Rg(r,!r,0).cross(A).$14n(),h=c.cross(A).$14n(),I=new $e(k,A.$11n()),W=new $e(j,A.$14n()),C=[],E=0;i>E;E++){var N=E/i,H=(E+1)/i;C.push(new Bl([I,U(0,N,-1),U(0,H,-1)])),C.push(new Bl([U(0,H,0),U(0,N,0),U(1,N,0),U(1,H,0)])),C.push(new Bl([W,U(1,H,1),U(1,N,1)]))}return Of.$15n(C)};var Rg=function(v,q,s){var R=this;3==arguments.length?(R.x=v,R.y=q,R.z=s):"x"in v?(R.x=v.x,R.y=v.y,R.z=v.z):(R.x=v[0],R.y=v[1],R.z=v[2])};Rg.prototype={clone:function(){return new Rg(this.x,this.y,this.z)},$11n:function(){return new Rg(-this.x,-this.y,-this.z)},$20n:function(A){return new Rg(this.x+A.x,this.y+A.y,this.z+A.z)},$13n:function(W){return new Rg(this.x-W.x,this.y-W.y,this.z-W.z)},$21n:function(g){return new Rg(this.x*g,this.y*g,this.z*g)},$16n:function(X){return new Rg(this.x/X,this.y/X,this.z/X)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lerp:function(Y,Q){return this.$20n(Y.$13n(this).$21n(Q))},length:function(){return V(this.dot(this))},$14n:function(){return this.$16n(this.length())},cross:function(x){var R=this;return new Rg(R.y*x.z-R.z*x.y,R.z*x.x-R.x*x.z,R.x*x.y-R.y*x.x)}};var $e=function(Q,X,s){var T=this;T.$24n=new Rg(Q),T.$22n=X?new Rg(X):null,T.uv=s?new Rg(s):null};$e.prototype={clone:function(){var i=this;return new $e(i.$24n.clone(),i.$22n.clone(),i.uv?i.uv.clone():null)},flip:function(){this.$22n=this.$22n.$11n()},$18n:function(W,K){var l=this;return new $e(l.$24n.lerp(W.$24n,K),l.$22n.lerp(W.$22n,K),l.uv?l.uv.lerp(W.uv,K):null)}};var fh=function(m,y){this.$22n=m,this.w=y};fh.$17n=function(x,V,d){var H=V.$13n(x).cross(d.$13n(x)).$14n();return new fh(H,H.dot(x))},fh.prototype={clone:function(){return new fh(this.$22n.clone(),this.w)},flip:function(){var c=this;c.$22n=c.$22n.$11n(),c.w=-c.w},$5n:function(g,r,i,p,w){for(var h=this,G=0,q=1,E=2,P=3,Z=0,K=[],Y=0;Y<g.$9n.length;Y++){var H=h.$22n.dot(g.$9n[Y].$24n)-h.w,O=-A>H?E:H>A?q:G;Z|=O,K.push(O)}switch(Z){case G:(h.$22n.dot(g.$8n.$22n)>0?r:i).push(g);break;case q:p.push(g);break;case E:w.push(g);break;case P:for(var N=[],C=[],Y=0;Y<g.$9n.length;Y++){var I=(Y+1)%g.$9n.length,D=K[Y],s=K[I],y=g.$9n[Y],l=g.$9n[I];if(D!=E&&N.push(y),D!=q&&C.push(D!=E?y.clone():y),(D|s)==P){var H=(h.w-this.$22n.dot(y.$24n))/h.$22n.dot(l.$24n.$13n(y.$24n)),_=y.$18n(l,H);N.push(_),C.push(_.clone())}}N.length>=3&&p.push(new Bl(N,g.$10n)),C.length>=3&&w.push(new Bl(C,g.$10n))}}};var Bl=function(f,h){var k=this;k.$9n=f,k.$10n=h,k.$8n=fh.$17n(f[0].$24n,f[1].$24n,f[2].$24n)};Bl.prototype={clone:function(){var m=this.$9n.map(function(z){return z.clone()});return new Bl(m,this.$10n)},flip:function(){this.$9n.reverse().map(function(L){L.flip()}),this.$8n.flip()}};var ns=function(T){var v=this;v.$8n=null,v.front=null,v.back=null,v.$4n=[],T&&v.$7n(T)};ns.prototype={clone:function(){var T=this,I=new ns;return I.$8n=T.$8n&&T.$8n.clone(),I.front=T.front&&T.front.clone(),I.back=T.back&&T.back.clone(),I.$4n=T.$4n.map(function(P){return P.clone()}),I},$6n:function(){for(var $=this,V=0;V<$.$4n.length;V++)$.$4n[V].flip();$.$8n&&$.$8n.flip(),$.front&&$.front.$6n(),$.back&&$.back.$6n();var e=$.front;$.front=$.back,$.back=e},$1n:function(o){var b=this;if(!b.$8n)return o.slice();for(var V=[],C=[],f=0;f<o.length;f++)b.$8n.$5n(o[f],V,C,V,C);return b.front&&(V=b.front.$1n(V)),C=b.back?b.back.$1n(C):[],V.concat(C)},$3n:function(u){var n=this;n.$4n=u.$1n(n.$4n),n.front&&n.front.$3n(u),n.back&&n.back.$3n(u)},$2n:function(){var w=this,Z=w.$4n.slice();return w.front&&(Z=Z.concat(w.front.$2n())),w.back&&(Z=Z.concat(w.back.$2n())),Z},$7n:function(d){var Y=this;if(d.length){Y.$8n||(Y.$8n=d[0].$8n.clone());for(var k=[],H=[],x=0;x<d.length;x++)this.$8n.$5n(d[x],Y.$4n,Y.$4n,k,H);k.length&&(Y.front||(Y.front=new ns),this.front.$7n(k)),H.length&&(Y.back||(Y.back=new ns),Y.back.$7n(H))}}};var zo="symbol",Yr=Y.Symbol=function(P,F,f){var X=this;k(Yr,X),X.s3(20,20,20),X.s({"all.visible":!1,shape:"rect"}),X.setIcon(P,F,f)};jo("Symbol",z,{setIcon:function(d,N,x){var r,F=this;return Yr.superClass.setIcon.call(F,d),d?(r={for3d:!0,face:"center",position:44,names:[d]},x&&(r.transaprent=!0),N&&(r.autorotate=N),F.addStyleIcon(zo,r)):F.removeStyleIcon(zo),F.setWidth(o.getImageWidth(g.getImage(d),F)||20),r}});var Ke=Y.CSGNode=function(){k(Ke,this),this.s({shape:"rect","attach.thickness":1.001,"2d.attachable":!0})},Rn={position:1,width:1,height:1,rotation:1,rotationX:1,rotationZ:1,rotationMode:1,tall:1,elevation:1,anchor:1,anchorElevation:1,"s:attach.cull":1,"s:attach.operation":1};jo("CSGNode",z,{_22Q:function(){return Mg},onPropertyChanged:function(j){var G=this,f=G.getHost();Ke.superClass.onPropertyChanged.call(G,j),Rn[j.property]&&(f instanceof If||f instanceof Ke)&&f.fp("csgNodeChange",!0,!1)}});var Mg=function(u,h){k(Mg,this,[u,h])};y(Mg,i.Node3dUI,{_80o:function(V,Q,d){var B=this;B._shape3d?Mg.superClass._80o.call(B,V,Q,d):(M(B.gv),Hf.forEach(function(D){u(B,V,Q,D,d)}))},validate:function(W,p){var i=this,Z=i.gv,V=i.data;if(V.s("shape3d"))return Mg.superClass.validate.call(i,W,p),i._shape3d=!0,void 0;i._shape3d=!1;var T=j(V,Z.getMat(V));V.appendAnchorMatrix3d(T);var K=W&&W.uv;i.vf2("csg",K);for(var o=0;6>o;o++)for(var d=sm[o],g=Jp[o],H=i.vf2(d,K,p),a=H.mat||T,M=H.vs,C=H.uv,L=H.tuv,k=0;2>k;k++){var y=B[g+3*k],P=B[g+3*k+1],D=B[g+3*k+2];if(v(M,a,[F[3*y],F[3*y+1],F[3*y+2]]),v(M,a,[F[3*P],F[3*P+1],F[3*P+2]]),v(M,a,[F[3*D],F[3*D+1],F[3*D+2]]),L)if(C){var h=8*o;L.push(C[2*y-h],C[2*y+1-h],C[2*P-h],C[2*P+1-h],C[2*D-h],C[2*D+1-h])}else L.push(l[2*y],l[2*y+1],l[2*P],l[2*P+1],l[2*D],l[2*D+1])}qi(i,W,p)},vf2:function(d,w,s){var t,k=this,F=k.gv.getFaceVisible(k.data,d);return t=T(k,d,s),t.vs=[],t.tuv=F&&(t.texture||w)?[]:f,t.visible=F,t}});var If=Y.CSGShape=function(){var h=this;k(If,h),h.s({"shape.background":f,"2d.hostable":!0,"shape.border.width":8}),h.setTall(240),h.setElevation(120),h.setThickness(14)};jo("CSGShape",S,{IRotatable:!1,_22Q:function(){return Dp},setRotationX:function(){},setRotation:function(){},setRotationZ:function(){},setSegments:function(){}});var Dp=function(_,K){k(Dp,this,[_,K])};y(Dp,i.Shape3dUI,{_80o:function(W,n,z){var T=this;T.undrawable||(M(T.gv),Hf.forEach(function(U){u(T,W,n,U,z)}))},validate:function(z,Z){var D=this,a=D.data,b=a.getPoints();if(D.undrawable=b.size()<2)return D.clear(),void 0;var v=a.isClosePath(),x=K(a._thickness/2,A),w=G(b,f,f,v);Hf.forEach(function(M){D.vf(M,z&&z.uv,!0,Z)}),v&&(D.left.visible=!1,D.right.visible=!1),D._12O(w,x),D._20Q(w);var e=a.getPointsMatrix3d(),X=Y.Math.requestVector3();sm.forEach(function(v){if(D[v])for(var m=D[v].vs,o=0,i=m.length;i>o;o+=3)X.set(m[o],m[o+1],m[o+2]).applyMatrix4(e),m[o]=X.x,m[o+1]=X.y,m[o+2]=X.z}),Y.Math.releaseVector3(X),qi(D,z,Z)}});var sp=Y.DoorWindow=function(){var _=this;k(sp,_),_.setElevation(100),_.s3(100,200,14)};jo("DoorWindow",Ke,{IDoorWindow:!0,toggle:function(v){this.setExpanded(!this.s(r),v)},isExpanded:function(){return this.s(r)},setExpanded:function(x,Y){var J=this,$=J.$25n,I=J.s(r);if($&&($.stop(!0),delete J.$25n),I!==x){J.beginTransaction();var b=x?J.s("dw.end"):J.s("dw.start");J.s(r,x),Y=_(Y),Y?(I=J.s(Nn),Y.action=function(Z){J.s(Nn,I+(b-I)*Z)},Y.finishFunc=function(){J.endTransaction()},J.$25n=D(Y)):(J.s(Nn,b),J.endTransaction())}},getMat:function(){var s=this,t=s.s("dw.s3"),c=s.s("dw.t3"),p=s.s("dw.flip"),Q=s.s(Nn);if(t||Q||c||p){var g=[];if(p&&g.push({r3:[0,X,0]}),t&&g.push({s3:t}),Q){t=s.getFinalScale3d();var A=s.s("dw.axis"),i=t[0]/2,n=t[1]/2;t[2]/2,A===C?g.push({t3:[i,0,0]},{r3:[0,-Q,0]},{t3:[-i,0,0]}):A===O?g.push({t3:[-i,0,0]},{r3:[0,Q,0]},{t3:[i,0,0]}):A===Z?g.push({t3:[0,-n,0]},{r3:[-Q,0,0]},{t3:[0,n,0]}):A===a?g.push({t3:[0,n,0]},{r3:[Q,0,0]},{t3:[0,-n,0]}):A===P?g.push({r3:[0,Q,0]}):A===W&&g.push({r3:[Q,0,0]})}return c&&g.push({t3:c}),I(g)}return f}});var ps=Y.CSGBox=function(){var z=this;k(ps,z),z.setElevation(100),z.s3(100,200,100)};jo("CSGBox",Ke,{ICSGBox:!0,toggleFace:function(C,x){this.setFaceExpanded(C,!this.s(C+w),x)},isFaceExpanded:function(b){return this.s(b+w)},setFaceExpanded:function(R,e,$){var m=this,Z=m.$25n,v=m.s(R+w);if(Z&&(Z.stop(!0),delete m.$25n),v!==e){var d=e?m.s(R+".end"):m.s(R+".start");m.s(R+w,e),$=_($),$?(v=m.s(R+bh),$.action=function(U){m.s(R+bh,v+(d-v)*U)},m.$25n=D($)):m.s(R+bh,d)}},getFaceMat:function(K){var R=this,U=R.s(K+bh);if(!U)return f;var V,H,A,C,X,k,a=R.s(K+".axis"),l=R.getFinalScale3d(),j=R.getAnchor3d(),i=l[0]*j.x,J=l[1]*j.y,s=l[2]*j.z,T=l[0]-i,d=l[1]-J,F=l[2]-s,Q=K+"_"+a;switch(Q){case"front_left":V=-i,H=0,A=F,C=0,X=-U,k=0;break;case"front_right":V=T,H=0,A=F,C=0,X=U,k=0;break;case"front_top":V=0,H=d,A=F,C=-U,X=0,k=0;break;case"front_bottom":V=0,H=-J,A=F,C=U,X=0,k=0;break;case"front_h":V=0,H=0,A=F,C=U,X=0,k=0;break;case"front_v":V=0,H=0,A=F,C=0,X=U,k=0;break;case"back_left":V=T,H=0,A=-s,C=0,X=-U,k=0;break;case"back_right":V=-i,H=0,A=-s,C=0,X=U,k=0;break;case"back_top":V=0,H=d,A=-s,C=U,X=0,k=0;break;case"back_bottom":V=0,H=-J,A=-s,C=-U,X=0,k=0;break;case"back_h":V=0,H=0,A=-s,C=U,X=0,k=0;break;case"back_v":V=0,H=0,A=-s,C=0,X=U,k=0;break;case"left_left":V=-i,H=0,A=-s,C=0,X=-U,k=0;break;case"left_right":V=-i,H=0,A=F,C=0,X=U,k=0;break;case"left_top":V=-i,H=d,A=0,C=0,X=0,k=-U;break;case"left_bottom":V=-i,H=-J,A=0,C=0,X=0,k=U;break;case"left_h":V=-i,H=0,A=0,C=0,X=0,k=U;break;case"left_v":V=-i,H=0,A=0,C=0,X=U,k=0;break;case"right_left":V=T,H=0,A=F,C=0,X=-U,k=0;break;case"right_right":V=T,H=0,A=-s,C=0,X=U,k=0;break;case"right_top":V=T,H=d,A=0,C=0,X=0,k=U;break;case"right_bottom":V=T,H=-J,A=0,C=0,X=0,k=-U;break;case"right_h":V=T,H=0,A=0,C=0,X=0,k=U;break;case"right_v":V=T,H=0,A=0,C=0,X=U,k=0;break;case"top_left":V=-i,H=d,A=0,C=0,X=0,k=U;break;case"top_right":V=T,H=d,A=0,C=0,X=0,k=-U;break;case"top_top":V=0,H=d,A=-s,C=-U,X=0,k=0;break;case"top_bottom":V=0,H=d,A=F,C=U,X=0,k=0;break;case"top_h":V=0,H=d,A=0,C=U,X=0,k=0;break;case"top_v":V=0,H=d,A=0,C=0,X=0,k=U;break;case"bottom_left":V=-i,H=-J,A=0,C=0,X=0,k=-U;break;case"bottom_right":V=T,H=-J,A=0,C=0,X=0,k=U;break;case"bottom_top":V=0,H=-J,A=F,C=-U,X=0,k=0;break;case"bottom_bottom":V=0,H=-J,A=-s,C=U,X=0,k=0;break;case"bottom_h":V=0,H=-J,A=0,C=U,X=0,k=0;break;case"bottom_v":V=0,H=-J,A=0,C=0,X=0,k=U}return I([{t3:[-V,-H,-A]},{r3:[C,X,k]},{t3:[V,H,A]}])}});var we=function(y,$,k,R,m){function i(){var b,v=[],r=new x,V=new x;for(G.eachShapeModel(function(I,_,y){for(var n=0,Q=_?_.length:I.length/3;Q>n;n++)_?(r.fromArray(I,3*_[n]),V.fromArray(y,3*_[n])):(r.fromArray(I,3*n),V.fromArray(y,3*n)),t(v,r,V)}),v=J(v,I.set(1,0,0)),v=J(v,I.set(-1,0,0)),v=J(v,I.set(0,1,0)),v=J(v,I.set(0,-1,0)),v=J(v,I.set(0,0,1)),v=J(v,I.set(0,0,-1)),b=0;b<v.length;b++){var j=v[b];g.push(.5+j.position.x/m.x,.5-j.position.y/m.y),j.position.applyMatrix4(P),X.push(j.position.x,j.position.y,j.position.z),Z.push(j.$22n.x,j.$22n.y,j.$22n.z)}}function t(O,F,d){F.applyMatrix4(E),F.applyMatrix4(l),d.transformDirection(E),d.transformDirection(l),O.push(new h(F.clone(),d.clone()))}function J(U,Z){for(var M=[],x=.5*Math.abs(m.dot(Z)),v=0;v<U.length;v+=3){var g,t,l,s,K,b,Y,S=0,n=U[v+0].position.dot(Z)-x,J=U[v+1].position.dot(Z)-x,f=U[v+2].position.dot(Z)-x;switch(g=n>0,t=J>0,l=f>0,S=(g?1:0)+(t?1:0)+(l?1:0)){case 0:M.push(U[v]),M.push(U[v+1]),M.push(U[v+2]);break;case 1:if(g&&(s=U[v+1],K=U[v+2],b=Q(U[v],s,Z,x),Y=Q(U[v],K,Z,x)),t){s=U[v],K=U[v+2],b=Q(U[v+1],s,Z,x),Y=Q(U[v+1],K,Z,x),M.push(b),M.push(K.clone()),M.push(s.clone()),M.push(K.clone()),M.push(b.clone()),M.push(Y);break}l&&(s=U[v],K=U[v+1],b=Q(U[v+2],s,Z,x),Y=Q(U[v+2],K,Z,x)),M.push(s.clone()),M.push(K.clone()),M.push(b),M.push(Y),M.push(b.clone()),M.push(K.clone());break;case 2:g||(s=U[v].clone(),K=Q(s,U[v+1],Z,x),b=Q(s,U[v+2],Z,x),M.push(s),M.push(K),M.push(b)),t||(s=U[v+1].clone(),K=Q(s,U[v+2],Z,x),b=Q(s,U[v],Z,x),M.push(s),M.push(K),M.push(b)),l||(s=U[v+2].clone(),K=Q(s,U[v],Z,x),b=Q(s,U[v+1],Z,x),M.push(s),M.push(K),M.push(b));break;case 3:}}return M}function Q(e,F,k,W){var b=e.position.dot(k)-W,V=F.position.dot(k)-W,T=b/(b-V),r=new h(new x(e.position.x+T*(F.position.x-e.position.x),e.position.y+T*(F.position.y-e.position.y),e.position.z+T*(F.position.z-e.position.z)),new x(e.$22n.x+T*(F.$22n.x-e.$22n.x),e.$22n.y+T*(F.$22n.y-e.$22n.y),e.$22n.z+T*(F.$22n.z-e.$22n.z)));return r}var X=[],Z=[],g=[],I=new x,G=y.getData3dUI($);if(G.mat){var E=(new H).fromArray(G.mat),v=new H;v.makeRotationFromEuler(R),v.setPosition(k);var l=(new H).getInverse(v),P=(new H).scale({x:1/m.x,y:1/m.y,z:1/m.z});return i(),{vs:X,ns:Z,uv:g}}};h.prototype.clone=function(){return new h(this.position.clone(),this.$22n.clone())};var Wf=function(S,Q,l,j){var D=this,C=D.getDataAt(S);if(C){var T=D.intersectObject(S,C);if(T){"object"==typeof Q?Q=Q.x?new x(Q.x,Q.y,Q.z):new x(Q[0],Q[1],Q[2]):(Q=Q||20,Q=new x(Q,Q,Q)),l=l===R?.1:l;var s=new x(D.getUp()),U=new x(D.getCenter()).sub(new x(D.getEye())).normalize(),z="cross",r=U.clone()[z](s).normalize();s.copy(r)[z](U).normalize(),j&&s.applyAxisAngle(T.worldNormal,-j);var m=new Y.Node,L=T.worldNormal.clone().setLength(l).add(T.world),h=(new H).lookAt(T.worldNormal.clone(),new x(0,0,0),s),X=(new q).setFromRotationMatrix(h),a=we(D,C,T.world.clone(),X,Q);return m.p3(L.x,L.y,L.z),m.setEuler(X),m.s3(Q.x,Q.y,Q.z),m.s({shape3d:a,"shape3d.reverse.flip":!0}),m}}};L(Y.graph3d.Graph3dView,{createDecal:Wf})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);