!function(b){"use strict";function n(P){var k,w,L,O,Y,c,Q,R=[],$=0;k=t.createDiv(),k.style.overflow="hidden";var E=P.getView();E.insertBefore(k,P.getCanvas()),w=I.Default.createDiv(),w.style.WebkitTransformStyle="preserve-3d",w.style.MozTransformStyle="preserve-3d",w.style.transformStyle="preserve-3d",k.appendChild(w),[{event:"mousedown",style:"none"},{event:"mouseup",style:"auto"},{event:"touchstart",style:"none"},{event:"touchend",style:"auto"}].forEach(function(v){var d=v.style;E.addEventListener(v.event,function(){k.style.pointerEvents=d})}),this.updateWebView=function(){var N=P.getCanvas(),H=1*N.style.width.slice(0,-2),b=1*N.style.height.slice(0,-2);(R[0]!==H||R[1]!==b)&&(R[0]=H,R[1]=b,k.style.width=H+"px",k.style.height=b+"px",w.style.width=H+"px",w.style.height=b+"px");var n=P._projectMatrix[5]*R[1]/2;n!==L&&(L=n,k.style.WebkitPerspective=L+"px",k.style.MozPerspective=L+"px",k.style.perspective=L+"px"),c="translateZ("+L+"px)"+l(P._viewMatrix);var B=c+"translate("+R[0]/2+"px,"+R[1]/2+"px)";O===B||Y||(w.style.WebkitTransform=B,w.style.MozTransform=B,w.style.transform=B,O=B),$++,Q=!1,P.dm().each(function(_){_.isWebView&&y(_)});for(var F,q=w.children,i=[],S=0,v=q.length;v>S;S++)F=q[S],F._isHtWebView&&F._renderCookie!==$&&i.push(F);i.length&&i.forEach(function(M){w.removeChild(M)})};var H=new Array(16),y=function(X){var j=X.getAttach();if(j){j.parentElement!==w&&w.appendChild(j),j._renderCookie=$,Q=!0;var n=X.getFinalScale3d(),A=X._prefrenceSize;A&&A[0]?A[1]||(A[1]=A[0]/n[0]*n[1]):A=[n[0],n[1]],j.style.width=A[0]+"px",j.style.height=A[1]+"px";var D=1/A[0],y=1/A[1],h=1,E=X.mat;H[0]=E[0]*D,H[1]=E[1]*D,H[2]=E[2]*D,H[3]=E[3]*D,H[4]=E[4]*y,H[5]=E[5]*y,H[6]=E[6]*y,H[7]=E[7]*y,H[8]=E[8]*h,H[9]=E[9]*h,H[10]=E[10]*h,H[11]=E[11]*h,H[12]=E[12],H[13]=E[13],H[14]=E[14],H[15]=E[15];var M=u(H,Y?"translate("+R[0]/2+"px,"+R[1]/2+"px)"+c:""),m=j.$a2;m!==M&&(j.$a2=M,j.style.WebkitTransform=M,j.style.MozTransform=M,j.style.transform=M)}}}function y(g){return Math.abs(g)<1e-10?0:g}function l(A){var i=A;return"matrix3d("+y(i[0])+","+y(-i[1])+","+y(i[2])+","+y(i[3])+","+y(i[4])+","+y(-i[5])+","+y(i[6])+","+y(i[7])+","+y(i[8])+","+y(-i[9])+","+y(i[10])+","+y(i[11])+","+y(i[12])+","+y(-i[13])+","+y(i[14])+","+y(i[15])+")"}function u(j,Y){var T=j,$="matrix3d("+y(T[0])+","+y(T[1])+","+y(T[2])+","+y(T[3])+","+y(-T[4])+","+y(-T[5])+","+y(-T[6])+","+y(-T[7])+","+y(T[8])+","+y(T[9])+","+y(T[10])+","+y(T[11])+","+y(T[12])+","+y(T[13])+","+y(T[14])+","+y(T[15])+")";return"translate(-50%,-50%)"+(Y||"")+$}var V="ht",I=b[V],t=I.Default,c=t.getInternal(),D=c.superCall,v=I.graph3d.Graph3dView,O=v.prototype.validateImpl;v.prototype.validateImpl=function(){O.call(this);var s=this._webViewRenderer;s||(s=this._webViewRenderer=new n(this)),s.updateWebView()};var h=I.WebView3d=function(){var P=this;D(h,P),P.s({shape3d:"billboard","shape3d.reverse.flip":!0})},_=[1,1,1,1],A=[0,0,0,0];t.def(V+"."+"WebView3d",I.Node,{ms_ac:["attach"],isWebView:!0,attachDOM:function(F,n,k){if(!F)return this.detachDOM();if("string"==typeof F){var K=document.createElement("iframe");K.src=F,F=K}var G=F.style;G.position="absolute",G.border=0,G.outline=0,G.padding=0,G.margin=0,F._isHtWebView=!0,this.setAttach(F),this._prefrenceSize=[n,k],this.s("shape3d.blend",A)},detachDOM:function(){this.setAttach(null),this.s("shape3d.blend",this.getBgColor())},setBgColor:function(k){this.a("defaultBgColor",k),this.getAttach()||this.s("shape3d.blend",k)},getBgColor:function(){return this.a("defaultBgColor")||_}})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);