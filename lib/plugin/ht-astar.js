!function(V,Y,J){"use strict";var w=V.ht;w.Astar={},function(E){var i=E();V.AStar=i.astar,V.AStar.Graph=i.Graph}(function(){function Q(d){for(var k=d,o=[];k.parent;)o.unshift(k),k=k.parent;return o}function t(){return new K(function(N){return N.f})}function M(t,h){h=h||{},this.nodes=[],this.diagonal=!!h.diagonal,this.grid=[];for(var T=0;T<t.length;T++){this.grid[T]=[];for(var H=0,j=t[T];H<j.length;H++){var $=new m(T,H,j[H]);this.grid[T][H]=$,this.nodes.push($)}}this.$13x()}function m(D,x,K){this.x=D,this.y=x,this.weight=K}function K(T){this.content=[],this.scoreFunction=T}var p={search:function(P,A,n,k){P.$6x(),k=k||{};var i=k.heuristic;i||(i=P.diagonal?p.$4x.diagonal:p.$4x.manhattan);var u=k.closest||!1,l=k.punish,e=t(),w=A;for(A.h=i(A,n),P.$7x(A),e.push(A);e.size()>0;){var c=e.pop();if(c===n)return Q(c);c.closed=!0;for(var X=P.neighbors(c),m=0,W=X.length;W>m;++m){var C=X[m];if(!C.closed&&!C.$9x()){var b=c.g+C.getCost(c,l),F=C.visited;(!F||b<C.g)&&(C.visited=!0,C.parent=c,C.h=C.h||i(C,n),C.g=b,C.f=C.g+C.h,P.$7x(C),u&&(C.h<w.h||C.h===w.h&&C.g<w.g)&&(w=C),F?e.$10x(C):e.push(C))}}}return u?Q(w):[]},$4x:{manhattan:function(v,T){var w=Math.abs(T.x-v.x),z=Math.abs(T.y-v.y);return w+z},diagonal:function(o,w){var Z=1,v=Math.sqrt(2),H=Math.abs(w.x-o.x),B=Math.abs(w.y-o.y);return Z*(H+B)+(v-2*Z)*Math.min(H,B)}},$5x:function(T){T.f=0,T.g=0,T.h=0,T.visited=!1,T.closed=!1,T.parent=null}};return M.prototype.$13x=function(){this.dirtyNodes=[];for(var Y=0;Y<this.nodes.length;Y++)p.$5x(this.nodes[Y])},M.prototype.$6x=function(){for(var i=0;i<this.dirtyNodes.length;i++)p.$5x(this.dirtyNodes[i]);this.dirtyNodes=[]},M.prototype.$7x=function(W){this.dirtyNodes.push(W)},M.prototype.neighbors=function(h){var B=[],j=h.x,P=h.y,T=this.grid;return T[j-1]&&T[j-1][P]&&B.push(T[j-1][P]),T[j+1]&&T[j+1][P]&&B.push(T[j+1][P]),T[j]&&T[j][P-1]&&B.push(T[j][P-1]),T[j]&&T[j][P+1]&&B.push(T[j][P+1]),this.diagonal&&(T[j-1]&&T[j-1][P-1]&&B.push(T[j-1][P-1]),T[j+1]&&T[j+1][P-1]&&B.push(T[j+1][P-1]),T[j-1]&&T[j-1][P+1]&&B.push(T[j-1][P+1]),T[j+1]&&T[j+1][P+1]&&B.push(T[j+1][P+1])),B},M.prototype.toString=function(){for(var O=[],P=this.grid,s=0;s<P.length;s++){for(var g=[],k=P[s],A=0;A<k.length;A++)g.push(k[A].weight);O.push(g.join(" "))}return O.join("\n")},m.prototype.toString=function(){return"["+this.x+" "+this.y+"]"},m.prototype.getCost=function(w,o){var B;if(B=w&&w.x!=this.x&&w.y!=this.y?1.41421*this.weight:this.weight,o){var U=w;if(!U)return B;var G=U.parent;return G?Math.abs(G.x+this.x-2*U.x)>1e-5?B+o:Math.abs(G.y+this.y-2*U.y)>1e-5?B+o:B:B}},m.prototype.$9x=function(){return 0===this.weight},K.prototype={push:function(D){this.content.push(D),this.$11x(this.content.length-1)},pop:function(){var k=this.content[0],D=this.content.pop();return this.content.length>0&&(this.content[0]=D,this.$12x(0)),k},remove:function(p){var j=this.content.indexOf(p),q=this.content.pop();j!==this.content.length-1&&(this.content[j]=q,this.scoreFunction(q)<this.scoreFunction(p)?this.$11x(j):this.$12x(j))},size:function(){return this.content.length},$10x:function(d){this.$11x(this.content.indexOf(d))},$11x:function(V){for(var q=this.content[V];V>0;){var J=(V+1>>1)-1,b=this.content[J];if(!(this.scoreFunction(q)<this.scoreFunction(b)))break;this.content[J]=q,this.content[V]=b,V=J}},$12x:function(k){for(var I=this.content.length,v=this.content[k],p=this.scoreFunction(v);;){var V,Z=k+1<<1,b=Z-1,G=null;if(I>b){var C=this.content[b];V=this.scoreFunction(C),p>V&&(G=b)}if(I>Z){var $=this.content[Z],M=this.scoreFunction($);(null===G?p:V)>M&&(G=Z)}if(null===G)break;this.content[k]=this.content[G],this.content[G]=v,k=G}}},{astar:p,Graph:M}});var S=w.Astar.Finder=function(d,t){var I=this;I.gv=d,I.$13x(t),I.refreshMap()};S.prototype={},S.prototype.constructor=S,Y.defineProperties(S.prototype,{_debugInfo:{get:function(){return this.gv._astarDebugInfo},set:function(h){this.gv._astarDebugInfo=h}}}),S.prototype.$13x=function(P){var a=this,w=a.$14x={};P=P||{};var p=P.gridSize||10;w.gridSizeX=P.gridSizeX||p,w.gridSizeY=P.gridSizeY||p,w.rect=P.rect,w.filter=P.filter,w.extendBlocks=P.extendBlocks||3,w.fastOverlap=P.fastOverlap===J?!0:P.fastOverlap,w.nodeRectExtend=P.nodeRectExtend||0,w.diagonal=P.diagonal===J?!0:P.diagonal,w.turnPunish=P.turnPunish===J?.1:P.turnPunish,w.simplify=P.simplify===J?!0:P.simplify,w.toGridCenter=P.toGridCenter===J?!1:P.toGridCenter,w.closest=P.closest===J?!0:P.closest},S.prototype.refreshMap=function(){var B,N=this,z=N.$14x,A=z.gridSizeX,v=z.gridSizeY,c=z.extendBlocks;z.rect?B=z.rect:(B=N.$15x(),w.Default.grow(B,A*c,v*c)),w.Default.grow(B,A,v);var g=Math.floor(B.x/A)*A,Q=Math.floor(B.y/v)*v,x=Math.ceil(B.width/A),G=Math.ceil(B.height/v),Y=x*A,d=G*v;N.$16x={x:g,y:Q,w:Y,h:d,gridX:A,gridY:v,xLen:x,yLen:G},N.$17x(),N.$21x()},S.prototype.$15x=function(){var D=this.gv;if(D instanceof w.graph.GraphView)return D.getContentRect();var I,x=w.Default.unionRect;return D.dm().each(function(Q){D.isVisible(Q)&&Q.getRect&&(I=x(I,Q.getRect()))}),I},S.prototype.$17x=function(){var K,o,x,V,Q=this,i=Q.$16x,n=i.xLen,v=i.yLen;for(K=new Array(n),x=0;n>x;x++)for(K[x]=o=new Array(v),V=v;V--;)o[V]=1;var X=Q.$14x.filter;for(Q.gv.dm().each(function(A){X&&X(A)===!1||(!Q._debugInfo||A!==Q._debugInfo.grid&&A!=Q._debugInfo.path)&&Q.$1cw(K,A)}),x=0;n>x;x++)K[x][0]=1,K[x][v-1]=1;for(V=0;v>V;V++)K[0][V]=1,K[n-1][V]=1;Q.grid=K;var c=new AStar.Graph(K,{diagonal:Q.$14x.diagonal});Q.graph=c},S.prototype.$18x=function(K,h,y,A,B,C,w,u){var q=this.$19x,P=q(y-K,B-w,A-h,C-u);if(1e-6>=P&&P>=-1e-6)return!1;var l=q(B-K,B-w,C-h,C-u)/P;if(0>l||l>1)return!1;var n=q(y-K,B-K,A-h,C-h)/P;return 0>n||n>1?!1:!0},S.prototype.$19x=function(K,o,c,O){return K*O-o*c},S.prototype.$1aw=function(Y,J,s,f){for(var u=[-(J[1]-Y[1]),J[0]-Y[0]],c=u[0]*(s[0]-Y[0])+u[1]*(s[1]-Y[1])>=0,D=0,h=f.length;h>D;D+=2)if(u[0]*(f[D]-Y[0])+u[1]*(f[D+1]-Y[1])>=0===c)return!1;return!0},S.prototype.$1bw=function(C,r){for(var o,y,O=this,M=0,f=C.length;f>M;M+=2)if(o=M===f-2?0:M+2,y=o===f-2?0:o+2,O.$1aw([C[M],C[M+1]],[C[o],C[o+1]],[C[y],C[y+1]],r))return!1;for(var M=0,f=r.length;f>M;M+=2)if(o=M===f-2?0:M+2,y=o===f-2?0:o+2,O.$1aw([r[M],r[M+1]],[r[o],r[o+1]],[r[y],r[y+1]],C))return!1;return!0},S.prototype.$1cw=function(o,e){if(e.getRect){var y=this,k=e.getRect();w.Default.grow(k,y.$14x.nodeRectExtend);var t,d,Z,E,m,h,r,u,g,A,O,$=y.$1dw({x:k.x,y:k.y}),N=y.$1dw({x:k.x+k.width,y:k.y+k.height}),v=y.$14x.fastOverlap;if(!v){var q=e.getCorners();r=[],q.forEach(function(T){r.push(T.x,T.y)}),A=y.$14x.gridSizeX/2,O=y.$14x.gridSizeY/2}for(d=Math.max(0,$.x),Z=Math.min(N.x,o.length-1),m=Math.max(0,$.y),h=Math.min(N.y,o.length?o[0].length-1:-1),t=d;Z>=t;t++)for(E=m;h>=E;E++)if(v)o[t][E]=0;else{g=y.$1ew({x:t,y:E});var W=g.x-A,P=g.x+A,a=g.y-O,H=g.y+O;u=[W,a,W,H,P,H,P,a],y.$1bw(r,u)&&(o[t][E]=0)}}},S.prototype.$1dw=function(r,Y){var O=this,h=O.$16x,G=(r.x-h.x)/h.gridX,I=(r.y-h.y)/h.gridY;return Y!==!1&&(G=Math.round(G),I=Math.round(I)),{x:G,y:I}},S.prototype.$1ew=function(y){var P=this,X=P.$16x;return{x:y.x*X.gridX+X.x,y:y.y*X.gridY+X.y}},S.prototype.$1fw=function(H){var f=this,l=f.$16x,P=l.xLen,h=l.yLen;if(H.x>=0&&H.x<P&&H.y>=0&&H.y<h)return H;var V={x:H.x,y:H.y};return V.x<0?V.x=0:V.x>=P&&(V.x=P-1),V.y<0?V.y=0:V.y>=h&&(V.y=h-1),V},S.prototype.findPath=function(x,d){var o,b,e,f,F=this,H=F.$1dw(x),g=F.$1dw(d);if(e=F.$1fw(H),f=F.$1fw(g),e!==H&&f!==g){var G=F.$16x,w=G.x-G.gridX/2,c=G.y-G.gridY/2,i=w+G.gridX*G.xLen,m=c+G.gridY*G.yLen;if(!(F.$18x(x.x,x.y,d.x,d.y,w,c,i,c)||F.$18x(x.x,x.y,d.x,d.y,i,c,i,m)||F.$18x(x.x,x.y,d.x,d.y,i,m,w,m)||F.$18x(x.x,x.y,d.x,d.y,w,m,w,c)))return[x,d]}e!==H&&(o=!0,H=e),f!==g&&(b=!0,g=f);var v=F.graph.grid[H.x][H.y],n=F.graph.grid[g.x][g.y],L=AStar.search(F.graph,v,n,{closest:F.$14x.closest,punish:F.$14x.turnPunish});if(!L||!L.length)return null;var R=[];R.push(x),o&&R.push(F.$1ew(L[0]));for(var l=1,X=L.length;X-1>l;l++)R.push(F.$1ew(L[l]));if(b)R.push(F.$1ew(L[X-1])),R.push(d);else{var $=L[X-1];g.x!==$.x||g.y!==$.y||F.$14x.toGridCenter?R.push(F.$1ew($)):R.push(d)}return F.$14x.simplify&&(R=F.simplifyPath(R)),F.$20x=R,F.$21x(),R},S.prototype.debugOn=function(H){this.debugFlag=!0,this.debugSettings=H||{},this.$21x()},S.prototype.simplifyPath=function(c){var E=c.length;if(2>=E)return c;var r,O,v=[c[0],c[1]],z=v[0],G=v[1],I=1e-5;for(r=2;E>r;r++)O=c[r],Math.abs((G.x-z.x)*(O.y-z.y)-(G.y-z.y)*(O.x-z.x))<I?G=v[v.length-1]=O:(z=G,G=O,v.push(O));return v},S.prototype.$21x=function(){var r=this;if(r.$22x(),this.debugFlag){var O=r.grid;if(O){var x,A=r.gv;if(r.debugSettings.$16x!==!1){x=[];for(var M,o,H,q,u,h=[],Z=r.$14x.gridSizeX/2,t=r.$14x.gridSizeY/2,P=O.length,Q=P?O[0].length:0,W=1;P-1>W;W++)for(var N=1;Q-1>N;N++)O[W][N]||(M=r.$1ew({x:W,y:N}),o=M.x-Z,H=M.x+Z,q=M.y-t,u=M.y+t,x.push({x:o,y:q},{x:o,y:u},{x:H,y:u},{x:H,y:q}),h.push(1,2,2,2,5));var T=new w.Shape;T.s("shape.border.color","rgba(50, 50, 50, 0.2)"),T.s("shape.border.width",1),T.s("shape.background","rgba(200, 50, 100, 0.2)"),T.s("2d.editable",!1),T.s("2d.selectable",!1),T.setPoints(x),T.setSegments(h),r._debugInfo={grid:T},A.dm().add(T)}r.debugSettings.path!==!1&&(x=new w.Shape,r.$20x&&(x.setPoints(r.$20x),x.s("shape.border.color","red"),x.s("shape.border.width",1),x.s("2d.editable",!1),x.s("2d.selectable",!1),x.s("shape.background",null),r._debugInfo||(r._debugInfo={}),r._debugInfo.path=x,A.dm().add(x)))}}},S.prototype.debugOff=function(){this.debugFlag=!1,this.$22x()},S.prototype.$22x=function(){var o=this;if(o._debugInfo){var j=o._debugInfo.grid,Q=o._debugInfo.path,M=o.gv;j&&M.dm().remove(j),Q&&M.dm().remove(Q),o._debugInfo=null}}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);