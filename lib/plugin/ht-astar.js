!function(y,c,e){"use strict";var N=y.ht;N.Astar={},function(x){var F=x();y.AStar=F.astar,y.AStar.Graph=F.Graph}(function(){function A(U){for(var W=U,f=[];W.parent;)f.unshift(W),W=W.parent;return f}function w(){return new Y(function(y){return y.f})}function Z(p,q){q=q||{},this.nodes=[],this.diagonal=!!q.diagonal,this.grid=[];for(var l=0;l<p.length;l++){this.grid[l]=[];for(var A=0,$=p[l];A<$.length;A++){var L=new S(l,A,$[A]);this.grid[l][A]=L,this.nodes.push(L)}}this.$13x()}function S(N,l,J){this.x=N,this.y=l,this.weight=J}function Y(V){this.content=[],this.scoreFunction=V}var d={search:function(r,y,j,V){r.$6x(),V=V||{};var S=V.heuristic;S||(S=r.diagonal?d.$4x.diagonal:d.$4x.manhattan);var D=V.closest||!1,m=V.punish,z=w(),n=y;for(y.h=S(y,j),r.$7x(y),z.push(y);z.size()>0;){var N=z.pop();if(N===j)return A(N);N.closed=!0;for(var G=r.neighbors(N),f=0,C=G.length;C>f;++f){var b=G[f];if(!b.closed&&!b.$9x()){var H=N.g+b.getCost(N,m),B=b.visited;(!B||H<b.g)&&(b.visited=!0,b.parent=N,b.h=b.h||S(b,j),b.g=H,b.f=b.g+b.h,r.$7x(b),D&&(b.h<n.h||b.h===n.h&&b.g<n.g)&&(n=b),B?z.$10x(b):z.push(b))}}}return D?A(n):[]},$4x:{manhattan:function(P,j){var M=Math.abs(j.x-P.x),J=Math.abs(j.y-P.y);return M+J},diagonal:function(B,m){var O=1,Z=Math.sqrt(2),D=Math.abs(m.x-B.x),j=Math.abs(m.y-B.y);return O*(D+j)+(Z-2*O)*Math.min(D,j)}},$5x:function(k){k.f=0,k.g=0,k.h=0,k.visited=!1,k.closed=!1,k.parent=null}};return Z.prototype.$13x=function(){this.dirtyNodes=[];for(var p=0;p<this.nodes.length;p++)d.$5x(this.nodes[p])},Z.prototype.$6x=function(){for(var j=0;j<this.dirtyNodes.length;j++)d.$5x(this.dirtyNodes[j]);this.dirtyNodes=[]},Z.prototype.$7x=function(h){this.dirtyNodes.push(h)},Z.prototype.neighbors=function(c){var O=[],t=c.x,k=c.y,B=this.grid;return B[t-1]&&B[t-1][k]&&O.push(B[t-1][k]),B[t+1]&&B[t+1][k]&&O.push(B[t+1][k]),B[t]&&B[t][k-1]&&O.push(B[t][k-1]),B[t]&&B[t][k+1]&&O.push(B[t][k+1]),this.diagonal&&(B[t-1]&&B[t-1][k-1]&&O.push(B[t-1][k-1]),B[t+1]&&B[t+1][k-1]&&O.push(B[t+1][k-1]),B[t-1]&&B[t-1][k+1]&&O.push(B[t-1][k+1]),B[t+1]&&B[t+1][k+1]&&O.push(B[t+1][k+1])),O},Z.prototype.toString=function(){for(var Q=[],L=this.grid,p=0;p<L.length;p++){for(var w=[],a=L[p],k=0;k<a.length;k++)w.push(a[k].weight);Q.push(w.join(" "))}return Q.join("\n")},S.prototype.toString=function(){return"["+this.x+" "+this.y+"]"},S.prototype.getCost=function(Q,W){var i;if(i=Q&&Q.x!=this.x&&Q.y!=this.y?1.41421*this.weight:this.weight,W){var u=Q;if(!u)return i;var q=u.parent;if(!q)return i;if(Math.abs(q.x+this.x-2*u.x)>1e-5)return i+W;if(Math.abs(q.y+this.y-2*u.y)>1e-5)return i+W}return i},S.prototype.$9x=function(){return 0===this.weight},Y.prototype={push:function(z){this.content.push(z),this.$11x(this.content.length-1)},pop:function(){var e=this.content[0],p=this.content.pop();return this.content.length>0&&(this.content[0]=p,this.$12x(0)),e},remove:function(N){var L=this.content.indexOf(N),B=this.content.pop();L!==this.content.length-1&&(this.content[L]=B,this.scoreFunction(B)<this.scoreFunction(N)?this.$11x(L):this.$12x(L))},size:function(){return this.content.length},$10x:function(i){this.$11x(this.content.indexOf(i))},$11x:function(O){for(var F=this.content[O];O>0;){var I=(O+1>>1)-1,s=this.content[I];if(!(this.scoreFunction(F)<this.scoreFunction(s)))break;this.content[I]=F,this.content[O]=s,O=I}},$12x:function(m){for(var X=this.content.length,T=this.content[m],r=this.scoreFunction(T);;){var K,A=m+1<<1,g=A-1,E=null;if(X>g){var V=this.content[g];K=this.scoreFunction(V),r>K&&(E=g)}if(X>A){var u=this.content[A],R=this.scoreFunction(u);(null===E?r:K)>R&&(E=A)}if(null===E)break;this.content[m]=this.content[E],this.content[E]=T,m=E}}},{astar:d,Graph:Z}});var W=N.Astar.Finder=function(d,_){var B=this;B.gv=d,B.$13x(_),B.refreshMap()};W.prototype={},W.prototype.constructor=W,c.defineProperties(W.prototype,{_debugInfo:{get:function(){return this.gv._astarDebugInfo},set:function(r){this.gv._astarDebugInfo=r}}}),W.prototype.$13x=function(U){var J=this,g=J.$14x={};U=U||{};var h=U.gridSize||10;g.gridSizeX=U.gridSizeX||h,g.gridSizeY=U.gridSizeY||h,g.rect=U.rect,g.filter=U.filter,g.extendBlocks=U.extendBlocks||3,g.fastOverlap=U.fastOverlap===e?!0:U.fastOverlap,g.nodeRectExtend=U.nodeRectExtend||0,g.diagonal=U.diagonal===e?!0:U.diagonal,g.turnPunish=U.turnPunish===e?.1:U.turnPunish,g.simplify=U.simplify===e?!0:U.simplify,g.toGridCenter=U.toGridCenter===e?!1:U.toGridCenter,g.closest=U.closest===e?!0:U.closest},W.prototype.refreshMap=function(){var Y,s=this,G=s.$14x,r=G.gridSizeX,T=G.gridSizeY,v=G.extendBlocks;G.rect?Y=G.rect:(Y=s.$15x(),N.Default.grow(Y,r*v,T*v)),N.Default.grow(Y,r,T);var p=Math.floor(Y.x/r)*r,H=Math.floor(Y.y/T)*T,W=Math.ceil(Y.width/r),A=Math.ceil(Y.height/T),F=W*r,$=A*T;s.$16x={x:p,y:H,w:F,h:$,gridX:r,gridY:T,xLen:W,yLen:A},s.$17x(),s.$21x()},W.prototype.$15x=function(){var S=this.gv;if(S instanceof N.graph.GraphView)return S.getContentRect();var G,J=N.Default.unionRect;return S.dm().each(function(N){S.isVisible(N)&&N.getRect&&(G=J(G,N.getRect()))}),G},W.prototype.$17x=function(){var M,A,w,j,k=this,J=k.$16x,D=J.xLen,B=J.yLen;for(M=new Array(D),w=0;D>w;w++)for(M[w]=A=new Array(B),j=B;j--;)A[j]=1;var p=k.$14x.filter;for(k.gv.dm().each(function(N){p&&p(N)===!1||(!k._debugInfo||N!==k._debugInfo.grid&&N!=k._debugInfo.path)&&k.$1cw(M,N)}),w=0;D>w;w++)M[w][0]=1,M[w][B-1]=1;for(j=0;B>j;j++)M[0][j]=1,M[D-1][j]=1;k.grid=M;var m=new AStar.Graph(M,{diagonal:k.$14x.diagonal});k.graph=m},W.prototype.$18x=function(Z,$,l,q,r,i,y,D){var H=this.$19x,b=H(l-Z,r-y,q-$,i-D);if(1e-6>=b&&b>=-1e-6)return!1;var m=H(r-Z,r-y,i-$,i-D)/b;if(0>m||m>1)return!1;var V=H(l-Z,r-Z,q-$,i-$)/b;return 0>V||V>1?!1:!0},W.prototype.$19x=function(i,K,I,G){return i*G-K*I},W.prototype.$1aw=function(k,B,W,S){for(var U=[-(B[1]-k[1]),B[0]-k[0]],q=U[0]*(W[0]-k[0])+U[1]*(W[1]-k[1])>=0,$=0,R=S.length;R>$;$+=2)if(U[0]*(S[$]-k[0])+U[1]*(S[$+1]-k[1])>=0===q)return!1;return!0},W.prototype.$1bw=function(S,Z){for(var O,W,Y=this,T=0,P=S.length;P>T;T+=2)if(O=T===P-2?0:T+2,W=O===P-2?0:O+2,Y.$1aw([S[T],S[T+1]],[S[O],S[O+1]],[S[W],S[W+1]],Z))return!1;for(var T=0,P=Z.length;P>T;T+=2)if(O=T===P-2?0:T+2,W=O===P-2?0:O+2,Y.$1aw([Z[T],Z[T+1]],[Z[O],Z[O+1]],[Z[W],Z[W+1]],S))return!1;return!0},W.prototype.$1cw=function(P,u){if(u.getRect){var C=this,e=u.getRect();N.Default.grow(e,C.$14x.nodeRectExtend);var M,b,r,B,I,s,S,H,G,h,o,l=C.$1dw({x:e.x,y:e.y}),n=C.$1dw({x:e.x+e.width,y:e.y+e.height}),A=C.$14x.fastOverlap;if(!A){var D=u.getCorners();S=[],D.forEach(function(H){S.push(H.x,H.y)}),h=C.$14x.gridSizeX/2,o=C.$14x.gridSizeY/2}for(b=Math.max(0,l.x),r=Math.min(n.x,P.length-1),I=Math.max(0,l.y),s=Math.min(n.y,P.length?P[0].length-1:-1),M=b;r>=M;M++)for(B=I;s>=B;B++)if(A)P[M][B]=0;else{G=C.$1ew({x:M,y:B});var d=G.x-h,x=G.x+h,i=G.y-o,k=G.y+o;H=[d,i,d,k,x,k,x,i],C.$1bw(S,H)&&(P[M][B]=0)}}},W.prototype.$1dw=function(D,j){var E=this,v=E.$16x,L=(D.x-v.x)/v.gridX,O=(D.y-v.y)/v.gridY;return j!==!1&&(L=Math.round(L),O=Math.round(O)),{x:L,y:O}},W.prototype.$1ew=function(M){var V=this,f=V.$16x;return{x:M.x*f.gridX+f.x,y:M.y*f.gridY+f.y}},W.prototype.$1fw=function(p){var X=this,j=X.$16x,c=j.xLen,Y=j.yLen;if(p.x>=0&&p.x<c&&p.y>=0&&p.y<Y)return p;var o={x:p.x,y:p.y};return o.x<0?o.x=0:o.x>=c&&(o.x=c-1),o.y<0?o.y=0:o.y>=Y&&(o.y=Y-1),o},W.prototype.findPath=function(Y,G){var Q,c,m,v,W=this,M=W.$1dw(Y),K=W.$1dw(G);if(m=W.$1fw(M),v=W.$1fw(K),m!==M&&v!==K){var P=W.$16x,C=P.x-P.gridX/2,O=P.y-P.gridY/2,a=C+P.gridX*P.xLen,e=O+P.gridY*P.yLen;if(!(W.$18x(Y.x,Y.y,G.x,G.y,C,O,a,O)||W.$18x(Y.x,Y.y,G.x,G.y,a,O,a,e)||W.$18x(Y.x,Y.y,G.x,G.y,a,e,C,e)||W.$18x(Y.x,Y.y,G.x,G.y,C,e,C,O)))return[Y,G]}m!==M&&(Q=!0,M=m),v!==K&&(c=!0,K=v);var D=W.graph.grid[M.x][M.y],_=W.graph.grid[K.x][K.y],x=AStar.search(W.graph,D,_,{closest:W.$14x.closest,punish:W.$14x.turnPunish});if(!x||!x.length)return null;var H=[];H.push(Y),Q&&H.push(W.$1ew(x[0]));for(var q=1,d=x.length;d-1>q;q++)H.push(W.$1ew(x[q]));if(c)H.push(W.$1ew(x[d-1])),H.push(G);else{var y=x[d-1];K.x!==y.x||K.y!==y.y||W.$14x.toGridCenter?H.push(W.$1ew(y)):H.push(G)}return W.$14x.simplify&&(H=W.simplifyPath(H)),W.$20x=H,W.$21x(),H},W.prototype.debugOn=function(X){this.debugFlag=!0,this.debugSettings=X||{},this.$21x()},W.prototype.simplifyPath=function(l){var e=l.length;if(2>=e)return l;var m,U,b=[l[0],l[1]],B=b[0],f=b[1],g=1e-5;for(m=2;e>m;m++)U=l[m],Math.abs((f.x-B.x)*(U.y-B.y)-(f.y-B.y)*(U.x-B.x))<g?f=b[b.length-1]=U:(B=f,f=U,b.push(U));return b},W.prototype.$21x=function(){var l=this;if(l.$22x(),this.debugFlag){var k=l.grid;if(k){var s,E=l.gv;if(l.debugSettings.$16x!==!1){s=[];for(var i,X,d,z,A,f=[],P=l.$14x.gridSizeX/2,W=l.$14x.gridSizeY/2,C=k.length,y=C?k[0].length:0,Y=1;C-1>Y;Y++)for(var I=1;y-1>I;I++)k[Y][I]||(i=l.$1ew({x:Y,y:I}),X=i.x-P,d=i.x+P,z=i.y-W,A=i.y+W,s.push({x:X,y:z},{x:X,y:A},{x:d,y:A},{x:d,y:z}),f.push(1,2,2,2,5));var V=new N.Shape;V.s("shape.border.color","rgba(50, 50, 50, 0.2)"),V.s("shape.border.width",1),V.s("shape.background","rgba(200, 50, 100, 0.2)"),V.s("2d.editable",!1),V.s("2d.selectable",!1),V.setPoints(s),V.setSegments(f),l._debugInfo={grid:V},E.dm().add(V)}l.debugSettings.path!==!1&&(s=new N.Shape,l.$20x&&(s.setPoints(l.$20x),s.s("shape.border.color","red"),s.s("shape.border.width",1),s.s("2d.editable",!1),s.s("2d.selectable",!1),s.s("shape.background",null),l._debugInfo||(l._debugInfo={}),l._debugInfo.path=s,E.dm().add(s)))}}},W.prototype.debugOff=function(){this.debugFlag=!1,this.$22x()},W.prototype.$22x=function(){var e=this;if(e._debugInfo){var s=e._debugInfo.grid,t=e._debugInfo.path,n=e.gv;s&&n.dm().remove(s),t&&n.dm().remove(t),e._debugInfo=null}}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);